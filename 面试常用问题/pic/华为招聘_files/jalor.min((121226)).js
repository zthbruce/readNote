/*! jQuery v1.10.2 | (c) 2005, 2013 jQuery Foundation, Inc. | jquery.org/license
//@ sourceMappingURL=jquery-1.10.2.min.map
*/
(function(e,t){var n,r,i=typeof t,o=e.location,a=e.document,s=a.documentElement,l=e.jQuery,u=e.$,c={},p=[],f="1.10.2",d=p.concat,h=p.push,g=p.slice,m=p.indexOf,y=c.toString,v=c.hasOwnProperty,b=f.trim,x=function(e,t){return new x.fn.init(e,t,r)},w=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,T=/\S+/g,C=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,N=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,k=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,E=/^[\],:{}\s]*$/,S=/(?:^|:|,)(?:\s*\[)+/g,A=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,j=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,D=/^-ms-/,L=/-([\da-z])/gi,H=function(e,t){return t.toUpperCase()},q=function(e){(a.addEventListener||"load"===e.type||"complete"===a.readyState)&&(_(),x.ready())},_=function(){a.addEventListener?(a.removeEventListener("DOMContentLoaded",q,!1),e.removeEventListener("load",q,!1)):(a.detachEvent("onreadystatechange",q),e.detachEvent("onload",q))};x.fn=x.prototype={jquery:f,constructor:x,init:function(e,n,r){var i,o;if(!e){return this}if("string"==typeof e){if(i="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:N.exec(e),!i||!i[1]&&n){return !n||n.jquery?(n||r).find(e):this.constructor(n).find(e)}if(i[1]){if(n=n instanceof x?n[0]:n,x.merge(this,x.parseHTML(i[1],n&&n.nodeType?n.ownerDocument||n:a,!0)),k.test(i[1])&&x.isPlainObject(n)){for(i in n){x.isFunction(this[i])?this[i](n[i]):this.attr(i,n[i])}}return this}if(o=a.getElementById(i[2]),o&&o.parentNode){if(o.id!==i[2]){return r.find(e)}this.length=1,this[0]=o}return this.context=a,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):x.isFunction(e)?r.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),x.makeArray(e,this))},selector:"",length:0,toArray:function(){return g.call(this)},get:function(e){return null==e?this.toArray():0>e?this[this.length+e]:this[e]},pushStack:function(e){var t=x.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return x.each(this,e,t)},ready:function(e){return x.ready.promise().done(e),this},slice:function(){return this.pushStack(g.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(0>e?t:0);return this.pushStack(n>=0&&t>n?[this[n]]:[])},map:function(e){return this.pushStack(x.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:h,sort:[].sort,splice:[].splice},x.fn.init.prototype=x.fn,x.extend=x.fn.extend=function(){var e,n,r,i,o,a,s=arguments[0]||{},l=1,u=arguments.length,c=!1;for("boolean"==typeof s&&(c=s,s=arguments[1]||{},l=2),"object"==typeof s||x.isFunction(s)||(s={}),u===l&&(s=this,--l);u>l;l++){if(null!=(o=arguments[l])){for(i in o){e=s[i],r=o[i],s!==r&&(c&&r&&(x.isPlainObject(r)||(n=x.isArray(r)))?(n?(n=!1,a=e&&x.isArray(e)?e:[]):a=e&&x.isPlainObject(e)?e:{},s[i]=x.extend(c,a,r)):r!==t&&(s[i]=r))}}}return s},x.extend({expando:"jQuery"+(f+Math.random()).replace(/\D/g,""),noConflict:function(t){return e.$===x&&(e.$=u),t&&e.jQuery===x&&(e.jQuery=l),x},isReady:!1,readyWait:1,holdReady:function(e){e?x.readyWait++:x.ready(!0)},ready:function(e){if(e===!0?!--x.readyWait:!x.isReady){if(!a.body){return setTimeout(x.ready)}x.isReady=!0,e!==!0&&--x.readyWait>0||(n.resolveWith(a,[x]),x.fn.trigger&&x(a).trigger("ready").off("ready"))}},isFunction:function(e){return"function"===x.type(e)},isArray:Array.isArray||function(e){return"array"===x.type(e)},isWindow:function(e){return null!=e&&e==e.window},isNumeric:function(e){return !isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?c[y.call(e)]||"object":typeof e},isPlainObject:function(e){var n;if(!e||"object"!==x.type(e)||e.nodeType||x.isWindow(e)){return !1}try{if(e.constructor&&!v.call(e,"constructor")&&!v.call(e.constructor.prototype,"isPrototypeOf")){return !1}}catch(r){return !1}if(x.support.ownLast){for(n in e){return v.call(e,n)}}for(n in e){}return n===t||v.call(e,n)},isEmptyObject:function(e){var t;for(t in e){return !1}return !0},error:function(e){throw Error(e)},parseHTML:function(e,t,n){if(!e||"string"!=typeof e){return null}"boolean"==typeof t&&(n=t,t=!1),t=t||a;var r=k.exec(e),i=!n&&[];return r?[t.createElement(r[1])]:(r=x.buildFragment([e],t,i),i&&x(i).remove(),x.merge([],r.childNodes))},parseJSON:function(n){return e.JSON&&e.JSON.parse?e.JSON.parse(n):null===n?n:"string"==typeof n&&(n=x.trim(n),n&&E.test(n.replace(A,"@").replace(j,"]").replace(S,"")))?Function("return "+n)():(x.error("Invalid JSON: "+n),t)},parseXML:function(n){var r,i;if(!n||"string"!=typeof n){return null}try{e.DOMParser?(i=new DOMParser,r=i.parseFromString(n,"text/xml")):(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(n))}catch(o){r=t}return r&&r.documentElement&&!r.getElementsByTagName("parsererror").length||x.error("Invalid XML: "+n),r},noop:function(){},globalEval:function(t){t&&x.trim(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(D,"ms-").replace(L,H)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r,i=0,o=e.length,a=M(e);if(n){if(a){for(;o>i;i++){if(r=t.apply(e[i],n),r===!1){break}}}else{for(i in e){if(r=t.apply(e[i],n),r===!1){break}}}}else{if(a){for(;o>i;i++){if(r=t.call(e[i],i,e[i]),r===!1){break}}}else{for(i in e){if(r=t.call(e[i],i,e[i]),r===!1){break}}}}return e},trim:b&&!b.call("\ufeff\u00a0")?function(e){return null==e?"":b.call(e)}:function(e){return null==e?"":(e+"").replace(C,"")},makeArray:function(e,t){var n=t||[];return null!=e&&(M(Object(e))?x.merge(n,"string"==typeof e?[e]:e):h.call(n,e)),n},inArray:function(e,t,n){var r;if(t){if(m){return m.call(t,e,n)}for(r=t.length,n=n?0>n?Math.max(0,r+n):n:0;r>n;n++){if(n in t&&t[n]===e){return n}}}return -1},merge:function(e,n){var r=n.length,i=e.length,o=0;if("number"==typeof r){for(;r>o;o++){e[i++]=n[o]}}else{while(n[o]!==t){e[i++]=n[o++]}}return e.length=i,e},grep:function(e,t,n){var r,i=[],o=0,a=e.length;for(n=!!n;a>o;o++){r=!!t(e[o],o),n!==r&&i.push(e[o])}return i},map:function(e,t,n){var r,i=0,o=e.length,a=M(e),s=[];if(a){for(;o>i;i++){r=t(e[i],i,n),null!=r&&(s[s.length]=r)}}else{for(i in e){r=t(e[i],i,n),null!=r&&(s[s.length]=r)}}return d.apply([],s)},guid:1,proxy:function(e,n){var r,i,o;return"string"==typeof n&&(o=e[n],n=e,e=o),x.isFunction(e)?(r=g.call(arguments,2),i=function(){return e.apply(n||this,r.concat(g.call(arguments)))},i.guid=e.guid=e.guid||x.guid++,i):t},access:function(e,n,r,i,o,a,s){var l=0,u=e.length,c=null==r;if("object"===x.type(r)){o=!0;for(l in r){x.access(e,n,l,r[l],!0,a,s)}}else{if(i!==t&&(o=!0,x.isFunction(i)||(s=!0),c&&(s?(n.call(e,i),n=null):(c=n,n=function(e,t,n){return c.call(x(e),n)})),n)){for(;u>l;l++){n(e[l],r,s?i:i.call(e[l],l,n(e[l],r)))}}}return o?e:c?n.call(e):u?n(e[0],r):a},now:function(){return(new Date).getTime()},swap:function(e,t,n,r){var i,o,a={};for(o in t){a[o]=e.style[o],e.style[o]=t[o]}i=n.apply(e,r||[]);for(o in t){e.style[o]=a[o]}return i}}),x.ready.promise=function(t){if(!n){if(n=x.Deferred(),"complete"===a.readyState){setTimeout(x.ready)}else{if(a.addEventListener){a.addEventListener("DOMContentLoaded",q,!1),e.addEventListener("load",q,!1)}else{a.attachEvent("onreadystatechange",q),e.attachEvent("onload",q);var r=!1;try{r=null==e.frameElement&&a.documentElement}catch(i){}r&&r.doScroll&&function o(){if(!x.isReady){try{r.doScroll("left")}catch(e){return setTimeout(o,50)}_(),x.ready()}}()}}}return n.promise(t)},x.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){c["[object "+t+"]"]=t.toLowerCase()});function M(e){var t=e.length,n=x.type(e);return x.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===n||"function"!==n&&(0===t||"number"==typeof t&&t>0&&t-1 in e)}r=x(a),function(e,t){var n,r,i,o,a,s,l,u,c,p,f,d,h,g,m,y,v,b="sizzle"+-new Date,w=e.document,T=0,C=0,N=st(),k=st(),E=st(),S=!1,A=function(e,t){return e===t?(S=!0,0):0},j=typeof t,D=1<<31,L={}.hasOwnProperty,H=[],q=H.pop,_=H.push,M=H.push,O=H.slice,F=H.indexOf||function(e){var t=0,n=this.length;for(;n>t;t++){if(this[t]===e){return t}}return -1},B="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",P="[\\x20\\t\\r\\n\\f]",R="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",W=R.replace("w","w#"),$="\\["+P+"*("+R+")"+P+"*(?:([*^$|!~]?=)"+P+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+W+")|)|)"+P+"*\\]",I=":("+R+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+$.replace(3,8)+")*)|.*)\\)|)",z=RegExp("^"+P+"+|((?:^|[^\\\\])(?:\\\\.)*)"+P+"+$","g"),X=RegExp("^"+P+"*,"+P+"*"),U=RegExp("^"+P+"*([>+~]|"+P+")"+P+"*"),V=RegExp(P+"*[+~]"),Y=RegExp("="+P+"*([^\\]'\"]*)"+P+"*\\]","g"),J=RegExp(I),G=RegExp("^"+W+"$"),Q={ID:RegExp("^#("+R+")"),CLASS:RegExp("^\\.("+R+")"),TAG:RegExp("^("+R.replace("w","w*")+")"),ATTR:RegExp("^"+$),PSEUDO:RegExp("^"+I),CHILD:RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+P+"*(even|odd|(([+-]|)(\\d*)n|)"+P+"*(?:([+-]|)"+P+"*(\\d+)|))"+P+"*\\)|)","i"),bool:RegExp("^(?:"+B+")$","i"),needsContext:RegExp("^"+P+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+P+"*((?:-\\d)?\\d*)"+P+"*\\)|)(?=[^-]|$)","i")},K=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,et=/^(?:input|select|textarea|button)$/i,tt=/^h\d$/i,nt=/'|\\/g,rt=RegExp("\\\\([\\da-f]{1,6}"+P+"?|("+P+")|.)","ig"),it=function(e,t,n){var r="0x"+t-65536;return r!==r||n?t:0>r?String.fromCharCode(r+65536):String.fromCharCode(55296|r>>10,56320|1023&r)};try{M.apply(H=O.call(w.childNodes),w.childNodes),H[w.childNodes.length].nodeType}catch(ot){M={apply:H.length?function(e,t){_.apply(e,O.call(t))}:function(e,t){var n=e.length,r=0;while(e[n++]=t[r++]){}e.length=n-1}}}function at(e,t,n,i){var o,a,s,l,u,c,d,m,y,x;if((t?t.ownerDocument||t:w)!==f&&p(t),t=t||f,n=n||[],!e||"string"!=typeof e){return n}if(1!==(l=t.nodeType)&&9!==l){return[]}if(h&&!i){if(o=Z.exec(e)){if(s=o[1]){if(9===l){if(a=t.getElementById(s),!a||!a.parentNode){return n}if(a.id===s){return n.push(a),n}}else{if(t.ownerDocument&&(a=t.ownerDocument.getElementById(s))&&v(t,a)&&a.id===s){return n.push(a),n}}}else{if(o[2]){return M.apply(n,t.getElementsByTagName(e)),n}if((s=o[3])&&r.getElementsByClassName&&t.getElementsByClassName){return M.apply(n,t.getElementsByClassName(s)),n}}}if(r.qsa&&(!g||!g.test(e))){if(m=d=b,y=t,x=9===l&&e,1===l&&"object"!==t.nodeName.toLowerCase()){c=mt(e),(d=t.getAttribute("id"))?m=d.replace(nt,"\\$&"):t.setAttribute("id",m),m="[id='"+m+"'] ",u=c.length;while(u--){c[u]=m+yt(c[u])}y=V.test(e)&&t.parentNode||t,x=c.join(",")}if(x){try{return M.apply(n,y.querySelectorAll(x)),n}catch(T){}finally{d||t.removeAttribute("id")}}}}return kt(e.replace(z,"$1"),t,n,i)}function st(){var e=[];function t(n,r){return e.push(n+=" ")>o.cacheLength&&delete t[e.shift()],t[n]=r}return t}function lt(e){return e[b]=!0,e}function ut(e){var t=f.createElement("div");try{return !!e(t)}catch(n){return !1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function ct(e,t){var n=e.split("|"),r=e.length;while(r--){o.attrHandle[n[r]]=t}}function pt(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||D)-(~e.sourceIndex||D);if(r){return r}if(n){while(n=n.nextSibling){if(n===t){return -1}}}return e?1:-1}function ft(e){return function(t){var n=t.nodeName.toLowerCase();return"input"===n&&t.type===e}}function dt(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function ht(e){return lt(function(t){return t=+t,lt(function(n,r){var i,o=e([],n.length,t),a=o.length;while(a--){n[i=o[a]]&&(n[i]=!(r[i]=n[i]))}})})}s=at.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1},r=at.support={},p=at.setDocument=function(e){var n=e?e.ownerDocument||e:w,i=n.defaultView;return n!==f&&9===n.nodeType&&n.documentElement?(f=n,d=n.documentElement,h=!s(n),i&&i.attachEvent&&i!==i.top&&i.attachEvent("onbeforeunload",function(){p()}),r.attributes=ut(function(e){return e.className="i",!e.getAttribute("className")}),r.getElementsByTagName=ut(function(e){return e.appendChild(n.createComment("")),!e.getElementsByTagName("*").length}),r.getElementsByClassName=ut(function(e){return e.innerHTML="<div class='a'></div><div class='a i'></div>",e.firstChild.className="i",2===e.getElementsByClassName("i").length}),r.getById=ut(function(e){return d.appendChild(e).id=b,!n.getElementsByName||!n.getElementsByName(b).length}),r.getById?(o.find.ID=function(e,t){if(typeof t.getElementById!==j&&h){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},o.filter.ID=function(e){var t=e.replace(rt,it);return function(e){return e.getAttribute("id")===t}}):(delete o.find.ID,o.filter.ID=function(e){var t=e.replace(rt,it);return function(e){var n=typeof e.getAttributeNode!==j&&e.getAttributeNode("id");return n&&n.value===t}}),o.find.TAG=r.getElementsByTagName?function(e,n){return typeof n.getElementsByTagName!==j?n.getElementsByTagName(e):t}:function(e,t){var n,r=[],i=0,o=t.getElementsByTagName(e);if("*"===e){while(n=o[i++]){1===n.nodeType&&r.push(n)}return r}return o},o.find.CLASS=r.getElementsByClassName&&function(e,n){return typeof n.getElementsByClassName!==j&&h?n.getElementsByClassName(e):t},m=[],g=[],(r.qsa=K.test(n.querySelectorAll))&&(ut(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||g.push("\\["+P+"*(?:value|"+B+")"),e.querySelectorAll(":checked").length||g.push(":checked")}),ut(function(e){var t=n.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("t",""),e.querySelectorAll("[t^='']").length&&g.push("[*^$]="+P+"*(?:''|\"\")"),e.querySelectorAll(":enabled").length||g.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),g.push(",.*:")})),(r.matchesSelector=K.test(y=d.webkitMatchesSelector||d.mozMatchesSelector||d.oMatchesSelector||d.msMatchesSelector))&&ut(function(e){r.disconnectedMatch=y.call(e,"div"),y.call(e,"[s!='']:x"),m.push("!=",I)}),g=g.length&&RegExp(g.join("|")),m=m.length&&RegExp(m.join("|")),v=K.test(d.contains)||d.compareDocumentPosition?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t){while(t=t.parentNode){if(t===e){return !0}}}return !1},A=d.compareDocumentPosition?function(e,t){if(e===t){return S=!0,0}var i=t.compareDocumentPosition&&e.compareDocumentPosition&&e.compareDocumentPosition(t);return i?1&i||!r.sortDetached&&t.compareDocumentPosition(e)===i?e===n||v(w,e)?-1:t===n||v(w,t)?1:c?F.call(c,e)-F.call(c,t):0:4&i?-1:1:e.compareDocumentPosition?-1:1}:function(e,t){var r,i=0,o=e.parentNode,a=t.parentNode,s=[e],l=[t];if(e===t){return S=!0,0}if(!o||!a){return e===n?-1:t===n?1:o?-1:a?1:c?F.call(c,e)-F.call(c,t):0}if(o===a){return pt(e,t)}r=e;while(r=r.parentNode){s.unshift(r)}r=t;while(r=r.parentNode){l.unshift(r)}while(s[i]===l[i]){i++}return i?pt(s[i],l[i]):s[i]===w?-1:l[i]===w?1:0},n):f},at.matches=function(e,t){return at(e,null,null,t)},at.matchesSelector=function(e,t){if((e.ownerDocument||e)!==f&&p(e),t=t.replace(Y,"='$1']"),!(!r.matchesSelector||!h||m&&m.test(t)||g&&g.test(t))){try{var n=y.call(e,t);if(n||r.disconnectedMatch||e.document&&11!==e.document.nodeType){return n}}catch(i){}}return at(t,f,null,[e]).length>0},at.contains=function(e,t){return(e.ownerDocument||e)!==f&&p(e),v(e,t)},at.attr=function(e,n){(e.ownerDocument||e)!==f&&p(e);var i=o.attrHandle[n.toLowerCase()],a=i&&L.call(o.attrHandle,n.toLowerCase())?i(e,n,!h):t;return a===t?r.attributes||!h?e.getAttribute(n):(a=e.getAttributeNode(n))&&a.specified?a.value:null:a},at.error=function(e){throw Error("Syntax error, unrecognized expression: "+e)},at.uniqueSort=function(e){var t,n=[],i=0,o=0;if(S=!r.detectDuplicates,c=!r.sortStable&&e.slice(0),e.sort(A),S){while(t=e[o++]){t===e[o]&&(i=n.push(o))}while(i--){e.splice(n[i],1)}}return e},a=at.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent){return e.textContent}for(e=e.firstChild;e;e=e.nextSibling){n+=a(e)}}else{if(3===i||4===i){return e.nodeValue}}}else{for(;t=e[r];r++){n+=a(t)}}return n},o=at.selectors={cacheLength:50,createPseudo:lt,match:Q,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(rt,it),e[3]=(e[4]||e[5]||"").replace(rt,it),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||at.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&at.error(e[0]),e},PSEUDO:function(e){var n,r=!e[5]&&e[2];return Q.CHILD.test(e[0])?null:(e[3]&&e[4]!==t?e[2]=e[4]:r&&J.test(r)&&(n=mt(r,!0))&&(n=r.indexOf(")",r.length-n)-r.length)&&(e[0]=e[0].slice(0,n),e[2]=r.slice(0,n)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(rt,it).toLowerCase();return"*"===e?function(){return !0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=N[e+" "];return t||(t=RegExp("(^|"+P+")"+e+"("+P+"|$)"))&&N(e,function(e){return t.test("string"==typeof e.className&&e.className||typeof e.getAttribute!==j&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=at.attr(r,e);return null==i?"!="===t:t?(i+="","="===t?i===n:"!="===t?i!==n:"^="===t?n&&0===i.indexOf(n):"*="===t?n&&i.indexOf(n)>-1:"$="===t?n&&i.slice(-n.length)===n:"~="===t?(" "+i+" ").indexOf(n)>-1:"|="===t?i===n||i.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r,i){var o="nth"!==e.slice(0,3),a="last"!==e.slice(-4),s="of-type"===t;return 1===r&&0===i?function(e){return !!e.parentNode}:function(t,n,l){var u,c,p,f,d,h,g=o!==a?"nextSibling":"previousSibling",m=t.parentNode,y=s&&t.nodeName.toLowerCase(),v=!l&&!s;if(m){if(o){while(g){p=t;while(p=p[g]){if(s?p.nodeName.toLowerCase()===y:1===p.nodeType){return !1}}h=g="only"===e&&!h&&"nextSibling"}return !0}if(h=[a?m.firstChild:m.lastChild],a&&v){c=m[b]||(m[b]={}),u=c[e]||[],d=u[0]===T&&u[1],f=u[0]===T&&u[2],p=d&&m.childNodes[d];while(p=++d&&p&&p[g]||(f=d=0)||h.pop()){if(1===p.nodeType&&++f&&p===t){c[e]=[T,d,f];break}}}else{if(v&&(u=(t[b]||(t[b]={}))[e])&&u[0]===T){f=u[1]}else{while(p=++d&&p&&p[g]||(f=d=0)||h.pop()){if((s?p.nodeName.toLowerCase()===y:1===p.nodeType)&&++f&&(v&&((p[b]||(p[b]={}))[e]=[T,f]),p===t)){break}}}}return f-=i,f===r||0===f%r&&f/r>=0}}},PSEUDO:function(e,t){var n,r=o.pseudos[e]||o.setFilters[e.toLowerCase()]||at.error("unsupported pseudo: "+e);return r[b]?r(t):r.length>1?(n=[e,e,"",t],o.setFilters.hasOwnProperty(e.toLowerCase())?lt(function(e,n){var i,o=r(e,t),a=o.length;while(a--){i=F.call(e,o[a]),e[i]=!(n[i]=o[a])}}):function(e){return r(e,0,n)}):r}},pseudos:{not:lt(function(e){var t=[],n=[],r=l(e.replace(z,"$1"));return r[b]?lt(function(e,t,n,i){var o,a=r(e,null,i,[]),s=e.length;while(s--){(o=a[s])&&(e[s]=!(t[s]=o))}}):function(e,i,o){return t[0]=e,r(t,null,o,n),!n.pop()}}),has:lt(function(e){return function(t){return at(e,t).length>0}}),contains:lt(function(e){return function(t){return(t.textContent||t.innerText||a(t)).indexOf(e)>-1}}),lang:lt(function(e){return G.test(e||"")||at.error("unsupported lang: "+e),e=e.replace(rt,it).toLowerCase(),function(t){var n;do{if(n=h?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang")){return n=n.toLowerCase(),n===e||0===n.indexOf(e+"-")}}while((t=t.parentNode)&&1===t.nodeType);return !1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===d},focus:function(e){return e===f.activeElement&&(!f.hasFocus||f.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling){if(e.nodeName>"@"||3===e.nodeType||4===e.nodeType){return !1}}return !0},parent:function(e){return !o.pseudos.empty(e)},header:function(e){return tt.test(e.nodeName)},input:function(e){return et.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||t.toLowerCase()===e.type)},first:ht(function(){return[0]}),last:ht(function(e,t){return[t-1]}),eq:ht(function(e,t,n){return[0>n?n+t:n]}),even:ht(function(e,t){var n=0;for(;t>n;n+=2){e.push(n)}return e}),odd:ht(function(e,t){var n=1;for(;t>n;n+=2){e.push(n)}return e}),lt:ht(function(e,t,n){var r=0>n?n+t:n;for(;--r>=0;){e.push(r)}return e}),gt:ht(function(e,t,n){var r=0>n?n+t:n;for(;t>++r;){e.push(r)}return e})}},o.pseudos.nth=o.pseudos.eq;for(n in {radio:!0,checkbox:!0,file:!0,password:!0,image:!0}){o.pseudos[n]=ft(n)}for(n in {submit:!0,reset:!0}){o.pseudos[n]=dt(n)}function gt(){}gt.prototype=o.filters=o.pseudos,o.setFilters=new gt;function mt(e,t){var n,r,i,a,s,l,u,c=k[e+" "];if(c){return t?0:c.slice(0)}s=e,l=[],u=o.preFilter;while(s){(!n||(r=X.exec(s)))&&(r&&(s=s.slice(r[0].length)||s),l.push(i=[])),n=!1,(r=U.exec(s))&&(n=r.shift(),i.push({value:n,type:r[0].replace(z," ")}),s=s.slice(n.length));for(a in o.filter){!(r=Q[a].exec(s))||u[a]&&!(r=u[a](r))||(n=r.shift(),i.push({value:n,type:a,matches:r}),s=s.slice(n.length))}if(!n){break}}return t?s.length:s?at.error(e):k(e,l).slice(0)}function yt(e){var t=0,n=e.length,r="";for(;n>t;t++){r+=e[t].value}return r}function vt(e,t,n){var r=t.dir,o=n&&"parentNode"===r,a=C++;return t.first?function(t,n,i){while(t=t[r]){if(1===t.nodeType||o){return e(t,n,i)}}}:function(t,n,s){var l,u,c,p=T+" "+a;if(s){while(t=t[r]){if((1===t.nodeType||o)&&e(t,n,s)){return !0}}}else{while(t=t[r]){if(1===t.nodeType||o){if(c=t[b]||(t[b]={}),(u=c[r])&&u[0]===p){if((l=u[1])===!0||l===i){return l===!0}}else{if(u=c[r]=[p],u[1]=e(t,n,s)||i,u[1]===!0){return !0}}}}}}}function bt(e){return e.length>1?function(t,n,r){var i=e.length;while(i--){if(!e[i](t,n,r)){return !1}}return !0}:e[0]}function xt(e,t,n,r,i){var o,a=[],s=0,l=e.length,u=null!=t;for(;l>s;s++){(o=e[s])&&(!n||n(o,r,i))&&(a.push(o),u&&t.push(s))}return a}function wt(e,t,n,r,i,o){return r&&!r[b]&&(r=wt(r)),i&&!i[b]&&(i=wt(i,o)),lt(function(o,a,s,l){var u,c,p,f=[],d=[],h=a.length,g=o||Nt(t||"*",s.nodeType?[s]:s,[]),m=!e||!o&&t?g:xt(g,f,e,s,l),y=n?i||(o?e:h||r)?[]:a:m;if(n&&n(m,y,s,l),r){u=xt(y,d),r(u,[],s,l),c=u.length;while(c--){(p=u[c])&&(y[d[c]]=!(m[d[c]]=p))}}if(o){if(i||e){if(i){u=[],c=y.length;while(c--){(p=y[c])&&u.push(m[c]=p)}i(null,y=[],u,l)}c=y.length;while(c--){(p=y[c])&&(u=i?F.call(o,p):f[c])>-1&&(o[u]=!(a[u]=p))}}}else{y=xt(y===a?y.splice(h,y.length):y),i?i(null,a,y,l):M.apply(a,y)}})}function Tt(e){var t,n,r,i=e.length,a=o.relative[e[0].type],s=a||o.relative[" "],l=a?1:0,c=vt(function(e){return e===t},s,!0),p=vt(function(e){return F.call(t,e)>-1},s,!0),f=[function(e,n,r){return !a&&(r||n!==u)||((t=n).nodeType?c(e,n,r):p(e,n,r))}];for(;i>l;l++){if(n=o.relative[e[l].type]){f=[vt(bt(f),n)]}else{if(n=o.filter[e[l].type].apply(null,e[l].matches),n[b]){for(r=++l;i>r;r++){if(o.relative[e[r].type]){break}}return wt(l>1&&bt(f),l>1&&yt(e.slice(0,l-1).concat({value:" "===e[l-2].type?"*":""})).replace(z,"$1"),n,r>l&&Tt(e.slice(l,r)),i>r&&Tt(e=e.slice(r)),i>r&&yt(e))}f.push(n)}}return bt(f)}function Ct(e,t){var n=0,r=t.length>0,a=e.length>0,s=function(s,l,c,p,d){var h,g,m,y=[],v=0,b="0",x=s&&[],w=null!=d,C=u,N=s||a&&o.find.TAG("*",d&&l.parentNode||l),k=T+=null==C?1:Math.random()||0.1;for(w&&(u=l!==f&&l,i=n);null!=(h=N[b]);b++){if(a&&h){g=0;while(m=e[g++]){if(m(h,l,c)){p.push(h);break}}w&&(T=k,i=++n)}r&&((h=!m&&h)&&v--,s&&x.push(h))}if(v+=b,r&&b!==v){g=0;while(m=t[g++]){m(x,y,l,c)}if(s){if(v>0){while(b--){x[b]||y[b]||(y[b]=q.call(p))}}y=xt(y)}M.apply(p,y),w&&!s&&y.length>0&&v+t.length>1&&at.uniqueSort(p)}return w&&(T=k,u=C),x};return r?lt(s):s}l=at.compile=function(e,t){var n,r=[],i=[],o=E[e+" "];if(!o){t||(t=mt(e)),n=t.length;while(n--){o=Tt(t[n]),o[b]?r.push(o):i.push(o)}o=E(e,Ct(i,r))}return o};function Nt(e,t,n){var r=0,i=t.length;for(;i>r;r++){at(e,t[r],n)}return n}function kt(e,t,n,i){var a,s,u,c,p,f=mt(e);if(!i&&1===f.length){if(s=f[0]=f[0].slice(0),s.length>2&&"ID"===(u=s[0]).type&&r.getById&&9===t.nodeType&&h&&o.relative[s[1].type]){if(t=(o.find.ID(u.matches[0].replace(rt,it),t)||[])[0],!t){return n}e=e.slice(s.shift().value.length)}a=Q.needsContext.test(e)?0:s.length;while(a--){if(u=s[a],o.relative[c=u.type]){break}if((p=o.find[c])&&(i=p(u.matches[0].replace(rt,it),V.test(s[0].type)&&t.parentNode||t))){if(s.splice(a,1),e=i.length&&yt(s),!e){return M.apply(n,i),n}break}}}return l(e,f)(i,t,!h,n,V.test(e)),n}r.sortStable=b.split("").sort(A).join("")===b,r.detectDuplicates=S,p(),r.sortDetached=ut(function(e){return 1&e.compareDocumentPosition(f.createElement("div"))}),ut(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||ct("type|href|height|width",function(e,n,r){return r?t:e.getAttribute(n,"type"===n.toLowerCase()?1:2)}),r.attributes&&ut(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||ct("value",function(e,n,r){return r||"input"!==e.nodeName.toLowerCase()?t:e.defaultValue}),ut(function(e){return null==e.getAttribute("disabled")})||ct(B,function(e,n,r){var i;return r?t:(i=e.getAttributeNode(n))&&i.specified?i.value:e[n]===!0?n.toLowerCase():null}),x.find=at,x.expr=at.selectors,x.expr[":"]=x.expr.pseudos,x.unique=at.uniqueSort,x.text=at.getText,x.isXMLDoc=at.isXML,x.contains=at.contains}(e);var O={};function F(e){var t=O[e]={};return x.each(e.match(T)||[],function(e,n){t[n]=!0}),t}x.Callbacks=function(e){e="string"==typeof e?O[e]||F(e):x.extend({},e);var n,r,i,o,a,s,l=[],u=!e.once&&[],c=function(t){for(r=e.memory&&t,i=!0,a=s||0,s=0,o=l.length,n=!0;l&&o>a;a++){if(l[a].apply(t[0],t[1])===!1&&e.stopOnFalse){r=!1;break}}n=!1,l&&(u?u.length&&c(u.shift()):r?l=[]:p.disable())},p={add:function(){if(l){var t=l.length;(function i(t){x.each(t,function(t,n){var r=x.type(n);"function"===r?e.unique&&p.has(n)||l.push(n):n&&n.length&&"string"!==r&&i(n)})})(arguments),n?o=l.length:r&&(s=t,c(r))}return this},remove:function(){return l&&x.each(arguments,function(e,t){var r;while((r=x.inArray(t,l,r))>-1){l.splice(r,1),n&&(o>=r&&o--,a>=r&&a--)}}),this},has:function(e){return e?x.inArray(e,l)>-1:!(!l||!l.length)},empty:function(){return l=[],o=0,this},disable:function(){return l=u=r=t,this},disabled:function(){return !l},lock:function(){return u=t,r||p.disable(),this},locked:function(){return !u},fireWith:function(e,t){return !l||i&&!u||(t=t||[],t=[e,t.slice?t.slice():t],n?u.push(t):c(t)),this},fire:function(){return p.fireWith(this,arguments),this},fired:function(){return !!i}};return p},x.extend({Deferred:function(e){var t=[["resolve","done",x.Callbacks("once memory"),"resolved"],["reject","fail",x.Callbacks("once memory"),"rejected"],["notify","progress",x.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return x.Deferred(function(n){x.each(t,function(t,o){var a=o[0],s=x.isFunction(e[t])&&e[t];i[o[1]](function(){var e=s&&s.apply(this,arguments);e&&x.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[a+"With"](this===r?n.promise():this,s?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?x.extend(e,r):r}},i={};return r.pipe=r.then,x.each(t,function(e,o){var a=o[2],s=o[3];r[o[1]]=a.add,s&&a.add(function(){n=s},t[1^e][2].disable,t[2][2].lock),i[o[0]]=function(){return i[o[0]+"With"](this===i?r:this,arguments),this},i[o[0]+"With"]=a.fireWith}),r.promise(i),e&&e.call(i,i),i},when:function(e){var t=0,n=g.call(arguments),r=n.length,i=1!==r||e&&x.isFunction(e.promise)?r:0,o=1===i?e:x.Deferred(),a=function(e,t,n){return function(r){t[e]=this,n[e]=arguments.length>1?g.call(arguments):r,n===s?o.notifyWith(t,n):--i||o.resolveWith(t,n)}},s,l,u;if(r>1){for(s=Array(r),l=Array(r),u=Array(r);r>t;t++){n[t]&&x.isFunction(n[t].promise)?n[t].promise().done(a(t,u,n)).fail(o.reject).progress(a(t,l,s)):--i}}return i||o.resolveWith(u,n),o.promise()}}),x.support=function(t){var n,r,o,s,l,u,c,p,f,d=a.createElement("div");if(d.setAttribute("className","t"),d.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",n=d.getElementsByTagName("*")||[],r=d.getElementsByTagName("a")[0],!r||!r.style||!n.length){return t}s=a.createElement("select"),u=s.appendChild(a.createElement("option")),o=d.getElementsByTagName("input")[0],r.style.cssText="top:1px;float:left;opacity:.5",t.getSetAttribute="t"!==d.className,t.leadingWhitespace=3===d.firstChild.nodeType,t.tbody=!d.getElementsByTagName("tbody").length,t.htmlSerialize=!!d.getElementsByTagName("link").length,t.style=/top/.test(r.getAttribute("style")),t.hrefNormalized="/a"===r.getAttribute("href"),t.opacity=/^0.5/.test(r.style.opacity),t.cssFloat=!!r.style.cssFloat,t.checkOn=!!o.value,t.optSelected=u.selected,t.enctype=!!a.createElement("form").enctype,t.html5Clone="<:nav></:nav>"!==a.createElement("nav").cloneNode(!0).outerHTML,t.inlineBlockNeedsLayout=!1,t.shrinkWrapBlocks=!1,t.pixelPosition=!1,t.deleteExpando=!0,t.noCloneEvent=!0,t.reliableMarginRight=!0,t.boxSizingReliable=!0,o.checked=!0,t.noCloneChecked=o.cloneNode(!0).checked,s.disabled=!0,t.optDisabled=!u.disabled;try{delete d.test}catch(h){t.deleteExpando=!1}o=a.createElement("input"),o.setAttribute("value",""),t.input=""===o.getAttribute("value"),o.value="t",o.setAttribute("type","radio"),t.radioValue="t"===o.value,o.setAttribute("checked","t"),o.setAttribute("name","t"),l=a.createDocumentFragment(),l.appendChild(o),t.appendChecked=o.checked,t.checkClone=l.cloneNode(!0).cloneNode(!0).lastChild.checked,d.attachEvent&&(d.attachEvent("onclick",function(){t.noCloneEvent=!1}),d.cloneNode(!0).click());for(f in {submit:!0,change:!0,focusin:!0}){d.setAttribute(c="on"+f,"t"),t[f+"Bubbles"]=c in e||d.attributes[c].expando===!1}d.style.backgroundClip="content-box",d.cloneNode(!0).style.backgroundClip="",t.clearCloneStyle="content-box"===d.style.backgroundClip;for(f in x(t)){break}return t.ownLast="0"!==f,x(function(){var n,r,o,s="padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;",l=a.getElementsByTagName("body")[0];l&&(n=a.createElement("div"),n.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",l.appendChild(n).appendChild(d),d.innerHTML="<table><tr><td></td><td>t</td></tr></table>",o=d.getElementsByTagName("td"),o[0].style.cssText="padding:0;margin:0;border:0;display:none",p=0===o[0].offsetHeight,o[0].style.display="",o[1].style.display="none",t.reliableHiddenOffsets=p&&0===o[0].offsetHeight,d.innerHTML="",d.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",x.swap(l,null!=l.style.zoom?{zoom:1}:{},function(){t.boxSizing=4===d.offsetWidth}),e.getComputedStyle&&(t.pixelPosition="1%"!==(e.getComputedStyle(d,null)||{}).top,t.boxSizingReliable="4px"===(e.getComputedStyle(d,null)||{width:"4px"}).width,r=d.appendChild(a.createElement("div")),r.style.cssText=d.style.cssText=s,r.style.marginRight=r.style.width="0",d.style.width="1px",t.reliableMarginRight=!parseFloat((e.getComputedStyle(r,null)||{}).marginRight)),typeof d.style.zoom!==i&&(d.innerHTML="",d.style.cssText=s+"width:1px;padding:1px;display:inline;zoom:1",t.inlineBlockNeedsLayout=3===d.offsetWidth,d.style.display="block",d.innerHTML="<div></div>",d.firstChild.style.width="5px",t.shrinkWrapBlocks=3!==d.offsetWidth,t.inlineBlockNeedsLayout&&(l.style.zoom=1)),l.removeChild(n),n=d=o=r=null)}),n=s=l=u=r=o=null,t}({});var B=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,P=/([A-Z])/g;function R(e,n,r,i){if(x.acceptData(e)){var o,a,s=x.expando,l=e.nodeType,u=l?x.cache:e,c=l?e[s]:e[s]&&s;if(c&&u[c]&&(i||u[c].data)||r!==t||"string"!=typeof n){return c||(c=l?e[s]=p.pop()||x.guid++:s),u[c]||(u[c]=l?{}:{toJSON:x.noop}),("object"==typeof n||"function"==typeof n)&&(i?u[c]=x.extend(u[c],n):u[c].data=x.extend(u[c].data,n)),a=u[c],i||(a.data||(a.data={}),a=a.data),r!==t&&(a[x.camelCase(n)]=r),"string"==typeof n?(o=a[n],null==o&&(o=a[x.camelCase(n)])):o=a,o}}}function W(e,t,n){if(x.acceptData(e)){var r,i,o=e.nodeType,a=o?x.cache:e,s=o?e[x.expando]:x.expando;if(a[s]){if(t&&(r=n?a[s]:a[s].data)){x.isArray(t)?t=t.concat(x.map(t,x.camelCase)):t in r?t=[t]:(t=x.camelCase(t),t=t in r?[t]:t.split(" ")),i=t.length;while(i--){delete r[t[i]]}if(n?!I(r):!x.isEmptyObject(r)){return}}(n||(delete a[s].data,I(a[s])))&&(o?x.cleanData([e],!0):x.support.deleteExpando||a!=a.window?delete a[s]:a[s]=null)}}}x.extend({cache:{},noData:{applet:!0,embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(e){return e=e.nodeType?x.cache[e[x.expando]]:e[x.expando],!!e&&!I(e)},data:function(e,t,n){return R(e,t,n)},removeData:function(e,t){return W(e,t)},_data:function(e,t,n){return R(e,t,n,!0)},_removeData:function(e,t){return W(e,t,!0)},acceptData:function(e){if(e.nodeType&&1!==e.nodeType&&9!==e.nodeType){return !1}var t=e.nodeName&&x.noData[e.nodeName.toLowerCase()];return !t||t!==!0&&e.getAttribute("classid")===t}}),x.fn.extend({data:function(e,n){var r,i,o=null,a=0,s=this[0];if(e===t){if(this.length&&(o=x.data(s),1===s.nodeType&&!x._data(s,"parsedAttrs"))){for(r=s.attributes;r.length>a;a++){i=r[a].name,0===i.indexOf("data-")&&(i=x.camelCase(i.slice(5)),$(s,i,o[i]))}x._data(s,"parsedAttrs",!0)}return o}return"object"==typeof e?this.each(function(){x.data(this,e)}):arguments.length>1?this.each(function(){x.data(this,e,n)}):s?$(s,e,x.data(s,e)):null},removeData:function(e){return this.each(function(){x.removeData(this,e)})}});function $(e,n,r){if(r===t&&1===e.nodeType){var i="data-"+n.replace(P,"-$1").toLowerCase();if(r=e.getAttribute(i),"string"==typeof r){try{r="true"===r?!0:"false"===r?!1:"null"===r?null:+r+""===r?+r:B.test(r)?x.parseJSON(r):r}catch(o){}x.data(e,n,r)}else{r=t}}return r}function I(e){var t;for(t in e){if(("data"!==t||!x.isEmptyObject(e[t]))&&"toJSON"!==t){return !1}}return !0}x.extend({queue:function(e,n,r){var i;return e?(n=(n||"fx")+"queue",i=x._data(e,n),r&&(!i||x.isArray(r)?i=x._data(e,n,x.makeArray(r)):i.push(r)),i||[]):t},dequeue:function(e,t){t=t||"fx";var n=x.queue(e,t),r=n.length,i=n.shift(),o=x._queueHooks(e,t),a=function(){x.dequeue(e,t)};"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,a,o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return x._data(e,n)||x._data(e,n,{empty:x.Callbacks("once memory").add(function(){x._removeData(e,t+"queue"),x._removeData(e,n)})})}}),x.fn.extend({queue:function(e,n){var r=2;return"string"!=typeof e&&(n=e,e="fx",r--),r>arguments.length?x.queue(this[0],e):n===t?this:this.each(function(){var t=x.queue(this,e,n);x._queueHooks(this,e),"fx"===e&&"inprogress"!==t[0]&&x.dequeue(this,e)})},dequeue:function(e){return this.each(function(){x.dequeue(this,e)})},delay:function(e,t){return e=x.fx?x.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,n){var r,i=1,o=x.Deferred(),a=this,s=this.length,l=function(){--i||o.resolveWith(a,[a])};"string"!=typeof e&&(n=e,e=t),e=e||"fx";while(s--){r=x._data(a[s],e+"queueHooks"),r&&r.empty&&(i++,r.empty.add(l))}return l(),o.promise(n)}});var z,X,U=/[\t\r\n\f]/g,V=/\r/g,Y=/^(?:input|select|textarea|button|object)$/i,J=/^(?:a|area)$/i,G=/^(?:checked|selected)$/i,Q=x.support.getSetAttribute,K=x.support.input;x.fn.extend({attr:function(e,t){return x.access(this,x.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){x.removeAttr(this,e)})},prop:function(e,t){return x.access(this,x.prop,e,t,arguments.length>1)},removeProp:function(e){return e=x.propFix[e]||e,this.each(function(){try{this[e]=t,delete this[e]}catch(n){}})},addClass:function(e){var t,n,r,i,o,a=0,s=this.length,l="string"==typeof e&&e;if(x.isFunction(e)){return this.each(function(t){x(this).addClass(e.call(this,t,this.className))})}if(l){for(t=(e||"").match(T)||[];s>a;a++){if(n=this[a],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(U," "):" ")){o=0;while(i=t[o++]){0>r.indexOf(" "+i+" ")&&(r+=i+" ")}n.className=x.trim(r)}}}return this},removeClass:function(e){var t,n,r,i,o,a=0,s=this.length,l=0===arguments.length||"string"==typeof e&&e;if(x.isFunction(e)){return this.each(function(t){x(this).removeClass(e.call(this,t,this.className))})}if(l){for(t=(e||"").match(T)||[];s>a;a++){if(n=this[a],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(U," "):"")){o=0;while(i=t[o++]){while(r.indexOf(" "+i+" ")>=0){r=r.replace(" "+i+" "," ")}}n.className=e?x.trim(r):""}}}return this},toggleClass:function(e,t){var n=typeof e;return"boolean"==typeof t&&"string"===n?t?this.addClass(e):this.removeClass(e):x.isFunction(e)?this.each(function(n){x(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if("string"===n){var t,r=0,o=x(this),a=e.match(T)||[];while(t=a[r++]){o.hasClass(t)?o.removeClass(t):o.addClass(t)}}else{(n===i||"boolean"===n)&&(this.className&&x._data(this,"__className__",this.className),this.className=this.className||e===!1?"":x._data(this,"__className__")||"")}})},hasClass:function(e){var t=" "+e+" ",n=0,r=this.length;for(;r>n;n++){if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(U," ").indexOf(t)>=0){return !0}}return !1},val:function(e){var n,r,i,o=this[0];if(arguments.length){return i=x.isFunction(e),this.each(function(n){var o;1===this.nodeType&&(o=i?e.call(this,n,x(this).val()):e,null==o?o="":"number"==typeof o?o+="":x.isArray(o)&&(o=x.map(o,function(e){return null==e?"":e+""})),r=x.valHooks[this.type]||x.valHooks[this.nodeName.toLowerCase()],r&&"set" in r&&r.set(this,o,"value")!==t||(this.value=o))})}if(o){return r=x.valHooks[o.type]||x.valHooks[o.nodeName.toLowerCase()],r&&"get" in r&&(n=r.get(o,"value"))!==t?n:(n=o.value,"string"==typeof n?n.replace(V,""):null==n?"":n)}}}),x.extend({valHooks:{option:{get:function(e){var t=x.find.attr(e,"value");return null!=t?t:e.text}},select:{get:function(e){var t,n,r=e.options,i=e.selectedIndex,o="select-one"===e.type||0>i,a=o?null:[],s=o?i+1:r.length,l=0>i?s:o?i:0;for(;s>l;l++){if(n=r[l],!(!n.selected&&l!==i||(x.support.optDisabled?n.disabled:null!==n.getAttribute("disabled"))||n.parentNode.disabled&&x.nodeName(n.parentNode,"optgroup"))){if(t=x(n).val(),o){return t}a.push(t)}}return a},set:function(e,t){var n,r,i=e.options,o=x.makeArray(t),a=i.length;while(a--){r=i[a],(r.selected=x.inArray(x(r).val(),o)>=0)&&(n=!0)}return n||(e.selectedIndex=-1),o}}},attr:function(e,n,r){var o,a,s=e.nodeType;if(e&&3!==s&&8!==s&&2!==s){return typeof e.getAttribute===i?x.prop(e,n,r):(1===s&&x.isXMLDoc(e)||(n=n.toLowerCase(),o=x.attrHooks[n]||(x.expr.match.bool.test(n)?X:z)),r===t?o&&"get" in o&&null!==(a=o.get(e,n))?a:(a=x.find.attr(e,n),null==a?t:a):null!==r?o&&"set" in o&&(a=o.set(e,r,n))!==t?a:(e.setAttribute(n,r+""),r):(x.removeAttr(e,n),t))}},removeAttr:function(e,t){var n,r,i=0,o=t&&t.match(T);if(o&&1===e.nodeType){while(n=o[i++]){r=x.propFix[n]||n,x.expr.match.bool.test(n)?K&&Q||!G.test(n)?e[r]=!1:e[x.camelCase("default-"+n)]=e[r]=!1:x.attr(e,n,""),e.removeAttribute(Q?n:r)}}},attrHooks:{type:{set:function(e,t){if(!x.support.radioValue&&"radio"===t&&x.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},propFix:{"for":"htmlFor","class":"className"},prop:function(e,n,r){var i,o,a,s=e.nodeType;if(e&&3!==s&&8!==s&&2!==s){return a=1!==s||!x.isXMLDoc(e),a&&(n=x.propFix[n]||n,o=x.propHooks[n]),r!==t?o&&"set" in o&&(i=o.set(e,r,n))!==t?i:e[n]=r:o&&"get" in o&&null!==(i=o.get(e,n))?i:e[n]}},propHooks:{tabIndex:{get:function(e){var t=x.find.attr(e,"tabindex");return t?parseInt(t,10):Y.test(e.nodeName)||J.test(e.nodeName)&&e.href?0:-1}}}}),X={set:function(e,t,n){return t===!1?x.removeAttr(e,n):K&&Q||!G.test(n)?e.setAttribute(!Q&&x.propFix[n]||n,n):e[x.camelCase("default-"+n)]=e[n]=!0,n}},x.each(x.expr.match.bool.source.match(/\w+/g),function(e,n){var r=x.expr.attrHandle[n]||x.find.attr;x.expr.attrHandle[n]=K&&Q||!G.test(n)?function(e,n,i){var o=x.expr.attrHandle[n],a=i?t:(x.expr.attrHandle[n]=t)!=r(e,n,i)?n.toLowerCase():null;return x.expr.attrHandle[n]=o,a}:function(e,n,r){return r?t:e[x.camelCase("default-"+n)]?n.toLowerCase():null}}),K&&Q||(x.attrHooks.value={set:function(e,n,r){return x.nodeName(e,"input")?(e.defaultValue=n,t):z&&z.set(e,n,r)}}),Q||(z={set:function(e,n,r){var i=e.getAttributeNode(r);return i||e.setAttributeNode(i=e.ownerDocument.createAttribute(r)),i.value=n+="","value"===r||n===e.getAttribute(r)?n:t}},x.expr.attrHandle.id=x.expr.attrHandle.name=x.expr.attrHandle.coords=function(e,n,r){var i;return r?t:(i=e.getAttributeNode(n))&&""!==i.value?i.value:null},x.valHooks.button={get:function(e,n){var r=e.getAttributeNode(n);return r&&r.specified?r.value:t},set:z.set},x.attrHooks.contenteditable={set:function(e,t,n){z.set(e,""===t?!1:t,n)}},x.each(["width","height"],function(e,n){x.attrHooks[n]={set:function(e,r){return""===r?(e.setAttribute(n,"auto"),r):t}}})),x.support.hrefNormalized||x.each(["href","src"],function(e,t){x.propHooks[t]={get:function(e){return e.getAttribute(t,4)}}}),x.support.style||(x.attrHooks.style={get:function(e){return e.style.cssText||t},set:function(e,t){return e.style.cssText=t+""}}),x.support.optSelected||(x.propHooks.selected={get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}}),x.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){x.propFix[this.toLowerCase()]=this}),x.support.enctype||(x.propFix.enctype="encoding"),x.each(["radio","checkbox"],function(){x.valHooks[this]={set:function(e,n){return x.isArray(n)?e.checked=x.inArray(x(e).val(),n)>=0:t}},x.support.checkOn||(x.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var Z=/^(?:input|select|textarea)$/i,et=/^key/,tt=/^(?:mouse|contextmenu)|click/,nt=/^(?:focusinfocus|focusoutblur)$/,rt=/^([^.]*)(?:\.(.+)|)$/;function it(){return !0}function ot(){return !1}function at(){try{return a.activeElement}catch(e){}}x.event={global:{},add:function(e,n,r,o,a){var s,l,u,c,p,f,d,h,g,m,y,v=x._data(e);if(v){r.handler&&(c=r,r=c.handler,a=c.selector),r.guid||(r.guid=x.guid++),(l=v.events)||(l=v.events={}),(f=v.handle)||(f=v.handle=function(e){return typeof x===i||e&&x.event.triggered===e.type?t:x.event.dispatch.apply(f.elem,arguments)},f.elem=e),n=(n||"").match(T)||[""],u=n.length;while(u--){s=rt.exec(n[u])||[],g=y=s[1],m=(s[2]||"").split(".").sort(),g&&(p=x.event.special[g]||{},g=(a?p.delegateType:p.bindType)||g,p=x.event.special[g]||{},d=x.extend({type:g,origType:y,data:o,handler:r,guid:r.guid,selector:a,needsContext:a&&x.expr.match.needsContext.test(a),namespace:m.join(".")},c),(h=l[g])||(h=l[g]=[],h.delegateCount=0,p.setup&&p.setup.call(e,o,m,f)!==!1||(e.addEventListener?e.addEventListener(g,f,!1):e.attachEvent&&e.attachEvent("on"+g,f))),p.add&&(p.add.call(e,d),d.handler.guid||(d.handler.guid=r.guid)),a?h.splice(h.delegateCount++,0,d):h.push(d),x.event.global[g]=!0)}e=null}},remove:function(e,t,n,r,i){var o,a,s,l,u,c,p,f,d,h,g,m=x.hasData(e)&&x._data(e);if(m&&(c=m.events)){t=(t||"").match(T)||[""],u=t.length;while(u--){if(s=rt.exec(t[u])||[],d=g=s[1],h=(s[2]||"").split(".").sort(),d){p=x.event.special[d]||{},d=(r?p.delegateType:p.bindType)||d,f=c[d]||[],s=s[2]&&RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),l=o=f.length;while(o--){a=f[o],!i&&g!==a.origType||n&&n.guid!==a.guid||s&&!s.test(a.namespace)||r&&r!==a.selector&&("**"!==r||!a.selector)||(f.splice(o,1),a.selector&&f.delegateCount--,p.remove&&p.remove.call(e,a))}l&&!f.length&&(p.teardown&&p.teardown.call(e,h,m.handle)!==!1||x.removeEvent(e,d,m.handle),delete c[d])}else{for(d in c){x.event.remove(e,d+t[u],n,r,!0)}}}x.isEmptyObject(c)&&(delete m.handle,x._removeData(e,"events"))}},trigger:function(n,r,i,o){var s,l,u,c,p,f,d,h=[i||a],g=v.call(n,"type")?n.type:n,m=v.call(n,"namespace")?n.namespace.split("."):[];if(u=f=i=i||a,3!==i.nodeType&&8!==i.nodeType&&!nt.test(g+x.event.triggered)&&(g.indexOf(".")>=0&&(m=g.split("."),g=m.shift(),m.sort()),l=0>g.indexOf(":")&&"on"+g,n=n[x.expando]?n:new x.Event(g,"object"==typeof n&&n),n.isTrigger=o?2:3,n.namespace=m.join("."),n.namespace_re=n.namespace?RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,n.result=t,n.target||(n.target=i),r=null==r?[n]:x.makeArray(r,[n]),p=x.event.special[g]||{},o||!p.trigger||p.trigger.apply(i,r)!==!1)){if(!o&&!p.noBubble&&!x.isWindow(i)){for(c=p.delegateType||g,nt.test(c+g)||(u=u.parentNode);u;u=u.parentNode){h.push(u),f=u}f===(i.ownerDocument||a)&&h.push(f.defaultView||f.parentWindow||e)}d=0;while((u=h[d++])&&!n.isPropagationStopped()){n.type=d>1?c:p.bindType||g,s=(x._data(u,"events")||{})[n.type]&&x._data(u,"handle"),s&&s.apply(u,r),s=l&&u[l],s&&x.acceptData(u)&&s.apply&&s.apply(u,r)===!1&&n.preventDefault()}if(n.type=g,!o&&!n.isDefaultPrevented()&&(!p._default||p._default.apply(h.pop(),r)===!1)&&x.acceptData(i)&&l&&i[g]&&!x.isWindow(i)){f=i[l],f&&(i[l]=null),x.event.triggered=g;try{i[g]()}catch(y){}x.event.triggered=t,f&&(i[l]=f)}return n.result}},dispatch:function(e){e=x.event.fix(e);var n,r,i,o,a,s=[],l=g.call(arguments),u=(x._data(this,"events")||{})[e.type]||[],c=x.event.special[e.type]||{};if(l[0]=e,e.delegateTarget=this,!c.preDispatch||c.preDispatch.call(this,e)!==!1){s=x.event.handlers.call(this,e,u),n=0;while((o=s[n++])&&!e.isPropagationStopped()){e.currentTarget=o.elem,a=0;while((i=o.handlers[a++])&&!e.isImmediatePropagationStopped()){(!e.namespace_re||e.namespace_re.test(i.namespace))&&(e.handleObj=i,e.data=i.data,r=((x.event.special[i.origType]||{}).handle||i.handler).apply(o.elem,l),r!==t&&(e.result=r)===!1&&(e.preventDefault(),e.stopPropagation()))}}return c.postDispatch&&c.postDispatch.call(this,e),e.result}},handlers:function(e,n){var r,i,o,a,s=[],l=n.delegateCount,u=e.target;if(l&&u.nodeType&&(!e.button||"click"!==e.type)){for(;u!=this;u=u.parentNode||this){if(1===u.nodeType&&(u.disabled!==!0||"click"!==e.type)){for(o=[],a=0;l>a;a++){i=n[a],r=i.selector+" ",o[r]===t&&(o[r]=i.needsContext?x(r,this).index(u)>=0:x.find(r,this,null,[u]).length),o[r]&&o.push(i)}o.length&&s.push({elem:u,handlers:o})}}}return n.length>l&&s.push({elem:this,handlers:n.slice(l)}),s},fix:function(e){if(e[x.expando]){return e}var t,n,r,i=e.type,o=e,s=this.fixHooks[i];s||(this.fixHooks[i]=s=tt.test(i)?this.mouseHooks:et.test(i)?this.keyHooks:{}),r=s.props?this.props.concat(s.props):this.props,e=new x.Event(o),t=r.length;while(t--){n=r[t],e[n]=o[n]}return e.target||(e.target=o.srcElement||a),3===e.target.nodeType&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,s.filter?s.filter(e,o):e},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,n){var r,i,o,s=n.button,l=n.fromElement;return null==e.pageX&&null!=n.clientX&&(i=e.target.ownerDocument||a,o=i.documentElement,r=i.body,e.pageX=n.clientX+(o&&o.scrollLeft||r&&r.scrollLeft||0)-(o&&o.clientLeft||r&&r.clientLeft||0),e.pageY=n.clientY+(o&&o.scrollTop||r&&r.scrollTop||0)-(o&&o.clientTop||r&&r.clientTop||0)),!e.relatedTarget&&l&&(e.relatedTarget=l===e.target?n.toElement:l),e.which||s===t||(e.which=1&s?1:2&s?3:4&s?2:0),e}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==at()&&this.focus){try{return this.focus(),!1}catch(e){}}},delegateType:"focusin"},blur:{trigger:function(){return this===at()&&this.blur?(this.blur(),!1):t},delegateType:"focusout"},click:{trigger:function(){return x.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):t},_default:function(e){return x.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){e.result!==t&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,r){var i=x.extend(new x.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?x.event.trigger(i,null,t):x.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},x.removeEvent=a.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){var r="on"+t;e.detachEvent&&(typeof e[r]===i&&(e[r]=null),e.detachEvent(r,n))},x.Event=function(e,n){return this instanceof x.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault()?it:ot):this.type=e,n&&x.extend(this,n),this.timeStamp=e&&e.timeStamp||x.now(),this[x.expando]=!0,t):new x.Event(e,n)},x.Event.prototype={isDefaultPrevented:ot,isPropagationStopped:ot,isImmediatePropagationStopped:ot,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=it,e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=it,e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=it,this.stopPropagation()}},x.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){x.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,o=e.handleObj;return(!i||i!==r&&!x.contains(r,i))&&(e.type=o.origType,n=o.handler.apply(this,arguments),e.type=t),n}}}),x.support.submitBubbles||(x.event.special.submit={setup:function(){return x.nodeName(this,"form")?!1:(x.event.add(this,"click._submit keypress._submit",function(e){var n=e.target,r=x.nodeName(n,"input")||x.nodeName(n,"button")?n.form:t;r&&!x._data(r,"submitBubbles")&&(x.event.add(r,"submit._submit",function(e){e._submit_bubble=!0}),x._data(r,"submitBubbles",!0))}),t)},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&x.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){return x.nodeName(this,"form")?!1:(x.event.remove(this,"._submit"),t)}}),x.support.changeBubbles||(x.event.special.change={setup:function(){return Z.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(x.event.add(this,"propertychange._change",function(e){"checked"===e.originalEvent.propertyName&&(this._just_changed=!0)}),x.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),x.event.simulate("change",this,e,!0)})),!1):(x.event.add(this,"beforeactivate._change",function(e){var t=e.target;Z.test(t.nodeName)&&!x._data(t,"changeBubbles")&&(x.event.add(t,"change._change",function(e){!this.parentNode||e.isSimulated||e.isTrigger||x.event.simulate("change",this.parentNode,e,!0)}),x._data(t,"changeBubbles",!0))}),t)},handle:function(e){var n=e.target;return this!==n||e.isSimulated||e.isTrigger||"radio"!==n.type&&"checkbox"!==n.type?e.handleObj.handler.apply(this,arguments):t},teardown:function(){return x.event.remove(this,"._change"),!Z.test(this.nodeName)}}),x.support.focusinBubbles||x.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,r=function(e){x.event.simulate(t,e.target,x.event.fix(e),!0)};x.event.special[t]={setup:function(){0===n++&&a.addEventListener(e,r,!0)},teardown:function(){0===--n&&a.removeEventListener(e,r,!0)}}}),x.fn.extend({on:function(e,n,r,i,o){var a,s;if("object"==typeof e){"string"!=typeof n&&(r=r||n,n=t);for(a in e){this.on(a,n,r,e[a],o)}return this}if(null==r&&null==i?(i=n,r=n=t):null==i&&("string"==typeof n?(i=r,r=t):(i=r,r=n,n=t)),i===!1){i=ot}else{if(!i){return this}}return 1===o&&(s=i,i=function(e){return x().off(e),s.apply(this,arguments)},i.guid=s.guid||(s.guid=x.guid++)),this.each(function(){x.event.add(this,e,i,r,n)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,n,r){var i,o;if(e&&e.preventDefault&&e.handleObj){return i=e.handleObj,x(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this}if("object"==typeof e){for(o in e){this.off(o,n,e[o])}return this}return(n===!1||"function"==typeof n)&&(r=n,n=t),r===!1&&(r=ot),this.each(function(){x.event.remove(this,e,r,n)})},trigger:function(e,t){return this.each(function(){x.event.trigger(e,t,this)})},triggerHandler:function(e,n){var r=this[0];return r?x.event.trigger(e,n,r,!0):t}});var st=/^.[^:#\[\.,]*$/,lt=/^(?:parents|prev(?:Until|All))/,ut=x.expr.match.needsContext,ct={children:!0,contents:!0,next:!0,prev:!0};x.fn.extend({find:function(e){var t,n=[],r=this,i=r.length;if("string"!=typeof e){return this.pushStack(x(e).filter(function(){for(t=0;i>t;t++){if(x.contains(r[t],this)){return !0}}}))}for(t=0;i>t;t++){x.find(e,r[t],n)}return n=this.pushStack(i>1?x.unique(n):n),n.selector=this.selector?this.selector+" "+e:e,n},has:function(e){var t,n=x(e,this),r=n.length;return this.filter(function(){for(t=0;r>t;t++){if(x.contains(this,n[t])){return !0}}})},not:function(e){return this.pushStack(ft(this,e||[],!0))},filter:function(e){return this.pushStack(ft(this,e||[],!1))},is:function(e){return !!ft(this,"string"==typeof e&&ut.test(e)?x(e):e||[],!1).length},closest:function(e,t){var n,r=0,i=this.length,o=[],a=ut.test(e)||"string"!=typeof e?x(e,t||this.context):0;for(;i>r;r++){for(n=this[r];n&&n!==t;n=n.parentNode){if(11>n.nodeType&&(a?a.index(n)>-1:1===n.nodeType&&x.find.matchesSelector(n,e))){n=o.push(n);break}}}return this.pushStack(o.length>1?x.unique(o):o)},index:function(e){return e?"string"==typeof e?x.inArray(this[0],x(e)):x.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){var n="string"==typeof e?x(e,t):x.makeArray(e&&e.nodeType?[e]:e),r=x.merge(this.get(),n);return this.pushStack(x.unique(r))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}});function pt(e,t){do{e=e[t]}while(e&&1!==e.nodeType);return e}x.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return x.dir(e,"parentNode")},parentsUntil:function(e,t,n){return x.dir(e,"parentNode",n)},next:function(e){return pt(e,"nextSibling")},prev:function(e){return pt(e,"previousSibling")},nextAll:function(e){return x.dir(e,"nextSibling")},prevAll:function(e){return x.dir(e,"previousSibling")},nextUntil:function(e,t,n){return x.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return x.dir(e,"previousSibling",n)},siblings:function(e){return x.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return x.sibling(e.firstChild)},contents:function(e){return x.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:x.merge([],e.childNodes)}},function(e,t){x.fn[e]=function(n,r){var i=x.map(this,t,n);return"Until"!==e.slice(-5)&&(r=n),r&&"string"==typeof r&&(i=x.filter(r,i)),this.length>1&&(ct[e]||(i=x.unique(i)),lt.test(e)&&(i=i.reverse())),this.pushStack(i)}}),x.extend({filter:function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?x.find.matchesSelector(r,e)?[r]:[]:x.find.matches(e,x.grep(t,function(e){return 1===e.nodeType}))},dir:function(e,n,r){var i=[],o=e[n];while(o&&9!==o.nodeType&&(r===t||1!==o.nodeType||!x(o).is(r))){1===o.nodeType&&i.push(o),o=o[n]}return i},sibling:function(e,t){var n=[];for(;e;e=e.nextSibling){1===e.nodeType&&e!==t&&n.push(e)}return n}});function ft(e,t,n){if(x.isFunction(t)){return x.grep(e,function(e,r){return !!t.call(e,r,e)!==n})}if(t.nodeType){return x.grep(e,function(e){return e===t!==n})}if("string"==typeof t){if(st.test(t)){return x.filter(t,e,n)}t=x.filter(t,e)}return x.grep(e,function(e){return x.inArray(e,t)>=0!==n})}function dt(e){var t=ht.split("|"),n=e.createDocumentFragment();if(n.createElement){while(t.length){n.createElement(t.pop())}}return n}var ht="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",gt=/ jQuery\d+="(?:null|\d+)"/g,mt=RegExp("<(?:"+ht+")[\\s/>]","i"),yt=/^\s+/,vt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,bt=/<([\w:]+)/,xt=/<tbody/i,wt=/<|&#?\w+;/,Tt=/<(?:script|style|link)/i,Ct=/^(?:checkbox|radio)$/i,Nt=/checked\s*(?:[^=]|=\s*.checked.)/i,kt=/^$|\/(?:java|ecma)script/i,Et=/^true\/(.*)/,St=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,At={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:x.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},jt=dt(a),Dt=jt.appendChild(a.createElement("div"));At.optgroup=At.option,At.tbody=At.tfoot=At.colgroup=At.caption=At.thead,At.th=At.td,x.fn.extend({text:function(e){return x.access(this,function(e){return e===t?x.text(this):this.empty().append((this[0]&&this[0].ownerDocument||a).createTextNode(e))},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=Lt(this,e);t.appendChild(e)}})},prepend:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=Lt(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){var n,r=e?x.filter(e,this):this,i=0;for(;null!=(n=r[i]);i++){t||1!==n.nodeType||x.cleanData(Ft(n)),n.parentNode&&(t&&x.contains(n.ownerDocument,n)&&_t(Ft(n,"script")),n.parentNode.removeChild(n))}return this},empty:function(){var e,t=0;for(;null!=(e=this[t]);t++){1===e.nodeType&&x.cleanData(Ft(e,!1));while(e.firstChild){e.removeChild(e.firstChild)}e.options&&x.nodeName(e,"select")&&(e.options.length=0)}return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return x.clone(this,e,t)})},html:function(e){return x.access(this,function(e){var n=this[0]||{},r=0,i=this.length;if(e===t){return 1===n.nodeType?n.innerHTML.replace(gt,""):t}if(!("string"!=typeof e||Tt.test(e)||!x.support.htmlSerialize&&mt.test(e)||!x.support.leadingWhitespace&&yt.test(e)||At[(bt.exec(e)||["",""])[1].toLowerCase()])){e=e.replace(vt,"<$1></$2>");try{for(;i>r;r++){n=this[r]||{},1===n.nodeType&&(x.cleanData(Ft(n,!1)),n.innerHTML=e)}n=0}catch(o){}}n&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=x.map(this,function(e){return[e.nextSibling,e.parentNode]}),t=0;return this.domManip(arguments,function(n){var r=e[t++],i=e[t++];i&&(r&&r.parentNode!==i&&(r=this.nextSibling),x(this).remove(),i.insertBefore(n,r))},!0),t?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(e,t,n){e=d.apply([],e);var r,i,o,a,s,l,u=0,c=this.length,p=this,f=c-1,h=e[0],g=x.isFunction(h);if(g||!(1>=c||"string"!=typeof h||x.support.checkClone)&&Nt.test(h)){return this.each(function(r){var i=p.eq(r);g&&(e[0]=h.call(this,r,i.html())),i.domManip(e,t,n)})}if(c&&(l=x.buildFragment(e,this[0].ownerDocument,!1,!n&&this),r=l.firstChild,1===l.childNodes.length&&(l=r),r)){for(a=x.map(Ft(l,"script"),Ht),o=a.length;c>u;u++){i=l,u!==f&&(i=x.clone(i,!0,!0),o&&x.merge(a,Ft(i,"script"))),t.call(this[u],i,u)}if(o){for(s=a[a.length-1].ownerDocument,x.map(a,qt),u=0;o>u;u++){i=a[u],kt.test(i.type||"")&&!x._data(i,"globalEval")&&x.contains(s,i)&&(i.src?x._evalUrl(i.src):x.globalEval((i.text||i.textContent||i.innerHTML||"").replace(St,"")))}}l=r=null}return this}});function Lt(e,t){return x.nodeName(e,"table")&&x.nodeName(1===t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function Ht(e){return e.type=(null!==x.find.attr(e,"type"))+"/"+e.type,e}function qt(e){var t=Et.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function _t(e,t){var n,r=0;for(;null!=(n=e[r]);r++){x._data(n,"globalEval",!t||x._data(t[r],"globalEval"))}}function Mt(e,t){if(1===t.nodeType&&x.hasData(e)){var n,r,i,o=x._data(e),a=x._data(t,o),s=o.events;if(s){delete a.handle,a.events={};for(n in s){for(r=0,i=s[n].length;i>r;r++){x.event.add(t,n,s[n][r])}}}a.data&&(a.data=x.extend({},a.data))}}function Ot(e,t){var n,r,i;if(1===t.nodeType){if(n=t.nodeName.toLowerCase(),!x.support.noCloneEvent&&t[x.expando]){i=x._data(t);for(r in i.events){x.removeEvent(t,r,i.handle)}t.removeAttribute(x.expando)}"script"===n&&t.text!==e.text?(Ht(t).text=e.text,qt(t)):"object"===n?(t.parentNode&&(t.outerHTML=e.outerHTML),x.support.html5Clone&&e.innerHTML&&!x.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):"input"===n&&Ct.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):"option"===n?t.defaultSelected=t.selected=e.defaultSelected:("input"===n||"textarea"===n)&&(t.defaultValue=e.defaultValue)}}x.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){x.fn[e]=function(e){var n,r=0,i=[],o=x(e),a=o.length-1;for(;a>=r;r++){n=r===a?this:this.clone(!0),x(o[r])[t](n),h.apply(i,n.get())}return this.pushStack(i)}});function Ft(e,n){var r,o,a=0,s=typeof e.getElementsByTagName!==i?e.getElementsByTagName(n||"*"):typeof e.querySelectorAll!==i?e.querySelectorAll(n||"*"):t;if(!s){for(s=[],r=e.childNodes||e;null!=(o=r[a]);a++){!n||x.nodeName(o,n)?s.push(o):x.merge(s,Ft(o,n))}}return n===t||n&&x.nodeName(e,n)?x.merge([e],s):s}function Bt(e){Ct.test(e.type)&&(e.defaultChecked=e.checked)}x.extend({clone:function(e,t,n){var r,i,o,a,s,l=x.contains(e.ownerDocument,e);if(x.support.html5Clone||x.isXMLDoc(e)||!mt.test("<"+e.nodeName+">")?o=e.cloneNode(!0):(Dt.innerHTML=e.outerHTML,Dt.removeChild(o=Dt.firstChild)),!(x.support.noCloneEvent&&x.support.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||x.isXMLDoc(e))){for(r=Ft(o),s=Ft(e),a=0;null!=(i=s[a]);++a){r[a]&&Ot(i,r[a])}}if(t){if(n){for(s=s||Ft(e),r=r||Ft(o),a=0;null!=(i=s[a]);a++){Mt(i,r[a])}}else{Mt(e,o)}}return r=Ft(o,"script"),r.length>0&&_t(r,!l&&Ft(e,"script")),r=s=i=null,o},buildFragment:function(e,t,n,r){var i,o,a,s,l,u,c,p=e.length,f=dt(t),d=[],h=0;for(;p>h;h++){if(o=e[h],o||0===o){if("object"===x.type(o)){x.merge(d,o.nodeType?[o]:o)}else{if(wt.test(o)){s=s||f.appendChild(t.createElement("div")),l=(bt.exec(o)||["",""])[1].toLowerCase(),c=At[l]||At._default,s.innerHTML=c[1]+o.replace(vt,"<$1></$2>")+c[2],i=c[0];while(i--){s=s.lastChild}if(!x.support.leadingWhitespace&&yt.test(o)&&d.push(t.createTextNode(yt.exec(o)[0])),!x.support.tbody){o="table"!==l||xt.test(o)?"<table>"!==c[1]||xt.test(o)?0:s:s.firstChild,i=o&&o.childNodes.length;while(i--){x.nodeName(u=o.childNodes[i],"tbody")&&!u.childNodes.length&&o.removeChild(u)}}x.merge(d,s.childNodes),s.textContent="";while(s.firstChild){s.removeChild(s.firstChild)}s=f.lastChild}else{d.push(t.createTextNode(o))}}}}s&&f.removeChild(s),x.support.appendChecked||x.grep(Ft(d,"input"),Bt),h=0;while(o=d[h++]){if((!r||-1===x.inArray(o,r))&&(a=x.contains(o.ownerDocument,o),s=Ft(f.appendChild(o),"script"),a&&_t(s),n)){i=0;while(o=s[i++]){kt.test(o.type||"")&&n.push(o)}}}return s=null,f},cleanData:function(e,t){var n,r,o,a,s=0,l=x.expando,u=x.cache,c=x.support.deleteExpando,f=x.event.special;for(;null!=(n=e[s]);s++){if((t||x.acceptData(n))&&(o=n[l],a=o&&u[o])){if(a.events){for(r in a.events){f[r]?x.event.remove(n,r):x.removeEvent(n,r,a.handle)}}u[o]&&(delete u[o],c?delete n[l]:typeof n.removeAttribute!==i?n.removeAttribute(l):n[l]=null,p.push(o))}}},_evalUrl:function(e){return x.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})}}),x.fn.extend({wrapAll:function(e){if(x.isFunction(e)){return this.each(function(t){x(this).wrapAll(e.call(this,t))})}if(this[0]){var t=x(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstChild&&1===e.firstChild.nodeType){e=e.firstChild}return e}).append(this)}return this},wrapInner:function(e){return x.isFunction(e)?this.each(function(t){x(this).wrapInner(e.call(this,t))}):this.each(function(){var t=x(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=x.isFunction(e);return this.each(function(n){x(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){x.nodeName(this,"body")||x(this).replaceWith(this.childNodes)}).end()}});var Pt,Rt,Wt,$t=/alpha\([^)]*\)/i,It=/opacity\s*=\s*([^)]*)/,zt=/^(top|right|bottom|left)$/,Xt=/^(none|table(?!-c[ea]).+)/,Ut=/^margin/,Vt=RegExp("^("+w+")(.*)$","i"),Yt=RegExp("^("+w+")(?!px)[a-z%]+$","i"),Jt=RegExp("^([+-])=("+w+")","i"),Gt={BODY:"block"},Qt={position:"absolute",visibility:"hidden",display:"block"},Kt={letterSpacing:0,fontWeight:400},Zt=["Top","Right","Bottom","Left"],en=["Webkit","O","Moz","ms"];function tn(e,t){if(t in e){return t}var n=t.charAt(0).toUpperCase()+t.slice(1),r=t,i=en.length;while(i--){if(t=en[i]+n,t in e){return t}}return r}function nn(e,t){return e=t||e,"none"===x.css(e,"display")||!x.contains(e.ownerDocument,e)}function rn(e,t){var n,r,i,o=[],a=0,s=e.length;for(;s>a;a++){r=e[a],r.style&&(o[a]=x._data(r,"olddisplay"),n=r.style.display,t?(o[a]||"none"!==n||(r.style.display=""),""===r.style.display&&nn(r)&&(o[a]=x._data(r,"olddisplay",ln(r.nodeName)))):o[a]||(i=nn(r),(n&&"none"!==n||!i)&&x._data(r,"olddisplay",i?n:x.css(r,"display"))))}for(a=0;s>a;a++){r=e[a],r.style&&(t&&"none"!==r.style.display&&""!==r.style.display||(r.style.display=t?o[a]||"":"none"))}return e}x.fn.extend({css:function(e,n){return x.access(this,function(e,n,r){var i,o,a={},s=0;if(x.isArray(n)){for(o=Rt(e),i=n.length;i>s;s++){a[n[s]]=x.css(e,n[s],!1,o)}return a}return r!==t?x.style(e,n,r):x.css(e,n)},e,n,arguments.length>1)},show:function(){return rn(this,!0)},hide:function(){return rn(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){nn(this)?x(this).show():x(this).hide()})}}),x.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Wt(e,"opacity");return""===n?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":x.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,n,r,i){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var o,a,s,l=x.camelCase(n),u=e.style;if(n=x.cssProps[l]||(x.cssProps[l]=tn(u,l)),s=x.cssHooks[n]||x.cssHooks[l],r===t){return s&&"get" in s&&(o=s.get(e,!1,i))!==t?o:u[n]}if(a=typeof r,"string"===a&&(o=Jt.exec(r))&&(r=(o[1]+1)*o[2]+parseFloat(x.css(e,n)),a="number"),!(null==r||"number"===a&&isNaN(r)||("number"!==a||x.cssNumber[l]||(r+="px"),x.support.clearCloneStyle||""!==r||0!==n.indexOf("background")||(u[n]="inherit"),s&&"set" in s&&(r=s.set(e,r,i))===t))){try{u[n]=r}catch(c){}}}},css:function(e,n,r,i){var o,a,s,l=x.camelCase(n);return n=x.cssProps[l]||(x.cssProps[l]=tn(e.style,l)),s=x.cssHooks[n]||x.cssHooks[l],s&&"get" in s&&(a=s.get(e,!0,r)),a===t&&(a=Wt(e,n,i)),"normal"===a&&n in Kt&&(a=Kt[n]),""===r||r?(o=parseFloat(a),r===!0||x.isNumeric(o)?o||0:a):a}}),e.getComputedStyle?(Rt=function(t){return e.getComputedStyle(t,null)},Wt=function(e,n,r){var i,o,a,s=r||Rt(e),l=s?s.getPropertyValue(n)||s[n]:t,u=e.style;return s&&(""!==l||x.contains(e.ownerDocument,e)||(l=x.style(e,n)),Yt.test(l)&&Ut.test(n)&&(i=u.width,o=u.minWidth,a=u.maxWidth,u.minWidth=u.maxWidth=u.width=l,l=s.width,u.width=i,u.minWidth=o,u.maxWidth=a)),l}):a.documentElement.currentStyle&&(Rt=function(e){return e.currentStyle},Wt=function(e,n,r){var i,o,a,s=r||Rt(e),l=s?s[n]:t,u=e.style;return null==l&&u&&u[n]&&(l=u[n]),Yt.test(l)&&!zt.test(n)&&(i=u.left,o=e.runtimeStyle,a=o&&o.left,a&&(o.left=e.currentStyle.left),u.left="fontSize"===n?"1em":l,l=u.pixelLeft+"px",u.left=i,a&&(o.left=a)),""===l?"auto":l});function on(e,t,n){var r=Vt.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function an(e,t,n,r,i){var o=n===(r?"border":"content")?4:"width"===t?1:0,a=0;for(;4>o;o+=2){"margin"===n&&(a+=x.css(e,n+Zt[o],!0,i)),r?("content"===n&&(a-=x.css(e,"padding"+Zt[o],!0,i)),"margin"!==n&&(a-=x.css(e,"border"+Zt[o]+"Width",!0,i))):(a+=x.css(e,"padding"+Zt[o],!0,i),"padding"!==n&&(a+=x.css(e,"border"+Zt[o]+"Width",!0,i)))}return a}function sn(e,t,n){var r=!0,i="width"===t?e.offsetWidth:e.offsetHeight,o=Rt(e),a=x.support.boxSizing&&"border-box"===x.css(e,"boxSizing",!1,o);if(0>=i||null==i){if(i=Wt(e,t,o),(0>i||null==i)&&(i=e.style[t]),Yt.test(i)){return i}r=a&&(x.support.boxSizingReliable||i===e.style[t]),i=parseFloat(i)||0}return i+an(e,t,n||(a?"border":"content"),r,o)+"px"}function ln(e){var t=a,n=Gt[e];return n||(n=un(e,t),"none"!==n&&n||(Pt=(Pt||x("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(t.documentElement),t=(Pt[0].contentWindow||Pt[0].contentDocument).document,t.write("<!doctype html><html><body>"),t.close(),n=un(e,t),Pt.detach()),Gt[e]=n),n}function un(e,t){var n=x(t.createElement(e)).appendTo(t.body),r=x.css(n[0],"display");return n.remove(),r}x.each(["height","width"],function(e,n){x.cssHooks[n]={get:function(e,r,i){return r?0===e.offsetWidth&&Xt.test(x.css(e,"display"))?x.swap(e,Qt,function(){return sn(e,n,i)}):sn(e,n,i):t},set:function(e,t,r){var i=r&&Rt(e);return on(e,t,r?an(e,n,r,x.support.boxSizing&&"border-box"===x.css(e,"boxSizing",!1,i),i):0)}}}),x.support.opacity||(x.cssHooks.opacity={get:function(e,t){return It.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?0.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var n=e.style,r=e.currentStyle,i=x.isNumeric(t)?"alpha(opacity="+100*t+")":"",o=r&&r.filter||n.filter||"";n.zoom=1,(t>=1||""===t)&&""===x.trim(o.replace($t,""))&&n.removeAttribute&&(n.removeAttribute("filter"),""===t||r&&!r.filter)||(n.filter=$t.test(o)?o.replace($t,i):o+" "+i)}}),x(function(){x.support.reliableMarginRight||(x.cssHooks.marginRight={get:function(e,n){return n?x.swap(e,{display:"inline-block"},Wt,[e,"marginRight"]):t}}),!x.support.pixelPosition&&x.fn.position&&x.each(["top","left"],function(e,n){x.cssHooks[n]={get:function(e,r){return r?(r=Wt(e,n),Yt.test(r)?x(e).position()[n]+"px":r):t}}})}),x.expr&&x.expr.filters&&(x.expr.filters.hidden=function(e){return 0>=e.offsetWidth&&0>=e.offsetHeight||!x.support.reliableHiddenOffsets&&"none"===(e.style&&e.style.display||x.css(e,"display"))},x.expr.filters.visible=function(e){return !x.expr.filters.hidden(e)}),x.each({margin:"",padding:"",border:"Width"},function(e,t){x.cssHooks[e+t]={expand:function(n){var r=0,i={},o="string"==typeof n?n.split(" "):[n];for(;4>r;r++){i[e+Zt[r]+t]=o[r]||o[r-2]||o[0]}return i}},Ut.test(e)||(x.cssHooks[e+t].set=on)});var cn=/%20/g,pn=/\[\]$/,fn=/\r?\n/g,dn=/^(?:submit|button|image|reset|file)$/i,hn=/^(?:input|select|textarea|keygen)/i;x.fn.extend({serialize:function(){return x.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=x.prop(this,"elements");return e?x.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!x(this).is(":disabled")&&hn.test(this.nodeName)&&!dn.test(e)&&(this.checked||!Ct.test(e))}).map(function(e,t){var n=x(this).val();return null==n?null:x.isArray(n)?x.map(n,function(e){return{name:t.name,value:e.replace(fn,"\r\n")}}):{name:t.name,value:n.replace(fn,"\r\n")}}).get()}}),x.param=function(e,n){var r,i=[],o=function(e,t){t=x.isFunction(t)?t():null==t?"":t,i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(n===t&&(n=x.ajaxSettings&&x.ajaxSettings.traditional),x.isArray(e)||e.jquery&&!x.isPlainObject(e)){x.each(e,function(){o(this.name,this.value)})}else{for(r in e){gn(r,e[r],n,o)}}return i.join("&").replace(cn,"+")};function gn(e,t,n,r){var i;if(x.isArray(t)){x.each(t,function(t,i){n||pn.test(e)?r(e,i):gn(e+"["+("object"==typeof i?t:"")+"]",i,n,r)})}else{if(n||"object"!==x.type(t)){r(e,t)}else{for(i in t){gn(e+"["+i+"]",t[i],n,r)}}}}x.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){x.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),x.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)}});var mn,yn,vn=x.now(),bn=/\?/,xn=/#.*$/,wn=/([?&])_=[^&]*/,Tn=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Cn=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Nn=/^(?:GET|HEAD)$/,kn=/^\/\//,En=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,Sn=x.fn.load,An={},jn={},Dn="*/".concat("*");try{yn=o.href}catch(Ln){yn=a.createElement("a"),yn.href="",yn=yn.href}mn=En.exec(yn.toLowerCase())||[];function Hn(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var r,i=0,o=t.toLowerCase().match(T)||[];if(x.isFunction(n)){while(r=o[i++]){"+"===r[0]?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}}}function qn(e,n,r,i){var o={},a=e===jn;function s(l){var u;return o[l]=!0,x.each(e[l]||[],function(e,l){var c=l(n,r,i);return"string"!=typeof c||a||o[c]?a?!(u=c):t:(n.dataTypes.unshift(c),s(c),!1)}),u}return s(n.dataTypes[0])||!o["*"]&&s("*")}function _n(e,n){var r,i,o=x.ajaxSettings.flatOptions||{};for(i in n){n[i]!==t&&((o[i]?e:r||(r={}))[i]=n[i])}return r&&x.extend(!0,e,r),e}x.fn.load=function(e,n,r){if("string"!=typeof e&&Sn){return Sn.apply(this,arguments)}var i,o,a,s=this,l=e.indexOf(" ");return l>=0&&(i=e.slice(l,e.length),e=e.slice(0,l)),x.isFunction(n)?(r=n,n=t):n&&"object"==typeof n&&(a="POST"),s.length>0&&x.ajax({url:e,type:a,dataType:"html",data:n}).done(function(e){o=arguments,s.html(i?x("<div>").append(x.parseHTML(e)).find(i):e)}).complete(r&&function(e,t){s.each(r,o||[e.responseText,t,e])}),this},x.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){x.fn[t]=function(e){return this.on(t,e)}}),x.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:yn,type:"GET",isLocal:Cn.test(mn[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Dn,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":x.parseJSON,"text xml":x.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?_n(_n(e,x.ajaxSettings),t):_n(x.ajaxSettings,e)},ajaxPrefilter:Hn(An),ajaxTransport:Hn(jn),ajax:function(e,n){"object"==typeof e&&(n=e,e=t),n=n||{};var r,i,o,a,s,l,u,c,p=x.ajaxSetup({},n),f=p.context||p,d=p.context&&(f.nodeType||f.jquery)?x(f):x.event,h=x.Deferred(),g=x.Callbacks("once memory"),m=p.statusCode||{},y={},v={},b=0,w="canceled",C={readyState:0,getResponseHeader:function(e){var t;if(2===b){if(!c){c={};while(t=Tn.exec(a)){c[t[1].toLowerCase()]=t[2]}}t=c[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===b?a:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return b||(e=v[n]=v[n]||e,y[e]=t),this},overrideMimeType:function(e){return b||(p.mimeType=e),this},statusCode:function(e){var t;if(e){if(2>b){for(t in e){m[t]=[m[t],e[t]]}}else{C.always(e[C.status])}}return this},abort:function(e){var t=e||w;return u&&u.abort(t),k(0,t),this}};if(h.promise(C).complete=g.add,C.success=C.done,C.error=C.fail,p.url=((e||p.url||yn)+"").replace(xn,"").replace(kn,mn[1]+"//"),p.type=n.method||n.type||p.method||p.type,p.dataTypes=x.trim(p.dataType||"*").toLowerCase().match(T)||[""],null==p.crossDomain&&(r=En.exec(p.url.toLowerCase()),p.crossDomain=!(!r||r[1]===mn[1]&&r[2]===mn[2]&&(r[3]||("http:"===r[1]?"80":"443"))===(mn[3]||("http:"===mn[1]?"80":"443")))),p.data&&p.processData&&"string"!=typeof p.data&&(p.data=x.param(p.data,p.traditional)),qn(An,p,n,C),2===b){return C}l=p.global,l&&0===x.active++&&x.event.trigger("ajaxStart"),p.type=p.type.toUpperCase(),p.hasContent=!Nn.test(p.type),o=p.url,p.hasContent||(p.data&&(o=p.url+=(bn.test(o)?"&":"?")+p.data,delete p.data),p.cache===!1&&(p.url=wn.test(o)?o.replace(wn,"$1_="+vn++):o+(bn.test(o)?"&":"?")+"_="+vn++)),p.ifModified&&(x.lastModified[o]&&C.setRequestHeader("If-Modified-Since",x.lastModified[o]),x.etag[o]&&C.setRequestHeader("If-None-Match",x.etag[o])),(p.data&&p.hasContent&&p.contentType!==!1||n.contentType)&&C.setRequestHeader("Content-Type",p.contentType),C.setRequestHeader("Accept",p.dataTypes[0]&&p.accepts[p.dataTypes[0]]?p.accepts[p.dataTypes[0]]+("*"!==p.dataTypes[0]?", "+Dn+"; q=0.01":""):p.accepts["*"]);for(i in p.headers){C.setRequestHeader(i,p.headers[i])}if(p.beforeSend&&(p.beforeSend.call(f,C,p)===!1||2===b)){return C.abort()}w="abort";for(i in {success:1,error:1,complete:1}){C[i](p[i])}if(u=qn(jn,p,n,C)){C.readyState=1,l&&d.trigger("ajaxSend",[C,p]),p.async&&p.timeout>0&&(s=setTimeout(function(){C.abort("timeout")},p.timeout));try{b=1,u.send(y,k)}catch(N){if(!(2>b)){throw N}k(-1,N)}}else{k(-1,"No Transport")}function k(e,n,r,i){var c,y,v,w,T,N=n;2!==b&&(b=2,s&&clearTimeout(s),u=t,a=i||"",C.readyState=e>0?4:0,c=e>=200&&300>e||304===e,r&&(w=Mn(p,C,r)),w=On(p,w,C,c),c?(p.ifModified&&(T=C.getResponseHeader("Last-Modified"),T&&(x.lastModified[o]=T),T=C.getResponseHeader("etag"),T&&(x.etag[o]=T)),204===e||"HEAD"===p.type?N="nocontent":304===e?N="notmodified":(N=w.state,y=w.data,v=w.error,c=!v)):(v=N,(e||!N)&&(N="error",0>e&&(e=0))),C.status=e,C.statusText=(n||N)+"",c?h.resolveWith(f,[y,N,C]):h.rejectWith(f,[C,N,v]),C.statusCode(m),m=t,l&&d.trigger(c?"ajaxSuccess":"ajaxError",[C,p,c?y:v]),g.fireWith(f,[C,N]),l&&(d.trigger("ajaxComplete",[C,p]),--x.active||x.event.trigger("ajaxStop")))}return C},getJSON:function(e,t,n){return x.get(e,t,n,"json")},getScript:function(e,n){return x.get(e,t,n,"script")}}),x.each(["get","post"],function(e,n){x[n]=function(e,r,i,o){return x.isFunction(r)&&(o=o||i,i=r,r=t),x.ajax({url:e,type:n,dataType:o,data:r,success:i})}});function Mn(e,n,r){var i,o,a,s,l=e.contents,u=e.dataTypes;while("*"===u[0]){u.shift(),o===t&&(o=e.mimeType||n.getResponseHeader("Content-Type"))}if(o){for(s in l){if(l[s]&&l[s].test(o)){u.unshift(s);break}}}if(u[0] in r){a=u[0]}else{for(s in r){if(!u[0]||e.converters[s+" "+u[0]]){a=s;break}i||(i=s)}a=a||i}return a?(a!==u[0]&&u.unshift(a),r[a]):t}function On(e,t,n,r){var i,o,a,s,l,u={},c=e.dataTypes.slice();if(c[1]){for(a in e.converters){u[a.toLowerCase()]=e.converters[a]}}o=c.shift();while(o){if(e.responseFields[o]&&(n[e.responseFields[o]]=t),!l&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),l=o,o=c.shift()){if("*"===o){o=l}else{if("*"!==l&&l!==o){if(a=u[l+" "+o]||u["* "+o],!a){for(i in u){if(s=i.split(" "),s[1]===o&&(a=u[l+" "+s[0]]||u["* "+s[0]])){a===!0?a=u[i]:u[i]!==!0&&(o=s[0],c.unshift(s[1]));break}}}if(a!==!0){if(a&&e["throws"]){t=a(t)}else{try{t=a(t)}catch(p){return{state:"parsererror",error:a?p:"No conversion from "+l+" to "+o}}}}}}}}return{state:"success",data:t}}x.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return x.globalEval(e),e}}}),x.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),x.ajaxTransport("script",function(e){if(e.crossDomain){var n,r=a.head||x("head")[0]||a.documentElement;return{send:function(t,i){n=a.createElement("script"),n.async=!0,e.scriptCharset&&(n.charset=e.scriptCharset),n.src=e.url,n.onload=n.onreadystatechange=function(e,t){(t||!n.readyState||/loaded|complete/.test(n.readyState))&&(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),n=null,t||i(200,"success"))},r.insertBefore(n,r.firstChild)},abort:function(){n&&n.onload(t,!0)}}}});var Fn=[],Bn=/(=)\?(?=&|$)|\?\?/;x.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Fn.pop()||x.expando+"_"+vn++;return this[e]=!0,e}}),x.ajaxPrefilter("json jsonp",function(n,r,i){var o,a,s,l=n.jsonp!==!1&&(Bn.test(n.url)?"url":"string"==typeof n.data&&!(n.contentType||"").indexOf("application/x-www-form-urlencoded")&&Bn.test(n.data)&&"data");return l||"jsonp"===n.dataTypes[0]?(o=n.jsonpCallback=x.isFunction(n.jsonpCallback)?n.jsonpCallback():n.jsonpCallback,l?n[l]=n[l].replace(Bn,"$1"+o):n.jsonp!==!1&&(n.url+=(bn.test(n.url)?"&":"?")+n.jsonp+"="+o),n.converters["script json"]=function(){return s||x.error(o+" was not called"),s[0]},n.dataTypes[0]="json",a=e[o],e[o]=function(){s=arguments},i.always(function(){e[o]=a,n[o]&&(n.jsonpCallback=r.jsonpCallback,Fn.push(o)),s&&x.isFunction(a)&&a(s[0]),s=a=t}),"script"):t});var Pn,Rn,Wn=0,$n=e.ActiveXObject&&function(){var e;for(e in Pn){Pn[e](t,!0)}};function In(){try{return new e.XMLHttpRequest}catch(t){}}function zn(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}x.ajaxSettings.xhr=e.ActiveXObject?function(){return !this.isLocal&&In()||zn()}:In,Rn=x.ajaxSettings.xhr(),x.support.cors=!!Rn&&"withCredentials" in Rn,Rn=x.support.ajax=!!Rn,Rn&&x.ajaxTransport(function(n){if(!n.crossDomain||x.support.cors){var r;return{send:function(i,o){var a,s,l=n.xhr();if(n.username?l.open(n.type,n.url,n.async,n.username,n.password):l.open(n.type,n.url,n.async),n.xhrFields){for(s in n.xhrFields){l[s]=n.xhrFields[s]}}n.mimeType&&l.overrideMimeType&&l.overrideMimeType(n.mimeType);try{for(s in i){l.setRequestHeader(s,i[s])}}catch(u){}l.send(n.hasContent&&n.data||null),r=function(e,i){var s,u,c,p;try{if(r&&(i||4===l.readyState)){if(r=t,a&&(l.onreadystatechange=x.noop,$n&&delete Pn[a]),i){4!==l.readyState&&l.abort()}else{p={},s=l.status,u=l.getAllResponseHeaders(),"string"==typeof l.responseText&&(p.text=l.responseText);try{c=l.statusText}catch(f){c=""}s||!n.isLocal||n.crossDomain?1223===s&&(s=204):s=p.text?200:404}}}catch(d){i||o(-1,d)}p&&o(s,c,p,u)},n.async?4===l.readyState?setTimeout(r):(a=++Wn,$n&&(Pn||(Pn={},x(e).unload($n)),Pn[a]=r),l.onreadystatechange=r):r()},abort:function(){r&&r(t,!0)}}}});var Xn,Un,Vn=/^(?:toggle|show|hide)$/,Yn=RegExp("^(?:([+-])=|)("+w+")([a-z%]*)$","i"),Jn=/queueHooks$/,Gn=[nr],Qn={"*":[function(e,t){var n=this.createTween(e,t),r=n.cur(),i=Yn.exec(t),o=i&&i[3]||(x.cssNumber[e]?"":"px"),a=(x.cssNumber[e]||"px"!==o&&+r)&&Yn.exec(x.css(n.elem,e)),s=1,l=20;if(a&&a[3]!==o){o=o||a[3],i=i||[],a=+r||1;do{s=s||".5",a/=s,x.style(n.elem,e,a+o)}while(s!==(s=n.cur()/r)&&1!==s&&--l)}return i&&(a=n.start=+a||+r||0,n.unit=o,n.end=i[1]?a+(i[1]+1)*i[2]:+i[2]),n}]};function Kn(){return setTimeout(function(){Xn=t}),Xn=x.now()}function Zn(e,t,n){var r,i=(Qn[t]||[]).concat(Qn["*"]),o=0,a=i.length;for(;a>o;o++){if(r=i[o].call(n,t,e)){return r}}}function er(e,t,n){var r,i,o=0,a=Gn.length,s=x.Deferred().always(function(){delete l.elem}),l=function(){if(i){return !1}var t=Xn||Kn(),n=Math.max(0,u.startTime+u.duration-t),r=n/u.duration||0,o=1-r,a=0,l=u.tweens.length;for(;l>a;a++){u.tweens[a].run(o)}return s.notifyWith(e,[u,o,n]),1>o&&l?n:(s.resolveWith(e,[u]),!1)},u=s.promise({elem:e,props:x.extend({},t),opts:x.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:Xn||Kn(),duration:n.duration,tweens:[],createTween:function(t,n){var r=x.Tween(e,u.opts,t,n,u.opts.specialEasing[t]||u.opts.easing);return u.tweens.push(r),r},stop:function(t){var n=0,r=t?u.tweens.length:0;if(i){return this}for(i=!0;r>n;n++){u.tweens[n].run(1)}return t?s.resolveWith(e,[u,t]):s.rejectWith(e,[u,t]),this}}),c=u.props;for(tr(c,u.opts.specialEasing);a>o;o++){if(r=Gn[o].call(u,e,c,u.opts)){return r}}return x.map(c,Zn,u),x.isFunction(u.opts.start)&&u.opts.start.call(e,u),x.fx.timer(x.extend(l,{elem:e,anim:u,queue:u.opts.queue})),u.progress(u.opts.progress).done(u.opts.done,u.opts.complete).fail(u.opts.fail).always(u.opts.always)}function tr(e,t){var n,r,i,o,a;for(n in e){if(r=x.camelCase(n),i=t[r],o=e[n],x.isArray(o)&&(i=o[1],o=e[n]=o[0]),n!==r&&(e[r]=o,delete e[n]),a=x.cssHooks[r],a&&"expand" in a){o=a.expand(o),delete e[r];for(n in o){n in e||(e[n]=o[n],t[n]=i)}}else{t[r]=i}}}x.Animation=x.extend(er,{tweener:function(e,t){x.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");var n,r=0,i=e.length;for(;i>r;r++){n=e[r],Qn[n]=Qn[n]||[],Qn[n].unshift(t)}},prefilter:function(e,t){t?Gn.unshift(e):Gn.push(e)}});function nr(e,t,n){var r,i,o,a,s,l,u=this,c={},p=e.style,f=e.nodeType&&nn(e),d=x._data(e,"fxshow");n.queue||(s=x._queueHooks(e,"fx"),null==s.unqueued&&(s.unqueued=0,l=s.empty.fire,s.empty.fire=function(){s.unqueued||l()}),s.unqueued++,u.always(function(){u.always(function(){s.unqueued--,x.queue(e,"fx").length||s.empty.fire()})})),1===e.nodeType&&("height" in t||"width" in t)&&(n.overflow=[p.overflow,p.overflowX,p.overflowY],"inline"===x.css(e,"display")&&"none"===x.css(e,"float")&&(x.support.inlineBlockNeedsLayout&&"inline"!==ln(e.nodeName)?p.zoom=1:p.display="inline-block")),n.overflow&&(p.overflow="hidden",x.support.shrinkWrapBlocks||u.always(function(){p.overflow=n.overflow[0],p.overflowX=n.overflow[1],p.overflowY=n.overflow[2]}));for(r in t){if(i=t[r],Vn.exec(i)){if(delete t[r],o=o||"toggle"===i,i===(f?"hide":"show")){continue}c[r]=d&&d[r]||x.style(e,r)}}if(!x.isEmptyObject(c)){d?"hidden" in d&&(f=d.hidden):d=x._data(e,"fxshow",{}),o&&(d.hidden=!f),f?x(e).show():u.done(function(){x(e).hide()}),u.done(function(){var t;x._removeData(e,"fxshow");for(t in c){x.style(e,t,c[t])}});for(r in c){a=Zn(f?d[r]:0,r,u),r in d||(d[r]=a.start,f&&(a.end=a.start,a.start="width"===r||"height"===r?1:0))}}}function rr(e,t,n,r,i){return new rr.prototype.init(e,t,n,r,i)}x.Tween=rr,rr.prototype={constructor:rr,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(x.cssNumber[n]?"":"px")},cur:function(){var e=rr.propHooks[this.prop];return e&&e.get?e.get(this):rr.propHooks._default.get(this)},run:function(e){var t,n=rr.propHooks[this.prop];return this.pos=t=this.options.duration?x.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):rr.propHooks._default.set(this),this}},rr.prototype.init.prototype=rr.prototype,rr.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=x.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){x.fx.step[e.prop]?x.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[x.cssProps[e.prop]]||x.cssHooks[e.prop])?x.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},rr.propHooks.scrollTop=rr.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},x.each(["toggle","show","hide"],function(e,t){var n=x.fn[t];x.fn[t]=function(e,r,i){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(ir(t,!0),e,r,i)}}),x.fn.extend({fadeTo:function(e,t,n,r){return this.filter(nn).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=x.isEmptyObject(e),o=x.speed(t,n,r),a=function(){var t=er(this,x.extend({},e),o);(i||x._data(this,"finish"))&&t.stop(!0)};return a.finish=a,i||o.queue===!1?this.each(a):this.queue(o.queue,a)},stop:function(e,n,r){var i=function(e){var t=e.stop;delete e.stop,t(r)};return"string"!=typeof e&&(r=n,n=e,e=t),n&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,n=null!=e&&e+"queueHooks",o=x.timers,a=x._data(this);if(n){a[n]&&a[n].stop&&i(a[n])}else{for(n in a){a[n]&&a[n].stop&&Jn.test(n)&&i(a[n])}}for(n=o.length;n--;){o[n].elem!==this||null!=e&&o[n].queue!==e||(o[n].anim.stop(r),t=!1,o.splice(n,1))}(t||!r)&&x.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=x._data(this),r=n[e+"queue"],i=n[e+"queueHooks"],o=x.timers,a=r?r.length:0;for(n.finish=!0,x.queue(this,e,[]),i&&i.stop&&i.stop.call(this,!0),t=o.length;t--;){o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1))}for(t=0;a>t;t++){r[t]&&r[t].finish&&r[t].finish.call(this)}delete n.finish})}});function ir(e,t){var n,r={height:e},i=0;for(t=t?1:0;4>i;i+=2-t){n=Zt[i],r["margin"+n]=r["padding"+n]=e}return t&&(r.opacity=r.width=e),r}x.each({slideDown:ir("show"),slideUp:ir("hide"),slideToggle:ir("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){x.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),x.speed=function(e,t,n){var r=e&&"object"==typeof e?x.extend({},e):{complete:n||!n&&t||x.isFunction(e)&&e,duration:e,easing:n&&t||t&&!x.isFunction(t)&&t};return r.duration=x.fx.off?0:"number"==typeof r.duration?r.duration:r.duration in x.fx.speeds?x.fx.speeds[r.duration]:x.fx.speeds._default,(null==r.queue||r.queue===!0)&&(r.queue="fx"),r.old=r.complete,r.complete=function(){x.isFunction(r.old)&&r.old.call(this),r.queue&&x.dequeue(this,r.queue)},r},x.easing={linear:function(e){return e},swing:function(e){return 0.5-Math.cos(e*Math.PI)/2}},x.timers=[],x.fx=rr.prototype.init,x.fx.tick=function(){var e,n=x.timers,r=0;for(Xn=x.now();n.length>r;r++){e=n[r],e()||n[r]!==e||n.splice(r--,1)}n.length||x.fx.stop(),Xn=t},x.fx.timer=function(e){e()&&x.timers.push(e)&&x.fx.start()},x.fx.interval=13,x.fx.start=function(){Un||(Un=setInterval(x.fx.tick,x.fx.interval))},x.fx.stop=function(){clearInterval(Un),Un=null},x.fx.speeds={slow:600,fast:200,_default:400},x.fx.step={},x.expr&&x.expr.filters&&(x.expr.filters.animated=function(e){return x.grep(x.timers,function(t){return e===t.elem}).length}),x.fn.offset=function(e){if(arguments.length){return e===t?this:this.each(function(t){x.offset.setOffset(this,e,t)})}var n,r,o={top:0,left:0},a=this[0],s=a&&a.ownerDocument;if(s){return n=s.documentElement,x.contains(n,a)?(typeof a.getBoundingClientRect!==i&&(o=a.getBoundingClientRect()),r=or(s),{top:o.top+(r.pageYOffset||n.scrollTop)-(n.clientTop||0),left:o.left+(r.pageXOffset||n.scrollLeft)-(n.clientLeft||0)}):o}},x.offset={setOffset:function(e,t,n){var r=x.css(e,"position");"static"===r&&(e.style.position="relative");var i=x(e),o=i.offset(),a=x.css(e,"top"),s=x.css(e,"left"),l=("absolute"===r||"fixed"===r)&&x.inArray("auto",[a,s])>-1,u={},c={},p,f;l?(c=i.position(),p=c.top,f=c.left):(p=parseFloat(a)||0,f=parseFloat(s)||0),x.isFunction(t)&&(t=t.call(e,n,o)),null!=t.top&&(u.top=t.top-o.top+p),null!=t.left&&(u.left=t.left-o.left+f),"using" in t?t.using.call(e,u):i.css(u)}},x.fn.extend({position:function(){if(this[0]){var e,t,n={top:0,left:0},r=this[0];return"fixed"===x.css(r,"position")?t=r.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),x.nodeName(e[0],"html")||(n=e.offset()),n.top+=x.css(e[0],"borderTopWidth",!0),n.left+=x.css(e[0],"borderLeftWidth",!0)),{top:t.top-n.top-x.css(r,"marginTop",!0),left:t.left-n.left-x.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||s;while(e&&!x.nodeName(e,"html")&&"static"===x.css(e,"position")){e=e.offsetParent}return e||s})}}),x.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,n){var r=/Y/.test(n);x.fn[e]=function(i){return x.access(this,function(e,i,o){var a=or(e);return o===t?a?n in a?a[n]:a.document.documentElement[i]:e[i]:(a?a.scrollTo(r?x(a).scrollLeft():o,r?o:x(a).scrollTop()):e[i]=o,t)},e,i,arguments.length,null)}});function or(e){return x.isWindow(e)?e:9===e.nodeType?e.defaultView||e.parentWindow:!1}x.each({Height:"height",Width:"width"},function(e,n){x.each({padding:"inner"+e,content:n,"":"outer"+e},function(r,i){x.fn[i]=function(i,o){var a=arguments.length&&(r||"boolean"!=typeof i),s=r||(i===!0||o===!0?"margin":"border");return x.access(this,function(n,r,i){var o;return x.isWindow(n)?n.document.documentElement["client"+e]:9===n.nodeType?(o=n.documentElement,Math.max(n.body["scroll"+e],o["scroll"+e],n.body["offset"+e],o["offset"+e],o["client"+e])):i===t?x.css(n,r,s):x.style(n,r,i,s)},n,a?i:t,a,null)}})}),x.fn.size=function(){return this.length},x.fn.andSelf=x.fn.addBack,"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=x:(e.jQuery=e.$=x,"function"==typeof define&&define.amd&&define("jquery",[],function(){return x}))})(window);
/*!
 * jQuery Migrate - v1.2.1 - 2013-05-08
 * https://github.com/jquery/jquery-migrate
 * Copyright 2005, 2013 jQuery Foundation, Inc. and other contributors; Licensed MIT
 */
(function(u,r,j){var F={};u.migrateWarnings=[];if(!u.migrateMute&&r.console&&r.console.log){r.console.log("JQMIGRATE: Logging is active")}if(u.migrateTrace===j){u.migrateTrace=true}u.migrateReset=function(){F={};u.migrateWarnings.length=0};function h(J){var I=r.console;if(!F[J]){F[J]=true;u.migrateWarnings.push(J);if(I&&I.warn&&!u.migrateMute){I.warn("JQMIGRATE: "+J);if(u.migrateTrace&&I.trace){I.trace()}}}}function a(K,M,J,L){if(Object.defineProperty){try{Object.defineProperty(K,M,{configurable:true,enumerable:true,get:function(){h(L);return J},set:function(N){h(L);J=N}});return}catch(I){}}u._definePropertyBroken=true;K[M]=J}if(document.compatMode==="BackCompat"){h("jQuery is not compatible with Quirks Mode")}var f=u("<input/>",{size:1}).attr("size")&&u.attrFn,z=u.attr,y=u.attrHooks.value&&u.attrHooks.value.get||function(){return null},k=u.attrHooks.value&&u.attrHooks.value.set||function(){return j},v=/^(?:input|button)$/i,A=/^[238]$/,D=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,l=/^(?:checked|selected)$/i;a(u,"attrFn",f||{},"jQuery.attrFn is deprecated");u.attr=function(M,K,N,L){var J=K.toLowerCase(),I=M&&M.nodeType;if(L){if(z.length<4){h("jQuery.fn.attr( props, pass ) is deprecated")}if(M&&!A.test(I)&&(f?K in f:u.isFunction(u.fn[K]))){return u(M)[K](N)}}if(K==="type"&&N!==j&&v.test(M.nodeName)&&M.parentNode){h("Can't change the 'type' of an input or button in IE 6/7/8")}if(!u.attrHooks[J]&&D.test(J)){u.attrHooks[J]={get:function(P,O){var R,Q=u.prop(P,O);return Q===true||typeof Q!=="boolean"&&(R=P.getAttributeNode(O))&&R.nodeValue!==false?O.toLowerCase():j},set:function(P,R,O){var Q;if(R===false){u.removeAttr(P,O)}else{Q=u.propFix[O]||O;if(Q in P){P[Q]=true}P.setAttribute(O,O.toLowerCase())}return O}};if(l.test(J)){h("jQuery.fn.attr('"+J+"') may use property instead of attribute")}}return z.call(u,M,K,N)};u.attrHooks.value={get:function(J,I){var K=(J.nodeName||"").toLowerCase();if(K==="button"){return y.apply(this,arguments)}if(K!=="input"&&K!=="option"){h("jQuery.fn.attr('value') no longer gets properties")}return I in J?J.value:null},set:function(I,J){var K=(I.nodeName||"").toLowerCase();if(K==="button"){return k.apply(this,arguments)}if(K!=="input"&&K!=="option"){h("jQuery.fn.attr('value', val) no longer sets properties")}I.value=J}};var s,G,B=u.fn.init,C=u.parseJSON,x=/^([^<]*)(<[\w\W]+>)([^>]*)$/;u.fn.init=function(I,L,K){var J;if(I&&typeof I==="string"&&!u.isPlainObject(L)&&(J=x.exec(u.trim(I)))&&J[0]){if(I.charAt(0)!=="<"){h("$(html) HTML strings must start with '<' character")}if(J[3]){h("$(html) HTML text after last tag is ignored")}if(J[0].charAt(0)==="#"){h("HTML string cannot start with a '#' character");u.error("JQMIGRATE: Invalid selector string (XSS)")}if(L&&L.context){L=L.context}if(u.parseHTML){return B.call(this,u.parseHTML(J[2],L,true),L,K)}}return B.apply(this,arguments)};u.fn.init.prototype=u.fn;u.parseJSON=function(I){if(!I&&I!==null){h("jQuery.parseJSON requires a valid JSON string");return null}return C.apply(this,arguments)};u.uaMatch=function(J){J=J.toLowerCase();var I=/(chrome)[ \/]([\w.]+)/.exec(J)||/(webkit)[ \/]([\w.]+)/.exec(J)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(J)||/(msie) ([\w.]+)/.exec(J)||J.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(J)||[];return{browser:I[1]||"",version:I[2]||"0"}};if(!u.browser){s=u.uaMatch(navigator.userAgent);G={};if(s.browser){G[s.browser]=true;G.version=s.version}if(G.chrome){G.webkit=true}else{if(G.webkit){G.safari=true}}u.browser=G}a(u,"browser",u.browser,"jQuery.browser is deprecated");u.sub=function(){function I(L,M){return new I.fn.init(L,M)}u.extend(true,I,this);I.superclass=this;I.fn=I.prototype=this();I.fn.constructor=I;I.sub=this.sub;I.fn.init=function K(L,M){if(M&&M instanceof u&&!(M instanceof I)){M=I(M)}return u.fn.init.call(this,L,M,J)};I.fn.init.prototype=I.fn;var J=I(document);h("jQuery.sub() is deprecated");return I};u.ajaxSetup({converters:{"text json":u.parseJSON}});var p=u.fn.data;u.fn.data=function(K){var J,I,L=this[0];if(L&&K==="events"&&arguments.length===1){J=u.data(L,K);I=u._data(L,K);if((J===j||J===I)&&I!==j){h("Use of jQuery.fn.data('events') is deprecated");return I}}return p.apply(this,arguments)};var q=/\/(java|ecma)script/i,w=u.fn.andSelf||u.fn.addBack;u.fn.andSelf=function(){h("jQuery.fn.andSelf() replaced by jQuery.fn.addBack()");return w.apply(this,arguments)};if(!u.clean){u.clean=function(I,J,P,L){J=J||document;J=!J.nodeType&&J[0]||J;J=J.ownerDocument||J;h("jQuery.clean() is deprecated");var M,K,N,Q,O=[];u.merge(O,u.buildFragment(I,J).childNodes);if(P){N=function(R){if(!R.type||q.test(R.type)){return L?L.push(R.parentNode?R.parentNode.removeChild(R):R):P.appendChild(R)}};for(M=0;(K=O[M])!=null;M++){if(!(u.nodeName(K,"script")&&N(K))){P.appendChild(K);if(typeof K.getElementsByTagName!=="undefined"){Q=u.grep(u.merge([],K.getElementsByTagName("script")),N);O.splice.apply(O,[M+1,0].concat(Q));M+=Q.length}}}}return O}}var c=u.event.add,b=u.event.remove,g=u.event.trigger,t=u.fn.toggle,d=u.fn.live,o=u.fn.die,E="ajaxStart|ajaxStop|ajaxSend|ajaxComplete|ajaxError|ajaxSuccess",e=new RegExp("\\b(?:"+E+")\\b"),H=/(?:^|\s)hover(\.\S+|)\b/,n=function(I){if(typeof(I)!=="string"||u.event.special.hover){return I}if(H.test(I)){h("'hover' pseudo-event is deprecated, use 'mouseenter mouseleave'")}return I&&I.replace(H,"mouseenter$1 mouseleave$1")};if(u.event.props&&u.event.props[0]!=="attrChange"){u.event.props.unshift("attrChange","attrName","relatedNode","srcElement")}if(u.event.dispatch){a(u.event,"handle",u.event.dispatch,"jQuery.event.handle is undocumented and deprecated")}u.event.add=function(L,J,K,M,I){if(L!==document&&e.test(J)){h("AJAX events should be attached to document: "+J)}c.call(this,L,n(J||""),K,M,I)};u.event.remove=function(M,K,L,I,J){b.call(this,M,n(K)||"",L,I,J)};u.fn.error=function(){var I=Array.prototype.slice.call(arguments,0);h("jQuery.fn.error() is deprecated");I.splice(0,0,"error");if(arguments.length){return this.bind.apply(this,I)}this.triggerHandler.apply(this,I);return this};u.fn.toggle=function(M,K){if(!u.isFunction(M)||!u.isFunction(K)){return t.apply(this,arguments)}h("jQuery.fn.toggle(handler, handler...) is deprecated");var J=arguments,I=M.guid||u.guid++,L=0,N=function(O){var P=(u._data(this,"lastToggle"+M.guid)||0)%L;u._data(this,"lastToggle"+M.guid,P+1);O.preventDefault();return J[P].apply(this,arguments)||false};N.guid=I;while(L<J.length){J[L++].guid=I}return this.click(N)};u.fn.live=function(I,K,J){h("jQuery.fn.live() is deprecated");if(d){return d.apply(this,arguments)}u(this.context).on(I,this.selector,K,J);return this};u.fn.die=function(I,J){h("jQuery.fn.die() is deprecated");if(o){return o.apply(this,arguments)}u(this.context).off(I,this.selector||"**",J);return this};u.event.trigger=function(K,L,J,I){if(!J&&!e.test(K)){h("Global events are undocumented and deprecated")}return g.call(this,K,L,J||document,I)};u.each(E.split("|"),function(J,I){u.event.special[I]={setup:function(){var K=this;if(K!==document){u.event.add(document,I+"."+u.guid,function(){u.event.trigger(I,null,K,true)});u._data(this,I,u.guid++)}return false},teardown:function(){if(this!==document){u.event.remove(document,I+"."+u._data(this,I))}return false}}})})(jQuery,window);
/*!
 * jQuery-ajaxTransport-XDomainRequest - v1.0.3 - 2014-06-06
 * https://github.com/MoonScript/jQuery-ajaxTransport-XDomainRequest
 * Copyright (c) 2014 Jason Moon (@JSONMOON)
 * Licensed MIT (/blob/master/LICENSE.txt)
 */
(function(b){if(typeof define==="function"&&define.amd){define(["jquery"],b)}else{if(typeof exports==="object"){module.exports=b(require("jquery"))}else{b(jQuery)}}}(function(a){if(a.support.cors||!a.ajaxTransport||!window.XDomainRequest){return}var d=/^https?:\/\//i;var c=/^get|post$/i;var b=new RegExp("^"+location.protocol,"i");a.ajaxTransport("* text html xml json",function(h,g,f){if(!h.crossDomain||!h.async||!c.test(h.type)||!d.test(h.url)||!b.test(h.url)){return}var e=null;return{send:function(n,l){var k="";var j=(g.dataType||"").toLowerCase();e=new XDomainRequest();if(/^\d+$/.test(g.timeout)){e.timeout=g.timeout}e.ontimeout=function(){l(500,"timeout")};e.onload=function(){var p="Content-Length: "+e.responseText.length+"\r\nContent-Type: "+e.contentType;var o={code:200,message:"success"};var t={text:e.responseText};try{if(j==="html"||/text\/html/i.test(e.contentType)){t.html=e.responseText}else{if(j==="json"||(j!=="text"&&/\/json/i.test(e.contentType))){try{t.json=a.parseJSON(e.responseText)}catch(r){o.code=500;o.message="parseerror"}}else{if(j==="xml"||(j!=="text"&&/\/xml/i.test(e.contentType))){var s=new ActiveXObject("Microsoft.XMLDOM");s.async=false;try{s.loadXML(e.responseText)}catch(r){s=undefined}if(!s||!s.documentElement||s.getElementsByTagName("parsererror").length){o.code=500;o.message="parseerror";throw"Invalid XML: "+e.responseText}t.xml=s}}}}catch(q){throw q}finally{l(o.code,o.message,t,p)}};e.onprogress=function(){};e.onerror=function(){l(500,"error",{text:e.responseText})};if(g.data){k=(a.type(g.data)==="string")?g.data:a.param(g.data)}e.open(h.type,h.url);e.send(k)},abort:function(){if(e){e.abort()}}}})}));jQuery.cookie=function(d,e,b){if(arguments.length>1&&String(e)!=="[object Object]"){b=jQuery.extend({},b);if(e===null||e===undefined){b.expires=-1}if(typeof b.expires==="number"){var g=b.expires,c=b.expires=new Date();c.setDate(c.getDate()+g)}e=String(e);return(document.cookie=[encodeURIComponent(d),"=",b.raw?e:encodeURIComponent(e),b.expires?"; expires="+b.expires.toUTCString():"",b.path?"; path="+b.path:"",b.domain?"; domain="+b.domain:"",b.secure?"; secure":""].join(""))}b=e||{};var a,f=b.raw?function(h){return h}:decodeURIComponent;return(a=new RegExp("(?:^|; )"+encodeURIComponent(d)+"=([^;]*)").exec(document.cookie))?f(a[1]):null};(function(d){var f={put:function(j,h){var g=h||window;if(g.location.hash.replace(/^(#!|#)/,"")!=j){g.location.hash=j}},get:function(g){return((g||window).location.hash).replace(/^(#!|#)/,"")},encoder:encodeURIComponent};var c={id:"__jQuery_history",init:function(){var g='<iframe id="'+this.id+'" style="display:none" src="javascript:false;" />';d("body").prepend(g);return this},_document:function(){return d("#"+this.id)[0].contentWindow.document},put:function(h){var g=this._document();g.open();g.close();f.put(h,g)},get:function(){return f.get(this._document())}};function e(h){h=d.extend({unescape:false},h||{});f.encoder=j(h.unescape);function j(k){if(k===true){return function(l){return l}}if(typeof k=="string"&&(k=g(k.split("")))||typeof k=="function"){return function(l){return k(encodeURIComponent(l))}}return encodeURIComponent}function g(l){var k=new RegExp(d.map(l,encodeURIComponent).join("|"),"ig");return function(n){return n.replace(k,decodeURIComponent)}}}var b={};b.base={callback:undefined,type:undefined,check:function(){},load:function(g){},init:function(h,g){e(g);a.callback=h;a._options=g;a._init()},_init:function(){},_options:{}};b.timer={_appState:undefined,_init:function(){var g=f.get();a._appState=g;a.callback(g);setInterval(a.check,100)},check:function(){var g=f.get();if(g!=a._appState){a._appState=g;a.callback(g)}},load:function(g){if(g!=a._appState){f.put(g);a._appState=g;a.callback(g)}}};b.iframeTimer={_appState:undefined,_init:function(){var g=f.get();a._appState=g;c.init().put(g);a.callback(g);setInterval(a.check,100)},check:function(){var h=c.get().replace(/^#/,""),g=f.get();if(g.indexOf("#")>-1){return}if(g!=h){if(g==a._appState){a._appState=h;f.put("#!"+h);a.callback(h)}else{a._appState=g;c.put(g);a.callback(g)}}},load:function(g){if(g!=a._appState){f.put(g);c.put(g);a._appState=g;a.callback(g)}}};b.hashchangeEvent={_init:function(){var h=f.get(),g=h.indexOf("#");if(g<0&&h.indexOf("#!")<0){a.callback(f.get());d(window).bind("hashchange",a.check)}else{if(g>-1){Jalor.UI.showMessage($i18n("Jalor.History.HashTip"),"error");Jalor.UI.loadingClose()}}},check:function(){var g=f.get();if(g.indexOf("#")<0){a.callback(f.get())}else{Jalor.UI.showMessage($i18n("Jalor.History.HashTip"),"error")}},load:function(g){f.put(g)}};var a=d.extend({},b.base);if("onhashchange" in window){a.type="hashchangeEvent"}else{if(d.browser.msie&&(d.browser.version<8||document.documentMode<8)){a.type="iframeTimer"}else{a.type="timer"}}d.extend(a,b[a.type]);d.history=a})(jQuery);(function(h){function o(a,f,g,t){var contentType=t==="json"?"application/json":"text/plain;charset=UTF-8";var dataType=t==="json"?"json":"text";h.ajax({url:a,async:false,cache:true,contentType:contentType,dataType:dataType,success:function(d){if(t==="json"){h.i18n.map=d;return}var n="";d=d.split(/\n/);for(var p=/(\{\d+\})/g,q=/\{(\d+)\}/g,s=/(\\u.{4})/ig,j=0;j<d.length;j++){d[j]=d[j].replace(/^\s\s*/,"").replace(/\s\s*$/,"");if(d[j].length>0&&d[j].match("^#")!="#"){var b=d[j].split("=");if(b.length>0){for(var l=unescape(b[0]).replace(/^\s\s*/,"").replace(/\s\s*$/,""),c=b.length==1?"":b[1];c.match(/\\$/)=="\\";){c=c.substring(0,c.length-1);c+=d[++j].replace(/\s\s*$/,"")}for(var e=2;e<b.length;e++){c+="="+b[e]}c=c.replace(/^\s\s*/,"").replace(/\s\s*$/,"");if(g=="map"||g=="both"){if(b=c.match(s)){for(e=0;e<b.length;e++){c=c.replace(b[e],t(b[e]))}}h.i18n.map[l]=c}if(g=="vars"||g=="both"){if(/\./.test(l)){b="";e=l.split(/\./);for(var k=0;k<e.length;k++){if(k>0){b+="."}b+=e[k];eval("typeof "+b+' == "undefined"')&&eval(b+"={};")}}if(p.test(c)){b=c.split(p);e=true;k="";for(var r=[],m=0;m<b.length;m++){if(p.test(b[m])&&r.indexOf(b[m])==-1){e||(k+=",");k+=b[m].replace(q,"v$1");r.push(b[m]);e=false}}n+=l+"=function("+k+"){";l='"'+c.replace(q,'"+v$1+"')+'"';n+="return "+l+";};"}else{n+=l+'="'+c+'";'}}}}}eval(n)}})}function t(a){var f=[];a=parseInt(a.substr(2),16);a>=0&&a<Math.pow(2,16)&&f.push(a);a="";for(var g=0;g<f.length;++g){a+=String.fromCharCode(f[g])}return a}h.i18n={};h.i18n.map={};h.i18n.properties=function(a){a=h.extend({name:"Messages",language:"",path:"",mode:"vars",callback:function(){}},a);if(a.language===null||a.language==""){a.language=h.i18n.browserLang()}if(a.language===null){a.language=""}var f=a.name&&a.name.constructor==Array?a.name:[a.name];for(i=0;i<f.length;i++){o(a.path+f[i]+"",a.language,a.mode,a.dataType)}a.callback&&a.callback()};h.i18n.prop=function(a,f){var g=h.i18n.map[a];if(g==null){g=a}else{if(f){for(var d=0;d<f.length;d++){g=g.replace(new RegExp("\\{("+d+")\\}","g"),f[d])}}}if(typeof g==="string"&&workspaceVO.config.badScriptWords=="0"){g=g.encodeHtml()}else{if(typeof g==="string"&&workspaceVO.config.badScriptWords!="1"){var regs=workspaceVO.config.badScriptWords.split(",");for(var i=0;len=regs.length,i<len;i++){var reg=new RegExp(regs[i],"g");g=g.replace(reg,"")}}}return g};h.i18n.browserLang=function(){var a=navigator.language||navigator.userLanguage;a=a.toLowerCase();if(a.length>3){a=a.substring(0,3)+a.substring(3).toUpperCase()}return a}})(jQuery);if(!this.JSON){this.JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==="string"){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());(function(){typeof(Object.create)!=="function"&&(Object.create=function(c){var b=function(){};b.prototype=c;return new b()});$.mergeObj=function(e,b,c){var d;if(e==null){return $.extend(c,{},b)}$.isEmptyObject(b)||$.each(b,function(f,g){if(g!=null){d=e[f];if(d==null){e[f]=g}else{if(c&&$.isPlainObject(d)){$.mergeObj(d,g,c)}}}});return e};$.mergeFn=function(c,b,d){if(c){if(b){return function(){d&&b.apply(this,arguments);c.apply(this,arguments);d||b.apply(this,arguments)}}else{return c}}else{return b}};$.IObject=function(c,e,d,f){var b=arguments;if(typeof(c)!=="string"){f=b[2];d=b[1];e=b[0];c=null}var g=function(){this._indicators={};this.initTrigger&&this.initTrigger();this.init&&this.init.apply(this,arguments)};if(d){g.prototype=Object.create(d.prototype||d);g.prototype.base=d.prototype||d;g.prototype.constructor=g}else{g.prototype.fn=e}g.fn=g.prototype;$.extend(g.fn,$.IObject.Base);f&&$.inherit(g,$.ITrigger);e!=null&&$.inherit(g,e);g.fn.__type="iobject";c&&(g.fn.__name=c);return g};$.IObject.Base={extend:function(b){$.extend(this,b);return this},proxy:function(c,b){if(c){if(!$.isArray(b)){b=Array.prototype.slice.call(arguments,1)}return c.apply(this,b)}},call:function(c,d,b){if(d){if(!$.isArray(b)){b=Array.prototype.slice.call(arguments,1)}return d.apply(c,b)}},getParent:function(b){var d=this.base,c=this.__name;if(c==null&&b==null){return d}while(d){if(b){if(b&&d.__name==b){return d}}else{if(c!=d.__name){return d}}d=d.base}return d},_indicator:function(c,b){if(arguments.length>1){this._indicators[c]=b}else{return this._indicators[c]}},callParent:function(h,g,d){if(!this.base){return}if(typeof(g)!="string"){d=g;g=null}var f,e,b,c=this._indicator(h)||this;f=g?c.getParent(g):(c.base||c.fn.base||c);if(f&&(e=f[h])){this._indicator(h,f);b=e.apply(this,d)}this._indicator(h,null);return b}};$.inherit=function(b,c){$.extend(b.fn||b.prototype,c.prototype||c)};var a=$.IObject({init:function(c,e,b,d){this._list={};this.length=0;this.type=d;this.base=a.fn;e!=null&&$.extend(this,e);if(c){if(d=="copy"||c.__type=="iobject"){this._mapping=c}else{this._mapping=$.IObject("base",c)}}if(b){this._list.def=this.create()}},create:function(d,c){var e,b;if(c&&(c=this.get(c,false))){b=c}else{b=this._mapping}if(b){if(this.type=="copy"){e=$.extend(true,{},b,d);e.base=d}else{e=$.IObject(d,b);e=this.type=="object"?e:new e}}else{e=d}return e},add:function(e,f,d){var h=e.split(","),g;e=h.shift();if(f){f.__name=e}else{f={__name:e}}g=this._list[e]=this.create(f,d);if(h.length){for(var c=0,b=h.length;c<b;c++){this._list[h[c]]=g}}this.length++;return this},remove:function(b){var c=this._list[b];if(c){this.length--;this._list[b]=null}},push:function(e,f,d){var c=this;if($.isPlainObject(e)){var b=e;d=f;$.each(b,function(g,h){if(h){if(h.proto){c.add(g,h.proto,h.parent||d)}else{c.add(g,h,d)}}})}else{c.add(e,f,d)}return c},get:function(c,b){var d=this._list[c];if(!d&&b!==false){d=this.type=="copy"?$.extend(true,{},this._list.def):this._list.def}d&&(d.type=c);return d},setDefault:function(b){var c=this._list[b];if(c){this._list.def=c}},fire:function(d){if(this.length){var c=this.get(d);if($.type(c)=="function"){var b=Array.prototype.slice.call(arguments,1);return c.apply(null,b)}}},fireAll:function(c){if(this.length&&this._list){var b=Array.prototype.slice.call(arguments,1);$.each(this._list,function(e,f){var d=c?(f[c]||f):f;$.type(d)=="function"&&d.apply(f,b)})}}});$.IFactory=$.IAdapter=function(c,e,b,d){if(arguments.length==1&&c.mapping){var f=c;return new a(f.mapping,f.proto,f.setDefault,f.type)}else{return new a(c,e,b,d)}};$.IHandler=function(){return{_list:[],add:function(b){this._list.push(b);this.length=this._list.length},fire:function(){if(this._list.length){var c=arguments,b;$.each(this._list,function(d,e){b=e.apply(null,c);if(b===false){return false}});return b}},fireWithResult:function(){if(this._list.length){var c=Array.prototype.slice.call(arguments,0),d=c.shift(),b;$.each(this._list,function(e,f){b=f.apply(b||d,c);if(b===false){return false}});return b}}}};$.ITrigger={initTrigger:function(){this._trMap={};this._fnMap={}},_initTriggerOp:function(b){var d,c=b[0];if(typeof(b[0])=="string"){d={name:c,fn:b[1],step:b[2]}}else{d=c}d.step||(d.step="after");return d},_checkTriggerMap:function(b){var c=this.getTrigger(b);if(!c){c=this._trMap[b]={}}return c},_addTrigger:function(e,c,d){var b=e[d];b||(b=e[d]=$.Callbacks());b.add(c);return this},getTrigger:function(b){return this._trMap[b]},addTrigger:function(b,c,e){var f=this._initTriggerOp(arguments),d=this._checkTriggerMap(f.name);return this._addTrigger(d,f.fn,f.step)},bindTrigger:function(c,d,e){var f=this._initTriggerOp(arguments);c=f.name;this.addTrigger(f);var b=this._fnMap[c];if(!b){this._fnMap[c]=this[c];this[c]=function(){var h=Array.prototype.slice.call(arguments,0),j=this._trMap[c],g;if(this.fireTrigger(j.before,h)===false){return false}g=this.proxy(this._fnMap[c],h);if(h){h.result=g}else{h={result:g}}this.fireTrigger(j.after,h);return g}}return this},fireTrigger:function(c,b,d){if(typeof(c)=="string"){var e=this._trMap[c];c=e?e[d||"after"]:null}if(c){return c.fireWith(this,b)}},unbindTrigger:function(b){delete this._trMap[b]},clearTrigger:function(b){if(b){delete this._trMap[b]}else{this.initTrigger()}return this},extend:function(c){var b=this;$.each(c,function(d,e){if(b._fnMap[d]){b._fnMap[d]=e}else{b[d]=e}});return b}};DomClass={getProp:function(c,b,h,f,d){var e=c._domProps;e||(e=c._domProps={});var g=e[h];if(!g){e[h]=g=d?b.find(f):b.children(f)}return g},clear:function(b){b._domProps={}}}})();var Jalor={Core:{beforeFoward:$.Callbacks(),afterFoward:$.Callbacks()},UI:{Resizes:$.Callbacks(),Renders:$.Callbacks()},Init:{AfterCore:$.Callbacks("once"),AfterUI:$.Callbacks("once"),AfterSystem:$.Callbacks("once"),Complete:$.Callbacks("once")}};Jalor._Init=Jalor.Init.AfterCore;Jalor.getRequest=function(){var d=new Object();var h=window.location.href;var j=h.search("#");if(j<0){return{}}var b=h.substr(j+1).split("?");if(b.length>1){var a=b[1].split("&");for(var c=0;c<a.length;c++){var g=a[c].indexOf("=");if(g==-1){continue}var f=a[c].substring(0,g);var k=a[c].substring(g+1);try{k=decodeURIComponent(k);d[f]=k}catch(e){Jalor.UI.showMessage($i18n("Jalor.Page.Paramter.Error").formatText(k),"error");return{}}}}return d};Jalor.appendParamToRequestUrl=function(a){var d=workspaceVO.config.enabledParamterAppendToRequest;if(d){var f=Jalor.getRequest(),e=d.split(","),g=[];if(f){for(var b in f){if(e.contains(b)){g.push(b+"="+encodeURIComponent(f[b]))}}var h=a.lastIndexOf("."),l=a.substring(h),k=l.indexOf("?"),c=g.join("&"),j=l.indexOf(c);if(j<0){a+=k>-1?"&"+c:"?"+c}}}return a};$.ajaxSetup({cache:true,beforeSend:function(n){var b=this.url,k=this,d=Jalor.Config,c=d.Global.rootUrl,e=workspaceVO;if(b.indexOf(c)==0||(b.indexOf("http://")!=0&&b.indexOf("https://")!=0&&b.indexOf("/")!=0&&b.indexOf("../")!=0)){if(Jalor.Static&&Jalor.Static.isXDRCross){return}if(b.indexOf(c)==0){b=b.replace(c,"")}var f=Jalor.Static&&Jalor.Static.getAppVersion&&Jalor.Static.getAppVersion(b),h=Jalor.appendParamToRequestUrl;serviceCacheList=e.serviceCacheList;if(f&&b.indexOf(".js",b.length-3)!=-1&&b.indexOf("?")==-1){var l=e.envBean.exclusions,g;if(l){g=b.substring(c.length);g="/"+g.substr(0,g.indexOf("/")+1);if(l.contains(g)){return}}this.url=[b.substr(0,b.length-3),".js?version=",f].join("");this.url=Jalor.Static.getStaticUrl(this.url)}else{if(this.type.toUpperCase()=="GET"&&b.indexOf("services/")!=-1){b=h(b);if(serviceCacheList){var j=d.Service,o=j.serviceCache||(j.serviceCache=new Jalor.HashMap());$(serviceCacheList).each(function(r,p){try{var s=o.get(p.moduleName);if(!s){s=new RegExp(p.urlPattern);o.put(p.moduleName,s)}if(s.test(b)){k.url=[b,b.indexOf("?")==-1?"?":"&","jalorVersion=",p.version].join("");return false}}catch(q){Jalor.Log.error(q)}})}else{k.url=b}}else{if(f&&!/^(servlet|services|internalservices|publicservices)\//.test(b)&&b.indexOf(".html")!=-1){if(Jalor.Static&&Jalor.Static.isXDRCross){return}var a=b.split("?");this.url=[a[0],"?version=",f,a[1]?"&"+a[1]:""].join("");this.url=Jalor.Static&&Jalor.Static.getStaticUrl&&Jalor.Static.getStaticUrl(this.url)||this.url;this.url=h(this.url)}else{if(workspaceVO.config.i18nVersion&&b.indexOf("servlet/i18n")!=-1){this.url=[b,"&version=",workspaceVO.config.i18nVersion].join("");this.url=h(this.url)}}}}}}});Jalor.Config={Service:{languageUrl:"servlet/switchLanguage?backUrl={0}&switchTo={1}",changeRole:"servlet/changeRole?backUrl={0}&currentrole={1}"},Global:{refresh:0,catchErr:workspaceVO.envBean.profileName=="dev"?false:true,appVersion:workspaceVO.config.appVersion,rootUrl:document.location.protocol+"//"+document.location.host+workspaceVO.contextPath},Format:{sysDate:"yyyy-MM-dd",sysDateTime:"yyyy-MM-dd hh:mm:ss",date:"yyyy-MM-dd",datetime:"yyyy-MM-dd hh:mm:ss",datehm:"yyyy-MM-dd hh:mm",dateym:"yyyy-MM",months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],MDFormat:"",decimalfraction:2,valueSplit:",",textSplit:"; ",currencyFlag:null,fileSize:["B","KB","MB","GB","TB"],fileSizeFraction:2,yes:"Yes",no:"No",valueField:"value",displayField:"text"},Regular:{sysDate:/^(\d{4})(-|\/)(\d{1,2})\2(\d{1,2})$/,sysDateTime:/^(\d{4})(-|\/)(\d{1,2})\2(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})$/,serverDate:/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.\d{3}\+\d{4}$/,date:/^(\d{4})(-|\/)(\d{1,2})\2(\d{1,2})$/,datetime:/^(\d{4})(-|\/)(\d{1,2})\2(\d{1,2}) (\d{1,2}):(\d{1,2})(:(\d{1,2})|)$/,datehm:/^(\d{4})(-|\/)(\d{1,2})\2(\d{1,2}) (\d{1,2}):(\d{1,2})$/,dateym:/^(\d{4})(-|\/)(\d{1,2})$/},Log:{debug:1,info:2,warn:3,error:4},Local:{zh:"zh_CN",en:"en_US",cookie:"language"},Panel:{main:"jalorContentPanel",centent:"mainTableContent",frame:"jalorloadIframe",leftPanel:"#leftPanel",globalLoading:"#jalorContentPanel"},PushMsg:{open:workspaceVO.config.enablePushMessage,delayLoad:2000,service:"services/jalor/message/list",viewService:"services/jalor/message/list/page/{0}/{1}",markReadedService:"services/jalor/message/update/read/{0}",maxTime:10,alternation:30000,delayHide:Math.min(Math.max(workspaceVO.config.delayHide,10000),60000)||15000},Helper:{open:workspaceVO.config.enableDynamicHelp,service:"services/jalor/web/support/helper/list/user",readService:"services/jalor/web/support/helper/mapping",delayInit:1000},InfoTip:{open:workspaceVO.config.enableInfoTip,service:"services/jalor/web/support/helper/list/info",contentService:"services/jalor/htmlarea/query/list/InfoTip/{0}",templateService:"services/jalor/htmlarea/query/list/InfoTipTemplate/{0}",editService:"services/jalor/htmlarea/infotip/single",deleteService:"services/jalor/htmlarea/infotip/d/single",delayInit:200},Personalized:{open:true,delay:5000},Forward:{delayTime:workspaceVO.config.forwardDelayTime||1000,lastTimeSpace:2000},dataFormatter:{zh_CN:{date:"yyyy-MM-dd",dateym:"yyyy-MM",datehm:"yyyy-MM-dd hh:mm",datetime:"yyyy-MM-dd hh:mm:ss"},en_US:{date:"dd/MM/yyyy",dateym:"MM/yyyy",datehm:"dd/MM/yyyy hh:mm",datetime:"dd/MM/yyyy hh:mm:ss"}},HtmlRegular:{annotation:/<!--\s*([\s\S]*?)\s*-->/g,script:/<script([^>]*)\/>|<script([^>]*)>\s*([\s\S]*?)\s*<\/script>/gi,scriptUrl:/src\s*=\s*(['"])([\s\S]*?)\1/i,css:/<link([^>]*)>|<style([^>]*)>\s*([\s\S]*?)\s*<\/style>/gi,cssUrl:/href\s*=\s*(['"])([\s\S]*?)\1/i,elementEvent:/on[a-z]*\s*=\s*(['"])([\s\S]*?)\1|on[a-z]*\s*=\s*[\s\S]*?/gi,hrefEvent:/href\s*=\s*(['"])(javascript:[\s\S]*?)\1|href\s*=\s*(javascript:[\s\S]*?)/gi},Ldap:{isSingleSearchSpeed:false}};Jalor.UI.Config={Permission:{Class:{has:".hasPermission",no:".noPermission"},Model:{has:"hasPermission",no:"noPermission"},attr:"jalorPermission"},messageType:{error:"error",success:"success",warn:"warn",question:"question"},messageTitle:{title:"jalor.common.message.msgtitle",confirm:"jalor.common.message.confirm"},topBox:{top:150,width:200,timer:2000,title:"jalor.common.message.msgtitle"},loading:{top:150,width:150,title:"jalor.common.message.msgtitle",content:"jalor.common.message.loading"},button:{input:'<input type="button" value="{0}" {1} {2}/>',img:'<a class="jalor-icon {0} {4}" {1} title="{2}" {3}></a>',link:'<a class="jalor-link-btn {3}" {0} {2}>{1}</a>',imgBtn:'<span class="jalor-button {4}" {3} {1}><a class="jalor-icon {0}"></a><label>{2}</label></span>'},newButton:{input:'<input type="button" value="${text}" class="${css}" ${prop} />',img:'<a class="jalor-icon ${icon} ${css}" title="${text}" ${prop} ></a>',link:'<a class="jalor-link-btn ${css}" ${prop} >${text}</a>',imgBtn:'<span class="jalor-button ${css}" ${prop} ><a class="jalor-icon ${icon}"></a><label>${text}</label></span>'},datepicker:{date:"%d/%m/%Y",datetime:"%d/%m/%Y %H:%M"},pager:{pageSizes:[10,15,50,100,200,500],defaultSize:15,mode:"number",showMessage:true,maxPages:2147483647},dropdown:{comboDelay:1000,suggestDelay:2000,suggestNum:80,maxParseMatch:30,autoConnect:true,clearRepeating:false},igrid:{treeLoadDeep:1,wrapHead:true,headTip:false,customSetting:false,rowHeight:24},grid:{columnMinWidth:25},dialog:{btnAlign:"right"},excel:{rowRender:"group"}};Jalor.Layout={};Jalor.Layout.Config={W3MenuSettings:{user_id:workspaceVO.user&&workspaceVO.user.userCN,base:{header_id:"head_div",footer_id:"foot_div"},is_narrow:true,loutout:{en:{name:"Logout",url:"javascript:Jalor.Local.logout();"},cn:{name:"注销",url:"javascript:Jalor.Local.logout();"}},switch_lan:{en:{name:"中文",url:"javascript:Jalor.Local.changeLanguage('zh_CN')"},cn:{name:"English",url:"javascript:Jalor.Local.changeLanguage('en_US')"}},app_setting:{en:{name:"Jalor 5"},cn:{name:"Jalor 5"}}},LeftMenu:{panel:"jalorSiteMapTree",Target:{self:"_self",blank:"_blank",frame:"_contentFrame",website:"_website"}},resBean:[]};window.ws_res_path=workspaceVO.envBean.shortResPath+"/";window.Calendar={};window.contextPath=workspaceVO.contextPath;Jalor._fnInitI18nMsg4Validator=function(){$.extend($.validator.messages,{})};Jalor._fnInitI18nMsg4Pager=function(){Jalor.UI.Config.pager.text={pageSizes:$i18n("jalor.common.pager.pageSizes"),curPage:$i18n("jalor.common.pager.curPage"),first:$i18n("jalor.common.pager.first"),prev:$i18n("jalor.common.pager.prev"),next:$i18n("jalor.common.pager.next"),last:$i18n("jalor.common.pager.last"),goTo:$i18n("jalor.common.pager.goTo"),message:$i18n("jalor.common.pager.message"),total:$i18n("jalor.common.pager.total")}};Jalor._fnInitI18nMsg4Others=function(){Jalor.UI.Config.dropdown.text={suggestNum:$i18n("jalor.common.suggest.msg"),noMatch:$i18n("jalor.common.suggest.noMatch")};Jalor.Config.Format.yes=$i18n("jalor.common.label.yes");Jalor.Config.Format.no=$i18n("jalor.common.label.no")};Jalor.LocalStorage={getItem:function(a){if(localStorage){return localStorage.getItem("{0}_{1}_{2}".formatText(workspaceVO.user.userId,workspaceVO.config.appName,a))}},setItem:function(a,b){if(localStorage){try{localStorage.setItem("{0}_{1}_{2}".formatText(workspaceVO.user.userId,workspaceVO.config.appName,a),b)}catch(c){Jalor.Log.info("localStorage超出存储，清理掉比较老的5条数据");this.delOldPartItems(10)}}},delOldPartItems:function(b){var f=[];for(var a in localStorage){var e=localStorage[a],c=/"creationDate":(\d+)/;if(c.test(e)){f.push({key:a,creationDate:c.exec(e)[1]*1})}}Jalor.DataHelper.sort("creationDate","asc",f);for(var d=0;d<b;d++){if(f[d]){localStorage.removeItem(f[d].key)}}},removeItem:function(b){if(localStorage){var a=workspaceVO;localStorage.removeItem("{0}_{1}_{2}".formatText(a.user.userId,a.config.appName,b))}}};String.prototype.formatText=function(c){var a=arguments,b,d;if(a.length==1&&$.isPlainObject(c)){b=/\${([\s\S]*?)}/g;a=c}else{b=/\{(\d+)\}/g}return this.replace(b,function(e,f){d=a[f];return d==null?"":d})};Jalor.initI18n=function(c){var b=workspaceVO,e=b.config,d=b.currentLanguage,a=c?"&l="+new Date().getTime():"";$.i18n.properties({name:"i18n?lang="+d+a,path:"servlet/",mode:"map",language:d.substr(0,2),dataType:"json",callback:function(){$i18n=$.i18n.prop;if(localStorage&&e.enabledI18nCache!=="0"){var j=Jalor.LocalStorage,h=j.setItem,g=j.getItem,f=g("currentI18nVersion"),k=e.i18nVersion;h("currentI18nVersion",k);h("currentI18nLanguage",d);h(k,JSON.stringify($.i18n.map));if(f!==k){j.removeItem(f)}}}})};if(localStorage&&workspaceVO.config.enabledI18nCache!=="0"){var wVo=workspaceVO,jLocalStorage=Jalor.LocalStorage,newI18nVersion=wVo.config.i18nVersion,oldI18nVersion=jLocalStorage.getItem("currentI18nVersion"),newI18nLanguage=wVo.currentLanguage,oldI18nLanguage=jLocalStorage.getItem("currentI18nLanguage"),i18nMap;if(newI18nVersion===oldI18nVersion&&newI18nLanguage===oldI18nLanguage){i18nMap=Jalor.LocalStorage.getItem(newI18nVersion)}if(i18nMap){$.i18n.map=JSON.parse(i18nMap);$i18n=$.i18n.prop}else{Jalor.initI18n(1)}}else{Jalor.initI18n()}(function(){encode=function(b){if(b&&typeof b=="string"){return b.encode()}return b};String.prototype.encode=function(b){return this.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,b?'"':"&quot;")};String.prototype.encodeHtml=function(){var b=this.replace(Jalor.Config.HtmlRegular.script,"");b=b.replace(Jalor.Config.HtmlRegular.elementEvent,"");b=b.replace(Jalor.Config.HtmlRegular.hrefEvent,"");return b};String.prototype.getLength=function(){var b,c;c=0;for(b=0;b<this.length;b++){if((this.charCodeAt(b)>=0)&&(this.charCodeAt(b)<=255)){c=c+1}else{c=c+3}}return c};String.prototype.encodeURI=function(){return encodeURIComponent(this).replaceAll("%C2%A0","%20")};String.prototype.fillChar=function(d,f,e){if(!e){e="0"}var c=this.length-d;if(c>0){return f?this.substr(0,d):this.substr(c,d)}else{var b="";c=Math.abs(c)/e.length;for(;c>0;c--){b+=e}return f?this+b:b+this}};String.prototype.format=function(b,e){var d,c;if(typeof b=="object"){d=b;c=e}else{d=arguments}return this.replace(/\{(\d+)\}/g,function(f,g){return c?d[g].encodeURI():(""+d[g]).encode()})};String.prototype.formatField=function(c,b){return this.formatByMap(c,null,b)};String.prototype.formatByMap=function(g,c,e){var j,d,h,f,b;return this.replace(/\${([\s\S]*?)}/g,function(l,k){c&&(b=c(k,g));if(b===false){return l}switch(d=k.substr(0,1)){case"#":h="text";break;case"&":h="url";break;default:h=null;break}if(h){k=k.substring(1)}else{h=e}var n=Jalor.DataHelper.getObj(k,g);if(n!=null){if(typeof(n)=="string"&&h!="non"){return h?(h=="url"?encodeURIComponent(n):n):encode(n)}else{return n}}return""})};String.prototype.formatValue=function(){var b=arguments;return this.replace(/\{(\d+)\}/g,function(c,d){return(""+b[d]).encode()})};String.prototype.formatURI=function(){var b=arguments;return this.replace(/\{(\d+)\}/g,function(c,d){if(b[d]===null){return""}else{if(typeof b[d]=="string"){return b[d].encodeURI()}else{return b[d]}}})};String.prototype.isEmpty=function(){return this.trim().length==0};String.prototype.trim=function(){return this.replace(/(^[\s　]*)|([\s　]*$)/g,"")};$.trim=function(b){return b==null?"":b.toString().trim()};String.prototype.len=function(){var b=this.trim();if(b.length){return b.replace(/[^x00-xff]/g,"**").length}return 0};String.prototype.replaceText=function(b,c){return this.replace(new RegExp(b,"gm"),c)};String.prototype.toDate=function(c){var b;if(this.indexOf("T")>0){b=Jalor.Core.DateHandle.getStrArray(this.substr(0,19).replace("T"," "),Jalor.Config.Format.sysDateTime,true);b&&b.push(this.split(".").pop().split("+").shift()*1)}else{b=Jalor.Core.DateHandle.getStrArray(this,c,this.length>10)}if(b&&b[0]>0&&b[1]>-1){return new Date(b[0],b[1],b[2]||1,b[3]||0,b[4]||0,b[5]||0,b[6]||0)}return null};String.prototype.validDate=function(d,c){if(Jalor.Config.Regular.serverDate.test(this)){return true}var b=Jalor.Core.DateHandle.getStrArray(this,d,c);return b?(c?Jalor.Core.DateHandle.checkDateTimeStr(b):Jalor.Core.DateHandle.checkDateStr(b)):false};Jalor.Core.DateHandle={getStrArray:function(n,r,p){n=n.trim();var c=this.getDateRegular(n,r,p);if(c){if($.type(c)=="object"){var b=n.match(c.reg),j=(c.reg+"").replaceText("d","w"),e=c.format.match(new RegExp(j.substring(1,j.length-1)));if(b&&e&&b.length==e.length){var k=[0,0,1,0,0,0];for(var h=1,l=b.length;h<l;h++){var q=b[h]*1;if(q||q===0){var t=e[h];this.matchDateArray(k,q,t)}}return k}}else{if(n.substring(c.length).length){return null}var k=[0,0,1,0,0,0],s=0,o=0,q,t,g;for(var h=0,l=n.length;h<l;h++){var d=n.substr(h,1),g=isNaN(d*1)||d.trim()=="";if(g||(h==l-1&&s<h&&(h++))){g||h++;q=n.substring(s,h)*1;if(g){s=h+1;var f=c.indexOf(d,o);f<0&&(f=c.length);t=c.substring(o,f);o=f+1}else{t=c.substring(o)}this.matchDateArray(k,q,t)}}return k}}return null},matchDateArray:function(b,c,d){if(d){switch(d){case"yyyy":b[0]=c;break;case"MM":b[1]=c-1;break;case"dd":b[2]=c;break;case"hh":b[3]=c;break;case"mm":b[4]=c;break;case"ss":b[5]=c;break}}},getDateRegular:function(g,h,f){if(h==null){var c=f?"sysDateTime":"sysDate",e=Jalor.Config.Regular[c];if(e.test(g)){return{reg:e,format:Jalor.Config.Format[c]}}c=f?"datetime":"date",e=Jalor.Config.Regular[c];if(e.test(g)){return{reg:e,format:Jalor.Config.Format[c]}}c="dateym",e=Jalor.Config.Regular[c];if(e.test(g)){return{reg:e,format:Jalor.Config.Format[c]}}}else{try{if(typeof h=="string"){var b=h.replace(/yyyy|MM|dd|hh|mm|ss/g,function(j){if(j=="yyyy"){return"(\\d{4})"}else{return"(\\d{1,2})"}});return{reg:new RegExp("^"+b+"$"),format:h}}else{return h}}catch(d){}return h}},checkDateStr:function(b){var e=b[0],f=b[1],c=b[2],d=new Date(e,f,c);return d?(d.getFullYear()==e&&d.getMonth()==f&&d.getDate()==c):false},checkDateTimeStr:function(b){var g=b[0],h=b[1],d=b[2],c=b[3],j=b[4],f=b[5],e=new Date(g,h,d,c,j,f);return e?(e.getFullYear()==g&&e.getMonth()==h&&e.getDate()==d&&e.getHours()==c&&e.getMinutes()==j&&e.getSeconds()==f):false}};String.prototype.toDateTime=function(){return this.toDate()};String.prototype.replaceAll=function(b,c){return this.replace(new RegExp(b,"gm"),c)};Array.prototype.remove=function(d){for(var c=0,b=this.length;c<b;c++){if(d==this[c]){this.splice(c,1);c--}}};Array.prototype.contains=function(d){for(var c=0,b=this.length;c<b;c++){if(this[c]!==""&&d==this[c]){return true}}return false};Array.prototype.appendFormat=function(c,b){this.push($.isPlainObject(b)?c.formatField(b):c.formatText(b));return this};Array.prototype.clearRepeating=function(){var c=this.length,b=[],d;while(c>1){d=this.shift();b.push(d);this.remove(d);c=this.length}c>0&&(b=b.concat(this));return b};Date.prototype.format=function(e){var c=this;if(!e){e=Jalor.Config.Format.date}var g={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};var d=""+this.getFullYear();if(/(y+)/.test(e)){e=e.replace(RegExp.$1,d.substr(4-RegExp.$1.length))}var f=e.indexOf("MMM")>-1;if(f){delete g["M+"]}for(var b in g){if(b&&new RegExp("("+b+")").test(e)){e=e.replace(RegExp.$1,RegExp.$1.length==1?g[b]:("00"+g[b]).substr((""+g[b]).length))}}if(f){e=e.replace("MMM",Jalor.Config.Format.months[this.getMonth()])}return e};Date.prototype.toJSON=function(){function b(c,d){c=""+c;return c.fillChar(d?3:2)}return this.getFullYear()+"-"+b(this.getMonth()+1)+"-"+b(this.getDate())+"T"+b(this.getHours())+":"+b(this.getMinutes())+":"+b(this.getSeconds())+"."+b(this.getMilliseconds(),true)+"+0800"};Date.prototype.getUTCTime=function(d,c){if(!d||isNaN(d)){d=Jalor.Personalized.global.common.timeZone;d=d.substring(3,d.length)}if(!isNaN(d)){d=Math.min(Math.max(d,-12),13);if(!c||isNaN(c)){c=c==Jalor.Personalized.global.common.timeZone?c.substring(3,c.length):c="+8"}else{c=Math.min(Math.max(c,-12),13)}if(d===c){return this}var b=this.getTime()-(c*3600000);return new Date(b+d*3600000)}return this};Date.prototype.toString=function(){return this.toJSON()},Date.prototype.addMonth=function(b){var d=new Date(this.getTime());var c=d.getDate()==d.getMonthDay();var e=d.getMonth()+b;d.setMonth(e);if(d.getMonth()!=(e+12)%12){d.setDate(0)}if(c){d.setDate(d.getMonthDay())}return d};Date.prototype.getMonthDay=function(){var b=[[31,28,31,30,31,30,31,31,30,31,30,31],[31,29,31,30,31,30,31,31,30,31,30,31]];var c=this.getFullYear();if(c%4==0&&c%100>0||c%400==0){return b[1][this.getMonth()]}else{return b[0][this.getMonth()]}};Date.prototype.toDate=function(){return this};Date.prototype.toDateTime=function(){return this};Function.prototype._injectBefore=function(c){var b=this;return function(){if(c.apply(this,arguments)!==false){b.apply(this,arguments)}}};Function.prototype._injectAfter=function(c){var b=this;return function(){if(b.apply(this,arguments)!==false){c.apply(this,arguments)}}};Jalor.Format={toDate:function(d,e){if(d){var b,c=typeof(d);if(c=="string"&&isNaN(d)){b=d.toDate(e)}else{if(c=="object"){b=d}else{if(c=="number"||!isNaN(d)){b=new Date(d*1)}}}return b}return d},toDateTime:function(b,c){return this.toDate(b,c||Jalor.Config.Format.datetime)},toDateStr:function(c,d,b){return c?this.toDate(c,d||Jalor.Config.Format.date).format(b||d||Jalor.Config.Format.date):c},toDateTimeStr:function(c,d,b){return c?this.toDateTime(c,d).format(b||d||Jalor.Config.Format.datetime):c},toUTCDateTimeStr:function(c,b){if(c._updated===true||c._inserted===true||!b){return Jalor.Format.toDateTimeStr(b)}return Jalor.Format.toDateTimeStr(b.getUTCTime(Jalor.Personalized.global.common.timeZone,8))},toDateYM:function(c,d,b){return c?this.toDate(c,d).format(b||d||Jalor.Config.Format.dateym):c},toDateYMStr:function(c,d,b){return c?this.toDateYM(c,d).format(b||d||Jalor.Config.Format.dateym):c},toInt:function(c,b){return c!=null?parseInt(c):c},toDecimal:function(c,b){if(typeof c=="number"){if(b==void 0){b=Jalor.Config.Format.decimalfraction}return parseFloat(c).toFixed(b)}else{if(typeof c=="string"&&c!==""&&!isNaN(c)){return this.toDecimal(Jalor.Format.toNumber(c),b)}}return c},toCurrency:function(d,c,b){if(!Jalor.DataHelper.isEmpty(d)){d=this.toDecimal(d,c);d=d.replace(/(^|[^\w.])(\d{4,})/g,function(f,e,g){return e+g.replace(/\d(?=(?:\d\d\d)+(?!\d))/g,"$&,")});if(!b){b=Jalor.Config.Format.currencyFlag}return b?b.replace("[currency]",d).formatText(d):d}else{return""}},toCurrencyStr:function(g,f,c){if(!Jalor.DataHelper.isEmpty(g)){if(f==void 0){f=Jalor.Config.Format.decimalfraction}var b=g.indexOf(".");if(-1==b){if(g.length>15){if(f>0){g+=".";for(var e=0;e<f;e++){g+="0"}}}else{g=this.toDecimal(g,f)}}else{if(b>15){var d=g.substring(b-1);var h=parseFloat(d).toFixed(f);g=g.substring(0,b)+h.substring(1)}else{g=this.toDecimal(g,f)}}g=g.replace(/(^|[^\w.])(\d{4,})/g,function(k,j,l){return j+l.replace(/\d(?=(?:\d\d\d)+(?!\d))/g,"$&,")});if(!c){c=Jalor.Config.Format.currencyFlag}return c?c.replace("[currencystr]",g).formatText(g):g}else{return""}},toFileSize:function(g,f,b){if(g===0){return"0"+(b||f||"B")}for(var d=0,e=Jalor.Config.Format.fileSize.length;b&&d<e;d++){if(b==Jalor.Config.Format.fileSize[d]){break}g*=1024}if(g){var h=0,c=false;while(!c){g=g/1024;h++;if(f){if(f==Jalor.Config.Format.fileSize[h]||g<0.1){c=true}}else{c=!(g>1024)}}return this.toDecimal(g,Jalor.Config.Format.fileSizeFraction)+" "+Jalor.Config.Format.fileSize[h]}return""},toNumber:function(b){if(b&&typeof(b)=="string"){if(isNaN(b*1)&&isNaN(b[0])&&(b[0]!="-")){b=b.substring(1)}return b.replaceText(",","")*1}return b},toEllipsis:function(d,b){if(d){var e,c;if(typeof(b)=="number"&&b<d.length){e=d.substr(0,b)+"..."}else{e=d}}return"<label class='jalor-Text-Ellipsis' title=\"{1}\">{0}</label>".formatValue(Jalor.Format.formatSpace(e)||d||"",d||"")},toBoolView:function(d,c,b){if(d==null){return""}var e=(d!=0||d!=false)?Jalor.Config.Format.yes:Jalor.Config.Format.no;if(c){if(b==true){return(d!=0||d!=false)?("<a class='jalor-icon yes nocursor' title='"+e+"' ></a>"):""}else{return"<a class='jalor-icon {0} nocursor' title='{1}' ></a>".format((d!=0||d!=false)?"yes":"no",e)}}return e},toDateNum:function(b){return Date.parse(b)},toRate:function(g,e,d,b,h,j){if(g){g=this.toDecimal(g*100/(e||1),d||0)}else{if(j&&0!=g){return""}else{g=0}}var c;if(h){if(g==100){c="completed"}else{var f={0:"danger",1:"warning",2:"normal"};$.isArray(h)||(h=h.split(","));$.each(h,function(k,l){if(g<l){c=f[k];return false}})}}g+="%";if(b){return"<div class='jalor-data-rate'><div class='rate-chart "+(c||"")+"' style='width:"+g+"'/><span class='rate-text'>"+g+"</span></div>"}return g},toDateBefore:function(e){if(!e){return""}if(typeof(e)=="number"){e=Jalor.Format.toDate(e)}else{if(typeof(e)=="string"){e=e.toDate()}}var c=Jalor.Core.getServerTime(),j=c.getFullYear()-e.getFullYear(),h=c.getMonth()-e.getMonth();if(e>c){return e.format(Jalor.Config.Format.datehm)}if(j){return e.format(Jalor.Config.Format.datehm)}if(d(j,h)){j--;h+=12}var k=c.getDate()-e.getDate(),g=c.getHours()-e.getHours(),f=c.getMinutes()-e.getMinutes();if(d(h,k)){h--;k+=new Date(c.getFullYear(),c.getMonth(),0).getDate()}if(h>0||(h==0&k>2)){return e.format($i18n("jalor.common.format.dateMD"))}if(k>0||(k==0&&g>0)){var b=$i18n("jalor.common.format.day").split(",")[k];return b+e.format(" hh:mm")}if(f>0){return $i18n("jalor.common.format.minuteBefore").formatText(f)}return $i18n("jalor.common.format.Just");function d(n,l){if(n>0){if(l<0){return true}}return false}},toValueObj:function(e,d,b,c){if(e!==null){if(!$.isPlainObject(e)){e={value:e}}if(e.value&&e.text==null&&d){e.text=this.getArrayText(e.value,d,b,c)}return e}return{}},getPixe:function(b){if(typeof(b)=="number"){return b+"px"}return b},getField:function(c,b){return c||Jalor.Config.Format[b+"Field"]},getArrayItem:function(f,c,d){if(c){d=this.getField(d,"value");for(var e=0,b=c.length;e<b;e++){if(c[e][d]==f){return c[e]}}}return null},getArrayText:function(e,b,c,d){var f=this.getArrayItem(e,b,c);return f?f[this.getField(d,"display")]:""},convertArrayToObject:function(b,c,e){if(b&&b.length){var g={};c=this.getField(c,"value");e=e===true?null:this.getField(e,"display");for(var d=0,f=b[0];f;d++,f=b[d]){g[f[c]]=e?f[e]:f}return g}return b},convertSimpleArrayToObject:function(b,c,e){if(b&&b.length){var g={};c=this.getField(c,"value");e=this.getField(e,"display");if(!$.isPlainObject(b[0])){for(var d=0,f=b[0];f;d++,f=b[d]){var h={};h[c]=h[e]=f;g[d]=h}return g}else{return b}}return b},getObjectText:function(f,g){if($.isJalorDom(f)){f=""}if(f!=null){if(typeof(g)=="string"){g=Jalor.Cache.get(g)}if(g){var h=Jalor.Config.Format.valueSplit;var f=f.toString();if(f.indexOf(h)>0){var e=[],c=f.split(",");for(var d=0,b=c[0];b;d++,b=c[d]){e.push(g[b]||b)}return(e.join(Jalor.Config.Format.textSplit)+"").encode()}else{return((g[f]||f)+"").encode()}}}return null},showPersonInfo:function(b,c,e){var d=Jalor.DataHelper.getObj(b,e),f=Jalor.DataHelper.getObj(c,e);return(d&&f)?"<a href='javascript:Jalor.Component.popUserInfo(\"{0}\")'>{1}</a>".formatValue(d,f):""},showGroupInfo:function(b,c,e){var d=Jalor.DataHelper.getObj(b,e),f=Jalor.DataHelper.getObj(c,e);return(d&&f)?"<a href='javascript:Jalor.Component.popGroupInfo(\"{0}\")'>{1}</a>".formatValue(d,f):""},formatSpace:function(b){if(typeof b=="string"){return b.replace(/&/g,"&#38;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,'"').replace(/\s/g,"&nbsp;")}return b},formatAmount:function(h,g,b,c,f){var d=Jalor.DataHelper.getObj(g,Jalor.DataHelper.getObj(h,f)||{});if(d){d=Jalor.Format.toCurrency(Jalor.Format.toNumber(d),c);var e=Jalor.DataHelper.getObj(b,Jalor.DataHelper.getObj(h,f)||{});if(e){return e+d}return"CNY"+d}return null},dateFormatStrByLang:function(c){var b=Jalor.Config.dataFormatter[workspaceVO.currentLanguage];return c?(b[c]||b.datetime):b.datetime},boolRender:function(b,d,c){if(c){return""}return'<input type="checkbox" onclick="Jalor.Format.boolClickCheck(\''+b+"',this)\" "+(d?'checked="checked"':"")+"/>"},boolClickCheck:function(d,c){var f=$("#"+d).manager(),b=$(c).parent(),e=f.getColumnOp(b);var g=Jalor.Format.boolParse(c.checked,e.format);var h=f.cellValue(b,e,g,true);h===false&&(c.checked=false);h&&!b.hasClass("cell-update")&&b.addClass("cell-update")},boolParse:function(c,d){if(d&&d.nullValue){if(c==null||c==""){return null}}var b=typeof(c);if(b!="boolean"){if(c=="true"||c=="1"){c=true}else{c=false}}if(d&&d.isBool){return c?true:false}else{return c?1:0}},getLangugaeList:function(){var b=[{id:"zh_CN",text:$i18n("jalor.common.label.lang.chinese")},{id:"en_US",text:$i18n("jalor.common.label.lang.english")}];Array.prototype.push.apply(b,workspaceVO.languageList);$.each(workspaceVO.languageList,function(c,e){e.text=$i18n(e.text)});return b}};Jalor.HashMap=function(){this.keys=new Array();this.data=new Object();this.put=function(b,c){if(this.data[b]==null){this.keys.push(b)}this.data[b]=c};this.get=function(b){return this.data[b]};this.remove=function(b){this.keys.remove(b);this.data[b]=null};this.each=function(e){if(typeof e!="function"){return}var b=this.keys.length;for(var d=0;d<b;d++){var c=this.keys[d];e(c,this.data[c],d)}};this.entrys=function(){var b=this.keys.length;var d=new Array(b);for(var c=0;c<b;c++){d[c]={key:this.keys[c],value:this.data[this.keys[c]]}}return d};this.isEmpty=function(){return this.keys.length==0};this.size=function(){return this.keys.length};this.toString=function(){var d="{";for(var c=0;c<this.keys.length;c++,d+=","){var b=this.keys[c];d+=b+"="+this.data[b]}d+="}";return d}};Jalor.StringBuilder=function(b){this.strings=new Array();if(b&&b.length>0){this.append(b)}};Jalor.StringBuilder.prototype.append=function(b){if(b&&b.length>0){this.strings.push(b)}return this};Jalor.StringBuilder.prototype.isNotEmpty=function(){return this.strings.length>0};Jalor.StringBuilder.prototype.clear=function(){this.strings.length=0};Jalor.StringBuilder.prototype.toString=function(b){return this.strings.join(b||"")};Jalor.StringBuilder.prototype.removeLast=function(){this.strings=this.strings.slice(0,-1);return this};var a={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},badChars:/[&<>"'`]/g,possible:/[&<>"'`]/};Jalor.DataHelper={escape:function(b){if(b==null){return b}b=b.toString();if(!a.possible.test(b)){return b}return b.replace(a.badChars,function(c){return a.escape[c]||"&amp;"})},compare:function(d,b,c){if(c){if((d==null&&b==="")||(d===""&&b==null)){return false}}return d!=b},hasValue:function(b){return typeof b!="undefined"&&b!=null},getValue:function(){for(var b=0;b<arguments.length;b++){if(Jalor.DataHelper.hasValue(arguments[b])){return arguments[b]}}return""},isEmpty:function(b){if(Jalor.DataHelper.hasValue(b)){b+="";return b&&b.trim().length>0?false:true}else{return true}},toDecimal:function(c,b){if(c){return parseFloat(c).toFixed(b||Jalor.Config.Format.decimalfraction)}return c},toJsonStr:function(b){return b?JSON.stringify(b):""},buildJmlConfStr:function(e,d){if(d==null||d.length==0){return""}var b=new Array();for(var c=0;c<d.length;c++){if(e[d[c]]!=null){b.push(d[c]+" = '"+e[d[c]]+"' ")}}return b.join("")},toJson:function(b){return Jalor.DataHelper.isEmpty(b)?null:JSON.parse(b)},inRange:function(d,c,b){return d>=c&&d<=b},getRangeValue:function(d,c,b){if(d<c){d=c}else{if(d>b){d=b}}return d},getObj:function(g,e,c){if(g){g=g.split(".");var f=e||window,b=g.length;if(b>1){for(var d=c?1:0;d<b;d++){f=f[g[d]];if(f==null){return null}}return f}else{return f[g[0]]}}},setObj:function(h,e,k){if(h){h=h.split(".");var d=e||window,b,f=h.length,g,j;if(f>1){f--;j=d;for(var c=0;c<f;c++){b=h[c];g=j[b];if(g==null){g=j[b]={}}j=g}j[h[f]]=k}else{d[h[0]]=k}return d}},getDataChange:function(b,f,d){var e={},c=this,g=0;$.each(b,function(k,o){var j=f[k],n;if($.isPlainObject(o)){o=c.getDataChange(o,j,d);n=o!=null}else{if($.type(o)=="array"){var l=d[k],h=new Array(o.length);if(l){o=c.getObjectArrayChange(o,j,h,l,d)}else{o=c.getArrayChange(o,j,h)}n=o!=null}else{if(o||j){n=o!=j}else{if(o!==""&&j!=null){n=o!=j}}}}if(n){g++;e[k]=o}});return g?e:null},getArrayChange:function(d,c,b){var e=0;$.each(d,function(g,h){var f=c[g];if(h!=f){e++;b[g]=h}});return e?b:null},getObjectArrayChange:function(e,d,b,c,f){var g=0;$.each(e,function(h,j){var l=d[h],k={};$.each(j,function(o,p){if(c!=o){var n=l[o];p!=n&&(k[o]=p)}});if(!$.isEmptyObject(k)){k[c]=l[c];b[h]=k;g++}});return g?b:null},applyChangeData:function(f,b,e,d){var c=this;$.each(b,function(h,l){var g=f[h],k=$.type(l);if(g&&k==$.type(g)){if($.isPlainObject(l)){if($.isPlainObject(g)&&!$.isEmptyObject(g)){c.applyChangeData(g,l,e,d);return}}else{if(k=="array"){if(g.length){var j=e&&e[h];if(j){c.applyArrayChange(g,l,j,e,d);return}}}}}if(!d||d(h,l,g)!==false){f[h]=l}})},applyArrayChange:function(b,f,c,e,d){$.each(f,function(h,g){if(g){var k=g[c],j;if(k){$.each(b,function(l,n){if(n&&n[c]==k){if(!d||d(c,g,h,n,l)!==false){$.extend(true,n,g)}j=true;return false}});if(!j&&(!d||d(c,g,h)!==false)){b.push(g)}}}})},copyField:function(c,b){if(b){var d={};$.each(b,function(e,f){d[f]=c[f]});return d}else{return $.extend({},c)}},copyArray:function(b){var d=this,c=[];$.each(b,function(e,f){c.push(d.copyField(f))});return c},parseUrlParams:function(d){var c=d.indexOf("?")+1,g,b,e,f;if(c>0&&c<d.length){g=d.substring(c).split("&");if(g.length){b={};$.each(g,function(h,j){e=j.split("=");if(f=e[1]){Jalor.DataHelper.setObj(e[0],b,decodeURIComponent(f))}})}}return b},languageExtraction:function(j){if(j==null){return""}var d=workspaceVO.currentLanguage;d=","+d+"=";var b=","+j;var g=b.indexOf(d);var k=workspaceVO.validLanguages;var f=-1,h=-1;for(var e=0;e<k.length;e++){var c=","+k[e]+"=";h=b.indexOf(c);if(h!=-1&&g==-1){return""}if(h>g){b=b.substring(0,h);f=h}}if(g==-1&&f==-1){return j}g=d.length+g;return f==-1?b.substring(g):b.substring(g,f)}}})();if(window.XMLHttpRequest){var JalorXMLHttpRequest=window.XMLHttpRequest;window.XMLHttpRequest=function(){var f=new JalorXMLHttpRequest(),e=(""+Math.random()).substring(2),c=new Date(),b=function(){if(f.readyState==4){}};if(window.addEventListener){f.addEventListener("readystatechange",b,false)}else{try{var g=null;f.onreadystatechange=function(){b.apply(this,arguments);g&&g.apply(this,arguments)};Object.defineProperty(f,"onreadystatechange",{set:function(h){g=h}})}catch(a){console.error(a)}}var d=f.send;f.send=function(){var h=$.cookie("uuid"),j=$.cookie("appid");h&&f.setRequestHeader("uuid",h);j&&f.setRequestHeader("appid",j);d.apply(this,arguments)};return f}}Jalor.Core.Namespace={register:function(d){var b=window;var e=d.split(".");var a=e.length;for(var c=0;c<a;c++){b=b[e[c]]=b[e[c]]||{}}return b},regModule:function(d,e){var b=window;var f=d.split(".");var a=f.length;for(var c=0;c<a;c++){b=b[f[c]]=b[f[c]]||e||{}}Jalor.Module.modules.put(d);return b},getVariable:function(name){var value=false;try{value=eval(name)||false}catch(e){}return value},get:function(a){if(a){a=a.split(".");if(a.length){var c=window;for(var b=0;c&&a[b];b++){c=c[a[b]]}return c}}return null}};if(!window.console){window.console={log:function(){},debug:function(){},warn:function(){},info:function(){},error:function(){}}}Jalor.Log={level:workspaceVO.config.ScriptLogLevel?parseInt(workspaceVO.config.ScriptLogLevel):2,debug:function(a){if(this.level==1){window.console.log(a)}},info:function(a){if(this.level<=2){window.console.info(a)}},warn:function(a){if(this.level<=3){window.console.error("warn:"+a)}},error:function(a){if(this.level<=4){window.console.error(a)}}};Jalor.Core.log=function(a,b){if(!b){b=2}if(b>=Jalor.Log.level){window.console.log(a)}};if(typeof(workspaceVO)==="undefined"){document.write("<h2>System error occured(Can not init workspace).</h2>");$("#firstLoading").remove()}Jalor.Core._diffServerTime=Jalor.Format.toDate(workspaceVO.serverTime).getTime()-new Date().getTime();Jalor.Core.getServerTime=function(){return new Date(new Date().getTime()+Jalor.Core._diffServerTime)};Jalor.Module=function(a){this.name=a;this.hasInit=false};Jalor.Module.SupperClass={};Jalor.Module.modules=new Jalor.HashMap();Jalor.Module.define=function(b,d){var c=Jalor.Core.Namespace.register(b);$.extend(c,Jalor.Module.SupperClass);var a=function(f,e){return(c.context||$(document)).find(f,e)};if(typeof d=="function"){d(c,a)}Jalor.Module.modules.put(b,new Jalor.Module(b));Jalor.Core.log("加载模块："+b,Jalor.Config.Log.info)};Jalor.Module.executeReady=function(){Jalor.Module.modules.each(function(b,c){var a=Jalor.Core.Namespace.register(b);if(!c.hasInit&&typeof(a.ready)==="function"){c.hasInit=true;a.ready()}})};Jalor.Module.remove=function(moduleName){if(moduleName){try{var realModuleObj=Jalor.Core.Namespace.register(moduleName);if(realModuleObj&&typeof(realModuleObj.exit)==="function"){Jalor.Core.log(moduleName+"模块定义了Exit方法，现在执行",Jalor.Config.Log.info);realModuleObj.exit()}Jalor.Module.modules.remove(moduleName);eval(moduleName+"=null");Jalor.Core.log(moduleName+"模块数据清空",Jalor.Config.Log.info)}catch(e){Jalor.Core.log(moduleName+"模块不存在，不需要注销",Jalor.Config.Log.info)}}};Jalor.Module.clear=function(){var a=$.extend([],Jalor.Module.modules.keys);$.each(a,function(){Jalor.Module.remove(this)})};Jalor.Resource={register:function(a){var b=/\.css$/i;if(!b.test(a)){document.write('<script type="text/javascript" src="'+a+'"  charset="utf-8"><\/script>')}else{document.write('<link  rel="stylesheet" href="'+a+'" type="text/css">')}}};Jalor.Page={ajaxCompleted:function(){return Jalor.Core_ajaxCount.other<1&&Jalor.Core_ajaxCount.get<1},register:function(b,a){if(a){Jalor.Page._list[b]=a}else{return Jalor.Page._list[b]||b}},has:function(a){return Jalor.Page._list[a]?true:false},_list:{},getContentPanel:function(){return $("#"+Jalor.Config.Panel.main)},_clearCache:true,_forwardCount:0,_forward:function(url){var panel=Jalor.Page.getContentPanel();if(Jalor.DataHelper.isEmpty(url)){Jalor.UI.loading();Jalor.Module.clear();Jalor.Page.clearCache();if(workspaceVO.leftMenuNode.url){panel.removeAttr("module").jalorLoad(workspaceVO.leftMenuNode.url.split("#!")[1])}else{panel.removeAttr("module").empty()}Jalor.UI.loadingClose();Jalor.Layout.selectMenuByUrl();return}with(Jalor.Page){var refresTimes=Jalor.Config.Global.refresh;if(refresTimes&&++_forwardCount>refresTimes&&_clearCache){refresh()}}url=url.replaceAll(" ","%20");var Target=Jalor.Layout.Config.LeftMenu.Target,target=Jalor.Page.getRequest()["__target"];if(target&&target!=Target.self){if(target==Target.frame){var frame=$("<iframe id='#jalorContentframe'  src="+url+" frameborder=no border=0 ></iframe>").css({width:"100%",height:"800px"});Jalor.Page.getContentPanel().empty().append(frame);$("#jalorContentPanel").css("visibility","inherit");Jalor.Layout.selectMenuByUrl()}return}$("#jalor_fullscreen_overlay").hide();Jalor.UI.loading();$("#jalorContentPanel").css("visibility","hidden");Jalor.Module.clear();Jalor.Page.clearCache();$(document.documentElement).removeClass("hidden-scroll");$(".jalor-tip.global").remove();$("#jalor_float_bar").remove();Jalor.Page._beforeForward&&Jalor.Page._beforeForward();panel.removeAttr("module").jalorLoad(url,function(){Jalor.Page.afterForward&&Jalor.Page.afterForward();Jalor.Page._afterForward&&Jalor.Page._afterForward();Jalor.Layout.selectMenuByUrl()});Jalor.SsoUpdate.request();if(Jalor.UI.TopMenu!=null){Jalor.UI.TopMenu.helper.endEvents("#!"+url)}if(Jalor.UI.TopItem&&$("#first_nav").length){Jalor.UI.TopItem.helper.selectMenuByUrl()}},goHome:function(){Jalor.Page.getContentPanel().jalorLoad(Jalor.Page.homePath,Jalor.Page.afterForward)},clearCache:function(){this._clearCache&&Jalor.Cache.clear();this._clearCache=true;$.validator.clearTempMethods()},forwardParam:{url:"",data:"",clearCache:"",isSelf:false,isDelay:false,lastTime:false,interval:""},forward:function(b,e,d){var c=Jalor.Page.forwardParam;c.isDelay=true;c.isSelf=(b==window.location.hash)?true:false;c.url=b;c.data=e;c.clearCache=d;if(c.interval){return}var a=new Date();if(a-c.lastTime>Jalor.Config.Forward.lastTimeSpace){c.isDelay=false;Jalor.Page.forwardIntervalMethod();return}c.interval=setInterval(Jalor.Page.forwardIntervalMethod,Jalor.Config.Forward.delayTime/2);Jalor.UI.loading()},forwardIntervalMethod:function(){var b=Jalor.Page.forwardParam;if(b.isDelay){b.isDelay=false;return}var a=b.url;b.lastTime=new Date().getTime();if(b.isSelf){if(Jalor.Page.ajaxCompleted){Jalor.Page._forward(a.indexOf("#!")==0?a.substr(2):a)}}else{Jalor.Page.forwardMethod(a,b.data,b.clearCache)}clearInterval(b.interval);b.interval=false},forwardMethod:function(a,d,c){if(Jalor.Page.beforeForward&&(Jalor.Page.beforeForward(a,d,c)==false)){return}if(typeof(a)=="string"&&a.indexOf("#!")){a=a.split("#!").pop()}var b=["#!"];if(!Jalor.DataHelper.isEmpty(a)){b.push(Jalor.Page.register(a));if(typeof(d)=="object"){if(b.join("").indexOf("?")<0){b.push("?")}b.push(Jalor.Core._ajax.serialize(d))}}a=b.join("");if(c===false){this._clearCache=false}if(window.location.hash==a){Jalor.Page._forward(window.location.hash.substring(2))}else{window.location.hash=a}},refresh:function(){location.reload()},reload:function(){Jalor.Page._forward(window.location.hash.substring(2))},getForwardUrl:function(b,a){var c=window.location.href.split("#")[0];c+="#!"+b;if(typeof(a)=="object"){for(para in a){c+=para+"="+a[para].encodeURI()+"&"}}return c},getRequest:function(){var d=new Object();var h=window.location.href;var j=h.search("#");if(j<0){return{}}var b=h.substr(j+1).split("?");if(b.length>1){var a=b[1].split("&");for(var c=0;c<a.length;c++){var g=a[c].indexOf("=");if(g==-1){continue}var f=a[c].substring(0,g);var k=a[c].substring(g+1);try{k=decodeURIComponent(k);d[f]=k}catch(e){Jalor.UI.showMessage($i18n("Jalor.Page.Paramter.Error").formatText(k),"error");return{}}}}return d},afterLoad:function(a){Jalor.ready(a);Jalor.Module.executeReady();$("#jalorContentPanel").css("visibility","inherit")},back:function(){history.go(-1)},importAppRes:function(a){$environment=workspaceVO.envBean;Jalor.Environment=$environment;$EnvBean=Jalor.Environment;Jalor.WorkspaceVO=workspaceVO;this.importRes(workspaceVO.appResBeans,function(){Jalor.Page.importRes(Jalor.Layout.Config.resBean,function(){a()})})},importRes:function(a,b){var d=0;function c(){if(++d==a.length){b()}}if(!a||a.length<1){b();return}$.each(a,function(f,e){if(this.resType=="js"){$.ajax({url:e.resPath,dataType:"script",crossDomain:e.crossDomain,success:function(){Jalor.Core.log("载入应用公共资源(js)成功，资源路径为:{0}".formatValue(e.resPath));c()},error:function(n,o,l){var k="";if(typeof l=="string"){k=l}else{if(typeof l=="object"&&l.message){k=l.message}}Jalor.Core.log("载入应用公共资源(js)失败，{1}：{0}".formatValue(e.resPath,k).replace("Not Found","找不到文件"));c()}})}else{if(this.resType=="css"){if(!/^http:|^https:/.test(e.resPath)){e.resPath=window.location.href.substr(0,window.location.href.split("#")[0].lastIndexOf("/")+1)+e.resPath}var g=e.resPath;if(workspaceVO.config.appVersion){var j=g.split("?");g=[j[0],"?version=",workspaceVO.config.appVersion,j[1]?"&"+j[1]:""].join("")}if(g.indexOf(Jalor.Config.Global.rootUrl)==0){g=g.replace(Jalor.Config.Global.rootUrl,"")}if(g.indexOf("http://")!=0&&g.indexOf("https://")!=0&&g.indexOf("/")!=0&&g.indexOf("../")!=0){g=Jalor.Static.getStaticUrl(g)}var h=$('<link rel="stylesheet" type="text/css"  href="{0}"></link>'.formatText(g))[0];Jalor.Core.log("载入应用公共资源(css)，资源路径为:{0}".formatValue(e.resPath));document.getElementsByTagName("head")[0].appendChild(h);c()}else{if(this.resType=="html"){$("<div></div>").appendTo("#jalorAppCommonRes").jalorLoad(this.resPath,function(){Jalor.Core.log("载入应用公共资源(html)成功,资源路径为:{0}".formatValue(e.resPath))});c()}else{c()}}}})},showMenu:function(){$("#leftPanel").show();$("#midPanel").show()},hideMenu:function(){$("#leftPanel").hide();$("#midPanel").hide()},showResize:function(){$("#resizeWorkSpace").show()},hideResize:function(){$("#resizeWorkSpace").hide()},showMainOnly:function(a,b,c){if(a===false){$("#head_div").show();$("#foot_div").show();$("#leftPanel").show();$("#midPanel").show();$("#jalor_page_nav").show();$("#s_switch_role").show()}else{$("#head_div").hide();$("#foot_div").hide();$("#leftPanel").hide();$("#midPanel").hide();(!b)&&($("#jalor_page_nav").hide());(!c)&&($("#s_switch_role").hide())}},showHead:function(){$("#head_div").show()},hideHead:function(){$("#head_div").hide()},showFoot:function(){$("#foot_div").show()},hideFoot:function(){$("#foot_div").hide()},showNav:function(){$("#jalor_page_nav").show()},hideNav:function(){$("#jalor_page_nav").hide()},showRoleSwicth:function(){$("#s_switch_role").show()},hideRoleSwicth:function(){$("#s_switch_role").hide()},loadPageCss:function(b){var a=b.find("link");a.each(function(){var c=document.createElement("link");c.setAttribute("href",$(this).attr("href"));c.setAttribute("rel","stylesheet");c.setAttribute("type","text/css");b.get(0).appendChild(c)})}};Jalor.Local={getCurrLanguage:function(b){var a=workspaceVO.currentLanguage;if(b){return a.substr(0,2)}else{return a}},changeLanguage:function(b){$(window.document.body).loading();var a={common:{lang:b,theme:Jalor.Personalized.global.common.theme}};if(Jalor.Personalized&&Jalor.Config.Personalized.open){Jalor.Personalized.save(a,true,function(){if(workspaceVO.config.enableHomeCache){Jalor.doGet({url:Jalor.Config.Service.languageUrl.formatURI(window.location.href,b),dataType:"text",loading:false,success:function(){window.location.reload()},error:function(){window.location.reload();return true}});return}window.location=Jalor.Config.Service.languageUrl.formatURI(window.location.href,b)})}else{if(workspaceVO.config.enableHomeCache){Jalor.doGet({url:Jalor.Config.Service.languageUrl.formatURI(window.location.href,b),dataType:"text",loading:false,success:function(){window.location.reload()},error:function(){window.location.reload();return true}});return}window.location=Jalor.Config.Service.languageUrl.formatURI(window.location.href,b)}},logout:function(a){a=a||"servlet/logout";location.href=a;if(workspaceVO.config.enableHomeCache){setTimeout(function(){location.reload(true)},100)}}};Jalor.ready=function(b,a){if($.isFunction(b)){Jalor.ready._list.push(b);Jalor.Core.log("Jalor.ready :注册渲染事件:"+a)}else{$.each(Jalor.ready._list,function(c,d){d(b)})}};Jalor.ready._list=new Array();Jalor.Core._Delegates={ajax_before:$.Callbacks(),ajax_Sucess:$.Callbacks(),ajax_Error:$.Callbacks()};Jalor.Core._activeForm;var _activeForm;Jalor.Core.setActiveForm=function(a){_activeForm=a};Jalor.Core.getActiveForm=function(){return _activeForm};Jalor.autoLoading=true;Jalor.Core._ajax=function(f,b,c,j,e,a,h){var d,g;if($.isPlainObject(b)){d=b;d.type=f;g=c}else{d={type:f,url:b,data:c,success:j,error:e,beforeSend:a,loading:h}}Jalor.Core.ajax(d,g)};Jalor.Core_ajaxCount={other:0,get:0};Jalor.Core.ajax=function(a,h){!h&&a.ui&&(h=a.ui);var c=$.extend(true,{contentType:"application/json",dataType:"json"},a);if(!c.setAjax||c.setAjax(c,h)!==false){if(c.getData){c.getData(c.success)}else{var g=c.filter;Jalor.autoLoading=c.loading;var f=c.type,j=c.success,d=c.error;if(f=="POST"||f=="PUT"){c.data=Jalor.DataHelper.toJsonStr(c.data)}else{var e=Jalor.Core._ajax.serialize(c.data);if(e){c.url+=(c.url.indexOf("?")>0?"&":"?")+e}c.data=""}var b=f!=="GET"?"other":"get";if(c.loading!==false&&!h){Jalor.Core_ajaxCount[b]++}c.success=function(k){if(c.loading!==false&&!h){Jalor.Core_ajaxCount[b]--}if(g){k=g(k)}if(j){if(Jalor.Config.Global.catchErr){try{j.call(this,k)}catch(l){Jalor.Core.log(l&&l.message)}}else{j.call(this,k)}}else{Jalor.UI.topBox({content:"jalor.common.message.success",style:"success"})}Jalor.Core._Delegates.ajax_Sucess.fire(f,h,c);Jalor.Core.setActiveForm("")};c.error=function(o,p,l){if(c.loading!==false&&!h){Jalor.Core_ajaxCount[b]--}Jalor.Core._Delegates.ajax_Error.fire(f,h,c);var n;if(d){if(Jalor.Config.Global.catchErr){try{n=d.call(this,p,l,o.responseText,o.status)}catch(k){Jalor.Core.log(k&&k.message)}}else{n=d.call(this,p,l,o.responseText,o.status)}}if(n){Jalor.UI.loadingClose();Jalor.Core.log("Error handled by errorCallback:"+o.responseText);return}Jalor.Core.handleError(o.responseText,p,o,function(){if(o.status==403){Jalor.Core._Delegates.ajax_before.fire(c,h,c);$.ajax(c)}});Jalor.Core.setActiveForm("")};Jalor.Core._Delegates.ajax_before.fire(c,h,c);Jalor.SsoUpdate.request();$.ajax(c)}}};Jalor.Core._ajax.serialize=function(c){var a=new Array();if(typeof(c)!=="object"){return c}function b(f,h){if($.isArray(f)){for(var e=0;e<f.length;e++){if(typeof(f[e])==="object"){b(f[e],h)}else{if(typeof(f[e])==="string"){a.push(h+"="+f[e].encodeURI())}else{a.push(h+"="+f[e])}}}}else{for(var d in f){var g=f[d];var j=h?h+"."+d:d;if(g&&g.getTimezoneOffset){a.push(j+".time="+(g.getTime()-8*60*60*1000-g.getTimezoneOffset()*60*1000))}else{if(typeof(g)==="object"){b(g,j)}else{if(typeof(g)==="string"){a.push(j+"="+f[d].encodeURI())}else{a.push(j+"="+f[d])}}}}}}b(c,"");a=a.join("&");return a};Jalor.SsoUpdate={ready:false,request:function(){if(!Jalor.SsoUpdate.ready){Jalor.SsoUpdate.ready=true;setTimeout(function(){Jalor.Core.ajax({url:"only4ssoTimeUpdate.do",sysauto:true,loading:false,success:$.noop});Jalor.SsoUpdate.ready=false;Jalor.Core.log("---------Requst SSO only4ssoTimeUpdate.do---------------")},150000)}}};Jalor.Permission={user:workspaceVO.user,perms:null,res:null};Jalor.Permission.changeRole=function(a){if(Jalor.Permission.beforeChangeRole(a)!==false){$(window.document.body).loading();window.location.href=Jalor.Config.Service.changeRole.formatURI(window.location.href,a)+"&t="+new Date().getTime()+$.newGuid("",5)}};Jalor.Permission.beforeChangeRole=function(a){};Jalor.Permission.init=function(){var b=this.user;if(!b.currentRole){return}var d=b.currentRole.personalPermissions;var a=b.currentRole.noPermissionUrl;this.perms=new Jalor.HashMap();this.res=new Jalor.HashMap();if(d){for(var c=0;c<d.length;c++){this.perms.put(d[c],true)}}if(a){for(var c=0;c<a.length;c++){this.res.put(a[c],true)}}d=b.currentRole.personalPermissions=null;a=b.currentRole.noPermissionUrl=null};Jalor.Permission.check=function(b,a){a=a||Jalor.UI.Config.Permission.Model.has;if(b.indexOf("|")>=0&&b.indexOf(",")>=0){Jalor.Core.log("permission 权限点标注错误，不能同时使用逻辑与“|”与逻辑或“,”来控制元素显示:"+b,Jalor.Config.Log.error);return false}if(b.indexOf("|")>=0){return Jalor.Permission._checkAnyOne(b.split("|"),a)}else{if(b.indexOf(",")>=0){return Jalor.Permission._checkAll(b.split(","),a)}else{return Jalor.Permission._check(b,a)}}};Jalor.Permission._check=function(a,b){if(b=="hasPermission"){return this.perms.get($.trim(a))?true:false}else{return this.perms.get($.trim(a))?false:true}};Jalor.Permission._checkAll=function(c,a){for(var b=0;b<c.length;b++){if(a=="hasPermission"){if(!this.perms.get($.trim(c[b]))){return false}}else{if(this.perms.get($.trim(c[b]))){return false}}}return true};Jalor.Permission._checkAnyOne=function(c,a){for(var b=0;b<c.length;b++){if(a=="hasPermission"){if(this.perms.get($.trim(c[b]))){return true}}else{if(!this.perms.get($.trim(c[b]))){return true}}}return false};Jalor.Cache={_cacheMap:{},get:function(a){return this._cacheMap[a]},put:function(a,b){this._cacheMap[a]=b},clear:function(){this._cacheMap={}},remove:function(a){try{delete this._cacheMap[a]}catch(b){}}};Jalor.Core.forbidBackSpace=function(j){var f=j||window.event;if(f.keyCode==8){var h=f.target||f.srcElement;var d=h.type||h.getAttribute("type");var g=h.readOnly;var c=h.disabled;g=(g==undefined)?false:g;c=(c==undefined)?true:c;var b=(d=="password"||d=="text"||d=="textarea")&&(g==true||c==true);var a=d!="password"&&d!="text"&&d!="textarea";if(a||b){_stopDefasultEvent(j);return false}}};Jalor.Hwa={send:function(b,a,c,d){if(workspaceVO.config.hwa=="0"){return}if(typeof b=="object"){d=b}else{d=d||{};b&&(d.opr_wf_n=b);a&&(d.opr_wf_d=a);c&&(d.url=c)}ha("trackEvent","click",d)}};Jalor.Static={isXDRCross:(function(){if(workspaceVO.config.resourceMode!="2"||$.support.cors||!$.ajaxTransport||!window.XDomainRequest){return false}else{var a=jQuery.ajax;rootUrl=Jalor.Config.Global.rootUrl;jQuery.ajax=function(d,b){if(typeof d=="object"&&typeof d.url=="string"){var c=d.url.split("?")[0];if(c.indexOf(rootUrl)==0){c=c.replace(rootUrl,"")}if(/\.(html|js)$/i.test(c)){d.url=Jalor.Static.getStaticUrl(c)+(workspaceVO.config.appVersion?"?version="+workspaceVO.config.appVersion:"")}}return a(d,b)};return true}})(),isOldMode:(function(){var c=$.trim(location.search).substring(1);if(!c){return false}var d=c.split("&");for(var b=0;len=d.length,b<len;b++){var a=d[b].split("=");if(a[0]=="oldMode"&&a[1]){return true}}return false})(),checkJalorUrl:function(a){var b=/^((jalor|har|guest|pub)\/)/i;return b.test(a)},getStaticUrl:function(b){if(this.isOldMode){return b}if(workspaceVO.config.resourceMap[b.split("?")[0]]){return b}else{var a=b.indexOf("/")!=-1&&workspaceVO.config.subAppMap[b.split("/")[0]];if(a){return a+b}return(this.checkJalorUrl(b)?workspaceVO.config.jalorStatic:workspaceVO.config.selfStatic)+b}},getAppVersion:function(a){var b=workspaceVO.config.jalorVersion,c=workspaceVO.config.appVersion;return this.checkJalorUrl(a)?(b?b:c):c}};if(Jalor.Static.isXDRCross){(function(g){var n=typeof undefined,h=[],c=h.concat,d=h.push,a=h.slice,o=h.indexOf,p=/^true\/(.*)/,b=/^$|\/(?:java|ecma)script/i,e=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function f(t,q){var r,u,s=0,v=typeof t.getElementsByTagName!==n?t.getElementsByTagName(q||"*"):typeof t.querySelectorAll!==n?t.querySelectorAll(q||"*"):undefined;if(!v){for(v=[],r=t.childNodes||t;(u=r[s])!=null;s++){if(!q||jQuery.nodeName(u,q)){v.push(u)}else{jQuery.merge(v,f(u,q))}}}return q===undefined||q&&jQuery.nodeName(t,q)?jQuery.merge([t],v):v}function k(q){q.type=(jQuery.find.attr(q,"type")!==null)+"/"+q.type;return q}function j(r){var q=p.exec(r.type);if(q){r.type=q[1]}else{r.removeAttribute("type")}return r}function l(r,q,t){if(!r.length){t&&t();return}var s=r.splice(0,1)[0];if(s.src){jQuery.ajax({url:s.src,type:"GET",dataType:"text",success:function(u){jQuery.globalEval(u);l(r,q,t)},error:function(u){l(r,q,t)}})}else{jQuery.globalEval((s.text||s.textContent||s.innerHTML||"").replace(e,""));l(r,q,t)}}g.fn.domManip=function(B,G,s){B=c.apply([],B);var y,t,q,w,E,A,x=0,v=this.length,D=this,F=v-1,C=B[0],r=jQuery.isFunction(C);if(r||!(v<=1||typeof C!=="string"||jQuery.support.checkClone||!rchecked.test(C))){return this.each(function(I){var H=D.eq(I);if(r){B[0]=C.call(this,I,H.html())}H.domManip(B,G,s)})}if(v){A=jQuery.buildFragment(B,this[0].ownerDocument,false,!s&&this);y=A.firstChild;if(A.childNodes.length===1){A=y}if(y){w=jQuery.map(f(A,"script"),k);q=w.length;for(;x<v;x++){t=A;if(x!==F){t=jQuery.clone(t,true,true);if(q){jQuery.merge(w,f(t,"script"))}}G.call(this[x],t,x)}var u=[];if(q){E=w[w.length-1].ownerDocument;jQuery.map(w,j);for(x=0;x<q;x++){t=w[x];if(b.test(t.type||"")&&!jQuery._data(t,"globalEval")&&jQuery.contains(E,t)){u.push(t)}}}var z=g(D).data("xdrCallback");g(D).removeData("xdrCallback");l(u,g(D),z);A=y=null}}return this}})(jQuery)}(function(){var a=Jalor.Modal={create:function(b){return new Jalor.IModal(b)},isModal:function(b){return b&&b.__name=="Modal"},isRequiredField:function(b){if(b){if((b.editorOp&&b.editorOp.rule&&b.editorOp.rule.required)||(b.rule&&b.rule.required)){return true}}return false},initAjax:function(c,d,b){if(c){if(typeof(c)=="string"){return{url:c,success:d.success,error:d.error,data:d.data,type:b}}else{d.url||(d.url=c.url);c.success&&(d.success=$.mergeFn(c.success,d.success));c.error&&(d.error=$.mergeFn(c.error,d.error));d.type||b&&(d.type=b);return d}}return null},request:function(f,g,h,e,b){if(h){var g;if(h.ajax){g=h.ajax}else{var g=this.initAjax(g,h,e);g&&h.urlParam&&(g.url=g.url.formatField(h.urlParam,"url"))}if(g){var c=f.getTrigger(b);if(c){var d=g.success;g.success=function(j){f.fireTrigger(c.before,[j]);d&&d(j);f.fireTrigger(c.after,[j])}}Jalor.Core.ajax(g,h.ui)}}}};Jalor.IModal=$.IObject("Modal",{init:function(c){var b=this;b._data={};if(c.fields){this.validator=Jalor.Validator.create();if($.isArray(c.fields)){$.each(c.fields,function(d,e){if(!e.alias&&c.autoAlias){e.alias=e.field.replaceAll("\\.","_")}b[e.alias||e.field]=b.initField(e)})}else{if(c.initField!==false){$.each(c.fields,function(d,e){if(!e.alias&&c.autoAlias){e.alias=e.field.replaceAll("\\.","_")}b[e.alias||e.field]=b.initField(e)})}else{$.extend(b,c.fields)}}b.fields=c.fields;delete c.fields}$.extend(true,b,c)},each:function(b){var c=this;$.each(c.fields,function(d,e){c.proxy(b,e,d)})},initField:function(c){var b=c.type?Jalor.UI.Config.typeRule[c.type]:null;if(c.rule||b){this.validator.addField(c.field,c.rule=$.extend(true,{},b,c.rule))}return Jalor.Control.initField(c)},getField:function(b){if(b){b=b.replace(this.modalName+".","");return Jalor.DataHelper.getObj(b,this)}},addField:function(c){var b=this.fields;c=this.initField(c);if($.isArray(b)){b.push(c)}else{b[c.alias||c.field]=c}this[c.alias||c.field]=c},removeField:function(c){var b=this.fields;if($.isArray(b)){$.each(b,function(d,e){if((e.alias||e.field)==c){b.splice(d,1);return false}})}else{delete b[c]}delete this[c];this.validator.removeField(c)},bindChange:function(c,b){this._ChangeHandler||(this._ChangeHandler={});if(c=="everyChange"){this._everyChange=true}else{if(c="viewChange"){this._viewChange=true}}this._ChangeHandler[c]||(this._ChangeHandler[c]=$.Callbacks());this._ChangeHandler[c].add(b)},bindRest:function(b,c){this.addTrigger(b,c)},attr:function(d,g,b,f){var c=Jalor.DataHelper.getObj(d,this._data);if(g===undefined){return c}else{if(c!==g){if(f!=false&&this._ChangeHandler){if(f!="view"&&this._viewChange){this._ChangeHandler.viewChange.fireWith(this,[d,g,c,b])}var e=this._ChangeHandler[d];this._everyChange&&this._ChangeHandler.everyChange.fireWith(this,[d,g,c,b]);e&&e.fireWith(this,[d,g,c,b])}Jalor.DataHelper.setObj(d,this._data,g)}}return this},setData:function(b){this._data=b},getData:function(b){return b?$.extend(true,{},this._data):this._data},valid:function(b){return this.validator?this.validator.valid(b):true},request:function(b,f,c){var d=this,e=d.rest[b];a.request(d,e,f,c,b)},buildParam:function(c){if(!$.isPlainObject(c)){var b=c;c={urlParam:{}};c.urlParam[this.modalKey]=b}else{if(!c.url&&!c.urlParam&&!c.success&&c.param){c={urlParam:c}}}return c},findSingle:function(b){this.request("findSingle",this.buildParam(b))},findList:function(b){this.request("findList",b)},isRequired:function(b){if(typeof(b)=="string"){b=this.fields[b]}return a.isRequiredField(b)},isNew:function(){return !this.getKey()},getKey:function(){return this.attr(this.modalKey)},createSingle:function(b){b||(b);b.data=this.getData();this.request("createSingle",b,"POST")},updateSingle:function(b){b||(b={});b.data=this.getData();this.request("updateSingle",b,"PUT")},saveSingle:function(b){this.isNew()?this.createSingle(b):this.updateSingle(b)},saveBatch:function(b){this.request("saveBatch",b,"PUT")},deleteSingle:function(b){this.request("deleteSingle",this.buildParam(b),"DELETE")}},null,true)})();(function(){var c=$.IObject({init:function(d){$.extend(true,this,d);this.buildTmpl();if(d.autoLayout!==false){this._inLayout=true}if(this.onInit){this.onInit();delete this.onInit}},buildContent:function(j,g){var h;if(j){if($.isArray(j)){var f=[];for(var e=0,k;k=j[e];e++){this.modal.data(k);f.push(Jalor.View.bindTmpl(this,g))}return f.join("")}this.modal.setData(j)}return Jalor.View.bindTmpl(this,g)},render:function(d,e,f){d=$(d);e||(e=this.renderType);this.layout&&(this.layout.renderType=e);this.tmpl&&d.append(this.buildContent(f,e));Jalor.Control.build(d,this.modal,e,this.validOp,this.buildControlTag===false);return new Jalor.Controller({modal:this.modal,dom:d,events:this.events})},getField:function(d){var e=Jalor.DataHelper.getObj(d,this.modal,true);if(!e){e=this.modal[d.substr(d.indexOf(".")+1)]}return e},startLayout:function(){if(this.layout){this._inLayout=true;return this.layout.start()}},endLayout:function(){if(this._inLayout){delete this._inLayout;return this.layout.end()}},startCustomLayout:function(e){this._inLayout=null;var d=this.layout.getItemLayout(e,"${content}").split("${content}");this._customLayout=d[1];return d[0]},endCustomLayout:function(){this._inLayout=true;var d=this._customLayout;delete this._customLayout;return d},buildTmpl:function(d){d&&(this.op.tmpl=d);Jalor.View.buildTmpl(this)}});Jalor.Controller=$.IObject({init:function(d){this.setup(d);$.extend(true,this,d)},setup:function(f){var d=f.dom||this.dom,e=this;if(f.events){$.each(f.events,function(k,j){var g=k.split(" "),l=g[0],h=g[1];d.find(l).bind(h,e,function(n){j.call(this,n,n.data)})});delete f.events}this.bindChangeTrigger(d,f);return this},bindChangeTrigger:function(d,e){if(e.changeTrigger){d.focusin(this,function(f){f.data.triggerChange(f)}).focusout(this,function(f){f.data.triggerChange(f)});(e.modal||this.modal).bindChange("viewChange",function(h,j,g,f){f.findByName(h).manager().setValue(j)})}},triggerChange:function(h){var g=$.getEventTarget(h),d=g.attr("name"),f;if(d){this.modal.attr(d,Jalor.Control.ctrValue(g,this.modal),this,"view")}},valid:function(){return Jalor.Control.valid(this.dom)},find:function(d){return this.dom.find(d)},findByName:function(d){return this.dom.find('[name="'+d+'"]')},getData:function(d){return Jalor.Control.getValue(this.dom,this.modal,d==null?"edit":d)},setData:function(e,d){Jalor.Control.setValue(this.dom,this.modal,e,d)}});var a=Jalor.Tmpl={convert:function(e,d,f){return e.replace(/\r|\n/g,"").replace(/("|\\)/g,"\\$1").replace(/\<\%([\s\S]*?)\%\>/g,'");\n $1 _s.push("').replace(/\${([\s\S]*?)}/g,function(h,g){return d(g,f)})},build:function(e,d,f,g){e=this.convert(e,d,g);return new Function(f,'var _s=[];_s.push("'+e+'"); return _s;')},bind:function(f,d,e){return f.apply(e,d)}};Jalor.View={create:function(d){return new c(d)},initLayout:function(d){var e=d.layout;if(e&&typeof(e)=="string"){d.layout=Jalor.ViewLayout.build(e)}},buildTmpl:function(d){this.initLayout(d);var e=d.tmpl;if(e&&typeof(e)=="string"){d.tmpl=a.build(e,this.buildFiledItem,[d.modal.modalName,"renderType"],d)}},bindTmpl:function(d,f){var e=a.bind(d.tmpl,[d.modal,f||op.renderType],d).join("");if(d.layout.replaceVar){return d.layout.replaceVar(e)}return e},buildFiledItem:function(e,j,g){var f=e.charAt(0),l,d;if(f=="#"){d="edit"}else{if(f=="&"){d="view"}else{if(f=="="){d="custom"}}}l=d?e.substring(1):e;var n,h=['",'];if(d=="custom"){h.push(l)}else{n=j.getField(l,j);if(n.enable!==false||g){if(n.renderTmpl&&l!=g){var k=a.convert(n.renderTmpl,function(o,p){return Jalor.View.buildFiledItem(o,p,l)},j);return'",this.startCustomLayout('+l+'),"'+k+'",this.endCustomLayout(),"'}else{h.push("Jalor.View.formatField(",l,',"',l,'",',d?'"'+d+'"':"renderType",",this)")}}else{return""}}h.push(',\n"');return h.join("")},formatField:function(g,h,e,d){g.renderType&&(e=g.renderType);var f=Jalor.Control.buildCtrTag(h,e);if(g.renderLayout!==false&&d._inLayout&&d.layout){return d.layout.getItemLayout(g,f)}return f}};var b={init:function(d){this.itemCount=0;this.html=[];$.extend(this,d)},checkPart:function(){},checkPartEnd:function(){},beginPart:function(d){this.html.appendFormat(this.partStart,this.setPartOp(d))},endPart:function(d){this.html.push(this.partEnd)},setPartOp:function(d){return d},setItemOp:function(d){},append:function(f,e){this.setItemOp(f);var d=this.layout.replace(/\${([\s\S]*?)}/g,function(h,g){if(g=="item"){return e}else{return Jalor.DataHelper.getObj(g,f,true)||""}});this.itemCount++;return this.html.push(d)},getItemLayout:function(f,e,d){this.html=[];this.checkPart(f);this.append(f,e,d);this.checkPartEnd(f);return this.html.join("")},start:function(){},end:function(){this.html=[];this.itemCount=0;return this.partEnd}};Jalor.ViewLayout=$.IAdapter({mapping:b,proto:{build:function(d,f){if(typeof(d)=="string"){var e=this.get(d);return e?new e(f):null}return new d(f)}},type:"object"})})();(function(a){Jalor.ViewLayout.add("form-Flow",{partStart:'<div class="${css}"><ul>',layout:'<li class="layout-item jalor-form-row jalor-form-${item.layout}" field="${item.field}"><samp class="layout-title ${item.titleMark}">${item.name}</samp><span class="jalor-form-input">${item}</span></li>',partEnd:"</ul></div>",setPartOp:function(c){var b=c.layout=="custom";if(b){css="jalor-form-custom";(this.itemCount==0)&&(css+=" jalor-form-custommore")}else{css="jalor-form-body";this.itemCount>0&&(css+=" jalor-form-bodymore")}this._prevLayout=c.layout;return{css:css}},setItemOp:function(b){if(this.renderType&&this.renderType!=="view"){Jalor.Modal.isRequiredField(b)&&(b.titleMark="required")}return b},checkPartEnd:function(b){b.titleMark&&delete b.titleMark},checkPart:function(b){if(this.itemCount){if((b.layout=="custom")!=(this._prevLayout=="custom")){this.endPart();this.beginPart(b)}}else{this.beginPart(b)}}});a.add("form-Table",{partStart:"<tr>",layout:'<th width="20%" class="${item.titleMark}">${item.name}</th><td width="30%" class="" ${item._itemColspan}>${item}</td>',partEnd:"</tr>",setItemOp:function(b){if(this.renderType&&this.renderType!=="view"){Jalor.Modal.isRequiredField(b)&&(b.titleMark="required")}if(b.layout){b._itemColspan="colspan='3'";this._prevItem=null}else{this._prevItem=this.itemCount;this._colspanSet[this._prevItem]=1;b._itemColspan="${^"+this._prevItem+"}"}return b},checkPartEnd:function(b){b.titleMark&&delete b.titleMark;delete b._itemColspan},checkPart:function(b){if(this._colspanNum==0){this.itemCount>0&&this.endPart(b);this.beginPart(b);b.layout||this._colspanNum++}else{if(b.layout){if(this._prevItem){this._colspanSet[this._prevItem]=3}this.endPart(b);this.beginPart(b)}else{this._colspanNum=0}}},endPart:function(b){this.proxy(this.base.endPart,b);this._colspanNum=0},start:function(){this._colspanNum=0;this._prevItem=null;this._colspanSet={};return"<table class='jalor-table'>"},end:function(){if(this._colspanNum&&this._prevItem){this._colspanSet[this._prevItem]=3}delete this._colspanNum;delete this._prevItem;return this.proxy(this.base.end)+"</table>"},replaceVar:function(b){if(!$.isEmptyObject(this._colspanSet)){var d,c=this;return b.replace(/\${\^([\s\S]*?)}/g,function(f,e){d=c._colspanSet[e];if(d&&d>1){return"colspan='"+d+"'"}return""})}return b}})})(Jalor.ViewLayout);(function(){Jalor.Control=$.IAdapter({mapping:{render:function(c,b,a){a!=null&&this.setValue(c,b,a);return c},getValue:function(b,a){return a.renderer.getValue(b,a.format)},setValue:function(c,b,a){b.renderer.render(c,a,b.format)}},proto:{initField:function(a){if(!a.renderer||typeof(a.renderer)=="string"){a.renderer=Jalor.UI.Renderer.get(a.renderer||a.type)}a.renderer.initFormat&&a.renderer.initFormat(a.format);if(!a.editor||typeof(a.editor)=="string"){a.editor=Jalor.Editor.get(a.editor||a.type)}a.editorOp=$.extend(true,{type:a.type,field:a.field,format:a.format,rule:a.rule},a.editorOp);return a},render:function(c,a,f,e,b){var d=this.get(c).render(a,f,e);f.attrs&&d.attr(f.attrs);d.addClass("jalor-control").attr("rtype",c);f.onRender&&f.onRender(d,f,c);b&&d.attr("mapping",b);return d},buildCtrTag:function(b,a){return"<span class='jalor-field' mapping='{0}' rtype='{1}' />".formatText(b,a||"")},build:function(b,e,d,g,h,a){var f={},c=function(n,k,o,l){if(k!="view"){var j=o.editorOp&&o.editorOp.rule?o.editorOp.rule:null;if(j||o.rule){j=$.extend(true,{},o.rule,j)}j&&(f[o.field]=j)}a&&a(n,k,o,l)};b.find("span.jalor-field").each(function(){Jalor.Control.buildCtr($(this),e,d,h,c)});if(!$.isEmptyObject(f)||(g&&g.rule)){if(g){$.extend(g,{fields:f})}else{g={fields:f}}}b.jalorValidate(g).removeClass("init")},buildCtr:function(j,g,a,d,h){var b=j.attr("rtype")||a,e=j.attr("mapping"),f=Jalor.DataHelper.getObj(e,g,true),c=this.render(b,j,f,g.attr(f.field),e);h&&h(c,b,f,g);if(d){j.children().insertAfter(j);j.remove()}else{j.removeAttr("rtype").removeAttr("mapping")}},setValue:function(a,c,d,b){this.eachControl(a,c,b,function(h,j,f,e){var g=Jalor.DataHelper.getObj(f,d);e.setValue(h,j,g)})},getValue:function(a,c,b){var d={};this.eachControl(a,c,b,function(h,j,f,e){var g=e.getValue(h,j);g!=null&&g!==""&&Jalor.DataHelper.setObj(f,d,g)});return d},eachControl:function(c,f,e,b){var d=".jalor-control",a=Jalor.Control.get(e);e&&(d+="[rtype='"+e+"']");c.find(d).each(function(){var j=$(this),g=j.attr("name"),h=j.attr("rtype"),k=f.getField(j.attr("mapping"));k&&b(j,k,g,(e==h?a:Jalor.Control.get(h)))})},valid:function(b){if(b.valid()){var a=true;b.find(".control-composite").each(function(){if(!$(this).manager().valid()){a=false;return false}});return a}return false},ctrValue:function(f,d,e){var c=f.attr("mapping"),b=f.attr("rtype"),a=Jalor.Control.get(b),g=d.getField(c);if(g){if(arguments.length>2){a.setValue(f,g,e)}else{return a.getValue(f,g)}}return this}},setDefault:true});Jalor.Control.add("edit",{render:function(a,d,c){var b=d.editor.render(a,d.editorOp);c!=null&&this.setValue(b,d,c);return b},getValue:function(b,a){if(a.getValue){return a.getValue(b)}else{return this.parseValue(a.editor.getValue(b),a)}},setValue:function(c,b,a){if(b.setValue){b.setValue(c,a)}else{b.editor.setValue(c,this.parseValue(a,b))}return this},parseValue:function(a,b){if(a!=null){return b.renderer.parse(a.value||a,b.format)}return a}})})();(function(){var a=Jalor.DataCache={create:function(b){return new a.Cache(b)},createCaches:function(b){return new a.CacheCollection(b)}};a.Cache=$.IObject({init:function(b){$.extend(this,b);this.clear()},buildKey:function(g){var c=[];for(var e=0,b=this.keys.length;e<b;e++){var d=this.keys[e],f;if(!d){return}f=Jalor.DataHelper.getObj(d,g);if(f==null){return}c.push(f)}return c.join(this.split||"-")},clear:function(){this._store={};this.length=0},each:function(b){if(this.length){$.each(this._store,function(c,d){b(d,c)})}return this},cache:function(f,b){var d=this.buildKey(f),e=this.getValue(d);if(b){delete this._store[d];e!=null&&this.length--}else{if(!this.checkLimit()){return false}if(arguments.length>2){var c=Array.prototype.slice.call(arguments,0);c[1]=d;this._store[d]=this.buildValue.apply(this,c)}else{this._store[d]=this.buildValue(f,d)}e==null&&this.length++}return true},checkLimit:function(){if(this.limitCount){if(this.length+1>this.limitCount){this.fnOverLimit&&this.fnOverLimit.call(this,this.length,this.limitCount);return false}}return true},getValue:function(c,b){if(typeof(c)!="string"){c=this.buildKey(c)}return b?{key:c,value:this._store[c]}:this._store[c]},buildValue:function(b){return b},merge:function(c){var b=this.getValue(c,true);if(b.value!=null){this._store[b.key]=$.extend(c,b.value);return true}},toArray:function(){var b=[];if(this.length){this.each(function(d,c){b.push(d)})}return b}});a.CacheCollection=$.IObject({init:function(c){$.extend(this,c);this.Caches={};var b=this;$.each(c.caches,function(d,e){c.caches[d]=b.initCache(d,e)});this.limitCount;delete this.caches},initCache:function(b,c){c.keys||(c.keys=this.keys);this.Caches[b]=new a.Cache(c)},clear:function(){$.each(this.Caches,function(c,b){b.clear()})},clearCache:function(b){this.getCache(b).clear()},getCache:function(b){return this.Caches[b]},checkLimit:function(){if(this.limitCount){var b=this.count();if(b+1>this.limitCount){this.fnOverLimit&&this.fnOverLimit.call(this,b,this.limitCount);return false}}return true},cache:function(d,e,b){if(!b&&!this.checkLimit()){return false}var c=this.getCache(d);c.cache.apply(c,Array.prototype.slice.call(arguments,1));return true},count:function(){var b=0;$.each(this.Caches,function(d,c){b+=c.length});return b},merge:function(b){var c=[];$.each(this.Caches,function(f,e){if(e.length){c.push(e)}});if(c.length){var d=this;$.each(b,function(e,f){d.mergeItem(f,c)})}},mergeItem:function(c,b){$.each(b,function(e,d){if(d.merge(c)){return false}})},toArray:function(){var b={};$.each(this.Caches,function(d,c){b[d]=c.toArray()});return b}})})();(function(a){var c=Jalor.Storage={create:function(g,e){if(e&&e!=="Table"){var f=this[e];if(f){return new f(g)}}else{return this.createTable(g)}},createTable:function(f){var e=new this.Table(f);this.Cache.init(e);return e},createDataTree:function(e){return new this.Tree(e)},Status:{inserted:"_inserted",updated:"_updated",deleted:"_deleted",selected:"_selected",halfSelected:"_halfSelected"},ReturnValue:{complete:"complete",next:"continue",last:"last"}};var d={base:{valid:function(e){return this.modal.valid(e)},find:function(g,e){g=this.modal.buildParam(g);var f=this;g.success=function(h){if(h){f.store(h);e&&e(h,f)}};this.modal.findSingle(g)}}};c.Data=$.IObject({init:function(f){var e=this;$.extend(true,e,f);e.Status=c.Status;e.ReturnValue=c.ReturnValue;e.initStore(f)},initStore:function(e){this.dataset||(this.dataset={})},store:function(f,e){if(arguments.length){this.dataset=f||{};if(e){e.data=f}else{e={data:f}}this.fireTrigger("store",e);return this}else{return this.dataset}},clear:function(e){this.dataset={};this.fireTrigger("clear",e)},len:function(){return !$.isEmptyObject(this.dataset)},at:function(e){return this.dataset[e]},updateItem:function(f,g,e){if(g==null&&g==""){delete this.dataset[f]}else{this.dataset[f]=g}if(e){e.key=f;e.value=g}else{e={key:f,value:g}}this.fireTrigger("update",e)},update:function(g,f){var e=this;$.each(g,function(h,j){e.updateItem(h,j,f)})}},null,true);c.Table=$.IObject({init:function(f){var e=this;$.extend(true,e,f);e.initTrigger();e.Status=c.Status;e.ReturnValue=c.ReturnValue;e.initStore(f)},initStore:function(e){this.dataset||(this.dataset=[])},initTrigger:function(){this.Trigger={store:$.Callbacks(),clear:$.Callbacks(),update:$.Callbacks(),insert:$.Callbacks(),remove:$.Callbacks(),destroy:$.Callbacks(),select:$.Callbacks()}},fireTrigger:function(g){var f=this.Trigger[g],e=Array.prototype.slice.call(arguments,1);f&&f.fireWith(this,e)},bindTrigger:function(f,h,g){this._trigger||(this._trigger={});var e=this._trigger[f];e||(e=this._trigger[f]=$.Callbacks(g));e.add(h)},unbindTrigger:function(f,g){var e=this._trigger[f];e&&e.remove(g)},clearTrigger:function(f){var e=this._trigger[f];e&&e.empty()},run:function(h){var j=this[h],g;if(j&&$.isFunction(j)){g=Array.prototype.slice.call(arguments,1);g.unshift(j);var e=this.proxy.apply(this,g),f=this._trigger[h];g[0]=e;f&&f.fireWith(this,g);return e}return false},len:function(){return this.dataset.length},store:function(f,e){if(arguments.length){this.dataset=f||[];this.fireTrigger("store",f,e);return this}else{return this.dataset}},append:function(f,e){this.dataset=f||[];if(!f){return this}if(!$.isArray(f)){f=[f]}if(e!=null){f.unshift(e,0);Array.prototype.splice.apply(this.dataset,f)}else{$.merge(this.dataset,f)}this.fireTrigger("store",f,args);return this},clear:function(e){this.dataset=[];this.fireTrigger("clear",e)},each:function(f){if(f){for(var g=0,e=this.dataset.length;g<e;g++){if(this.proxy(f,this.dataset[g],g)===false){break}}}return this},handle:function(f,g){if(f&&typeof f=="object"){var j=f;f=function(o,l,n){for(var k in j){if(j[k]!==o[k]){return false}}return true}}var h=0,e;this.each(function(l,k){e=f?this.proxy(f,l,k,h):true;if(e){if(e==this.ReturnValue.complete){return false}h++;this.proxy(g,l,k,h);if(e==this.ReturnValue.last){return false}}});return h},at:function(e){return this.dataset[e]},findOne:function(f){var e;this.each(function(j,g,h){if(this.proxy(f,j,g,h)){e=j;return false}});return e},filter:function(f,h,n,k){var j=this,l=b.buildFilterOp(arguments);if(!l.fnFilter&&!l.copy){return j.dataset.slice(0)}var e=[],g;j.handle(l.fnFilter,function(o){g=(l.fields||l.copy)?a.copyField(o,l.fields):o;e.push(g);l.fnHandle&&j.proxy(l.fnHandle,g)});return e},range:function(f,e){return this.dataset.slice(f,e)},map:function(e){return $.map(this.dataset,e)},sort:function(g,f,h,e){this.dataset=b.sort(g,f,this.dataset,h,e);return this},group:function(f,e){},setStatus:function(g,f,e){if(e||e==null){g[f]=true}else{delete g[f]}return this},clearStatus:function(e){if(e=this.getItem(e)){$.each(this.Status,function(f,g){delete e[g]})}},getItem:function(e){return $.isNumeric(e)?this.at(e):e},setSelected:function(e,g,f){return this.handle(e,function(h){this.setItemSelected(h,g,f)})},setItemSelected:function(g,f,e,h){if(g=this.getItem(g)){f==null&&(f=true);this.innerStatus!==false&&this.setStatus(g,this.Status.selected,f);this.fireTrigger("select",g,f,e,h)}return this},insertItem:function(f,g,e){if(f){this.innerStatus!==false&&this.setStatus(f,this.Status.inserted);if(g!=null&&this.dataset.length){this.dataset.splice(g,0,f)}else{this.dataset.push(f)}this.fireTrigger("insert",f,g,e)}return this},insert:function(f,g){if(f){if($.isArray(f)){var e=this;$.each(f,function(h,j){e.insertItem(j,g?g+h:null)})}else{this.insertItem(f,index)}}return this},update:function(e){},updateItem:function(g,j,h,f){if(g=this.getItem(g)){if(typeof(j)=="string"){var e=f=j;j=a.setObj(e,{},h)}else{f=h}if($.isPlainObject(j)){$.extend(true,g,j)}else{this.dataset[index]=j}if(!this.isNew(g)){this.innerStatus!==false&&this.setStatus(g,this.Status.updated,true);this.fireTrigger("update",g,j,f)}}return this},remove:function(f,e,g){return this.handle(f,function(h){this.setItemSelect(h,e,g)})},removeItem:function(h,e,g){var f=$.isNumeric(h)?h:h._index;if(h=this.getItem(h)){this.innerStatus!==false&&this.setStatus(h,this.Status.deleted,e);this.fireTrigger("remove",h,e,g);return 1}return 0},destroyItem:function(f,e){if(f!=null){var g=this.dataset.splice(f,1);if(g.length){this.fireTrigger("destroy",g[0],e);return 1}}return 0},destroy:function(h,j){var g=0;if(h){var n=this.dataset,l;for(var k=0,f=n.length;k<f;k++){var l=n[k],e=this.proxy(h,l,k,g);if(e){if(e==this.ReturnValue.complete){break}n.splice(k,1);k--;g++;this.fireTrigger("destroy",l,j);if(e==this.ReturnValue.last){break}}}}return g},isNew:function(e){return e[this.Status.inserted]},isUpdated:function(e){return e[this.Status.updated]},isDeleted:function(e){return e[this.Status.deleted]},isSelected:function(e){return e[this.Status.selected]},getInsertedRecords:function(f,g,e){var h=g;if(typeof(f)=="boolean"){e=f;f=null}if(!e){if(typeof(f)=="function"){g=f;f=null}h=function(j){return !this.isDeleted(j)&&(!g||this.proxy(g,j))}}return this.filterByStatus(this.Status.inserted,f,h)},getUpdatedRecords:function(e,f){if(typeof(e)=="function"){f=e;e=null}var g=function(h){return !this.isDeleted(h)&&!this.isNew(h)&&(!f||this.proxy(f,h))};return this.filterByStatus(this.Status.updated,e,g)},getDeletedRecords:function(e,f,h){var g=f;if(typeof(e)=="boolean"){h=e;e=null}if(!h){if(typeof(e)=="function"){f=e;e=null}g=function(j){return !this.isNew(j)&&(!f||this.proxy(f,j))}}return this.filterByStatus(this.Status.deleted,e,g)},getSelectedRecords:function(e,f){return this.filterByStatus(this.Status.selected,e,f)},filterByStatus:function(h,e,g,j,f){if(typeof(e)=="function"){g=e;e=null}return this.filter(e,function(k){return k[h]&&(!g||this.proxy(g,k))},j,f)},getChangedRecords:function(f,h,g,j){var e={insertedRecords:[],updatedRecords:[],deletedRecords:[]};this.filter(f,function(l,k){if(!h||this.proxy(h,l)){if(this.isNew(l)&&!this.isDeleted(l)){e.insertedRecords.push(l)}else{if(this.isDeleted(l)&&!this.isNew(l)){e.deletedRecords.push(l)}else{if(this.isUpdated(l)){e.updatedRecords.push(l)}}}g&&this.proxy(g,l,k)}},j);return e},getPreDeletedRecords:function(e,g,f){if(typeof(e)=="function"){g=e;e=null}var h=function(j){return this.isDeleted(j)&&(!g||this.proxy(g,j))};return this.getInsertedRecords(e,h,true)}});c.Cache={init:function(f){if(f.cacheKey&&f.cache!==false){var e={keys:f.cacheKey,limitCount:f.cacheLimit,fnOverLimit:f.fnOverCacheLimit,caches:this.buildCacheOp(f.cacheOnlyChanged)};f.Cache=Jalor.DataCache.createCaches(e);this.extend(f).setTrigger(f.Trigger);this.initInsertCache(f)}},buildCacheOp:function(f){var e={updated:{},selected:{buildKey:function(g){if(g[c.Status.inserted]){return g._cacheKey}return this.fn.buildKey.call(this,g)}},deleted:{}};if(f){updated.buildValue=function(j,g,k){var h=this.getValue(g);if(!h){h=a.copyField(j,this.keys)}h=$.extend(h,k);h[c.Status.updated]=true;return h};selected.buildValue=function(j,g,k){var h=a.copyField(j,this.keys);h[c.Status.selected]=true;return h};deleted.buildValue=function(j,g,k){var h=a.copyField(j,this.keys);h[c.Status.deleted]=true;return h}}return e},extend:function(e){e.extend({filterByStatus:function(h,f,g){var k;switch(h){case this.Status.inserted:k=this.Cache.insertCache;break;case this.Status.updated:k=this.Cache.getCache("updated");break;case this.Status.deleted:k=this.Cache.getCache("deleted");break;case this.Status.selected:k=this.Cache.getCache("selected");break}if(k){var j=c.create();return j.store(k.toArray()).filter(f,g)}return[]},getChangedRecords:function(f,g){return{insertedRecords:this.getInsertedRecords(),updatedRecords:this.Cache.getCache("updated").toArray(),deletedRecords:this.Cache.getCache("deleted").toArray()}}});return this},setTrigger:function(e,f){e.store.add(function(h,g){this.Cache.merge(h);this.Cache.insertCache.merge(h,g)});e.clear.add(function(){this.Cache.clear();this.Cache.insertCache.clear()});e.update.add(function(g,h){this.Cache.cache("updated",g,false,h)});e.remove.add(function(h,g){!this.isNew(h)&&this.Cache.cache("deleted",h,!g)});e.select.add(function(h,g){this.Cache.cache("selected",h,!g)})},initInsertCache:function(f){var e=f.Cache.insertCache=Jalor.DataCache.create({_index:0,keys:f.cacheKey,buildValue:function(h,g,j){h._cachePos=j;return h},buildKey:function(g){if(g._cacheKey==null){g._cacheKey=this._index++}return g._cacheKey},merge:function(l,k){if(this.length){var j=0,h,n=k.startIndex?k.startIndex-1:(k.curPage-1)*k.pageSize,g=k.endIndex?k.endIndex-1:n+k.pageSize;this.each(function(o){delete o._newIndex;delete o._seq;h=o._cachePos-n;if(h>=0&&o._cachePos<g){l.splice(h+j,0,o);j++}})}}});f.Trigger.insert.add(function(g,h){e.cache(g,false,h)});f.Trigger.destroy.add(function(g){f.setItemSelected(g,false);e.cache(g,true)});f.Cache.count=function(){return this.fn.count.call(this)+f.Cache.insertCache.length}}};var b={buildFilterOp:function(e){var f=e[0];if(!$.isPlainObject(f)){if(typeof(f)=="function"){f={fnFilter:e[0],copy:e[1],fnHandle:e[2]}}else{f={fields:e[0],fnFilter:e[1],copy:e[2],fnHandle:e[3]}}}return f},sort:function(r,n,l,e,j){var t,h,f,k,g,q=n=="asc";check=function(v,u){h=a.getObj(r,v);f=a.getObj(r,u);if(h==null||($.type(h)=="number"&&isNaN(h))){h=""}if(f==null||($.type(f)=="number"&&isNaN(f))){f=""}k=$.type(h);g=$.type(f);if(k!==g){return q?h.toString()>f.toString():h.toString()<f.toString()}else{if(k=="date"){h=h.getTime();f=f.getTime()}if(h==f){return false}if(k=="string"){var w=h.localeCompare(f);return q?w>0:w<0}else{return q?h>f:h<f}}};var o=l;o&&(o.length>0)&&$.each(o,function(w){for(var u=w;u>0;u--){var v=check(o[u-1],o[u]);if(v){var x=o[u];o[u]=o[u-1];o[u-1]=x}else{break}}});var s=new Array(),p=new Array();$.each(o,function(v,u){if((u.inner||u.columnType||!u.field)&&u.lockEnd){p.push(u)}else{s.push(u)}});o.splice(0,o.length);Array.prototype.push.apply(o,s);Array.prototype.push.apply(o,p);return o},nodeFilter:function(q,p,o,l,e,s){var h,f,n=0,k=[],g,r,j;for(h in p.childs){f=p.childs[h];if(f.count){g=b.nodeFilter(q,f,o,l,e,s);r=g&&g.length}else{g=null;r=q.proxy(o,f.data,f,n)}if(r){j=(l||e)?a.copyField(f.data,l):f.data;k.push(j);s&&q.proxy(s,j,f,n);if(g&&g.length){q.setStatus(j,"_opened",true);k=k.concat(g)}}n++}return k}};a.sort=b.sort;c.Tree=$.IObject({initStore:function(e){this.clear();e&&e.dataset&&this.store(e.dataset)},initTrigger:function(){this.Trigger={insert:$.Callbacks(),remove:$.Callbacks(),select:$.Callbacks(),halfSelect:$.Callbacks()}},clear:function(){this.index=0;this.dataset={count:0,_n:true};return this},store:function(e){this.clear().buildChild(this.dataset,e);return this},append:function(e){var j=this,f=[],h=[],n,l=0,k,g;for(;n=e[l];l++){g=true;k=j.getParentKey(n);$.each(e,function(o,p){if(o!=l&&j.checkParent(k,p)){g=false;return false}});(g?f:h).push(n)}$.each(f,function(p,o){var q=j.insertItem(j.dataset,o);h.length&&j.buildChild(q,h,j.getKey(o))})},getKey:function(e){return a.getObj(this.nodeKey,e)},getParentKey:function(e){return a.getObj(this.parentKey,e)},checkRoot:function(f){var e=this.getParentKey(f);if(this.fnCheckRoot&&this.fnCheckRoot(e,f)){return true}return !e},checkParent:function(e,f){return this.getKey(f)==e},checkChild:function(e,f){return this.getParentKey(f)==e},buildChild:function(h,e,f){for(var g=0,j;j=e[g];g++){if(f?this.checkChild(f,j):this.checkRoot(j)){e.splice(g,1);--g;this.insertItem(h,j)}}if(h.count){var k,l;for(k in h.childs){l=h.childs[k];this.buildChild(l,e,this.getKey(l.data))}}!f&&e.length&&this.append(e)},each:function(g,j){j||(j=this.dataset);if(j.count){var h,k,f=0,e;for(h in j.childs){k=j.childs[h];e=this.proxy(g,k.data,k,f);if(e===false){break}else{if(e!=c.ReturnValue.next){this.each(g,k)}}f++}}},handle:function(f,g,j){var e,h=0;this.each(function(n,l,k){e=f?this.proxy(f,n,l,k,h):true;if(e){if(e==c.ReturnValue.complete){return false}h++;this.proxy(g,n,l,k,h);if(e==c.ReturnValue.last){return false}else{if(e==c.ReturnValue.next){return c.ReturnValue.next}}}},j);return h},filter:function(f,g,l,h,j){var e=[],k=b.buildFilterOp(arguments);k.node=arguments.length==5?j:h;this.handle(k.fnFilter,function(p,o,n){record=(k.fields||k.copy)?a.copyField(p,k.fields):p;e.push(record);k.fnHandle&&this.proxy(k.fnHandle,record,o,n)},k.node);return e},filterByDeep:function(g,e,f){return this.filter(function(k,j,h){return k._deep<=g},null,e,f)},nodeFilter:function(e,g,k,f,h){var j=b.buildFilterOp(arguments);j.node=arguments.length==5?h:f;h||(h=this.dataset);if(h.count){return b.nodeFilter(this,h,j.fnFilter,j.fields,j.copy,j.fnHandler)}return[]},getChilds:function(f,e){return this.filter(e,null,null,f)},at:function(e){if(e._n){return e}else{e=this.getTreeNo(e)}e=e.replace(/\./g,".childs.");return a.getObj(e,this.dataset.childs)},getTreeNo:function(e){if(typeof(e)!="string"){if(e._n){return e.data._treeNo}else{e=e._treeNo||""}}return e},getParent:function(e){return this.getNodeInf(e).parent},getNodeInf:function(g){var h=this.getTreeNo(g),f,e;if(h){h=h.split(".");if(e=h.pop()){f=this.at(h.join("."))}}else{f=this.dataset}return{key:e,parent:f}},insertItem:function(h,j,f){h=h?this.at(h):this.dataset;var e=h.data;if(e){j._treeNo=(e._treeNo?e._treeNo+".":"")+this.index;j._deep=e._deep!=null?e._deep+1:0}else{j._treeNo=this.index+"";j._deep=0}h.count++;h.childs||(h.childs={});var g=h.childs[this.index++]={data:j,count:0,_n:true};this.fireTrigger("insert",g,h,f);return g},insert:function(g,e){for(var f=0,h;h=e[f];f++){this.insertItem(g,h)}},toggleNode:function(f,e){if(f=this.at(f)){if(f.count){this.setStatus(f.data,"_opened",e);if(e){var h=[],g=this.getChilds(f,function(j){if(this.isNew(j)){h.push(j);return false}else{if(!this.isOpened(j)){return c.ReturnValue.next}else{return true}}});return h.concat(g)}}}return[]},isOpened:function(e){return e._opened},setNodeStatus:function(g,f,e){if(g=this.at(g)){this.setStatus(g.data,f,e);this.each(function(h){this.setStatus(h,f,e)},g)}return this},setSelected:function(g,f,e){return this.setNodeStatus(g,c.Status.selected,f)},setItemSelected:function(g,f,e){this.setStatus(g,c.Status.selected,f)},setHalfSelected:function(g,f,e){if(g=this.getItem(g)){f==null&&(f=true);this.innerStatus!==false&&this.setStatus(g,c.Status.halfSelected,f);this.fireTrigger("halfSelect",g,f,e)}return this},remove:function(h,e,g){if(h=this.at(h)){var f=c.Status.deleted;this.setStatus(h.data,f,e);this.each(function(j){if(this.isNew(j)){this.destroy(j)}else{this.setStatus(j,f,e)}},h)}return this},destroy:function(g){var f=this.getNodeInf(g),e=f.parent;if(f.key&&e){var h=e.childs[f.key];if(h){delete e.childs[f.key];e.count--;return true}}return false}},c.Table)})(Jalor.DataHelper);(function(f){Jalor.UI.Config.typeRule={required:{required:true},number:{number:true},floatRequ:{number:true},integer:{digits:true},currency:{number:true},date:{date:true},datetime:{datetime:true},datehm:{datetime:true},dateym:{dateym:true},rate:{number:true,max:1,min:0},email:{email:true},url:{url:true},digits:{digits:true},speczh:{speczh:true},specialch:{specialch:true},specialch2:{specialch2:true},filesize:{filesize:true},userAccount:{userAccount:true}};var c;var e=Jalor.DataValidator=f.IObject("dataValidator",c={init:function(g){return f.extend(this,{ignore:true,fields:{},context:{}},g)},addField:function(g,h){this.fields[g]=h;return this},addFields:function(g){this.fields=f.extend(this.fields,g);return this},removeField:function(g){if(g in this.fields){delete this.fields[g]}return this},clear:function(){this.fields={};return this},setIgnore:function(g){this.ignore=!!g},setContext:function(g){this.context=g},valid:function(h,g){if(h&&typeof h=="object"){return this.validFields(this.fields,h)}else{return this.validField(h,g)}},validFields:function(g,h){var k=true,l={};for(var j in g){k=this.validField(j,Jalor.DataHelper.getObj(j,h),h);if(k!==true){l[j]=k}if(!this.ignore&&k!==true){return l}}return f.isEmptyObject(l)?true:l},validField:function(j,h,g){if(j in this.fields){var k=this.fields[j];return this.validValue(h,k,g,j)}return true},validValue:function(k,o,j,n){if(typeof(k)!="object"){k=f.trim(k)}if(Jalor.DataHelper.isEmpty(k)){if(o.required){return c.getMessage.call(this,n,"required",j)}else{for(var l in o){var p=typeof o[l]=="function"?o[l]:a[l];if(l=="customRequired"||p&&p.required){var h=p.type=="old-version"?p.call(this,k,j,g):p.call(this,k,g,j);if(h!==true){return typeof h=="string"?h:c.getMessage.call(this,n,l,j)}}}return true}}var g,p,h=true;for(var l in o){g=o[l],p=null;if(typeof g=="function"){p=g}if(!p){p=a[l]}if(l=="customRequired"){p=o[l];h=p.call(this,k,g,j);if(h!==true){return h}}if(p){if(p.type=="old-version"){h=p.call(this,k,j,g);if(h===false){h=typeof d[l]=="function"?d[l].call(this,g,j):(d[l]||"Warning: No message defined for "+l)}else{if(h==="pending"){h=d.remote}}if(h!==true){return h}}else{h=p.call(this,k,g,j);if(h==="pending"){h=d.remote}}}else{if(Jalor.UI.Config.typeRule[l]){h=this.validValue(k,Jalor.UI.Config.typeRule[l],j,n);if(h!==true){return h}}}if(h!==true){return c.getMessage.call(this,n,l,g,j)}}return h},getMessage:function(n,l,o,g){var j,o,k;if(this.__type=="iobject"&&this.fields[n]){o=this.fields[n][l];k=this.fields.messages}if(k){j=k[n+"-"+l]||k[l]}if(!j){j=d[l]||"Warning: No message defined for "+l}var h=typeof j;if(h=="function"){j=j.call(this,o,g)}if(typeof j=="string"){if(f.isArray(o)){j=j.formatValue.apply(j,o)}else{j=j.formatValue(o)}}return j}});var b=Jalor.FormValidator=f.IObject("formValidator",{normalizeRules:function(g){f.each(g,function(j,h){if(h===false){delete g[j]}});f.each(["minlength","maxlength","min","max"],function(){if(g[this]){g[this]=Number(g[this])}});f.each(["rangelength","range"],function(){if(g[this]){g[this]=[Number(g[this][0]),Number(g[this][1])]}});if(g.min&&g.max){g.range=[g.min,g.max];delete g.min;delete g.max}if(g.minlength&&g.maxlength){g.rangelength=[g.minlength,g.maxlength];delete g.minlength;delete g.maxlength}return g},classRules:function(h){var j={};var g=h.attr("class");g&&f.each(g.split(" "),function(){if(this in Jalor.UI.Config.typeRule){j[this]=true}});return j},attributeRules:function(g){var j={};for(var k in a){var h=g.attr(k);if(h){j[k]=h}}return j},check:function(h,k){var o=f.extend({},this.fields[h.prop("name")],this.classRules(h));var p=this.attributeRules(h);if(p.url){delete p.url}f.extend(o,p);o=this.normalizeRules(o);var l=h.data("placeholder")!=h.val()?h.val():"";var g=this.validValue(l,o,h);if(this.checkType=="unit"&&g==d.required&&!this.valided&&this.focusoutValid){return g}if(this.checkType!=="unit"||g!==d.remote){if(typeof g=="string"&&h.hasClass("jalor-calendar")&&h.attr("format")&&!Jalor.Config.Format[h.attr("format")]){var n=h.attr("format").split(" ")[0],j=g.match(/(\d{4})-(\d{1,2})-(\d{1,2})/);if(j){j.shift();g=g.replace(/(\d{4})-(\d{1,2})-(\d{1,2})/,n.replace("yyyy",j[0]).replace("MM",j[1]).replace("dd",j[2]))}else{j=g.match(/(\d{4})-(\d{1,2})/);if(j){j.shift();g=g.replace(/(\d{4})-(\d{1,2})/,n.replace("yyyy",j[0]).replace("MM",j[1]))}}}if(g===true||g===""||g.indexOf(d.remote)==-1){this.showLabel(h,g)}}return g},showLabel:function(j,l){var h=j.next("label.error");if(l===true){j.removeClass("error-ctr");h.hide();if(typeof this.success=="function"){this.success(h)}}else{if(l===""){h.hide()}else{var g=j.position(),k=j.outerWidth();if(h.length==0){h=f.create("label","error").click(function(){f(this).hide().addClass("er-handle")})}h.html(l).css({top:g.top,left:g.left+k+5});if(typeof this.errorPlacement=="function"){this.errorPlacement(h,j.addClass("error"))}h.show()}}}},new e());Jalor.Validator=f.validator={create:function(h){var g;if(h&&h.type=="form"){g=new Jalor.FormValidator(h)}else{g=new Jalor.DataValidator(h)}return g},addRule:function(j,g,h){a[j]=g;if(h){d[j]=h}var k={};k[j]=true;Jalor.UI.Config.typeRule[j]=k},addClassRules:function(g,h){Jalor.UI.Config.typeRule[g]=h},removeRule:function(j,g,h){a[j]=null;d[j]=null;Jalor.UI.Config.typeRule[j]=null},addMethod:function(){if(typeof arguments[1]=="function"){arguments[1].type="old-version";if(arguments[3]=="required"){arguments[1].required=true}}this.addRule.apply(this,arguments)},messages:{},format:function(){},valid:function(h,j,g){return c.validValue(h,j,g)}};f.fn.validate=function(h){if(this.is("form")){this.attr("novalidate","novalidate")}if(h){h.type="form"}var g=Jalor.Validator.create(h);this.data("validator",g);if(!this.hasClass("validate-context")){this.addClass("validate-context").delegate(":input:not(.grid-editor)","focusout",function(k){var j=f(this);if(!j.is(":button")){if(j.hasClass("jalor-suggest")||j.hasClass("jalor-user")){setTimeout(function(){j.valid("focusout")},0)}else{j.valid("focusout")}}})}};f.fn.valid=function(n){if(f(this).data("INPUTING")){return}var j,k=[],h=true,g="unit";if(this.hasClass("validate-context")){j=this.data("validator");k=this.find(":input");g="container";f(this).triggerHandler("invalid-form",[this]);j.valided=true}else{if((k=this.filter(":input")).length>0){j=this.parents(".validate-context").data("validator")}}var l=null;if(j){j.focusoutValid=n=="focusout"?true:false;j.checkType=g;f.each(k,function(){var o=f(this);if(!o.is(":visible")&&o.parents(".jalor-hideValid").length==0){return}if(j.check(o)!==true){h=false;!l&&(l=o)}})}this.is("form")&&l&&l.focus();return h};f.fn.clearValid=function(){this.removeClass("error error-ctr").next("label.error").hide()};var a={required:function(g){return !Jalor.DataHelper.isEmpty(g)},regular:function(h,g){return g.test(h)},minlength:function(g,h){return g.getLength()>=h},maxlength:function(g,h){return g.getLength()<=h},rangelength:function(h,j){var g=h.getLength();return(g>=j[0]&&g<=j[1])},min:function(g,h){return g>=h},max:function(g,h){return g<=h},range:function(g,h){return(g>=h[0]&&g<=h[1])},email:function(g){return(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(g))},url:function(g){return(/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(g))},date:function(h,k,g){if(typeof(h)=="object"&&!isNaN(h)){return true}else{var j=!f.isPlainObject(g)?g.attr("format"):null;j=!j||!Jalor.Config.Format[j]?j:null;return h.validDate(j)}},dateym:function(k,n,h){if(typeof(k)=="object"&&!isNaN(k)){return true}var j=/^(\d{4})(-|\/)(\d{1,2})$/;var l=!f.isPlainObject(h)?h.attr("format"):null;if(j.test(k)){var g=k.match(j);if(g[3]*1<=12){return true}}else{if(l&&l!="date"&&l!="datetime"&&l!="dateym"){return k.validDate(l)}}return false},datetime:function(h,k,g){if(typeof(h)=="object"&&!isNaN(h)){return true}else{var j=!f.isPlainObject(g)?g.attr("format"):null;j=!j||!Jalor.Config.Format[j]?j:null;return h.validDate(j,1)}},number:function(g){return(/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/.test(g))},digits:function(g){return(/^\d+$/.test(g))},accept:function(g,h){h=typeof h=="string"?h.replace(/,/g,"|"):"png|jpe?g|gif";return new RegExp(".("+h+")$").test(g)},equalTo:function(h,g){return h==g},speczh:function(g){return !(new RegExp("[<>?!@#$%\\\\\\/]+").test(g))},specialch:function(g){return new RegExp("^[a-zA-Z0-9_.-]+$").test(g)},specialch2:function(g){return new RegExp("^[a-zA-Z0-9_-]+$").test(g)},filesize:function(l,n){var k=n[0],h=n[1],j=n[2];if(/^\d+\.?\d*[BKMGT]?$/i.test(l)){var g=l[l.search(/[BKMGT]/i)]||k;l=Jalor.Format.toFileSize(parseFloat(l),k,g.toUpperCase())||0;return parseFloat(l)<=(max||999999999)&&parseFloat(l)>=(min||0)}else{return false}},userAccount:function(g){return new RegExp("^[a-zA-Z][a-zA-Z0-9]{2}[0-9]{6}$").test(g)},remote:function(g,h){}};var d={required:$i18n("jalor.common.validate.required"),remote:$i18n("jalor.common.validate.remote"),email:$i18n("jalor.common.validate.email"),url:$i18n("jalor.common.validate.url"),number:$i18n("jalor.common.validate.number"),digits:$i18n("jalor.common.validate.digits"),equalTo:$i18n("jalor.common.validate.equalto"),accept:$i18n("jalor.common.validate.accept"),maxlength:function(g){return $i18n("jalor.common.validate.maxlength").replace("{-1}",Math.floor(g/3))},minlength:$i18n("jalor.common.validate.minlength"),rangelength:$i18n("jalor.common.validate.rangelength"),range:$i18n("jalor.common.validate.range"),max:$i18n("jalor.common.validate.max"),min:$i18n("jalor.common.validate.min"),dateCompare:$i18n("jalor.common.validate.dateCompare"),dateCompareB:$i18n("jalor.common.validate.dateCompareB"),date:$i18n("jalor.common.validate.date").formatText(new Date().format(Jalor.Config.Format.date)),datetime:$i18n("jalor.common.validate.datetime").formatText(new Date().format(Jalor.Config.Format.datehm)),dateym:$i18n("jalor.common.validate.dateym").formatText(new Date().format(Jalor.Config.Format.dateym)),dateISO:$i18n("jalor.common.validate.datetime").formatText(new Date().format(Jalor.Config.Format.datetime)),speczh:$i18n("jalor.common.validate.speczh"),specialch:$i18n("jalor.common.validate.specialcharacter"),specialch2:$i18n("jalor.common.validate.specialcharacter2"),userAccount:$i18n("jalor.common.validate.userAccount"),filesize:$i18n("jalor.common.validate.filesize"),sameValue:$i18n("jalor.common.validate.sameValue"),"jalor-user":function(h,g){return $i18n("jalor.common.validate.jalorUser").format(f(g).attr("error_msg")||"")},"jalor-suggest":function(h,g){return $i18n("jalor.common.validate.jalorSuggest").format(f(g).attr("error_msg")||"")},"max-gap":function(h,g){return $i18n("jalor.common.validate.dateInterval").formatText(f(g).attr("maxGap")||"")},"jalor-combobox":$i18n("jalor.common.validate.combobox")}})(jQuery);var IData={res:"servlet/idataProxy/params/",Template:function(){var b=$.makeArray(arguments).join("");function a(g){var e=[];var c=g.split("<%");for(var f=0;f<c.length;f++){var d=c[f].split("%>");if(d[1]){d[1]=d[1].replace(/\\/g,"\\\\").replace(/'/g,"\\'")}else{d[0]=d[0].replace(/\\/g,"\\\\").replace(/\'/g,"\\'")}e.push(d.join("%>"))}return e.join("<%")}this.template=new Function("obj","var p=[];with(obj){p.push('"+a(b).replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");this.apply=function(c){if(typeof c=="string"){return c}return this.template(c)}},Util:{cookieNames:["cs_app_id","cs_client"],cookeValues:["cs_js",location.href.split("#!")[0]],setRequestHeader:function(a){if(a&&a.setRequestHeader){a.setRequestHeader("appURL",location.href.split("#!")[0]);a.setRequestHeader("client","cs_js1.3.2010.01.28");a.setRequestHeader("appID","cs_js")}this.setCooike()},getRes:function(a){a=a.replace("ws/","ws/soaservices/").replace("wsres/","wsres/soaservices/");return IData.res+a},getLanguage:function(){return Jalor.Local.getCurrLanguage()=="zh_CN"?"CHN":"ENG"},getSOAP:function(a,f){var b='<?xml version="1.0" encoding="UTF-8"?><SOAP-ENV:Envelope xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema">';var c="<SOAP-ENV:Body>";var e=b+c;var d="</SOAP-ENV:Body></SOAP-ENV:Envelope>";return b+f+c+a+d},setCooike:function(){var b=this.cookieNames;var a=this.cookeValues;$.each(b,function(c,d){$.cookie(d,a[c]||null,{domain:"huawei.com",path:"/"})})},clearCookie:function(){this.setCooike(this.cookieNames,[])},getEmployeeNo:function(c){var d=c;if(d.indexOf(" ")>0){d=d.substr(d.lastIndexOf(" ")+1,d.length-d.lastIndexOf(" "))}else{var b=d.substr(0,1);var a=d.substr(1,1);if((b>"9"||b<"0")&&(a<="9"&&a>="0")){d=d.substr(1,d.length-1)}}return d}},Cache:{_cacheMap:{},get:function(a){return this._cacheMap[a]},put:function(a,b){this._cacheMap[a]=b},clear:function(){this._cacheMap={}},remove:function(a){try{delete this._cacheMap[a]}catch(b){}}},_defaultAjax:{cache:true,type:"GET",dataType:"jsonp",jsonp:"jsonp",beforeSend:function(a){IData.Util.setRequestHeader(a)},success:function(a){this.userSuccess&&this.userSuccess(a)},error:function(a,d,b){var c=Jalor.DataHelper.toJson(a.responseText);if(c&&c.message){Jalor.Log.error(a.status+" "+b+":"+c.message)}else{Jalor.Log.error(a.status+" "+d+" "+b)}}},_soapAjax:{},ajax:function(a,d,h,g,c){if(g&&IData.Cache.get(g)){return h(IData.Cache.get(g))}a=a.replace("ws/","ws/soaservices/").replace("wsres/","wsres/soaservices/");var b=$.extend(true,{},this._defaultAjax,d);b.userSuccess=function(e){if(g&&!e.errorInfo){IData.Cache.put(g,e)}h&&h(e)};try{$.ajax(this.res+a,b)}catch(f){f&&f.message&&Jalor.Core.log("idata ajax exception :"+f.message)}},HRDeptList:{url:"ws/HRDeptListServlet",get:function(a,b){IData.ajax(this.url,{data:a},b,"HRDeptList_"+$.param(a))}},HRDeptSuggest:{url:"wsres/dept/list",get:function(a,c){var b={searchValue:a,lang:IData.Util.getLanguage(),searchType:3,_type:"json",depttype:"full"};IData.ajax(this.url,{data:b},c,"HRDeptSuggest_"+$.param(b))}},HRDeptInfo:{url:"ws/HRDepartmentServlet",get:function(a,b){IData.ajax(this.url,{async:false,data:a},b,"HRDeptInfo_"+$.param(a))},getName:function(b,c){var a=[];this.get(b,function(e){for(var f=0;f<=10;f++){var d=e["l"+f+"_Name"];if(d){a.push(d)}}c(a.join("\\"))})}},HRDeptRegion2:{url:"servlet/deptregion",get:function(a,b){Jalor.doGet(this.url,a,b)}},HRApprover:{url:"ws/HRApproverServlet",get:function(a,b){IData.ajax(this.url,{data:a},b,"HRApprover_"+$.param(a))}},SSEApprover:{url:"ws/SseApproverServlet",get:function(a,b){IData.ajax(this.url,{data:a},b,"SSEApprover_"+$.param(a))}},Area:{url:"ws/AreaServlet",get:function(a,b){IData.ajax(this.url,{data:a},b,"Area_"+$.param(a))},getByDept:function(c,b,e){var a="dept_code";if(typeof c=="object"){a=c.valueField;c=c.code}var d={area_label:b};d[a]=c;this.get(d,e,"area"+b+c)},getByParent:function(a,d,c){var b=typeof d=="undefined"?{area_label:a}:{area_label:a,parent:d};this.get(b,c,"area"+a+d)}},Country:{url:"ws/CountryServlet",get:function(a,b){IData.ajax(this.url,{data:a},b,"Country_"+$.param(a))},getByCode:function(a,b){this.get({territory_code:a,language:"US"})}},Currency:{url:"ws/CurrencyServlet",get:function(a,b){IData.ajax(this.url,{data:a},b,"Currency_"+$.param(a))}},Company:{url:"ws/CompanyServlet",get:function(a,b){IData.ajax(this.url,{data:a},b,"Company_"+$.param(a))}},Customer:{url:"ws/CustomerServlet",get:function(a,b){IData.ajax(this.url,{data:a},b,"Customer_"+$.param(a))}},NotesGroup:{url:"ws/NGListServlet",get:function(a,b){IData.ajax(this.url,{data:a},b,"NotesGroup_"+$.param(a))}},LDAP:{url:"ws/IdServlet",get:function(a,b){IData.ajax(this.url,{data:a},b,"LDAP_"+$.param(a))}},HRBINew:{url:"ws/PersonServlet",get:function(a,b){if(workspaceVO.network==="internet"){Jalor.doPost("services/jalor/security/user/single/account",{userAccount:a.userAccount},b);return}delete a.userAccount;IData.ajax(this.url,{data:a},b,"HRBINew_"+$.param(a))},getByAccount:function(a,d){var b=IData.Util.getEmployeeNo(a);var c=IData.Util.getLanguage();this.get({empNo:b,lang:c,userAccount:a},function(e){d(e)})},getDeptName:function(a,b){this.getByAccount(a,function(e){var d=[];for(var f=0;f<7;f++){var c=e["l"+f+"_Name"];if(c){d.push(c)}}b(d.join("\\"))})}},Customer:{url:"ws/CustomerServlet",get:function(a,b){IData.ajax(this.url,{data:a},b,"Customer_"+$.param(a))}},Location:{url:"ws/LocationServlet",get:function(a,b){IData.ajax(this.url,{data:a},b,"Location_"+$.param(a))}}};(function(p){var G,H,I,J,K,L,r={},u={},v={},M={treeId:"",treeObj:null,view:{addDiyDom:null,autoCancelSelected:!0,dblClickExpand:!0,expandSpeed:"fast",fontCss:{},nameIsHTML:!1,selectedMulti:!0,showIcon:!0,showLine:!0,showTitle:!0,txtSelectedEnable:!1},data:{key:{children:"children",name:"name",title:"",url:"url"},simpleData:{enable:!1,idKey:"id",pIdKey:"pId",rootPId:null},keep:{parent:!1,leaf:!1}},async:{enable:!1,contentType:"application/x-www-form-urlencoded",type:"post",dataType:"text",url:"",autoParam:[],otherParam:[],dataFilter:null},callback:{beforeAsync:null,beforeClick:null,beforeDblClick:null,beforeRightClick:null,beforeMouseDown:null,beforeMouseUp:null,beforeExpand:null,beforeCollapse:null,beforeRemove:null,onAsyncError:null,onAsyncSuccess:null,onNodeCreated:null,onClick:null,onDblClick:null,onRightClick:null,onMouseDown:null,onMouseUp:null,onExpand:null,onCollapse:null,onRemove:null}},w=[function(b){var a=b.treeObj,c=e.event;a.bind(c.NODECREATED,function(a,c,g){j.apply(b.callback.onNodeCreated,[a,c,g])});a.bind(c.CLICK,function(a,c,g,l,h){j.apply(b.callback.onClick,[c,g,l,h])});a.bind(c.EXPAND,function(a,c,g){j.apply(b.callback.onExpand,[a,c,g])});a.bind(c.COLLAPSE,function(a,c,g){j.apply(b.callback.onCollapse,[a,c,g])});a.bind(c.ASYNC_SUCCESS,function(a,c,g,l){j.apply(b.callback.onAsyncSuccess,[a,c,g,l])});a.bind(c.ASYNC_ERROR,function(a,c,g,l,h,e){j.apply(b.callback.onAsyncError,[a,c,g,l,h,e])})}],x=[function(b){var a=e.event;b.treeObj.unbind(a.NODECREATED).unbind(a.CLICK).unbind(a.EXPAND).unbind(a.COLLAPSE).unbind(a.ASYNC_SUCCESS).unbind(a.ASYNC_ERROR)}],y=[function(b){var a=h.getCache(b);a||(a={},h.setCache(b,a));a.nodes=[];a.doms=[]}],z=[function(b,a,c,d,f,g){if(c){var l=h.getRoot(b),e=b.data.key.children;c.level=a;c.tId=b.treeId+"_"+ ++l.zId;c.parentTId=d?d.tId:null;c.open=typeof c.open=="string"?j.eqs(c.open,"true"):!!c.open;c[e]&&c[e].length>0?(c.isParent=!0,c.zAsync=!0):(c.isParent=typeof c.isParent=="string"?j.eqs(c.isParent,"true"):!!c.isParent,c.open=c.isParent&&!b.async.enable?c.open:!1,c.zAsync=!c.isParent);c.isFirstNode=f;c.isLastNode=g;c.getParentNode=function(){return h.getNodeCache(b,c.parentTId)};c.getPreNode=function(){return h.getPreNode(b,c)};c.getNextNode=function(){return h.getNextNode(b,c)};c.isAjaxing=!1;h.fixPIdKeyValue(b,c)}}],s=[function(b){var a=b.target,c=h.getSetting(b.data.treeId),d="",f=null,g="",l="",i=null,n=null,k=null;if(j.eqs(b.type,"mousedown")){l="mousedown"}else{if(j.eqs(b.type,"mouseup")){l="mouseup"}else{if(j.eqs(b.type,"contextmenu")){l="contextmenu"}else{if(j.eqs(b.type,"click")){if(j.eqs(a.tagName,"span")&&a.getAttribute("treeNode"+e.id.SWITCH)!==null){d=j.getNodeMainDom(a).id,g="switchNode"}else{if(k=j.getMDom(c,a,[{tagName:"a",attrName:"treeNode"+e.id.A}])){d=j.getNodeMainDom(k).id,g="clickNode"}}}else{if(j.eqs(b.type,"dblclick")&&(l="dblclick",k=j.getMDom(c,a,[{tagName:"a",attrName:"treeNode"+e.id.A}]))){d=j.getNodeMainDom(k).id,g="switchNode"}}}}}if(l.length>0&&d.length==0&&(k=j.getMDom(c,a,[{tagName:"a",attrName:"treeNode"+e.id.A}]))){d=j.getNodeMainDom(k).id}if(d.length>0){switch(f=h.getNodeCache(c,d),g){case"switchNode":f.isParent?j.eqs(b.type,"click")||j.eqs(b.type,"dblclick")&&j.apply(c.view.dblClickExpand,[c.treeId,f],c.view.dblClickExpand)?i=G:g="":g="";break;case"clickNode":i=H}}switch(l){case"mousedown":n=I;break;case"mouseup":n=J;break;case"dblclick":n=K;break;case"contextmenu":n=L}return{stop:!1,node:f,nodeEventType:g,nodeEventCallback:i,treeEventType:l,treeEventCallback:n}}],A=[function(b){var a=h.getRoot(b);a||(a={},h.setRoot(b,a));a[b.data.key.children]=[];a.expandTriggerFlag=!1;a.curSelectedList=[];a.noSelection=!0;a.createdNodes=[];a.zId=0;a._ver=(new Date).getTime()}],B=[],C=[],D=[],E=[],F=[],h={addNodeCache:function(b,a){h.getCache(b).nodes[h.getNodeCacheId(a.tId)]=a},getNodeCacheId:function(b){return b.substring(b.lastIndexOf("_")+1)},addAfterA:function(b){C.push(b)},addBeforeA:function(b){B.push(b)},addInnerAfterA:function(b){E.push(b)},addInnerBeforeA:function(b){D.push(b)},addInitBind:function(b){w.push(b)},addInitUnBind:function(b){x.push(b)},addInitCache:function(b){y.push(b)},addInitNode:function(b){z.push(b)},addInitProxy:function(b,a){a?s.splice(0,0,b):s.push(b)},addInitRoot:function(b){A.push(b)},addNodesData:function(b,a,c){var d=b.data.key.children;a[d]||(a[d]=[]);if(a[d].length>0){a[d][a[d].length-1].isLastNode=!1,i.setNodeLineIcos(b,a[d][a[d].length-1])}a.isParent=!0;a[d]=a[d].concat(c)},addSelectedNode:function(b,a){var c=h.getRoot(b);h.isSelectedNode(b,a)||c.curSelectedList.push(a)},addCreatedNode:function(b,a){(b.callback.onNodeCreated||b.view.addDiyDom)&&h.getRoot(b).createdNodes.push(a)},addZTreeTools:function(b){F.push(b)},exSetting:function(b){p.extend(!0,M,b)},fixPIdKeyValue:function(b,a){b.data.simpleData.enable&&(a[b.data.simpleData.pIdKey]=a.parentTId?a.getParentNode()[b.data.simpleData.idKey]:b.data.simpleData.rootPId)},getAfterA:function(b,a,c){for(var d=0,f=C.length;d<f;d++){C[d].apply(this,arguments)}},getBeforeA:function(b,a,c){for(var d=0,f=B.length;d<f;d++){B[d].apply(this,arguments)}},getInnerAfterA:function(b,a,c){for(var d=0,f=E.length;d<f;d++){E[d].apply(this,arguments)}},getInnerBeforeA:function(b,a,c){for(var d=0,f=D.length;d<f;d++){D[d].apply(this,arguments)}},getCache:function(b){return v[b.treeId]},getNextNode:function(b,a){if(!a){return null}for(var c=b.data.key.children,d=a.parentTId?a.getParentNode():h.getRoot(b),f=0,g=d[c].length-1;f<=g;f++){if(d[c][f]===a){return f==g?null:d[c][f+1]}}return null},getNodeByParam:function(b,a,c,d){if(!a||!c){return null}for(var f=b.data.key.children,g=0,l=a.length;g<l;g++){if(a[g][c]==d){return a[g]}var e=h.getNodeByParam(b,a[g][f],c,d);if(e){return e}}return null},getNodeCache:function(b,a){if(!a){return null}var c=v[b.treeId].nodes[h.getNodeCacheId(a)];return c?c:null},getNodeName:function(b,a){return""+a[b.data.key.name]},getNodeTitle:function(b,a){return""+a[b.data.key.title===""?b.data.key.name:b.data.key.title]},getNodes:function(b){return h.getRoot(b)[b.data.key.children]},getNodesByParam:function(b,a,c,d){if(!a||!c){return[]}for(var f=b.data.key.children,g=[],l=0,e=a.length;l<e;l++){a[l][c]==d&&g.push(a[l]),g=g.concat(h.getNodesByParam(b,a[l][f],c,d))}return g},getNodesByParamFuzzy:function(b,a,c,d){if(!a||!c){return[]}for(var f=b.data.key.children,g=[],d=d.toLowerCase(),l=0,e=a.length;l<e;l++){typeof a[l][c]=="string"&&a[l][c].toLowerCase().indexOf(d)>-1&&g.push(a[l]),g=g.concat(h.getNodesByParamFuzzy(b,a[l][f],c,d))}return g},getNodesByFilter:function(b,a,c,d,f){if(!a){return d?null:[]}for(var g=b.data.key.children,e=d?null:[],i=0,n=a.length;i<n;i++){if(j.apply(c,[a[i],f],!1)){if(d){return a[i]}e.push(a[i])}var k=h.getNodesByFilter(b,a[i][g],c,d,f);if(d&&k){return k}e=d?k:e.concat(k)}return e},getPreNode:function(b,a){if(!a){return null}for(var c=b.data.key.children,d=a.parentTId?a.getParentNode():h.getRoot(b),f=0,g=d[c].length;f<g;f++){if(d[c][f]===a){return f==0?null:d[c][f-1]}}return null},getRoot:function(b){return b?u[b.treeId]:null},getRoots:function(){return u},getSetting:function(b){return r[b]},getSettings:function(){return r},getZTreeTools:function(b){return(b=this.getRoot(this.getSetting(b)))?b.treeTools:null},initCache:function(b){for(var a=0,c=y.length;a<c;a++){y[a].apply(this,arguments)}},initNode:function(b,a,c,d,f,g){for(var e=0,h=z.length;e<h;e++){z[e].apply(this,arguments)}},initRoot:function(b){for(var a=0,c=A.length;a<c;a++){A[a].apply(this,arguments)}},isSelectedNode:function(b,a){for(var c=h.getRoot(b),d=0,f=c.curSelectedList.length;d<f;d++){if(a===c.curSelectedList[d]){return !0}}return !1},removeNodeCache:function(b,a){var c=b.data.key.children;if(a[c]){for(var d=0,f=a[c].length;d<f;d++){arguments.callee(b,a[c][d])}}h.getCache(b).nodes[h.getNodeCacheId(a.tId)]=null},removeSelectedNode:function(b,a){for(var c=h.getRoot(b),d=0,f=c.curSelectedList.length;d<f;d++){if(a===c.curSelectedList[d]||!h.getNodeCache(b,c.curSelectedList[d].tId)){c.curSelectedList.splice(d,1),d--,f--}}},setCache:function(b,a){v[b.treeId]=a},setRoot:function(b,a){u[b.treeId]=a},setZTreeTools:function(b,a){for(var c=0,d=F.length;c<d;c++){F[c].apply(this,arguments)}},transformToArrayFormat:function(b,a){if(!a){return[]}var c=b.data.key.children,d=[];if(j.isArray(a)){for(var f=0,g=a.length;f<g;f++){d.push(a[f]),a[f][c]&&(d=d.concat(h.transformToArrayFormat(b,a[f][c])))}}else{d.push(a),a[c]&&(d=d.concat(h.transformToArrayFormat(b,a[c])))}return d},transformTozTreeFormat:function(b,a){var c,d,f=b.data.simpleData.idKey,g=b.data.simpleData.pIdKey,e=b.data.key.children;if(!f||f==""||!a){return[]}if(j.isArray(a)){var h=[],i=[];for(c=0,d=a.length;c<d;c++){i[a[c][f]]=a[c]}for(c=0,d=a.length;c<d;c++){i[a[c][g]]&&a[c][f]!=a[c][g]?(i[a[c][g]][e]||(i[a[c][g]][e]=[]),i[a[c][g]][e].push(a[c])):h.push(a[c])}return h}else{return[a]}}},m={bindEvent:function(b){for(var a=0,c=w.length;a<c;a++){w[a].apply(this,arguments)}},unbindEvent:function(b){for(var a=0,c=x.length;a<c;a++){x[a].apply(this,arguments)}},bindTree:function(b){var a={treeId:b.treeId},c=b.treeObj;b.view.txtSelectedEnable||c.bind("selectstart",function(a){a=a.originalEvent.srcElement.nodeName.toLowerCase();return a==="input"||a==="textarea"}).css({"-moz-user-select":"-moz-none"});c.bind("click",a,m.proxy);c.bind("dblclick",a,m.proxy);c.bind("mouseover",a,m.proxy);c.bind("mouseout",a,m.proxy);c.bind("mousedown",a,m.proxy);c.bind("mouseup",a,m.proxy);c.bind("contextmenu",a,m.proxy)},unbindTree:function(b){b.treeObj.unbind("click",m.proxy).unbind("dblclick",m.proxy).unbind("mouseover",m.proxy).unbind("mouseout",m.proxy).unbind("mousedown",m.proxy).unbind("mouseup",m.proxy).unbind("contextmenu",m.proxy)},doProxy:function(b){for(var a=[],c=0,d=s.length;c<d;c++){var f=s[c].apply(this,arguments);a.push(f);if(f.stop){break}}return a},proxy:function(b){var a=h.getSetting(b.data.treeId);if(!j.uCanDo(a,b)){return !0}for(var a=m.doProxy(b),c=!0,d=0,f=a.length;d<f;d++){var g=a[d];g.nodeEventCallback&&(c=g.nodeEventCallback.apply(g,[b,g.node])&&c);g.treeEventCallback&&(c=g.treeEventCallback.apply(g,[b,g.node])&&c)}return c}};G=function(b,a){var c=h.getSetting(b.data.treeId);if(a.open){if(j.apply(c.callback.beforeCollapse,[c.treeId,a],!0)==!1){return !0}}else{if(j.apply(c.callback.beforeExpand,[c.treeId,a],!0)==!1){return !0}}h.getRoot(c).expandTriggerFlag=!0;i.switchNode(c,a);return !0};H=function(b,a){var c=h.getSetting(b.data.treeId),d=c.view.autoCancelSelected&&b.ctrlKey&&h.isSelectedNode(c,a)?0:c.view.autoCancelSelected&&b.ctrlKey&&c.view.selectedMulti?2:1;if(j.apply(c.callback.beforeClick,[c.treeId,a,d],!0)==!1){return !0}d===0?i.cancelPreSelectedNode(c,a):i.selectNode(c,a,d===2);c.treeObj.trigger(e.event.CLICK,[b,c.treeId,a,d]);return !0};I=function(b,a){var c=h.getSetting(b.data.treeId);j.apply(c.callback.beforeMouseDown,[c.treeId,a],!0)&&j.apply(c.callback.onMouseDown,[b,c.treeId,a]);return !0};J=function(b,a){var c=h.getSetting(b.data.treeId);j.apply(c.callback.beforeMouseUp,[c.treeId,a],!0)&&j.apply(c.callback.onMouseUp,[b,c.treeId,a]);return !0};K=function(b,a){var c=h.getSetting(b.data.treeId);j.apply(c.callback.beforeDblClick,[c.treeId,a],!0)&&j.apply(c.callback.onDblClick,[b,c.treeId,a]);return !0};L=function(b,a){var c=h.getSetting(b.data.treeId);j.apply(c.callback.beforeRightClick,[c.treeId,a],!0)&&j.apply(c.callback.onRightClick,[b,c.treeId,a]);return typeof c.callback.onRightClick!="function"};var j={apply:function(b,a,c){return typeof b=="function"?b.apply(N,a?a:[]):c},canAsync:function(b,a){var c=b.data.key.children;return b.async.enable&&a&&a.isParent&&!(a.zAsync||a[c]&&a[c].length>0)},clone:function(b){if(b===null){return null}var a=j.isArray(b)?[]:{},c;for(c in b){a[c]=b[c] instanceof Date?new Date(b[c].getTime()):typeof b[c]==="object"?arguments.callee(b[c]):b[c]}return a},eqs:function(b,a){return b.toLowerCase()===a.toLowerCase()},isArray:function(b){return Object.prototype.toString.apply(b)==="[object Array]"},$:function(b,a,c){a&&typeof a!="string"&&(c=a,a="");return typeof b=="string"?p(b,c?c.treeObj.get(0).ownerDocument:null):p("#"+b.tId+a,c?c.treeObj:null)},getMDom:function(b,a,c){if(!a){return null}for(;a&&a.id!==b.treeId;){for(var d=0,f=c.length;a.tagName&&d<f;d++){if(j.eqs(a.tagName,c[d].tagName)&&a.getAttribute(c[d].attrName)!==null){return a}}a=a.parentNode}return null},getNodeMainDom:function(b){return p(b).parent("li").get(0)||p(b).parentsUntil("li").parent().get(0)},isChildOrSelf:function(b,a){return p(b).closest("#"+a).length>0},uCanDo:function(){return !0}},i={addNodes:function(b,a,c,d){if(!b.data.keep.leaf||!a||a.isParent){if(j.isArray(c)||(c=[c]),b.data.simpleData.enable&&(c=h.transformTozTreeFormat(b,c)),a){var f=k(a,e.id.SWITCH,b),g=k(a,e.id.ICON,b),l=k(a,e.id.UL,b);if(!a.open){i.replaceSwitchClass(a,f,e.folder.CLOSE),i.replaceIcoClass(a,g,e.folder.CLOSE),a.open=!1,l.css({display:"none"})}h.addNodesData(b,a,c);i.createNodes(b,a.level+1,c,a);d||i.expandCollapseParentNode(b,a,!0)}else{h.addNodesData(b,h.getRoot(b),c),i.createNodes(b,0,c,null)}}},appendNodes:function(b,a,c,d,f,g){if(!c){return[]}for(var e=[],j=b.data.key.children,k=0,m=c.length;k<m;k++){var o=c[k];if(f){var t=(d?d:h.getRoot(b))[j].length==c.length&&k==0;h.initNode(b,a,o,d,t,k==c.length-1,g);h.addNodeCache(b,o)}t=[];o[j]&&o[j].length>0&&(t=i.appendNodes(b,a+1,o[j],o,f,g&&o.open));g&&(i.makeDOMNodeMainBefore(e,b,o),i.makeDOMNodeLine(e,b,o),h.getBeforeA(b,o,e),i.makeDOMNodeNameBefore(e,b,o),h.getInnerBeforeA(b,o,e),i.makeDOMNodeIcon(e,b,o),h.getInnerAfterA(b,o,e),i.makeDOMNodeNameAfter(e,b,o),h.getAfterA(b,o,e),o.isParent&&o.open&&i.makeUlHtml(b,o,e,t.join("")),i.makeDOMNodeMainAfter(e,b,o),h.addCreatedNode(b,o))}return e},appendParentULDom:function(b,a){var c=[],d=k(a,b);!d.get(0)&&a.parentTId&&(i.appendParentULDom(b,a.getParentNode()),d=k(a,b));var f=k(a,e.id.UL,b);f.get(0)&&f.remove();f=i.appendNodes(b,a.level+1,a[b.data.key.children],a,!1,!0);i.makeUlHtml(b,a,c,f.join(""));d.append(c.join(""))},asyncNode:function(b,a,c,d){var f,g;if(a&&!a.isParent){return j.apply(d),!1}else{if(a&&a.isAjaxing){return !1}else{if(j.apply(b.callback.beforeAsync,[b.treeId,a],!0)==!1){return j.apply(d),!1}}}if(a){a.isAjaxing=!0,k(a,e.id.ICON,b).attr({style:"","class":e.className.BUTTON+" "+e.className.ICO_LOADING})}var l={};for(f=0,g=b.async.autoParam.length;a&&f<g;f++){var q=b.async.autoParam[f].split("="),n=q;q.length>1&&(n=q[1],q=q[0]);l[n]=a[q]}if(j.isArray(b.async.otherParam)){for(f=0,g=b.async.otherParam.length;f<g;f+=2){l[b.async.otherParam[f]]=b.async.otherParam[f+1]}}else{for(var m in b.async.otherParam){l[m]=b.async.otherParam[m]}}var o=h.getRoot(b)._ver;p.ajax({contentType:b.async.contentType,type:b.async.type,url:j.apply(b.async.url,[b.treeId,a],b.async.url),data:l,dataType:b.async.dataType,success:function(f){if(o==h.getRoot(b)._ver){var g=[];try{g=!f||f.length==0?[]:typeof f=="string"?eval("("+f+")"):f}catch(l){g=f}if(a){a.isAjaxing=null,a.zAsync=!0}i.setNodeLineIcos(b,a);g&&g!==""?(g=j.apply(b.async.dataFilter,[b.treeId,a,g],g),i.addNodes(b,a,g?j.clone(g):[],!!c)):i.addNodes(b,a,[],!!c);b.treeObj.trigger(e.event.ASYNC_SUCCESS,[b.treeId,a,f]);j.apply(d)}},error:function(c,d,f){if(o==h.getRoot(b)._ver){if(a){a.isAjaxing=null}i.setNodeLineIcos(b,a);b.treeObj.trigger(e.event.ASYNC_ERROR,[b.treeId,a,c,d,f])}}});return !0},cancelPreSelectedNode:function(b,a){for(var c=h.getRoot(b).curSelectedList,d=c.length-1;d>=0;d--){if(!a||a===c[d]){if(k(c[d],e.id.A,b).removeClass(e.node.CURSELECTED),a){h.removeSelectedNode(b,a);break}}}if(!a){h.getRoot(b).curSelectedList=[]}},createNodeCallback:function(b){if(b.callback.onNodeCreated||b.view.addDiyDom){for(var a=h.getRoot(b);a.createdNodes.length>0;){var c=a.createdNodes.shift();j.apply(b.view.addDiyDom,[b.treeId,c]);b.callback.onNodeCreated&&b.treeObj.trigger(e.event.NODECREATED,[b.treeId,c])}}},createNodes:function(b,a,c,d){if(c&&c.length!=0){var f=h.getRoot(b),g=b.data.key.children,g=!d||d.open||!!k(d[g][0],b).get(0);f.createdNodes=[];a=i.appendNodes(b,a,c,d,!0,g);d?(d=k(d,e.id.UL,b),d.get(0)&&d.append(a.join(""))):b.treeObj.append(a.join(""));i.createNodeCallback(b)}},destroy:function(b){b&&(h.initCache(b),h.initRoot(b),m.unbindTree(b),m.unbindEvent(b),b.treeObj.empty())},expandCollapseNode:function(b,a,c,d,f){var g=h.getRoot(b),l=b.data.key.children;if(a){if(g.expandTriggerFlag){var q=f,f=function(){q&&q();a.open?b.treeObj.trigger(e.event.EXPAND,[b.treeId,a]):b.treeObj.trigger(e.event.COLLAPSE,[b.treeId,a])};g.expandTriggerFlag=!1}if(!a.open&&a.isParent&&(!k(a,e.id.UL,b).get(0)||a[l]&&a[l].length>0&&!k(a[l][0],b).get(0))){i.appendParentULDom(b,a),i.createNodeCallback(b)}if(a.open==c){j.apply(f,[])}else{var c=k(a,e.id.UL,b),g=k(a,e.id.SWITCH,b),n=k(a,e.id.ICON,b);a.isParent?(a.open=!a.open,a.iconOpen&&a.iconClose&&n.attr("style",i.makeNodeIcoStyle(b,a)),a.open?(i.replaceSwitchClass(a,g,e.folder.OPEN),i.replaceIcoClass(a,n,e.folder.OPEN),d==!1||b.view.expandSpeed==""?(c.show(),j.apply(f,[])):a[l]&&a[l].length>0?c.slideDown(b.view.expandSpeed,f):(c.show(),j.apply(f,[]))):(i.replaceSwitchClass(a,g,e.folder.CLOSE),i.replaceIcoClass(a,n,e.folder.CLOSE),d==!1||b.view.expandSpeed==""||!(a[l]&&a[l].length>0)?(c.hide(),j.apply(f,[])):c.slideUp(b.view.expandSpeed,f))):j.apply(f,[])}}else{j.apply(f,[])}},expandCollapseParentNode:function(b,a,c,d,f){a&&(a.parentTId?(i.expandCollapseNode(b,a,c,d),a.parentTId&&i.expandCollapseParentNode(b,a.getParentNode(),c,d,f)):i.expandCollapseNode(b,a,c,d,f))},expandCollapseSonNode:function(b,a,c,d,f){var g=h.getRoot(b),e=b.data.key.children,g=a?a[e]:g[e],e=a?!1:d,j=h.getRoot(b).expandTriggerFlag;h.getRoot(b).expandTriggerFlag=!1;if(g){for(var k=0,m=g.length;k<m;k++){g[k]&&i.expandCollapseSonNode(b,g[k],c,e)}}h.getRoot(b).expandTriggerFlag=j;i.expandCollapseNode(b,a,c,d,f)},makeDOMNodeIcon:function(b,a,c){var d=h.getNodeName(a,c),d=a.view.nameIsHTML?d:d.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");b.push("<span id='",c.tId,e.id.ICON,"' title='' treeNode",e.id.ICON," class='",i.makeNodeIcoClass(a,c),"' style='",i.makeNodeIcoStyle(a,c),"'></span><span id='",c.tId,e.id.SPAN,"'>",d,"</span>")},makeDOMNodeLine:function(b,a,c){b.push("<span id='",c.tId,e.id.SWITCH,"' title='' class='",i.makeNodeLineClass(a,c),"' treeNode",e.id.SWITCH,"></span>")},makeDOMNodeMainAfter:function(b){b.push("</li>")},makeDOMNodeMainBefore:function(b,a,c){b.push("<li id='",c.tId,"' class='",e.className.LEVEL,c.level,"' tabindex='0' hidefocus='true' treenode>")},makeDOMNodeNameAfter:function(b){b.push("</a>")},makeDOMNodeNameBefore:function(b,a,c){var d=h.getNodeTitle(a,c),f=i.makeNodeUrl(a,c),g=i.makeNodeFontCss(a,c),l=[],k;for(k in g){l.push(k,":",g[k],";")}b.push("<a id='",c.tId,e.id.A,"' class='",e.className.LEVEL,c.level,"' treeNode",e.id.A,' onclick="',c.click||"",'" ',f!=null&&f.length>0?"href='"+f+"'":""," target='",i.makeNodeTarget(c),"' style='",l.join(""),"'");j.apply(a.view.showTitle,[a.treeId,c],a.view.showTitle)&&d&&b.push("title='",d.replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),"'");b.push(">")},makeNodeFontCss:function(b,a){var c=j.apply(b.view.fontCss,[b.treeId,a],b.view.fontCss);return c&&typeof c!="function"?c:{}},makeNodeIcoClass:function(b,a){var c=["ico"];a.isAjaxing||(c[0]=(a.iconSkin?a.iconSkin+"_":"")+c[0],a.isParent?c.push(a.open?e.folder.OPEN:e.folder.CLOSE):c.push(e.folder.DOCU));return e.className.BUTTON+" "+c.join("_")},makeNodeIcoStyle:function(b,a){var c=[];if(!a.isAjaxing){var d=a.isParent&&a.iconOpen&&a.iconClose?a.open?a.iconOpen:a.iconClose:a.icon;d&&c.push("background:url(",d,") 0 0 no-repeat;");(b.view.showIcon==!1||!j.apply(b.view.showIcon,[b.treeId,a],!0))&&c.push("width:0px;height:0px;")}return c.join("")},makeNodeLineClass:function(b,a){var c=[];b.view.showLine?a.level==0&&a.isFirstNode&&a.isLastNode?c.push(e.line.ROOT):a.level==0&&a.isFirstNode?c.push(e.line.ROOTS):a.isLastNode?c.push(e.line.BOTTOM):c.push(e.line.CENTER):c.push(e.line.NOLINE);a.isParent?c.push(a.open?e.folder.OPEN:e.folder.CLOSE):c.push(e.folder.DOCU);return i.makeNodeLineClassEx(a)+c.join("_")},makeNodeLineClassEx:function(b){return e.className.BUTTON+" "+e.className.LEVEL+b.level+" "+e.className.SWITCH+" "},makeNodeTarget:function(b){return b.target||"_blank"},makeNodeUrl:function(b,a){var c=b.data.key.url;return a[c]?a[c]:null},makeUlHtml:function(b,a,c,d){c.push("<ul id='",a.tId,e.id.UL,"' class='",e.className.LEVEL,a.level," ",i.makeUlLineClass(b,a),"' style='display:",a.open?"block":"none","'>");c.push(d);c.push("</ul>")},makeUlLineClass:function(b,a){return b.view.showLine&&!a.isLastNode?e.line.LINE:""},removeChildNodes:function(b,a){if(a){var c=b.data.key.children,d=a[c];if(d){for(var f=0,g=d.length;f<g;f++){h.removeNodeCache(b,d[f])}h.removeSelectedNode(b);delete a[c];b.data.keep.parent?k(a,e.id.UL,b).empty():(a.isParent=!1,a.open=!1,c=k(a,e.id.SWITCH,b),d=k(a,e.id.ICON,b),i.replaceSwitchClass(a,c,e.folder.DOCU),i.replaceIcoClass(a,d,e.folder.DOCU),k(a,e.id.UL,b).remove())}}},setFirstNode:function(b,a){var c=b.data.key.children;if(a[c].length>0){a[c][0].isFirstNode=!0}},setLastNode:function(b,a){var c=b.data.key.children,d=a[c].length;if(d>0){a[c][d-1].isLastNode=!0}},removeNode:function(b,a){var c=h.getRoot(b),d=b.data.key.children,f=a.parentTId?a.getParentNode():c;a.isFirstNode=!1;a.isLastNode=!1;a.getPreNode=function(){return null};a.getNextNode=function(){return null};if(h.getNodeCache(b,a.tId)){k(a,b).remove();h.removeNodeCache(b,a);h.removeSelectedNode(b,a);for(var g=0,l=f[d].length;g<l;g++){if(f[d][g].tId==a.tId){f[d].splice(g,1);break}}i.setFirstNode(b,f);i.setLastNode(b,f);var j,g=f[d].length;if(!b.data.keep.parent&&g==0){f.isParent=!1,f.open=!1,g=k(f,e.id.UL,b),l=k(f,e.id.SWITCH,b),j=k(f,e.id.ICON,b),i.replaceSwitchClass(f,l,e.folder.DOCU),i.replaceIcoClass(f,j,e.folder.DOCU),g.css("display","none")}else{if(b.view.showLine&&g>0){var n=f[d][g-1],g=k(n,e.id.UL,b),l=k(n,e.id.SWITCH,b);j=k(n,e.id.ICON,b);f==c?f[d].length==1?i.replaceSwitchClass(n,l,e.line.ROOT):(c=k(f[d][0],e.id.SWITCH,b),i.replaceSwitchClass(f[d][0],c,e.line.ROOTS),i.replaceSwitchClass(n,l,e.line.BOTTOM)):i.replaceSwitchClass(n,l,e.line.BOTTOM);g.removeClass(e.line.LINE)}}}},replaceIcoClass:function(b,a,c){if(a&&!b.isAjaxing&&(b=a.attr("class"),b!=void 0)){b=b.split("_");switch(c){case e.folder.OPEN:case e.folder.CLOSE:case e.folder.DOCU:b[b.length-1]=c}a.attr("class",b.join("_"))}},replaceSwitchClass:function(b,a,c){if(a){var d=a.attr("class");if(d!=void 0){d=d.split("_");switch(c){case e.line.ROOT:case e.line.ROOTS:case e.line.CENTER:case e.line.BOTTOM:case e.line.NOLINE:d[0]=i.makeNodeLineClassEx(b)+c;break;case e.folder.OPEN:case e.folder.CLOSE:case e.folder.DOCU:d[1]=c}a.attr("class",d.join("_"));c!==e.folder.DOCU?a.removeAttr("disabled"):a.attr("disabled","disabled")}}},selectNode:function(b,a,c){c||i.cancelPreSelectedNode(b);k(a,e.id.A,b).addClass(e.node.CURSELECTED);h.addSelectedNode(b,a)},setNodeFontCss:function(b,a){var c=k(a,e.id.A,b),d=i.makeNodeFontCss(b,a);d&&c.css(d)},setNodeLineIcos:function(b,a){if(a){var c=k(a,e.id.SWITCH,b),d=k(a,e.id.UL,b),f=k(a,e.id.ICON,b),g=i.makeUlLineClass(b,a);g.length==0?d.removeClass(e.line.LINE):d.addClass(g);c.attr("class",i.makeNodeLineClass(b,a));a.isParent?c.removeAttr("disabled"):c.attr("disabled","disabled");f.removeAttr("style");f.attr("style",i.makeNodeIcoStyle(b,a));f.attr("class",i.makeNodeIcoClass(b,a))}},setNodeName:function(b,a){var c=h.getNodeTitle(b,a),d=k(a,e.id.SPAN,b);d.empty();b.view.nameIsHTML?d.html(h.getNodeName(b,a)):d.text(h.getNodeName(b,a));j.apply(b.view.showTitle,[b.treeId,a],b.view.showTitle)&&k(a,e.id.A,b).attr("title",!c?"":c)},setNodeTarget:function(b,a){k(a,e.id.A,b).attr("target",i.makeNodeTarget(a))},setNodeUrl:function(b,a){var c=k(a,e.id.A,b),d=i.makeNodeUrl(b,a);d==null||d.length==0?c.removeAttr("href"):c.attr("href",d)},switchNode:function(b,a){a.open||!j.canAsync(b,a)?i.expandCollapseNode(b,a,!a.open):b.async.enable?i.asyncNode(b,a)||i.expandCollapseNode(b,a,!a.open):a&&i.expandCollapseNode(b,a,!a.open)}};p.fn.zTree={consts:{className:{BUTTON:"button",LEVEL:"level",ICO_LOADING:"ico_loading",SWITCH:"switch"},event:{NODECREATED:"ztree_nodeCreated",CLICK:"ztree_click",EXPAND:"ztree_expand",COLLAPSE:"ztree_collapse",ASYNC_SUCCESS:"ztree_async_success",ASYNC_ERROR:"ztree_async_error"},id:{A:"_a",ICON:"_ico",SPAN:"_span",SWITCH:"_switch",UL:"_ul"},line:{ROOT:"root",ROOTS:"roots",CENTER:"center",BOTTOM:"bottom",NOLINE:"noline",LINE:"line"},folder:{OPEN:"open",CLOSE:"close",DOCU:"docu"},node:{CURSELECTED:"curSelectedNode"}},_z:{tools:j,view:i,event:m,data:h},getZTreeObj:function(b){return(b=h.getZTreeTools(b))?b:null},destroy:function(b){if(b&&b.length>0){i.destroy(h.getSetting(b))}else{for(var a in r){i.destroy(r[a])}}},init:function(b,a,c){var d=j.clone(M);p.extend(!0,d,a);d.treeId=b.attr("id");d.treeObj=b;d.treeObj.empty();r[d.treeId]=d;if(typeof document.body.style.maxHeight==="undefined"){d.view.expandSpeed=""}h.initRoot(d);b=h.getRoot(d);a=d.data.key.children;c=c?j.clone(j.isArray(c)?c:[c]):[];b[a]=d.data.simpleData.enable?h.transformTozTreeFormat(d,c):c;h.initCache(d);m.unbindTree(d);m.bindTree(d);m.unbindEvent(d);m.bindEvent(d);c={setting:d,addNodes:function(a,b,c){function e(){i.addNodes(d,a,h,c==!0)}if(!b){return null}a||(a=null);if(a&&!a.isParent&&d.data.keep.leaf){return null}var h=j.clone(j.isArray(b)?b:[b]);j.canAsync(d,a)?i.asyncNode(d,a,c,e):e();return h},cancelSelectedNode:function(a){i.cancelPreSelectedNode(d,a)},destroy:function(){i.destroy(d)},expandAll:function(a){a=!!a;i.expandCollapseSonNode(d,null,a,!0);return a},expandNode:function(a,b,c,e,n){if(!a||!a.isParent){return null}b!==!0&&b!==!1&&(b=!a.open);if((n=!!n)&&b&&j.apply(d.callback.beforeExpand,[d.treeId,a],!0)==!1){return null}else{if(n&&!b&&j.apply(d.callback.beforeCollapse,[d.treeId,a],!0)==!1){return null}}b&&a.parentTId&&i.expandCollapseParentNode(d,a.getParentNode(),b,!1);if(b===a.open&&!c){return null}h.getRoot(d).expandTriggerFlag=n;if(!j.canAsync(d,a)&&c){i.expandCollapseSonNode(d,a,b,!0,function(){if(e!==!1){try{k(a,d).focus().blur()}catch(b){}}})}else{if(a.open=!b,i.switchNode(this.setting,a),e!==!1){try{k(a,d).focus().blur()}catch(m){}}}return b},getNodes:function(){return h.getNodes(d)},getNodeByParam:function(a,b,c){return !a?null:h.getNodeByParam(d,c?c[d.data.key.children]:h.getNodes(d),a,b)},getNodeByTId:function(a){return h.getNodeCache(d,a)},getNodesByParam:function(a,b,c){return !a?null:h.getNodesByParam(d,c?c[d.data.key.children]:h.getNodes(d),a,b)},getNodesByParamFuzzy:function(a,b,c){return !a?null:h.getNodesByParamFuzzy(d,c?c[d.data.key.children]:h.getNodes(d),a,b)},getNodesByFilter:function(a,b,c,e){b=!!b;return !a||typeof a!="function"?b?null:[]:h.getNodesByFilter(d,c?c[d.data.key.children]:h.getNodes(d),a,b,e)},getNodeIndex:function(a){if(!a){return null}for(var b=d.data.key.children,c=a.parentTId?a.getParentNode():h.getRoot(d),e=0,i=c[b].length;e<i;e++){if(c[b][e]==a){return e}}return -1},getSelectedNodes:function(){for(var a=[],b=h.getRoot(d).curSelectedList,c=0,e=b.length;c<e;c++){a.push(b[c])}return a},isSelectedNode:function(a){return h.isSelectedNode(d,a)},reAsyncChildNodes:function(a,b,c){if(this.setting.async.enable){var j=!a;j&&(a=h.getRoot(d));if(b=="refresh"){for(var b=this.setting.data.key.children,m=0,p=a[b]?a[b].length:0;m<p;m++){h.removeNodeCache(d,a[b][m])}h.removeSelectedNode(d);a[b]=[];j?this.setting.treeObj.empty():k(a,e.id.UL,d).empty()}i.asyncNode(this.setting,j?null:a,!!c)}},refresh:function(){this.setting.treeObj.empty();var a=h.getRoot(d),b=a[d.data.key.children];h.initRoot(d);a[d.data.key.children]=b;h.initCache(d);i.createNodes(d,0,a[d.data.key.children])},removeChildNodes:function(a){if(!a){return null}var b=a[d.data.key.children];i.removeChildNodes(d,a);return b?b:null},removeNode:function(a,b){a&&(b=!!b,b&&j.apply(d.callback.beforeRemove,[d.treeId,a],!0)==!1||(i.removeNode(d,a),b&&this.setting.treeObj.trigger(e.event.REMOVE,[d.treeId,a])))},selectNode:function(a,b){if(a&&j.uCanDo(d)){b=d.view.selectedMulti&&b;if(a.parentTId){i.expandCollapseParentNode(d,a.getParentNode(),!0,!1,function(){try{k(a,d).focus().blur()}catch(b){}})}else{try{k(a,d).focus().blur()}catch(c){}}i.selectNode(d,a,b)}},transformTozTreeNodes:function(a){return h.transformTozTreeFormat(d,a)},transformToArray:function(a){return h.transformToArrayFormat(d,a)},updateNode:function(a){a&&k(a,d).get(0)&&j.uCanDo(d)&&(i.setNodeName(d,a),i.setNodeTarget(d,a),i.setNodeUrl(d,a),i.setNodeLineIcos(d,a),i.setNodeFontCss(d,a))}};b.treeTools=c;h.setZTreeTools(d,c);b[a]&&b[a].length>0?i.createNodes(d,0,b[a]):d.async.enable&&d.async.url&&d.async.url!==""&&i.asyncNode(d);return c}};var N=p.fn.zTree,k=j.$,e=N.consts})(jQuery);(function(h){var c,b,a,d={event:{CHECK:"ztree_check"},id:{CHECK:"_check"},checkbox:{STYLE:"checkbox",DEFAULT:"chk",DISABLED:"disable",FALSE:"false",TRUE:"true",FULL:"full",PART:"part",FOCUS:"focus"},radio:{STYLE:"radio",TYPE_ALL:"all",TYPE_LEVEL:"level"}},z={check:{enable:!1,autoCheckTrigger:!1,chkStyle:d.checkbox.STYLE,nocheckInherit:!1,chkDisabledInherit:!1,radioType:d.radio.TYPE_LEVEL,chkboxType:{Y:"ps",N:"ps"}},data:{key:{checked:"checked"}},callback:{beforeCheck:null,onCheck:null}};c=function(e,f){if(f.chkDisabled===!0){return !1}var k=x.getSetting(e.data.treeId),j=k.data.key.checked;if(l.apply(k.callback.beforeCheck,[k.treeId,f],!0)==!1){return !0}f[j]=!f[j];y.checkNodeRelation(k,f);j=g(f,w.id.CHECK,k);y.setChkClass(k,j,f);y.repairParentChkClassWithSelf(k,f);k.treeObj.trigger(w.event.CHECK,[e,k.treeId,f]);return !0};b=function(e,f){if(f.chkDisabled===!0){return !1}var k=x.getSetting(e.data.treeId),j=g(f,w.id.CHECK,k);f.check_Focus=!0;y.setChkClass(k,j,f);return !0};a=function(e,f){if(f.chkDisabled===!0){return !1}var k=x.getSetting(e.data.treeId),j=g(f,w.id.CHECK,k);f.check_Focus=!1;y.setChkClass(k,j,f);return !0};h.extend(!0,h.fn.zTree.consts,d);h.extend(!0,h.fn.zTree._z,{tools:{},view:{checkNodeRelation:function(e,j){var q,p,n,k=e.data.key.children,f=e.data.key.checked;q=w.radio;if(e.check.chkStyle==q.STYLE){var o=x.getRadioCheckedList(e);if(j[f]){if(e.check.radioType==q.TYPE_ALL){for(p=o.length-1;p>=0;p--){q=o[p],q[f]=!1,o.splice(p,1),y.setChkClass(e,g(q,w.id.CHECK,e),q),q.parentTId!=j.parentTId&&y.repairParentChkClassWithSelf(e,q)}o.push(j)}else{o=j.parentTId?j.getParentNode():x.getRoot(e);for(p=0,n=o[k].length;p<n;p++){q=o[k][p],q[f]&&q!=j&&(q[f]=!1,y.setChkClass(e,g(q,w.id.CHECK,e),q))}}}else{if(e.check.radioType==q.TYPE_ALL){for(p=0,n=o.length;p<n;p++){if(j==o[p]){o.splice(p,1);break}}}}}else{j[f]&&(!j[k]||j[k].length==0||e.check.chkboxType.Y.indexOf("s")>-1)&&y.setSonNodeCheckBox(e,j,!0),!j[f]&&(!j[k]||j[k].length==0||e.check.chkboxType.N.indexOf("s")>-1)&&y.setSonNodeCheckBox(e,j,!1),j[f]&&e.check.chkboxType.Y.indexOf("p")>-1&&y.setParentNodeCheckBox(e,j,!0),!j[f]&&e.check.chkboxType.N.indexOf("p")>-1&&y.setParentNodeCheckBox(e,j,!1)}},makeChkClass:function(e,f){var o=e.data.key.checked,n=w.checkbox,k=w.radio,j="",j=f.chkDisabled===!0?n.DISABLED:f.halfCheck?n.PART:e.check.chkStyle==k.STYLE?f.check_Child_State<1?n.FULL:n.PART:f[o]?f.check_Child_State===2||f.check_Child_State===-1?n.FULL:n.PART:f.check_Child_State<1?n.FULL:n.PART,o=e.check.chkStyle+"_"+(f[o]?n.TRUE:n.FALSE)+"_"+j,o=f.check_Focus&&f.chkDisabled!==!0?o+"_"+n.FOCUS:o;return w.className.BUTTON+" "+n.DEFAULT+" "+o},repairAllChk:function(e,j){if(e.check.enable&&e.check.chkStyle===w.checkbox.STYLE){for(var q=e.data.key.checked,p=e.data.key.children,n=x.getRoot(e),k=0,f=n[p].length;k<f;k++){var o=n[p][k];o.nocheck!==!0&&o.chkDisabled!==!0&&(o[q]=j);y.setSonNodeCheckBox(e,o,j)}}},repairChkClass:function(e,f){if(f&&(x.makeChkFlag(e,f),f.nocheck!==!0)){var j=g(f,w.id.CHECK,e);y.setChkClass(e,j,f)}},repairParentChkClass:function(e,f){if(f&&f.parentTId){var j=f.getParentNode();y.repairChkClass(e,j);y.repairParentChkClass(e,j)}},repairParentChkClassWithSelf:function(e,f){if(f){var j=e.data.key.children;f[j]&&f[j].length>0?y.repairParentChkClass(e,f[j][0]):y.repairParentChkClass(e,f)}},repairSonChkDisabled:function(e,j,p,o){if(j){var n=e.data.key.children;if(j.chkDisabled!=p){j.chkDisabled=p}y.repairChkClass(e,j);if(j[n]&&o){for(var k=0,f=j[n].length;k<f;k++){y.repairSonChkDisabled(e,j[n][k],p,o)}}}},repairParentChkDisabled:function(e,f,k,j){if(f){if(f.chkDisabled!=k&&j){f.chkDisabled=k}y.repairChkClass(e,f);y.repairParentChkDisabled(e,f.getParentNode(),k,j)}},setChkClass:function(e,f,j){f&&(j.nocheck===!0?f.hide():f.show(),f.removeClass(),f.addClass(y.makeChkClass(e,j)))},setParentNodeCheckBox:function(r,s,q,p){var n=r.data.key.children,j=r.data.key.checked,e=g(s,w.id.CHECK,r);p||(p=s);x.makeChkFlag(r,s);s.nocheck!==!0&&s.chkDisabled!==!0&&(s[j]=q,y.setChkClass(r,e,s),r.check.autoCheckTrigger&&s!=p&&r.treeObj.trigger(w.event.CHECK,[null,r.treeId,s]));if(s.parentTId){e=!0;if(!q){for(var n=s.getParentNode()[n],o=0,f=n.length;o<f;o++){if(n[o].nocheck!==!0&&n[o].chkDisabled!==!0&&n[o][j]||(n[o].nocheck===!0||n[o].chkDisabled===!0)&&n[o].check_Child_State>0){e=!1;break}}}e&&y.setParentNodeCheckBox(r,s.getParentNode(),q,p)}},setSonNodeCheckBox:function(u,v,t,s){if(v){var q=u.data.key.children,p=u.data.key.checked,j=g(v,w.id.CHECK,u);s||(s=v);var r=!1;if(v[q]){for(var n=0,f=v[q].length;n<f&&v.chkDisabled!==!0;n++){var e=v[q][n];y.setSonNodeCheckBox(u,e,t,s);e.chkDisabled===!0&&(r=!0)}}if(v!=x.getRoot(u)&&v.chkDisabled!==!0){r&&v.nocheck!==!0&&x.makeChkFlag(u,v);if(v.nocheck!==!0&&v.chkDisabled!==!0){if(v[p]=t,!r){v.check_Child_State=v[q]&&v[q].length>0?t?2:0:-1}}else{v.check_Child_State=-1}y.setChkClass(u,j,v);u.check.autoCheckTrigger&&v!=s&&v.nocheck!==!0&&v.chkDisabled!==!0&&u.treeObj.trigger(w.event.CHECK,[null,u.treeId,v])}}}},event:{},data:{getRadioCheckedList:function(e){for(var f=x.getRoot(e).radioCheckedList,k=0,j=f.length;k<j;k++){x.getNodeCache(e,f[k].tId)||(f.splice(k,1),k--,j--)}return f},getCheckStatus:function(e,f){if(!e.check.enable||f.nocheck||f.chkDisabled){return null}var j=e.data.key.checked;return{checked:f[j],half:f.halfCheck?f.halfCheck:e.check.chkStyle==w.radio.STYLE?f.check_Child_State===2:f[j]?f.check_Child_State>-1&&f.check_Child_State<2:f.check_Child_State>0}},getTreeCheckedNodes:function(s,t,r,q){if(!t){return[]}for(var n=s.data.key.children,j=s.data.key.checked,p=r&&s.check.chkStyle==w.radio.STYLE&&s.check.radioType==w.radio.TYPE_ALL,q=!q?[]:q,o=0,f=t.length;o<f;o++){if(t[o].nocheck!==!0&&t[o].chkDisabled!==!0&&t[o][j]==r&&(q.push(t[o]),p)){break}x.getTreeCheckedNodes(s,t[o][n],r,q);if(p&&q.length>0){break}}return q},getTreeChangeCheckedNodes:function(f,j,q){if(!j){return[]}for(var p=f.data.key.children,n=f.data.key.checked,q=!q?[]:q,k=0,o=j.length;k<o;k++){j[k].nocheck!==!0&&j[k].chkDisabled!==!0&&j[k][n]!=j[k].checkedOld&&q.push(j[k]),x.getTreeChangeCheckedNodes(f,j[k][p],q)}return q},makeChkFlag:function(s,t){if(t){var r=s.data.key.children,q=s.data.key.checked,k=-1;if(t[r]){for(var j=0,p=t[r].length;j<p;j++){var n=t[r][j],o=-1;if(s.check.chkStyle==w.radio.STYLE){if(o=n.nocheck===!0||n.chkDisabled===!0?n.check_Child_State:n.halfCheck===!0?2:n[q]?2:n.check_Child_State>0?2:0,o==2){k=2;break}else{o==0&&(k=0)}}else{if(s.check.chkStyle==w.checkbox.STYLE){if(o=n.nocheck===!0||n.chkDisabled===!0?n.check_Child_State:n.halfCheck===!0?1:n[q]?n.check_Child_State===-1||n.check_Child_State===2?2:1:n.check_Child_State>0?1:0,o===1){k=1;break}else{if(o===2&&k>-1&&j>0&&o!==k){k=1;break}else{if(k===2&&o>-1&&o<2){k=1;break}else{o>-1&&(k=o)}}}}}}}t.check_Child_State=k}}}});var h=h.fn.zTree,l=h._z.tools,w=h.consts,y=h._z.view,x=h._z.data,g=l.$;x.exSetting(z);x.addInitBind(function(e){e.treeObj.bind(w.event.CHECK,function(f,n,k,j){l.apply(e.callback.onCheck,[n?n:f,k,j])})});x.addInitUnBind(function(e){e.treeObj.unbind(w.event.CHECK)});x.addInitCache(function(){});x.addInitNode(function(e,f,k,j){if(k){f=e.data.key.checked;typeof k[f]=="string"&&(k[f]=l.eqs(k[f],"true"));k[f]=!!k[f];k.checkedOld=k[f];if(typeof k.nocheck=="string"){k.nocheck=l.eqs(k.nocheck,"true")}k.nocheck=!!k.nocheck||e.check.nocheckInherit&&j&&!!j.nocheck;if(typeof k.chkDisabled=="string"){k.chkDisabled=l.eqs(k.chkDisabled,"true")}k.chkDisabled=!!k.chkDisabled||e.check.chkDisabledInherit&&j&&!!j.chkDisabled;if(typeof k.halfCheck=="string"){k.halfCheck=l.eqs(k.halfCheck,"true")}k.halfCheck=!!k.halfCheck;k.check_Child_State=-1;k.check_Focus=!1;k.getCheckStatus=function(){return x.getCheckStatus(e,k)};e.check.chkStyle==w.radio.STYLE&&e.check.radioType==w.radio.TYPE_ALL&&k[f]&&x.getRoot(e).radioCheckedList.push(k)}});x.addInitProxy(function(f){var k=f.target,q=x.getSetting(f.data.treeId),p="",n=null,o="",j=null;if(l.eqs(f.type,"mouseover")){if(q.check.enable&&l.eqs(k.tagName,"span")&&k.getAttribute("treeNode"+w.id.CHECK)!==null){p=l.getNodeMainDom(k).id,o="mouseoverCheck"}}else{if(l.eqs(f.type,"mouseout")){if(q.check.enable&&l.eqs(k.tagName,"span")&&k.getAttribute("treeNode"+w.id.CHECK)!==null){p=l.getNodeMainDom(k).id,o="mouseoutCheck"}}else{if(l.eqs(f.type,"click")&&q.check.enable&&l.eqs(k.tagName,"span")&&k.getAttribute("treeNode"+w.id.CHECK)!==null){p=l.getNodeMainDom(k).id,o="checkNode"}}}if(p.length>0){switch(n=x.getNodeCache(q,p),o){case"checkNode":j=c;break;case"mouseoverCheck":j=b;break;case"mouseoutCheck":j=a}}return{stop:o==="checkNode",node:n,nodeEventType:o,nodeEventCallback:j,treeEventType:"",treeEventCallback:null}},!0);x.addInitRoot(function(e){x.getRoot(e).radioCheckedList=[]});x.addBeforeA(function(e,f,j){e.check.enable&&(x.makeChkFlag(e,f),j.push("<span ID='",f.tId,w.id.CHECK,"' class='",y.makeChkClass(e,f),"' treeNode",w.id.CHECK,f.nocheck===!0?" style='display:none;'":"","></span>"))});x.addZTreeTools(function(e,f){f.checkNode=function(k,q,n,p){var o=e.data.key.checked;if(k.chkDisabled!==!0&&(q!==!0&&q!==!1&&(q=!k[o]),p=!!p,(k[o]!==q||n)&&!(p&&l.apply(this.setting.callback.beforeCheck,[e.treeId,k],!0)==!1)&&l.uCanDo(this.setting)&&e.check.enable&&k.nocheck!==!0)){k[o]=q,q=g(k,w.id.CHECK,e),(n||e.check.chkStyle===w.radio.STYLE)&&y.checkNodeRelation(e,k),y.setChkClass(e,q,k),y.repairParentChkClassWithSelf(e,k),p&&e.treeObj.trigger(w.event.CHECK,[null,e.treeId,k])}};f.checkAllNodes=function(k){y.repairAllChk(e,!!k)};f.getCheckedNodes=function(k){var n=e.data.key.children;return x.getTreeCheckedNodes(e,x.getRoot(e)[n],k!==!1)};f.getChangeCheckedNodes=function(){var k=e.data.key.children;return x.getTreeChangeCheckedNodes(e,x.getRoot(e)[k])};f.setChkDisabled=function(k,p,o,n){p=!!p;o=!!o;y.repairSonChkDisabled(e,k,p,!!n);y.repairParentChkDisabled(e,k.getParentNode(),p,o)};var j=f.updateNode;f.updateNode=function(o,n){j&&j.apply(f,arguments);if(o&&e.check.enable&&g(o,e).get(0)&&l.uCanDo(e)){var k=g(o,w.id.CHECK,e);(n==!0||e.check.chkStyle===w.radio.STYLE)&&y.checkNodeRelation(e,o);y.setChkClass(e,k,o);y.repairParentChkClassWithSelf(e,o)}}});var C=y.createNodes;y.createNodes=function(e,f,k,j){C&&C.apply(y,arguments);k&&y.repairParentChkClassWithSelf(e,j)};var B=y.removeNode;y.removeNode=function(e,f){var j=f.getParentNode();B&&B.apply(y,arguments);f&&j&&(y.repairChkClass(e,j),y.repairParentChkClass(e,j))};var A=y.appendNodes;y.appendNodes=function(e,f,q,p,o,n){var k="";A&&(k=A.apply(y,arguments));p&&x.makeChkFlag(e,p);return k}})(jQuery);(function(u){var t={event:{DRAG:"ztree_drag",DROP:"ztree_drop",REMOVE:"ztree_remove",RENAME:"ztree_rename"},id:{EDIT:"_edit",INPUT:"_input",REMOVE:"_remove"},move:{TYPE_INNER:"inner",TYPE_PREV:"prev",TYPE_NEXT:"next"},node:{CURSELECTED_EDIT:"curSelectedNode_Edit",TMPTARGET_TREE:"tmpTargetzTree",TMPTARGET_NODE:"tmpTargetNode"}},s={onHoverOverNode:function(e,g){var p=b.getSetting(e.data.treeId),n=b.getRoot(p);if(n.curHoverNode!=g){s.onHoverOutNode(e)}n.curHoverNode=g;o.addHoverDom(p,g)},onHoverOutNode:function(d){var d=b.getSetting(d.data.treeId),e=b.getRoot(d);if(e.curHoverNode&&!b.isSelectedNode(d,e.curHoverNode)){o.removeTreeDom(d,e.curHoverNode),e.curHoverNode=null}},onMousedownNode:function(ah,ai){function ag(am){if(W.dragFlag==0&&Math.abs(p-am.clientX)<af.edit.drag.minMoveSize&&Math.abs(n-am.clientY)<af.edit.drag.minMoveSize){return !0}var an,al,T,U,ak;ak=af.data.key.children;w.css("cursor","pointer");if(W.dragFlag==0){if(j.apply(af.callback.beforeDrag,[af.treeId,Z],!0)==!1){return aa(am),!0}for(an=0,al=Z.length;an<al;an++){if(an==0){W.dragNodeShowBefore=[]}T=Z[an];T.isParent&&T.open?(o.expandCollapseNode(af,T,!T.open),W.dragNodeShowBefore[T.tId]=!0):W.dragNodeShowBefore[T.tId]=!1}W.dragFlag=1;P.showHoverDom=!1;j.showIfameMask(af,!0);T=!0;U=-1;if(Z.length>1){var aj=Z[0].parentTId?Z[0].getParentNode()[ak]:b.getNodes(af);ak=[];for(an=0,al=aj.length;an<al;an++){if(W.dragNodeShowBefore[aj[an].tId]!==void 0&&(T&&U>-1&&U+1!==an&&(T=!1),ak.push(aj[an]),U=an),Z.length===ak.length){Z=ak;break}}}T&&(E=Z[0].getPreNode(),g=Z[Z.length-1].getNextNode());S=a("<ul class='zTreeDragUL'></ul>",af);for(an=0,al=Z.length;an<al;an++){if(T=Z[an],T.editNameFlag=!1,o.selectNode(af,T,an>0),o.removeTreeDom(af,T),U=a("<li id='"+T.tId+"_tmp'></li>",af),U.append(a(T,q.id.A,af).clone()),U.css("padding","0"),U.children("#"+T.tId+q.id.A).removeClass(q.node.CURSELECTED),S.append(U),an==af.edit.drag.maxShowNodeNum-1){U=a("<li id='"+T.tId+"_moretmp'><a>  ...  </a></li>",af);S.append(U);break}}S.attr("id",Z[0].tId+q.id.UL+"_tmp");S.addClass(af.treeObj.attr("class"));S.appendTo(w);Y=a("<span class='tmpzTreeMove_arrow'></span>",af);Y.attr("id","zTreeMove_arrow_tmp");Y.appendTo(w);af.treeObj.trigger(q.event.DRAG,[am,af.treeId,Z])}if(W.dragFlag==1){Q&&Y.attr("id")==am.target.id&&I&&am.clientX+K.scrollLeft()+2>u("#"+I+q.id.A,Q).offset().left?(T=u("#"+I+q.id.A,Q),am.target=T.length>0?T.get(0):am.target):Q&&(Q.removeClass(q.node.TMPTARGET_TREE),I&&u("#"+I+q.id.A,Q).removeClass(q.node.TMPTARGET_NODE+"_"+q.move.TYPE_PREV).removeClass(q.node.TMPTARGET_NODE+"_"+t.move.TYPE_NEXT).removeClass(q.node.TMPTARGET_NODE+"_"+t.move.TYPE_INNER));I=Q=null;z=!1;ae=af;T=b.getSettings();for(var N in T){if(T[N].treeId&&T[N].edit.enable&&T[N].treeId!=af.treeId&&(am.target.id==T[N].treeId||u(am.target).parents("#"+T[N].treeId).length>0)){z=!0,ae=T[N]}}N=K.scrollTop();U=K.scrollLeft();ak=ae.treeObj.offset();an=ae.treeObj.get(0).scrollHeight;T=ae.treeObj.get(0).scrollWidth;al=am.clientY+N-ak.top;var R=ae.treeObj.height()+ak.top-am.clientY-N,O=am.clientX+U-ak.left,J=ae.treeObj.width()+ak.left-am.clientX-U;ak=al<af.edit.drag.borderMax&&al>af.edit.drag.borderMin;var aj=R<af.edit.drag.borderMax&&R>af.edit.drag.borderMin,F=O<af.edit.drag.borderMax&&O>af.edit.drag.borderMin,L=J<af.edit.drag.borderMax&&J>af.edit.drag.borderMin,R=al>af.edit.drag.borderMin&&R>af.edit.drag.borderMin&&O>af.edit.drag.borderMin&&J>af.edit.drag.borderMin,O=ak&&ae.treeObj.scrollTop()<=0,J=aj&&ae.treeObj.scrollTop()+ae.treeObj.height()+10>=an,C=F&&ae.treeObj.scrollLeft()<=0,B=L&&ae.treeObj.scrollLeft()+ae.treeObj.width()+10>=T;if(am.target&&j.isChildOrSelf(am.target,ae.treeId)){for(var M=am.target;M&&M.tagName&&!j.eqs(M.tagName,"li")&&M.id!=ae.treeId;){M=M.parentNode}var A=!0;for(an=0,al=Z.length;an<al;an++){if(T=Z[an],M.id===T.tId){A=!1;break}else{if(a(T,af).find("#"+M.id).length>0){A=!1;break}}}if(A&&am.target&&j.isChildOrSelf(am.target,M.id+q.id.A)){Q=u(M),I=M.id}}T=Z[0];if(R&&j.isChildOrSelf(am.target,ae.treeId)){if(!Q&&(am.target.id==ae.treeId||O||J||C||B)&&(z||!z&&T.parentTId)){Q=ae.treeObj}ak?ae.treeObj.scrollTop(ae.treeObj.scrollTop()-10):aj&&ae.treeObj.scrollTop(ae.treeObj.scrollTop()+10);F?ae.treeObj.scrollLeft(ae.treeObj.scrollLeft()-10):L&&ae.treeObj.scrollLeft(ae.treeObj.scrollLeft()+10);Q&&Q!=ae.treeObj&&Q.offset().left<ae.treeObj.offset().left&&ae.treeObj.scrollLeft(ae.treeObj.scrollLeft()+Q.offset().left-ae.treeObj.offset().left)}S.css({top:am.clientY+N+3+"px",left:am.clientX+U+3+"px"});ak=an=0;if(Q&&Q.attr("id")!=ae.treeId){var H=I==null?null:b.getNodeCache(ae,I);al=am.ctrlKey&&af.edit.drag.isMove&&af.edit.drag.isCopy||!af.edit.drag.isMove&&af.edit.drag.isCopy;an=!!(E&&I===E.tId);ak=!!(g&&I===g.tId);U=T.parentTId&&T.parentTId==I;T=(al||!ak)&&j.apply(ae.edit.drag.prev,[ae.treeId,Z,H],!!ae.edit.drag.prev);an=(al||!an)&&j.apply(ae.edit.drag.next,[ae.treeId,Z,H],!!ae.edit.drag.next);L=(al||!U)&&!(ae.data.keep.leaf&&!H.isParent)&&j.apply(ae.edit.drag.inner,[ae.treeId,Z,H],!!ae.edit.drag.inner);if(!T&&!an&&!L){if(Q=null,I="",G=q.move.TYPE_INNER,Y.css({display:"none"}),window.zTreeMoveTimer){clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null}}else{al=u("#"+I+q.id.A,Q);ak=H.isLastNode?null:u("#"+H.getNextNode().tId+q.id.A,Q.next());aj=al.offset().top;U=al.offset().left;F=T?L?0.25:an?0.5:1:-1;L=an?L?0.75:T?0.5:0:-1;am=(am.clientY+N-aj)/al.height();(F==1||am<=F&&am>=-0.2)&&T?(an=1-Y.width(),ak=aj-Y.height()/2,G=q.move.TYPE_PREV):(L==0||am>=L&&am<=1.2)&&an?(an=1-Y.width(),ak=ak==null||H.isParent&&H.open?aj+al.height()-Y.height()/2:ak.offset().top-Y.height()/2,G=q.move.TYPE_NEXT):(an=5-Y.width(),ak=aj,G=q.move.TYPE_INNER);Y.css({display:"block",top:ak+"px",left:U+an+"px"});al.addClass(q.node.TMPTARGET_NODE+"_"+G);if(e!=I||d!=G){y=(new Date).getTime()}if(H&&H.isParent&&G==q.move.TYPE_INNER&&(am=!0,window.zTreeMoveTimer&&window.zTreeMoveTargetNodeTId!==H.tId?(clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null):window.zTreeMoveTimer&&window.zTreeMoveTargetNodeTId===H.tId&&(am=!1),am)){window.zTreeMoveTimer=setTimeout(function(){G==q.move.TYPE_INNER&&H&&H.isParent&&!H.open&&(new Date).getTime()-y>ae.edit.drag.autoOpenTime&&j.apply(ae.callback.beforeDragOpen,[ae.treeId,H],!0)&&(o.switchNode(ae,H),ae.edit.drag.autoExpandTrigger&&ae.treeObj.trigger(q.event.EXPAND,[ae.treeId,H]))},ae.edit.drag.autoOpenTime+50),window.zTreeMoveTargetNodeTId=H.tId}}}else{if(G=q.move.TYPE_INNER,Q&&j.apply(ae.edit.drag.inner,[ae.treeId,Z,null],!!ae.edit.drag.inner)?Q.addClass(q.node.TMPTARGET_TREE):Q=null,Y.css({display:"none"}),window.zTreeMoveTimer){clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null}}e=I;d=G}return !1}function aa(x){if(window.zTreeMoveTimer){clearTimeout(window.zTreeMoveTimer),window.zTreeMoveTargetNodeTId=null}d=e=null;K.unbind("mousemove",ag);K.unbind("mouseup",aa);K.unbind("selectstart",ab);w.css("cursor","auto");Q&&(Q.removeClass(q.node.TMPTARGET_TREE),I&&u("#"+I+q.id.A,Q).removeClass(q.node.TMPTARGET_NODE+"_"+q.move.TYPE_PREV).removeClass(q.node.TMPTARGET_NODE+"_"+t.move.TYPE_NEXT).removeClass(q.node.TMPTARGET_NODE+"_"+t.move.TYPE_INNER));j.showIfameMask(af,!1);P.showHoverDom=!0;if(W.dragFlag!=0){W.dragFlag=0;var A,C,B;for(A=0,C=Z.length;A<C;A++){B=Z[A],B.isParent&&W.dragNodeShowBefore[B.tId]&&!B.open&&(o.expandCollapseNode(af,B,!B.open),delete W.dragNodeShowBefore[B.tId])}S&&S.remove();Y&&Y.remove();var H=x.ctrlKey&&af.edit.drag.isMove&&af.edit.drag.isCopy||!af.edit.drag.isMove&&af.edit.drag.isCopy;!H&&Q&&I&&Z[0].parentTId&&I==Z[0].parentTId&&G==q.move.TYPE_INNER&&(Q=null);if(Q){var F=I==null?null:b.getNodeCache(ae,I);if(j.apply(af.callback.beforeDrop,[ae.treeId,Z,F,G,H],!0)==!1){o.selectNodes(D,Z)}else{var J=H?j.clone(Z):Z;A=function(){if(z){if(!H){for(var L=0,M=Z.length;L<M;L++){o.removeNode(af,Z[L])}}if(G==q.move.TYPE_INNER){o.addNodes(ae,F,J)}else{if(o.addNodes(ae,F.getParentNode(),J),G==q.move.TYPE_PREV){for(L=0,M=J.length;L<M;L++){o.moveNode(ae,F,J[L],G,!1)}}else{for(L=-1,M=J.length-1;L<M;M--){o.moveNode(ae,F,J[M],G,!1)}}}}else{if(H&&G==q.move.TYPE_INNER){o.addNodes(ae,F,J)}else{if(H&&o.addNodes(ae,F.getParentNode(),J),G!=q.move.TYPE_NEXT){for(L=0,M=J.length;L<M;L++){o.moveNode(ae,F,J[L],G,!1)}}else{for(L=-1,M=J.length-1;L<M;M--){o.moveNode(ae,F,J[M],G,!1)}}}}o.selectNodes(ae,J);a(J[0],af).focus().blur();af.treeObj.trigger(q.event.DROP,[x,ae.treeId,J,F,G,H])};G==q.move.TYPE_INNER&&j.canAsync(ae,F)?o.asyncNode(ae,F,!1,A):A()}}else{o.selectNodes(D,Z),af.treeObj.trigger(q.event.DROP,[x,af.treeId,Z,null,null,null])}}}function ab(){return !1}var ad,ac,af=b.getSetting(ah.data.treeId),W=b.getRoot(af),P=b.getRoots();if(ah.button==2||!af.edit.enable||!af.edit.drag.isCopy&&!af.edit.drag.isMove){return !0}var X=ah.target,V=b.getRoot(af).curSelectedList,Z=[];if(b.isSelectedNode(af,ai)){for(ad=0,ac=V.length;ad<ac;ad++){if(V[ad].editNameFlag&&j.eqs(X.tagName,"input")&&X.getAttribute("treeNode"+q.id.INPUT)!==null){return !0}Z.push(V[ad]);if(Z[0].parentTId!==V[ad].parentTId){Z=[ai];break}}}else{Z=[ai]}o.editNodeBlur=!0;o.cancelCurEditNode(af);var K=u(af.treeObj.get(0).ownerDocument),w=u(af.treeObj.get(0).ownerDocument.body),S,Y,Q,z=!1,ae=af,D=af,E,g,e=null,d=null,I=null,G=q.move.TYPE_INNER,p=ah.clientX,n=ah.clientY,y=(new Date).getTime();j.uCanDo(af)&&K.bind("mousemove",ag);K.bind("mouseup",aa);K.bind("selectstart",ab);ah.preventDefault&&ah.preventDefault();return !0}};u.extend(!0,u.fn.zTree.consts,t);u.extend(!0,u.fn.zTree._z,{tools:{getAbs:function(d){d=d.getBoundingClientRect();return[d.left+(document.body.scrollLeft+document.documentElement.scrollLeft),d.top+(document.body.scrollTop+document.documentElement.scrollTop)]},inputFocus:function(d){d.get(0)&&(d.focus(),j.setCursorPosition(d.get(0),d.val().length))},inputSelect:function(d){d.get(0)&&(d.focus(),d.select())},setCursorPosition:function(d,e){if(d.setSelectionRange){d.focus(),d.setSelectionRange(e,e)}else{if(d.createTextRange){var g=d.createTextRange();g.collapse(!0);g.moveEnd("character",e);g.moveStart("character",e);g.select()}}},showIfameMask:function(g,n){for(var A=b.getRoot(g);A.dragMaskList.length>0;){A.dragMaskList[0].remove(),A.dragMaskList.shift()}if(n){for(var z=a("iframe",g),y=0,w=z.length;y<w;y++){var p=z.get(y),x=j.getAbs(p),p=a("<div id='zTreeMask_"+y+"' class='zTreeMask' style='top:"+x[1]+"px; left:"+x[0]+"px; width:"+p.offsetWidth+"px; height:"+p.offsetHeight+"px;'></div>",g);p.appendTo(a("body",g));A.dragMaskList.push(p)}}}},view:{addEditBtn:function(d,g){if(!(g.editNameFlag||a(g,q.id.EDIT,d).length>0)&&j.apply(d.edit.showRenameBtn,[d.treeId,g],d.edit.showRenameBtn)){var n=a(g,q.id.A,d),e="<span class='"+q.className.BUTTON+" edit' id='"+g.tId+q.id.EDIT+"' title='"+j.apply(d.edit.renameTitle,[d.treeId,g],d.edit.renameTitle)+"' treeNode"+q.id.EDIT+" style='display:none;'></span>";n.append(e);a(g,q.id.EDIT,d).bind("click",function(){if(!j.uCanDo(d)||j.apply(d.callback.beforeEditName,[d.treeId,g],!0)==!1){return !1}o.editNode(d,g);return !1}).show()}},addRemoveBtn:function(d,g){if(!(g.editNameFlag||a(g,q.id.REMOVE,d).length>0)&&j.apply(d.edit.showRemoveBtn,[d.treeId,g],d.edit.showRemoveBtn)){var n=a(g,q.id.A,d),e="<span class='"+q.className.BUTTON+" remove' id='"+g.tId+q.id.REMOVE+"' title='"+j.apply(d.edit.removeTitle,[d.treeId,g],d.edit.removeTitle)+"' treeNode"+q.id.REMOVE+" style='display:none;'></span>";n.append(e);a(g,q.id.REMOVE,d).bind("click",function(){if(!j.uCanDo(d)||j.apply(d.callback.beforeRemove,[d.treeId,g],!0)==!1){return !1}o.removeNode(d,g);d.treeObj.trigger(q.event.REMOVE,[d.treeId,g]);return !1}).bind("mousedown",function(){return !0}).show()}},addHoverDom:function(d,e){if(b.getRoots().showHoverDom){e.isHover=!0,d.edit.enable&&(o.addEditBtn(d,e),o.addRemoveBtn(d,e)),j.apply(d.view.addHoverDom,[d.treeId,e])}},cancelCurEditNode:function(d,g,x){var e=b.getRoot(d),n=d.data.key.name,w=e.curEditNode;if(w){var p=e.curEditInput,g=g?g:x?w[n]:p.val();if(j.apply(d.callback.beforeRename,[d.treeId,w,g,x],!0)===!1){return !1}else{w[n]=g,d.treeObj.trigger(q.event.RENAME,[d.treeId,w,x])}a(w,q.id.A,d).removeClass(q.node.CURSELECTED_EDIT);p.unbind();o.setNodeName(d,w);w.editNameFlag=!1;e.curEditNode=null;e.curEditInput=null;o.selectNode(d,w,!1)}return e.noSelection=!0},editNode:function(d,g){var p=b.getRoot(d);o.editNodeBlur=!1;if(b.isSelectedNode(d,g)&&p.curEditNode==g&&g.editNameFlag){setTimeout(function(){j.inputFocus(p.curEditInput)},0)}else{var e=d.data.key.name;g.editNameFlag=!0;o.removeTreeDom(d,g);o.cancelCurEditNode(d);o.selectNode(d,g,!1);a(g,q.id.SPAN,d).html("<input type=text class='rename' id='"+g.tId+q.id.INPUT+"' treeNode"+q.id.INPUT+" >");var n=a(g,q.id.INPUT,d);n.attr("value",g[e]);d.edit.editNameSelectAll?j.inputSelect(n):j.inputFocus(n);n.bind("blur",function(){o.editNodeBlur||o.cancelCurEditNode(d)}).bind("keydown",function(w){w.keyCode=="13"?(o.editNodeBlur=!0,o.cancelCurEditNode(d)):w.keyCode=="27"&&o.cancelCurEditNode(d,null,!0)}).bind("click",function(){return !1}).bind("dblclick",function(){return !1});a(g,q.id.A,d).addClass(q.node.CURSELECTED_EDIT);p.curEditInput=n;p.noSelection=!1;p.curEditNode=g}},moveNode:function(G,I,F,y,z,B){var A=b.getRoot(G),E=G.data.key.children;if(I!=F&&(!G.data.keep.leaf||!I||I.isParent||y!=q.move.TYPE_INNER)){var D=F.parentTId?F.getParentNode():A,K=I===null||I==A;K&&I===null&&(I=A);if(K){y=q.move.TYPE_INNER}A=I.parentTId?I.getParentNode():A;if(y!=q.move.TYPE_PREV&&y!=q.move.TYPE_NEXT){y=q.move.TYPE_INNER}if(y==q.move.TYPE_INNER){if(K){F.parentTId=null}else{if(!I.isParent){I.isParent=!0,I.open=!!I.open,o.setNodeLineIcos(G,I)}F.parentTId=I.tId}}var n;K?n=K=G.treeObj:(!B&&y==q.move.TYPE_INNER?o.expandCollapseNode(G,I,!0,!1):B||o.expandCollapseNode(G,I.getParentNode(),!0,!1),K=a(I,G),n=a(I,q.id.UL,G),K.get(0)&&!n.get(0)&&(n=[],o.makeUlHtml(G,I,n,""),K.append(n.join(""))),n=a(I,q.id.UL,G));var d=a(F,G);d.get(0)?K.get(0)||d.remove():d=o.appendNodes(G,F.level,[F],null,!1,!0).join("");n.get(0)&&y==q.move.TYPE_INNER?n.append(d):K.get(0)&&y==q.move.TYPE_PREV?K.before(d):K.get(0)&&y==q.move.TYPE_NEXT&&K.after(d);var p=-1,J=0,H=null,K=null,e=F.level;if(F.isFirstNode){if(p=0,D[E].length>1){H=D[E][1],H.isFirstNode=!0}}else{if(F.isLastNode){p=D[E].length-1,H=D[E][p-1],H.isLastNode=!0}else{for(n=0,d=D[E].length;n<d;n++){if(D[E][n].tId==F.tId){p=n;break}}}}p>=0&&D[E].splice(p,1);if(y!=q.move.TYPE_INNER){for(n=0,d=A[E].length;n<d;n++){A[E][n].tId==I.tId&&(J=n)}}if(y==q.move.TYPE_INNER){I[E]||(I[E]=[]);if(I[E].length>0){K=I[E][I[E].length-1],K.isLastNode=!1}I[E].splice(I[E].length,0,F);F.isLastNode=!0;F.isFirstNode=I[E].length==1}else{I.isFirstNode&&y==q.move.TYPE_PREV?(A[E].splice(J,0,F),K=I,K.isFirstNode=!1,F.parentTId=I.parentTId,F.isFirstNode=!0,F.isLastNode=!1):I.isLastNode&&y==q.move.TYPE_NEXT?(A[E].splice(J+1,0,F),K=I,K.isLastNode=!1,F.parentTId=I.parentTId,F.isFirstNode=!1,F.isLastNode=!0):(y==q.move.TYPE_PREV?A[E].splice(J,0,F):A[E].splice(J+1,0,F),F.parentTId=I.parentTId,F.isFirstNode=!1,F.isLastNode=!1)}b.fixPIdKeyValue(G,F);b.setSonNodeLevel(G,F.getParentNode(),F);o.setNodeLineIcos(G,F);o.repairNodeLevelClass(G,F,e);!G.data.keep.parent&&D[E].length<1?(D.isParent=!1,D.open=!1,I=a(D,q.id.UL,G),y=a(D,q.id.SWITCH,G),E=a(D,q.id.ICON,G),o.replaceSwitchClass(D,y,q.folder.DOCU),o.replaceIcoClass(D,E,q.folder.DOCU),I.css("display","none")):H&&o.setNodeLineIcos(G,H);K&&o.setNodeLineIcos(G,K);G.check&&G.check.enable&&o.repairChkClass&&(o.repairChkClass(G,D),o.repairParentChkClassWithSelf(G,D),D!=F.parent&&o.repairParentChkClassWithSelf(G,F));B||o.expandCollapseParentNode(G,F.getParentNode(),!0,z)}},removeEditBtn:function(d,e){a(e,q.id.EDIT,d).unbind().remove()},removeRemoveBtn:function(d,e){a(e,q.id.REMOVE,d).unbind().remove()},removeTreeDom:function(d,e){e.isHover=!1;o.removeEditBtn(d,e);o.removeRemoveBtn(d,e);j.apply(d.view.removeHoverDom,[d.treeId,e])},repairNodeLevelClass:function(d,n,x){if(x!==n.level){var w=a(n,d),p=a(n,q.id.A,d),d=a(n,q.id.UL,d),x=q.className.LEVEL+x,n=q.className.LEVEL+n.level;w.removeClass(x);w.addClass(n);p.removeClass(x);p.addClass(n);d.removeClass(x);d.addClass(n)}},selectNodes:function(e,g){for(var p=0,n=g.length;p<n;p++){o.selectNode(e,g[p],p>0)}}},event:{},data:{setSonNodeLevel:function(g,n,x){if(x){var w=g.data.key.children;x.level=n?n.level+1:0;if(x[w]){for(var n=0,p=x[w].length;n<p;n++){x[w][n]&&b.setSonNodeLevel(g,x,x[w][n])}}}}}});var v=u.fn.zTree,j=v._z.tools,q=v.consts,o=v._z.view,b=v._z.data,a=j.$;b.exSetting({edit:{enable:!1,editNameSelectAll:!1,showRemoveBtn:!0,showRenameBtn:!0,removeTitle:"remove",renameTitle:"rename",drag:{autoExpandTrigger:!1,isCopy:!0,isMove:!0,prev:!0,next:!0,inner:!0,minMoveSize:5,borderMax:10,borderMin:-5,maxShowNodeNum:5,autoOpenTime:500}},view:{addHoverDom:null,removeHoverDom:null},callback:{beforeDrag:null,beforeDragOpen:null,beforeDrop:null,beforeEditName:null,beforeRename:null,onDrag:null,onDrop:null,onRename:null}});b.addInitBind(function(d){var e=d.treeObj,g=q.event;e.bind(g.RENAME,function(n,x,w,p){j.apply(d.callback.onRename,[n,x,w,p])});e.bind(g.REMOVE,function(n,w,p){j.apply(d.callback.onRemove,[n,w,p])});e.bind(g.DRAG,function(n,x,w,p){j.apply(d.callback.onDrag,[x,w,p])});e.bind(g.DROP,function(w,C,A,z,x,B,y){j.apply(d.callback.onDrop,[C,A,z,x,B,y])})});b.addInitUnBind(function(d){var d=d.treeObj,e=q.event;d.unbind(e.RENAME);d.unbind(e.REMOVE);d.unbind(e.DRAG);d.unbind(e.DROP)});b.addInitCache(function(){});b.addInitNode(function(d,e,g){if(g){g.isHover=!1,g.editNameFlag=!1}});b.addInitProxy(function(A){var B=A.target,z=b.getSetting(A.data.treeId),y=A.relatedTarget,g="",w=null,n="",x=null,d=null;if(j.eqs(A.type,"mouseover")){if(d=j.getMDom(z,B,[{tagName:"a",attrName:"treeNode"+q.id.A}])){g=j.getNodeMainDom(d).id,n="hoverOverNode"}}else{if(j.eqs(A.type,"mouseout")){d=j.getMDom(z,y,[{tagName:"a",attrName:"treeNode"+q.id.A}]),d||(g="remove",n="hoverOutNode")}else{if(j.eqs(A.type,"mousedown")&&(d=j.getMDom(z,B,[{tagName:"a",attrName:"treeNode"+q.id.A}]))){g=j.getNodeMainDom(d).id,n="mousedownNode"}}}if(g.length>0){switch(w=b.getNodeCache(z,g),n){case"mousedownNode":x=s.onMousedownNode;break;case"hoverOverNode":x=s.onHoverOverNode;break;case"hoverOutNode":x=s.onHoverOutNode}}return{stop:!1,node:w,nodeEventType:n,nodeEventCallback:x,treeEventType:"",treeEventCallback:null}});b.addInitRoot(function(d){var d=b.getRoot(d),e=b.getRoots();d.curEditNode=null;d.curEditInput=null;d.curHoverNode=null;d.dragFlag=0;d.dragNodeShowBefore=[];d.dragMaskList=[];e.showHoverDom=!0});b.addZTreeTools(function(d,e){e.cancelEditName=function(g){b.getRoot(d).curEditNode&&o.cancelCurEditNode(d,g?g:null,!0)};e.copyNode=function(n,g,p,x){if(!g){return null}if(n&&!n.isParent&&d.data.keep.leaf&&p===q.move.TYPE_INNER){return null}var w=j.clone(g);if(!n){n=null,p=q.move.TYPE_INNER}p==q.move.TYPE_INNER?(g=function(){o.addNodes(d,n,[w],x)},j.canAsync(d,n)?o.asyncNode(d,n,x,g):g()):(o.addNodes(d,n.parentNode,[w],x),o.moveNode(d,n,w,p,!1,x));return w};e.editName=function(g){g&&g.tId&&g===b.getNodeCache(d,g.tId)&&(g.parentTId&&o.expandCollapseParentNode(d,g.getParentNode(),!0),o.editNode(d,g))};e.moveNode=function(n,g,p,x){function w(){o.moveNode(d,n,g,p,!1,x)}if(!g){return g}if(n&&!n.isParent&&d.data.keep.leaf&&p===q.move.TYPE_INNER){return null}else{if(n&&(g.parentTId==n.tId&&p==q.move.TYPE_INNER||a(g,d).find("#"+n.tId).length>0)){return null}else{n||(n=null)}}j.canAsync(d,n)&&p===q.move.TYPE_INNER?o.asyncNode(d,n,x,w):w();return g};e.setEditable=function(g){d.edit.enable=g;return this.refresh()}});var l=o.cancelPreSelectedNode;o.cancelPreSelectedNode=function(e,n){for(var x=b.getRoot(e).curSelectedList,w=0,p=x.length;w<p;w++){if(!n||n===x[w]){if(o.removeTreeDom(e,x[w]),n){break}}}l&&l.apply(o,arguments)};var k=o.createNodes;o.createNodes=function(e,g,p,n){k&&k.apply(o,arguments);p&&o.repairParentChkClassWithSelf&&o.repairParentChkClassWithSelf(e,n)};var c=o.makeNodeUrl;o.makeNodeUrl=function(d,e){return d.edit.enable?null:c.apply(o,arguments)};var r=o.removeNode;o.removeNode=function(d,e){var g=b.getRoot(d);if(g.curEditNode===e){g.curEditNode=null}r&&r.apply(o,arguments)};var h=o.selectNode;o.selectNode=function(e,g,p){var n=b.getRoot(e);if(b.isSelectedNode(e,g)&&n.curEditNode==g&&g.editNameFlag){return !1}h&&h.apply(o,arguments);o.addHoverDom(e,g);return !0};var f=j.uCanDo;j.uCanDo=function(d,e){var g=b.getRoot(d);if(e&&(j.eqs(e.type,"mouseover")||j.eqs(e.type,"mouseout")||j.eqs(e.type,"mousedown")||j.eqs(e.type,"mouseup"))){return !0}if(g.curEditNode){o.editNodeBlur=!1,g.curEditInput.focus()}return !g.curEditNode&&(f?f.apply(o,arguments):!0)}})(jQuery);(function(v){v.extend(!0,v.fn.zTree._z,{view:{clearOldFirstNode:function(j,f){for(var d=f.getNextNode();d;){if(d.isFirstNode){d.isFirstNode=!1;x.setNodeLineIcos(j,d);break}if(d.isLastNode){break}d=d.getNextNode()}},clearOldLastNode:function(j,f){for(var d=f.getPreNode();d;){if(d.isLastNode){d.isLastNode=!1;x.setNodeLineIcos(j,d);break}if(d.isFirstNode){break}d=d.getPreNode()}},makeDOMNodeMainBefore:function(j,f,d){j.push("<li ",d.isHidden?"style='display:none;' ":"","id='",d.tId,"' class='",k.className.LEVEL,d.level,"' tabindex='0' hidefocus='true' treenode>")},showNode:function(f,d){d.isHidden=!1;w.initShowForExCheck(f,d);u(d,f).show()},showNodes:function(q,s,r){if(s&&s.length!=0){var p={},o,d;for(o=0,d=s.length;o<d;o++){var n=s[o];if(!p[n.parentTId]){var l=n.getParentNode();p[n.parentTId]=l===null?w.getRoot(q):n.getParentNode()}x.showNode(q,n,r)}for(var f in p){s=p[f][q.data.key.children],x.setFirstNodeForShow(q,s),x.setLastNodeForShow(q,s)}}},hideNode:function(f,d){d.isHidden=!0;d.isFirstNode=!1;d.isLastNode=!1;w.initHideForExCheck(f,d);x.cancelPreSelectedNode(f,d);u(d,f).hide()},hideNodes:function(q,s,r){if(s&&s.length!=0){var p={},o,d;for(o=0,d=s.length;o<d;o++){var n=s[o];if((n.isFirstNode||n.isLastNode)&&!p[n.parentTId]){var l=n.getParentNode();p[n.parentTId]=l===null?w.getRoot(q):n.getParentNode()}x.hideNode(q,n,r)}for(var f in p){s=p[f][q.data.key.children],x.setFirstNodeForHide(q,s),x.setLastNodeForHide(q,s)}}},setFirstNode:function(l,f){var d=l.data.key.children,j=f[d].length;j>0&&!f[d][0].isHidden?f[d][0].isFirstNode=!0:j>0&&x.setFirstNodeForHide(l,f[d])},setLastNode:function(l,f){var d=l.data.key.children,j=f[d].length;j>0&&!f[d][0].isHidden?f[d][j-1].isLastNode=!0:j>0&&x.setLastNodeForHide(l,f[d])},setFirstNodeForHide:function(n,f){var d,l,j;for(l=0,j=f.length;l<j;l++){d=f[l];if(d.isFirstNode){break}if(!d.isHidden&&!d.isFirstNode){d.isFirstNode=!0;x.setNodeLineIcos(n,d);break}else{d=null}}return d},setFirstNodeForShow:function(q,j){var d,p,n,o,l;for(p=0,n=j.length;p<n;p++){if(d=j[p],!o&&!d.isHidden&&d.isFirstNode){o=d;break}else{if(!o&&!d.isHidden&&!d.isFirstNode){d.isFirstNode=!0,o=d,x.setNodeLineIcos(q,d)}else{if(o&&d.isFirstNode){d.isFirstNode=!1;l=d;x.setNodeLineIcos(q,d);break}}}}return{"new":o,old:l}},setLastNodeForHide:function(l,f){var d,j;for(j=f.length-1;j>=0;j--){d=f[j];if(d.isLastNode){break}if(!d.isHidden&&!d.isLastNode){d.isLastNode=!0;x.setNodeLineIcos(l,d);break}else{d=null}}return d},setLastNodeForShow:function(p,j){var d,o,l,n;for(o=j.length-1;o>=0;o--){if(d=j[o],!l&&!d.isHidden&&d.isLastNode){l=d;break}else{if(!l&&!d.isHidden&&!d.isLastNode){d.isLastNode=!0,l=d,x.setNodeLineIcos(p,d)}else{if(l&&d.isLastNode){d.isLastNode=!1;n=d;x.setNodeLineIcos(p,d);break}}}}return{"new":l,old:n}}},data:{initHideForExCheck:function(f,d){if(d.isHidden&&f.check&&f.check.enable){if(typeof d._nocheck=="undefined"){d._nocheck=!!d.nocheck,d.nocheck=!0}d.check_Child_State=-1;x.repairParentChkClassWithSelf&&x.repairParentChkClassWithSelf(f,d)}},initShowForExCheck:function(j,f){if(!f.isHidden&&j.check&&j.check.enable){if(typeof f._nocheck!="undefined"){f.nocheck=f._nocheck,delete f._nocheck}if(x.setChkClass){var d=u(f,k.id.CHECK,j);x.setChkClass(j,d,f)}x.repairParentChkClassWithSelf&&x.repairParentChkClassWithSelf(j,f)}}}});var v=v.fn.zTree,h=v._z.tools,k=v.consts,x=v._z.view,w=v._z.data,u=h.$;w.addInitNode(function(j,f,d){if(typeof d.isHidden=="string"){d.isHidden=h.eqs(d.isHidden,"true")}d.isHidden=!!d.isHidden;w.initHideForExCheck(j,d)});w.addBeforeA(function(){});w.addZTreeTools(function(j,f){f.showNodes=function(n,l){x.showNodes(j,n,l)};f.showNode=function(n,l){n&&x.showNodes(j,[n],l)};f.hideNodes=function(n,l){x.hideNodes(j,n,l)};f.hideNode=function(n,l){n&&x.hideNodes(j,[n],l)};var d=f.checkNode;if(d){f.checkNode=function(p,o,n,l){(!p||!p.isHidden)&&d.apply(f,arguments)}}});var g=w.initNode;w.initNode=function(r,f,d,q,p,n,o){var l=(q?q:w.getRoot(r))[r.data.key.children];w.tmpHideFirstNode=x.setFirstNodeForHide(r,l);w.tmpHideLastNode=x.setLastNodeForHide(r,l);x.setNodeLineIcos(r,w.tmpHideFirstNode);x.setNodeLineIcos(r,w.tmpHideLastNode);p=w.tmpHideFirstNode===d;n=w.tmpHideLastNode===d;g&&g.apply(w,arguments);n&&x.clearOldLastNode(r,d)};var e=w.makeChkFlag;if(e){w.makeChkFlag=function(f,d){(!d||!d.isHidden)&&e.apply(w,arguments)}}var c=w.getTreeCheckedNodes;if(c){w.getTreeCheckedNodes=function(o,j,f,l){if(j&&j.length>0){var n=j[0].getParentNode();if(n&&n.isHidden){return[]}}return c.apply(w,arguments)}}var b=w.getTreeChangeCheckedNodes;if(b){w.getTreeChangeCheckedNodes=function(n,j,f){if(j&&j.length>0){var l=j[0].getParentNode();if(l&&l.isHidden){return[]}}return b.apply(w,arguments)}}var a=x.expandCollapseSonNode;if(a){x.expandCollapseSonNode=function(o,j,d,n,l){(!j||!j.isHidden)&&a.apply(x,arguments)}}var z=x.setSonNodeCheckBox;if(z){x.setSonNodeCheckBox=function(l,f,d,j){(!f||!f.isHidden)&&z.apply(x,arguments)}}var y=x.repairParentChkClassWithSelf;if(y){x.repairParentChkClassWithSelf=function(f,d){(!d||!d.isHidden)&&y.apply(x,arguments)}}})(jQuery);(function($){$.extend({metadata:{defaults:{type:"class",name:"metadata",cre:/({.*})/,single:"metadata"},setType:function(type,name){this.defaults.type=type;this.defaults.name=name},get:function(elem,opts){var settings=$.extend({},this.defaults,opts);if(!settings.single.length){settings.single="metadata"}var data=$.data(elem,settings.single);if(data){return data}data="{}";if(settings.type=="class"){var m=settings.cre.exec(elem.className);if(m){data=m[1]}}else{if(settings.type=="elem"){if(!elem.getElementsByTagName){return undefined}var e=elem.getElementsByTagName(settings.name);if(e.length){data=$.trim(e[0].innerHTML)}}else{if(elem.getAttribute!=undefined){var attr=elem.getAttribute(settings.name);if(attr){data=attr}}}}if(data.indexOf("{")<0){data="{"+data+"}"}data=eval("("+data+")");$.data(elem,settings.single,data);return data}}});$.fn.metadata=function(opts){return $.metadata.get(this[0],opts)}})(jQuery);
/*! nanoScrollerJS - v0.7.6 - 2013
* http://jamesflorentino.github.com/nanoScrollerJS/
* Copyright (c) 2013 James Florentino; Licensed MIT */
(function(g,q,C){var c,s,k,F,d,e,a,u,B,o,G,H,b,t,A,E,l,f,w,r,v,y,j,n,D,x,p,z,h;v={paneClass:"pane",sliderClass:"slider",contentClass:"content",iOSNativeScrolling:false,preventPageScrolling:false,disableResize:false,alwaysVisible:false,flashDelay:1500,sliderMinHeight:20,sliderMaxHeight:null,documentContext:null,windowContext:null};E="scrollbar";A="scroll";u="mousedown";B="mousemove";G="mousewheel";o="mouseup";t="resize";d="drag";f="up";b="panedown";k="DOMMouseScroll";F="down";w="wheel";e="keydown";a="keyup";l="touchmove";c=q.navigator.appName==="Microsoft Internet Explorer"&&/msie 7./i.test(q.navigator.appVersion)&&q.ActiveXObject;s=null;D=q.requestAnimationFrame;r=q.cancelAnimationFrame;p=C.createElement("div").style;h=(function(){var K,J,N,M,L,I;M=["t","webkitT","MozT","msT","OT"];for(K=L=0,I=M.length;L<I;K=++L){N=M[K];J=M[K]+"ransform";if(J in p){return M[K].substr(0,M[K].length-1)}}return false})();z=function(I){if(h===false){return false}if(h===""){return I}return h+I.charAt(0).toUpperCase()+I.substr(1)};x=z("transform");j=x!==false;y=function(){var I,K,J;I=C.createElement("div");K=I.style;K.position="absolute";K.width="100px";K.height="100px";K.overflow=A;K.top="-9999px";C.body.appendChild(I);J=I.offsetWidth-I.clientWidth;C.body.removeChild(I);return J};n=function(){var K,J,I;J=q.navigator.userAgent;K=/(?=.+Mac OS X)(?=.+Firefox)/.test(J);if(!K){return false}I=/Firefox\/\d{2}\./.exec(J);if(I){I=I[0].replace(/\D+/g,"")}return K&&+I>23};H=(function(){function I(K,J){this.el=K;this.options=J;s||(s=y());this.$el=g(this.el);this.doc=g(this.options.documentContext||C);this.win=g(this.options.windowContext||q);this.$content=this.$el.children("."+J.contentClass);this.$content.attr("tabindex",this.options.tabIndex||0);this.content=this.$content[0];if(this.options.iOSNativeScrolling&&(this.el.style.WebkitOverflowScrolling!=null)){this.nativeScrolling()}else{this.generate()}this.createEvents();this.addEvents();this.reset()}I.prototype.preventScrolling=function(K,J){if(!this.isActive){return}if(K.type===k){if(J===F&&K.originalEvent.detail>0||J===f&&K.originalEvent.detail<0){K.preventDefault()}}else{if(K.type===G){if(!K.originalEvent||!K.originalEvent.wheelDelta){return}if(J===F&&K.originalEvent.wheelDelta<0||J===f&&K.originalEvent.wheelDelta>0){K.preventDefault()}}}};I.prototype.nativeScrolling=function(){this.$content.css({WebkitOverflowScrolling:"touch"});this.iOSNativeScrolling=true;this.isActive=true};I.prototype.updateScrollValues=function(){var J;J=this.content;this.maxScrollTop=J.scrollHeight-J.clientHeight;this.prevScrollTop=this.contentScrollTop||0;this.contentScrollTop=J.scrollTop;if(!this.iOSNativeScrolling){this.maxSliderTop=this.paneHeight-this.sliderHeight;this.sliderTop=this.maxScrollTop===0?0:this.contentScrollTop*this.maxSliderTop/this.maxScrollTop}};I.prototype.setOnScrollStyles=function(){var J,K=this;if(j){J={};J[x]="translate(0, "+this.sliderTop+"px)"}else{J={top:this.sliderTop}}if(D){if(!this.scrollRAF){this.scrollRAF=D(function(){K.scrollRAF=null;K.slider.css(J)})}}else{this.slider.css(J)}};I.prototype.createEvents=function(){var J=this;this.events={down:function(K){J.isBeingDragged=true;J.offsetY=K.pageY-J.slider.offset().top;J.pane.addClass("active");J.doc.bind(B,J.events[d]).bind(o,J.events[f]);return false},drag:function(K){J.sliderY=K.pageY-J.$el.offset().top-J.offsetY;J.scroll();if(J.contentScrollTop>=J.maxScrollTop&&J.prevScrollTop!==J.maxScrollTop){J.$el.trigger("scrollend")}else{if(J.contentScrollTop===0&&J.prevScrollTop!==0){J.$el.trigger("scrolltop")}}return false},up:function(K){J.isBeingDragged=false;J.pane.removeClass("active");J.doc.unbind(B,J.events[d]).unbind(o,J.events[f]);return false},resize:function(K){J.reset()},panedown:function(K){J.sliderY=(K.offsetY||K.originalEvent.layerY)-(J.sliderHeight*0.5);J.scroll();J.events.down(K);return false},scroll:function(K){J.updateScrollValues();if(J.isBeingDragged){return}if(!J.iOSNativeScrolling){J.sliderY=J.sliderTop;J.setOnScrollStyles()}if(K==null){return}if(J.contentScrollTop>=J.maxScrollTop){if(J.options.preventPageScrolling){J.preventScrolling(K,F)}if(J.prevScrollTop!==J.maxScrollTop){J.$el.trigger("scrollend")}}else{if(J.contentScrollTop===0){if(J.options.preventPageScrolling){J.preventScrolling(K,f)}if(J.prevScrollTop!==0){J.$el.trigger("scrolltop")}}}},wheel:function(K){var L;if(K==null){return}L=K.delta||K.wheelDelta||(K.originalEvent&&K.originalEvent.wheelDelta)||-K.detail||(K.originalEvent&&-K.originalEvent.detail);if(L){J.sliderY+=-L/3}J.scroll();return false}}};I.prototype.addEvents=function(){var K;this.removeEvents();K=this.events;if(!this.options.disableResize){this.win.bind(t,K[t])}if(!this.iOSNativeScrolling){this.slider.bind(u,K[F]);this.pane.bind(u,K[b]).bind(""+G+" "+k,K[w])}var L=K[A],J=g.browser.version;if(parseInt(g.browser.version)>9){L=function(M){setTimeout(function(){K[A](M)},0)}}this.$content.bind(""+A+" "+G+" "+k+" "+l,L)};I.prototype.removeEvents=function(){var J;J=this.events;this.win.unbind(t,J[t]);if(!this.iOSNativeScrolling){this.slider.unbind();this.pane.unbind()}this.$content.unbind(""+A+" "+G+" "+k+" "+l,J[A])};I.prototype.generate=function(){var L,M,N,K,J,O;K=this.options;J=K.paneClass,O=K.sliderClass,L=K.contentClass;if(!this.$el.find("."+J).length&&!this.$el.find("."+O).length){this.$el.append('<div class="'+J+'"><div class="'+O+'" /></div>')}this.pane=this.$el.children("."+J);this.slider=this.pane.find("."+O);if(s===0&&n()){N=q.getComputedStyle(this.content,null).getPropertyValue("padding-right").replace(/\D+/g,"");M={right:-14,paddingRight:+N+14}}else{if(s){M={right:-s};this.$el.addClass("has-scrollbar")}}if(M!=null){this.$content.css(M)}return this};I.prototype.restore=function(){this.stopped=false;if(!this.iOSNativeScrolling){this.pane.show()}this.addEvents()};I.prototype.reset=function(){var P,R,S,K,L,J,N,M,Q,O;if(this.iOSNativeScrolling){this.contentHeight=this.content.scrollHeight;return}if(!this.$el.find("."+this.options.paneClass).length){this.generate().stop()}if(this.stopped){this.restore()}P=this.content;S=P.style;K=S.overflowY;if(c){this.$content.css({height:this.$content.height()})}R=P.scrollHeight+s;Q=parseInt(this.$el.css("max-height"),10);if(Q>0){this.$el.height("");this.$el.height(P.scrollHeight>Q?Q:P.scrollHeight)}J=this.pane.outerHeight(false);M=parseInt(this.pane.css("top"),10);L=parseInt(this.pane.css("bottom"),10);N=J+M+L;O=Math.round(N/R*N);if(O<this.options.sliderMinHeight){O=this.options.sliderMinHeight}else{if((this.options.sliderMaxHeight!=null)&&O>this.options.sliderMaxHeight){O=this.options.sliderMaxHeight}}if(K===A&&S.overflowX!==A){O+=s}this.maxSliderTop=N-O;this.contentHeight=R;this.paneHeight=J;this.paneOuterHeight=N;this.sliderHeight=O;this.slider.height(O);this.events.scroll();this.pane.show();this.isActive=true;if((P.scrollHeight===P.clientHeight)||(this.pane.outerHeight(true)>=P.scrollHeight&&K!==A)){this.pane.hide();this.isActive=false}else{if(this.el.clientHeight===P.scrollHeight&&K===A){this.slider.hide()}else{this.slider.show()}}this.pane.css({opacity:(this.options.alwaysVisible?1:""),visibility:(this.options.alwaysVisible?"visible":"")});return this};I.prototype.scroll=function(){if(!this.isActive){return}this.sliderY=Math.max(0,this.sliderY);this.sliderY=Math.min(this.maxSliderTop,this.sliderY);this.$content.scrollTop((this.paneHeight-this.contentHeight+s)*this.sliderY/this.maxSliderTop*-1);if(!this.iOSNativeScrolling){this.updateScrollValues();this.setOnScrollStyles()}return this};I.prototype.scrollBottom=function(J){if(!this.isActive){return}this.reset();this.$content.scrollTop(this.contentHeight-this.$content.height()-J).trigger(G);return this};I.prototype.scrollTop=function(J){if(!this.isActive){return}this.reset();this.$content.scrollTop(+J).trigger(G);return this};I.prototype.scrollTo=function(J){if(!this.isActive){return}this.reset();this.scrollTop(this.$el.find(J).get(0).offsetTop);return this};I.prototype.stop=function(){if(r&&this.scrollRAF){r(this.scrollRAF);this.scrollRAF=null}this.stopped=true;this.removeEvents();if(!this.iOSNativeScrolling){this.pane.hide()}return this};I.prototype.destroy=function(){if(!this.stopped){this.stop()}if(!this.iOSNativeScrolling&&this.pane.length){this.pane.remove()}if(c){this.$content.height("")}this.$content.removeAttr("tabindex");if(this.$el.hasClass("has-scrollbar")){this.$el.removeClass("has-scrollbar");this.$content.css({right:""})}return this};I.prototype.flash=function(){var J=this;if(this.iOSNativeScrolling){return}if(!this.isActive){return}this.reset();this.pane.addClass("flashed");setTimeout(function(){J.pane.removeClass("flashed")},this.options.flashDelay);return this};return I})();g.fn.nanoScroller=function(I){return this.each(function(){var J,K;if(!(K=this.nanoscroller)){J=g.extend({},v,I);this.nanoscroller=K=new H(this,J)}if(I&&typeof I==="object"){g.extend(K.options,I);if(I.scrollBottom!=null){return K.scrollBottom(I.scrollBottom)}if(I.scrollTop!=null){return K.scrollTop(I.scrollTop)}if(I.scrollTo){return K.scrollTo(I.scrollTo)}if(I.scroll==="bottom"){return K.scrollBottom(0)}if(I.scroll==="top"){return K.scrollTop(0)}if(I.scroll&&I.scroll instanceof g){return K.scrollTo(I.scroll)}if(I.stop){return K.stop()}if(I.destroy){return K.destroy()}if(I.flash){return K.flash()}}return K.reset()})};g.fn.nanoScroller.Constructor=H})(jQuery,window,document);(function(){$.isJalorDom=function(d){try{return d instanceof Element}catch(c){return false}};$.create=function(c,d,g,e){var f=$(document.createElement(c));d&&f.addClass(d);g&&f.id(g);e&&f.attr("type",e);return f};$.getEventTarget=function(g,c){var f=$(g.target||g.srcElement);if(c&&!c(f)){var d=f.parent();while(d.length&&g.delegateTarget!=d[0]){if(c(d)){return d}else{d=d.parent()}}}return f};$.fn.id=function(c){if(c!==void 0){this.attr("id",c);return this}else{return this.attr("id")}};$.fn.fixedPosition=function(){var c=this[0];return{top:c.offsetTop,left:c.offsetLeft}};$.fn.getOffsetInf=function(){var c=this.offset();c.height=this.outerHeight();c.width=this.outerWidth();c.right=c.width+c.left;c.bottom=c.height+c.top;return c};$.newGuid=function(d,c){return(d||"")+Math.floor(Math.random()*Math.pow(10,c||8))};$.fn.dataValue=function(d){if(d!==void 0){this.data("value",d);return this}else{var c=this.attr("valueType"),d=this.data("value");if(c=="array"){return d?d.split(Jalor.Config.Format.valueSplit):null}return d||""}};$.fn.getValue=function(){var c=this.data("value");return c==null?this.val():c};$.fn.cacheSet=function(e,c){var d=e[c];delete e[c];return this.data(c,d)};$.fn.isVisiable=function(){return this.css("display")!=="none"&&this.length&&this[0].offsetWidth>0&&this[0].offsetHeight>0};Jalor.UI.popup=function(d,l,h,f,e,c,n){l=$(l);if(!l.hasClass("jalor-popup")){l.addClass("jalor-popup")}d=$(d);if(!d.length){return}var g;if(e=="fixed"){g=d.fixedPosition()}else{if(e=="position"){g=d.position();var k=d.parents(".jalor-dialog-body:first");if(k.length>0){g.left+=k.scrollLeft();g.top+=k.scrollTop()}}else{if(e===true||l.hasClass("calendar")){if(n){b++;l.data("_popnum",true).show();Jalor.UI.checkPopuperPosition(d,l);d.parents(".jalor-popup").addClass("jalor-popup-lock");return}else{g=d.offset()}}else{if(d.parent().hasClass("gt-editor-container")){var k=d.parents(".jalor-dialog:first");if(k.length>0){var j=k.position();g=d.offset();g.left-=j.left;g.top-=j.top}else{g=d.offset()}}else{if(d.parents(".jalor-dialog:first").length>0){g=d.fixedPosition()}else{g=d.position()}}}}}g||(g={left:0,top:0});if(h){if(h.left){g.left=h.left+g.left>0?h.left+g.left:0}if(h.top){g.top=h.top+g.top>0?h.top+g.top:0}}l.css(g);if(f!==false){l.show();d.parents(".jalor-popup").addClass("jalor-popup-lock")}return l};var b=0;$(document.body).bind("mousewheel",function(){var c=Jalor.Page.getContentPanel().children("#popupPanel").children(".jalor-popup:visible");if(b){c.filter(":not(.jalor-popup-lock)").each(function(){Jalor.UI.popupClose($(this))});b=c.filter(":visible").length}$("#jalor_calendar_div:visible").each(function(){if(!$("#timeZone_calendar_ddl:visible").length){Jalor.UI.popupClose($(this))}})});Jalor.UI.getPopupPanel=function(){var c=$("#popupPanel");if(c.length){return c}return $.create("div",null,"popupPanel").appendTo(Jalor.Page.getContentPanel())};Jalor.UI.bindPopupClose=function(d,c,e){d.blur(function(f){if(!c.data("_open")){Jalor.UI.popupClose(c);if(c.attr("id")=="timeZone_calendar_ddl"){Jalor.UI.popupClose($("#jalor_calendar_div"))}}});if(!c.data("_popupBinded")){c.data("_popupBinded",true);this.bindPopupHover(c,function(f){f.data("_active",true)},function(f){f.data("_active",null)});c.bind("focusin",function(){$(this).data("_open",true)}).focusout(function(){setTimeout(function(){c.data("_open",null);if(!c.data("_active")&&!d.is(":focus")){c.data("_active",null);Jalor.UI.popupClose(c);Jalor.UI.popupClose($("#jalor_calendar_div"))}},e||100)})}};Jalor.UI.popupClose=function(d,c){if(c||!d.data("_inpop")){var e,g=d.data("callerId");if(g){e=$("#"+g);e.length&&e.parents(".jalor-popup").removeClass("jalor-popup-lock")}if(d.attr("id")=="jalor_calendar_div"&&d.hasClass("jalor-popup-lock")){return}d.hide().removeData("_open").removeData("_callInput");return true}else{if(!d.data("_open")){var f=d.data("_callInput");f&&!f.attr("disabled")&&f.focus()}}};$.fn.__remove=$.fn.remove;$.fn.remove=function(){if(this.length){this.find("[_des]").trigger("elemDestory");this.attr("_des")&&this.trigger("elemDestory")}return this.__remove.apply(this,arguments)};$.fn.__empty=$.fn.empty;$.fn.empty=function(){if(this.length){this.find("[_des]").trigger("elemDestory");this.attr("_des")&&this.trigger("elemDestory")}return this.__empty.apply(this,arguments)};$.fn.__html=$.fn.html;$.fn.html=function(e){if(e===void 0){return $(this).__html()}var h=Jalor.Config.HtmlRegular.css,f=Jalor.Config.HtmlRegular.cssUrl;var g=this;var d=[];if(e&&typeof e==="string"){e=e.replace(h,function(k,j,n,l){if(k){k=k.match(f);if(k&&k[2]){d.push({url:k[2]})}else{l&&d.push({text:l})}return""}return k})}var c=$(this).__html(e);if(d.length){$.each(d,function(l,o){if(o.url){var n=document.createElement("link");var j=Jalor.Config.Global.appVersion,k=o.url;if(k.indexOf("http://")!=0&&k.indexOf("https://")!=0&&k.indexOf("/")!=0&&k.indexOf("../")!=0){k=Jalor.Static.getStaticUrl(k)}n.setAttribute("href",[k,j?"?version="+j:""].join(""));n.setAttribute("rel","stylesheet");n.setAttribute("type","text/css");$(g).get(0).appendChild(n)}else{if(o.text){$(g).append(['<style type="text/css">',o.text,"</style>"].join(""))}}})}return c};$.fn.__show=$.fn.show;$.fn.show=function(){var c=this.__show.apply(this,arguments);this.each(function(){$(this).find("div.jalor-igrid").each(function(){var d=$(this).manager();d.autoWhiteWidth&&d.autoWhiteWidth();var e=d.op;if(e&&e.lazyLoad==true&&e._scrollOp){d.getBodyPanel().scrollTop(e._lasyLoadScrollTop)}})});return c};$.fn.__hide=$.fn.hide;$.fn.hide=function(){this.each(function(){$(this).find("div.jalor-igrid:visible").each(function(){var c=$(this).manager(),d=c.op;if(d&&d.lazyLoad==true&&d._scrollOp){d.lazyLoad==true&&d._scrollOp&&(d._lasyLoadScrollTop=c.getBodyPanel().scrollTop())}})});return this.__hide.apply(this,arguments)};$.fn.bindDestory=function(c){this.attr("_des","1").bind("elemDestory",c)};Jalor.UI.bindPopupHover=function(c,d,e){c.mouseenter(function(){var f=$(this);f.data("_inpop",true);d&&d(f)}).mouseleave(function(){var f=$(this).data("_inpop",null);e&&e(c)})};Jalor.UI.checkPopuperPosition=function(e,n){var k=$(window),o=k.width(),p=k.height(),h=k.scrollLeft(),d=k.scrollTop(),j=e.offset(),f=e.outerHeight(),c=n.outerWidth(),q=n.outerHeight(),l={},g=(n.attr("id")=="timeZone_calendar_ddl"&&e.attr("id")=="timeZone_calendar");if(j.top+q+f-d>p){l.top=j.top-q}else{l.top=j.top+f}if(j.left+c-h>o){l.left=o-c}else{l.left=j.left}l.top<d&&(l.top=j.top+f);l.left<h&&(l.left=j.left);if(g){l.left-=1;$("#timeZone_calendar_ddl").css("z-index","9000")}n.css(l)};Jalor.UI.getModalPosition=function(c){var d=c.parents("div.jalor-dialog:first");if(d.length){return d.position()}};Jalor.UI.delayEvent=function(e,g,d,h,c){var f=true;e.bind(g,function(l){var k=$(this);if(f){var j=c?c(l,k):true;if(j){f=false;setTimeout(function(){d.call(k,l);f=true},h||1000)}}})};Jalor.UI.delayEvent2=function(e,f,d,g,c){e.bind(f,function(l){if(l.keyCode!=16){var k=$(this);if(l.keyCode==86&&this.value==k.data("prevalue")){return}k.data("prevalue",this.value);var j=parseInt(Math.random()*1000000);k.data("round",j);var h=c?c(l,k):true;if(h){k.data("INPUTING",1);setTimeout(function(){if(k.data("round")==j){k.removeData("INPUTING"),d.call(k,l)}},g||1000)}}})};Jalor.UI.setInputFocus=function(f,c,j){if(document.activeElement.tagName.toLowerCase()=="input"&&document.activeElement!=f[0]&&$(document.activeElement).hasClass("jalor-dropdown")){return}if(f.isVisiable()){var e=f.val().length;if(e){var h=f[0],d=Jalor.DataHelper.hasValue(c);if(!d||e<c){c=e}if(h.setSelectionRange){!d&&setTimeout(function(){f.focus()});h.setSelectionRange(c,c);j&&f.select()}else{setTimeout(function(){f.focus()});var g=h.createTextRange();if(j){g.moveStart("character",0);g.moveEnd("character",c)}else{g.moveStart("character",c);g.collapse(true)}g.select()}}else{setTimeout(function(){f.focus()})}}};Jalor.UI.getInputFocus=function(c,g){var h=0,f=c[0]||c;if(f==document.activeElement||g){if(document.selection){var e=document.selection.createRange();if(f.tagName=="INPUT"){e.moveStart("character",-f.value.length);h=e.text.length}else{if(e.text.length){h=f.value.indexOf(e.text)}else{f.select();var d=document.selection.createRange();e.setEndPoint("StartToStart",d);h=e.text.length;e.collapse(false);e.select()}}}else{if(f.selectionStart||f.selectionStart=="0"){h=f.selectionStart}}}return h};Jalor.UI.matchText=function(h,j,f,e,d,c,g){h=(h+"").toLowerCase();if(e){h=e+h+e}$(j).each(function(){var n=$(this),l=d?n.attr(d):n.text();l=l.toLowerCase();if(e){l=e+l+e}var k=c?c(l,n):((d||g)?h.indexOf(l)>-1:l.indexOf(h)>-1);if(f(k,n,l)===false){return false}})};Jalor.UI.ajax=function(c,e){var d=$.extend({type:"GET"},c);if(d.loading==void 0&&d.type=="GET"){d.loading=true}if(d.type=="GET"&&e&&$(e).data("_cacheRequest")){Jalor.UI.ajax.getLastRequest($(e),d.url,d.data)}Jalor.Core.ajax(d,d.loading=="ui"?e:null)};Jalor.UI.ajax.openCacheRequest=function(c){c.data("_cacheRequest",1)};Jalor.UI.ajax.getLastRequest=function(d,c,e){if(c!=void 0){return d.data("_url",c).data("_param",e)}else{var c=d.data("_url");if(c){return{url:c,param:d.data("_param")}}return null}};Jalor.UI.ajax.setFnSuccess=function(e,c,d){if(c){var f=e.success;e.success=function(g){d&&c(g);f&&f(g);d||c(g)}}else{e.fnSuccess=e.success;e.success=null}};Jalor.UI.isKeyDownValue=function(g,d){var f=g.keyCode,c=(f>47&&f<106)||f==8||f==46||f==32||f==13;if(d!==false){c=c||f>=187&&f<=191||f>=219&&f<=222}return c};Jalor.UI.getValueText=function(d,k){if(k.sortBy){Jalor.DataHelper.sort(k.sortBy,"asc",d)}var g="",j="";if($.isArray(d)){var f=new Array(),c=new Array();for(var e=0,h=d[0];h;e++,h=d[e]){c.push(h[k.valueField]);f.push(h[k.displayField])}g=c.join(k.valueSplit);j=f.join(k.multiSplit)}else{g=d[k.valueField];j=d[k.displayField]}return{value:g,text:j}},Jalor.UI._manager={};Jalor.UI.Manager=function(){};Jalor.UI.Manager.prototype={setValue:function(e){if(this.ctr.length>0){var c=this.ctr[0].tagName;if(c=="INPUT"||c=="SELECT"||c=="TEXTAREA"){var d=this.ctr.attr("type");if(d=="checkbox"||d=="radio"){e?this.ctr.attr("checked","checked"):this.ctr.removeAttr("checked")}else{this.ctr.val(e)}}else{this.ctr.text(e)}}return this},getValue:function(){if(this.ctr.length>0){var e,c=this.ctr[0].tagName;if(c=="INPUT"||c=="SELECT"||c=="TEXTAREA"){var d=this.ctr.attr("type");if(d=="checkbox"||d=="radio"){return this.ctr.attr("checked")?true:false}else{e=this.ctr.getValue();return e!=null?e+"":""}}else{return this.ctr.text()}}return""},disabled:function(c){if(c){this.ctr.removeAttr("disabled")}else{this.ctr.attr("disabled","disabled")}return this},hide:function(c){c?this.ctr.show():this.ctr.hide();return this},readonly:function(c){if(c){this.ctr.removeAttr("readonly")}else{this.ctr.attr("readonly","readonly")}return this}};Jalor.UI._baseManager=new Jalor.UI.Manager();Jalor.UI.regManager=function(c,d){Jalor.UI._manager[c]=$.isFunction(d)?d:$.extend(new Jalor.UI.Manager(),d)};$.fn.managerReg=function(c,e){if(e){this.data("ui-manager",c)}else{var d=$.inArray(this[0].nodeName,["INPUT","SELECT","TEXTAREA"]);if(d==-1&&!this.data("ui-manager")){this.data("ui-manager",c)}}return this};$.fn.manager=function(c){if(!c){c=this.data("ui-manager")}var d;if(c){d=Jalor.UI._manager[c]}if(!d){d=Jalor.UI._baseManager}if($.isFunction(d)){return d(this)}else{d.ctr=this;return d}};var a=$.IObject({init:function(c,d){this.dom=c;if(d){this._baseInit(d)}else{this.op=c.data(this.ctrType+"_op")}this.id=c.id()},_baseInit:function(c){this.op=c;this.dom.data(this.ctrType+"_op",c);this._manager&&this.dom.managerReg(this.ctrType)}});$.IControl=function(c,f,e){e||e!==false&&(e=true);f.ctrType=c;f._manager=e;var d=$.IObject(f,a);e&&Jalor.UI.regManager(c,function(g){return new d(g)});return d};$.fn.getConfig=function(d){d||(d="conf");var c=this.metadata({type:"",name:d,single:d});return $.isEmptyObject(c)?null:c};Jalor.UI.HtmlHelper={getConf:function(e,c,d){return d?e.getConfig(c):e.attr(c)},_getAttr:function(j,e,d){var g,h,c=e.substr(0,1);if(c=="#"){g=e.substring(1);h=true}else{g=e}var f=this.getConf(j,g,h);if(f){d&&j.removeAttr(g);h&&(f._json=true)}return{name:g,attr:f}},getAttr:function(j,f,d,k){if($.type(f)=="array"){var e=k||{};for(var g=0,c;c=f[g];g++){if(c){var h=this._getAttr(j,c,d);h.attr&&(e[h.name]=h.attr)}}return e}else{var h=this._getAttr(j,c,d);if(k){h.attr&&(k[h.name]=h.attr);return k}else{return h.attr}}},toAttrStr:function(d){var c=[];$.each(d,function(f,e){c.push(" ",f,'="',e,'"')});return c.join("")},formatAttr:function(c){$.each(c,function(e,d){d._json&&(delete d._json)&&(c[e]=Jalor.UI.HtmlHelper.toAttrStr(d))})}}})();(function(c){var d={init:function(f,h){if(f.length>0){h=this.initOp(h);f.managerReg(this.type);var g=new this.xCtr(f,h);this.initCtr(g,h)}},initOp:function(h){var g=this.config;if(g&&typeof g=="function"){this.config=g()}var f=$.extend(true,{},this.config.op||this.config);h&&Jalor.DataHelper.applyChangeData(f,h);return f},initHandler:function(g){var f=g.handler=$.extend(g.handler,{initComplete:$.Callbacks(),complete:$.Callbacks()});if(this.dataCtr){(g.ajax||g.request)&&(f.beforeRequest=$.Callbacks());$.extend(f,{beforeBindData:$.Callbacks(),dataProcess:$.IHandler(),afterBindData:$.Callbacks()})}},initCtr:function(g,f){this.initHandler(f);f._initing=true;this.runFlow("preInit",g,f);this.plugin.fireAll("preInit",g,f);if(this.dataCtr&&!f._reIniting){f.Storage=Jalor.Storage.create(f.storageOp,this.dataCtr);f.Storage.Cache&&(f._cache=true);if(f.dataset){f.Storage.store(f.dataset);delete f.dataset}}f.fnInit&&f.fnInit.call(g,f);this.runFlow("init",g,f).runFlow("build",g,f);this.plugin.fireAll("build",g,f);this.runFlow("bindEvent",g,f);f.handler.initComplete.fire(g,f);f.fnInitComplete&&f.fnInitComplete.call(g,f);this.runFlow("initComplete",g,f);this.checkRequest(g,f)},runFlow:function(g,l,k,h,f){var j=this.flow[g];j&&j.call(this,l,k,h,f);return this},checkRequest:function(h,g){if(g.loadOp){this.checkLoad(h,g)}else{if(this.dataCtr){if(g.ajax){var f=this;g._reIniting||(g._ajax=g.ajax);g.ajax=$.extend(true,{},g._ajax);Jalor.UI.ajax.setFnSuccess(g.ajax,function(j){g._requesting=true;f.bindData(h,g,j||{});delete g._requesting});this.runFlow("initAjax",h,g,g.ajax)}else{if(g.request){this.runFlow("initAjax",h,g)}}if(g.autoLoad!==false){if(g.Storage.len()){this.bindData(h,g);return}else{if(g.ajax||g.request){this.request(h,g);return}else{this.bindData(h,g)}}}else{if(g.Storage.len()){this.bindData(h,g);return}}}this.complete(h,g)}},request:function(g,f){if(f.handler.beforeRequest.fire(g,f)!==false){if(!f.fnBeforeRequest||f.fnBeforeRequest.call(g,f)!==false){f.fnRequest?f.fnRequest(g,f):Jalor.UI.ajax(f.ajax)}}},bindData:function(l,k,g){var f,j;if(g!=null){f=g.pageVO||(k.pagerOp&&k.pagerOp.pageInf);j=g.result||g;k.Storage.store(j,f)}else{j=k.Storage.store()}this.runFlow("preBindData",l,k,j,f);k.handler.beforeBindData.fire(l,k,j,f);k.fnBeforeBindData&&k.fnBeforeBindData.call(l,k,j,f);var h=k.handler.dataProcess.length?k.handler.dataProcess.fireWithResult(j,k,l):j;this.runFlow("bindData",l,k,h);k.handler.afterBindData.fire(l,k);k.fnDataBindComplete&&k.fnDataBindComplete.call(l);this.runFlow("bindDataComplete",l,k).complete(l,k)},checkLoad:function(h,g){if(g.loadOp.content){g.loadOp.container.html(content);this.load(h,g)}else{if(g.loadOp.url){var f=function(){this.load(h,g)};g.loadOp.container.jalorLoad(g.loadOp.url,f,g.noscroll,g.error)}}},load:function(g,f){f.loadOp.success(g,f);this.complete(g,f)},complete:function(g,f){if(f._initing){f.handler.complete.fire(g,f);f.fnComplete&&f.fnComplete.call(g);this.runFlow("complete",g,f);delete f._initing;g.dom.data("xctrInited",true)}}};var b=c.XControl=function(k,g,h,j,f){if(typeof(k)=="string"){var l=e(k,j);h||(h={});Jalor.UI.Config[k]=h;var n=c.XControl[k]=$.IObject({type:k,config:h,flow:g,xCtr:l,dataCtr:f,plugin:$.IAdapter()},d);return n}};b.addPlugin=function(g,f,h){c.XControl[g].fn.plugin.add(f,h)};b.getPlugin=function(f){return c.XControl[f].fn.plugin};b.extendIManager=function(f,g){$.extend(b.getIManager(f),g)};b.getIManager=function(f){return c.XControl[f].fn.xCtr.fn};b.isInited=function(f){return f.data("xctrInited")};var a={init:function(f,g){this.dom=f;if(g){this._baseInit(g)}else{this.op=f.data(this.type+"_op")}this.id=f.id()},setOp:function(f){this.op=f;this.dom.data(this.type+"_op",f)},_baseInit:function(f){this.setOp(f);this._manager&&this.dom.managerReg(this.type)},setValue:function(f){this.dom.val(f)},getValue:function(){var f=this.dom.getValue();return f!=null?f+"":""},disabled:function(f){if(f){this.dom.removeAttr("disabled")}else{this.dom.attr("disabled","disabled")}},hide:function(f){f?this.dom.show():this.dom.hide()},readonly:function(f){if(f){this.dom.removeAttr("readonly")}else{this.dom.attr("readonly","readonly")}},valid:function(){return this.dom.valid()},setDefaultValue:function(f){this.dom[0].defaultValue=f;return this},reset:function(){this.dom.setValue(this.dom[0].defaultValue);return this},reInit:function(j){if(this.type){var h=c.XControl[this.type],f,g;if(h){g=this.dom;j._reIniting=true;DomClass.clear(this);f=new h(g,j);j._reIniting=true;return g.manager()}}return this},remove:function(){this.dom.remove();return this},reload:function(f){if(this.type){var g=c.XControl[this.type];if(g){if(f===true){g.fn.request(this,this.op)}else{g.fn.bindData(this,this.op,f)}}}return this},request:function(f){if(this.type){var h=c.XControl[this.type],g=this.op;if(h){if(f){if(g.ajax.params!=null){f=$.extend(true,{},g.ajax.params,f)}g.ajax.data=f}h.fn.request(this,g)}}return this}};var e=function(g,f){f||(f={});f.type=g;var h=$.IObject(f,a);Jalor.UI.regManager(g,function(j){return new h(j)});return h};c.getCtrHandler=function(g,f){return g.data(f)};c.setCtrHandler=function(h,f,g){h.data(f,g)};c.fireCtrHandler=function(h,f,j){var g=c.getCtrHandler(h,f);if(g){g.call(h,j)}}})(Jalor.UI);function htmlEncode(a,b){if(a&&typeof a=="string"){a=a.replace(/&/g,"&#38;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,'"');b&&(a=a.replace(/\s{2,}/g,function(c){return c.substring(0,c.length-1).replace(/\s/g,"&nbsp;")+" "}))}return a}function varEncode(a,b){if(a&&typeof a=="string"){a=a.replace(/&/g,"&#38;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/\]/g,"&#93;").replace(/\[/g,"&#91;");if(b===1){return a}b&&(a=a.replace(/\s{2,}/g,function(c){return c.substring(0,c.length-1).replace(/\s/g,"&nbsp;")+" "}))}return a}function tmplValue(b,a,c){if(b!==void 0){if($.isPlainObject(b)&&!$.isEmptyObject(b)){return Jalor.DataHelper.toJsonStr(b)}else{if($.isJalorDom(b)){return""}}return a>0?(a==1?htmlEncode(b,c):varEncode(b,c)):b}return""}Jalor.UI.template=function(f,b,h,j,d,c){if(f){if(j&&this[j]){f=this[j]}else{if(typeof(f)=="object"){f=f.html()}if(j){this[j]=f}}if(f){f=f.replace(/\r|\n/g,"").replace(/("|\\)/g,"\\$1").replace(/\<\%([\s\S]*?)\%\>/g,'");\n $1 _s.push("').replace(/\${([\s\S]*?)}/g,function(o,k){var l=k.substr(0,1),n=1;if(l=="#"){n=0}else{if(l=="&"){n=2}}return'"); try{_s.push(tmplValue('+(n==1?k:k.substring(1))+","+n+","+c+'))}catch(e){Jalor.Core.log(e && e.message);};_s.push("'});var e=[],g=[],a;for(a in b){e.push(a);g.push(b[a])}if(d){for(a in d){e.push(a);g.push(d[a])}}e.push("index");g.push(h||1);return(new Function(e,'var _s=[];_s.push("'+f+'"); return _s;')).apply(null,g).join("")}else{return""}}};Jalor.UI.multiTmplList=function(h,d,a,k,l){if(h&&d){if(typeof(h)=="object"){h=h.html()}if(!a){a="datas"}var b=[],c=[],f=["\n return ["],e=h.length-1;$.each(h,function(p,o){if(o){var q="_s"+p;c.push(q,'.push("',o.replace(/\r|\n/g,"").replace(/("|\\)/g,"\\$1").replace(/<\%/g,'");\n').replace(/\%>/g,q+'.push("').replace(/\${#([\s\S]*?)\}/g,'",tmplValue($1),"').replace(/\${([\s\S]*?)\}/g,'",tmplValue($1,1),"'),'");');b.push(q+"=[]");f.push(p==0?q:","+q,".join('')")}});h="var "+b.join(",")+";for (var i=0,data="+a+"[0]; data; i ++,index++,data ="+a+"[i]) { with(data){"+c.join("")+"}};"+f.join("")+"]";var g=["datas","index"],j=[d,k||1];return(new Function(g,h)).apply(null,j)}else{return""}};Jalor.UI.tmplList=function(c,a,e,g,f,d,h){if(c&&a){if(typeof(c)=="object"){c=c.html()}if(!e){e="datas"}c="<%for (var i=0,data; data ="+e+"[i]; i ++,index++) { with(data){ %>"+c+"<% }}; %>";var b={};b[e]=a;return Jalor.UI.template(c,b,g,f,d,h)}else{return""}};(function(b){b.fn.jalorTemplate=function(e,c){e=b.extend({tmpl:null,key:null,insertPosition:null,ajax:null},e);if(e.tmpl){var d=this;if(c){a.build(d,e,c)}else{if(e.ajax){ajax=Jalor.UI.ajax.setFnSuccess(e.ajax,function(f){a.build(d,e,b.isPlainObject(f)?f.result:f)});Jalor.UI.ajax(e.ajax,d)}}}};var a={build:function(f,g,c,d){var e=b.isArray(c)?Jalor.UI.tmplList(g.tmpl,c,d,g.startIndex,g.key):Jalor.UI.template(g.tmpl,c,g.startIndex,g.key);if(g.insertPosition){b.fn[g.insertPosition].apply(f,[e])}else{f.html(e)}return f},buildHtml:function(d,c){return d.each(function(){var e=b(this);e.find(".jalor-tmpl-list").each(function(){var f=b(this),g=f.attr("mapping")||"datas";if(g&&c[g]){a.setHtmlTmpl(b(this),c[g],g)}});e.find(".jalor-tmpl").each(function(){a.setHtmlTmpl(b(this),c)})})},setHtmlTmpl:function(f,c,e){var g=f.children(":first"),d;if(g.length&&g[0].tagName.toLowerCase()=="script"){d=g.html()}else{d=f.html()}if(d){a.build(f,{tmpl:d.trim()},c,e)}}};b.fn.jalorHtmlTemplate=function(d,c){if(this.length){var e=this;if(c){a.buildHtml(e,c)}else{if(d){Jalor.UI.ajax.setFnSuccess(d,function(f){a.buildHtml(e,f)},1);Jalor.UI.ajax(d,e)}}}}})(jQuery);Jalor.UI.Pager={};(function(a){var e={pageInf:{pageSize:Jalor.UI.Config.pager.defaultSize,curPage:1,totalRows:0,totalPages:null},noTotalRows:false,asynTotalRows:{URL:null,searchCache:false},pageSizes:Jalor.UI.Config.pager.pageSizes,mode:Jalor.UI.Config.pager.mode,text:{pageSizes:$i18n("jalor.common.pager.pageSizes"),curPage:$i18n("jalor.common.pager.curPage"),first:$i18n("jalor.common.pager.first"),prev:$i18n("jalor.common.pager.prev"),next:$i18n("jalor.common.pager.next"),last:$i18n("jalor.common.pager.last"),goTo:$i18n("jalor.common.pager.goTo"),message:$i18n("jalor.common.pager.message"),total:$i18n("jalor.common.pager.total")},isInitChange:false,fnBeforeChanged:null,fnPageChanged:null,modeOp:{btnNum:6},showLast:true,showMessage:Jalor.UI.Config.pager.showMessage};var g=a.Factory={createBtn:function(k,l){return"<a class='jalor-pager-btn jalor-pager-{0}' title='{1}'><b type='{0}'></b></a>".formatText(k,l.text[k])},createNumBtn:function(l,n,o,k){l.push("<a class='jalor-pager-numbtn {2}'><span type='{0}'>{1}</span></a>".formatText(n,o,k||""))},buildNumBtns:function(r,l,t,k){if(l.totalPages>1){var p=[];if(!k){k=r.modeOp}if(!t){t=r.text}var s,o,q;if(k.btnNum>l.totalPages){s=l.totalPages-2;o=0;q=2}else{s=l.curPage>99999?4:k.btnNum;o=parseInt(s/2);q=l.curPage-o+1;if(q<2){q=2}else{if(l.totalPages-o<l.curPage){q-=l.curPage-l.totalPages+o}}if(q==1){q=2}}if(l.curPage>1){this.createNumBtn(p,"prev",t.prev)}this.createNumBtn(p,"num",1,l.curPage==1?"cur":"");if(o>0&&q>2){this.createNumBtn(p,"","…","dot")}for(var n=0;n<s;n++,q++){if(q<l.totalPages){this.createNumBtn(p,"num",q,q==l.curPage?"cur":"")}}if(k.showLast){if(o>0&&q<l.totalPages){this.createNumBtn(p,"","…","dot")}this.createNumBtn(p,"num",l.totalPages,l.curPage==l.totalPages?"cur":"")}if(l.curPage!=l.totalPages){this.createNumBtn(p,"next",t.next)}return p.join("")}return""},getTotalPage:function(k){return k.totalRows>0?(parseInt(k.totalRows/k.pageSize)+(k.totalRows%k.pageSize>0?1:0)):1},setDisabled:function(k,l){k.toggleClass("disabled",l);return this},setBtnState:function(l,o){var k=o.curPage==1,n=o.curPage==o.totalPages;this.setDisabled(l.getFirstBtn(),k).setDisabled(l.getPrevBtn(),k);this.setDisabled(l.getNextBtn(),n).setDisabled(l.getLastBtn(),n);this.setDisabled(l.getGroupGoto(),k&&n)},updateStatus:function(l,k,o){var n=l.getGotoInput();l.getRecordsTotal().text(o.totalRows);l.getPagesizesSelect().val(o.pageSize);if(l.dom.hasClass("jalor-pager-number")){n.val(o.curPage);l.getGroupNumBtns().html(g.buildNumBtns(l.op,o));l.getGroupGoto().toggleClass("hide",o.totalPages==1)}else{n.val(o.curPage);l.getCurrentPage().text(o.curPage);l.getTotalPages().text(o.totalPages);g.setBtnState(l,o)}},checkPage:function(k){if(isNaN(k.pageInf.curPage)){return false}else{if((k.pageInf.curPage>k.pageInf.totalPages)&&(!k.noTotalRows)){k.pageInf.curPage=k.pageInf.totalPages}else{if(k.pageInf.curPage>Jalor.UI.Config.pager.maxPages){k.pageInf.curPage=Jalor.UI.Config.pager.maxPages}}}return true},setPager:function(o,q){var k=o.getPagerPanel().toggleClass("hide",!q.totalRows),s=o.getPagerText();s.length&&s.toggleClass("hide",q.totalRows>0);o.dom.toggleClass("hide",!q.totalRows);if(q.totalRows==0){var p=$("#"+o.id).parent();if(p.attr("gtgrid_init")){var t=$(p.getJalorGridManager().viewport);!t.find(".grid-no-result").length&&t.append('<div class="grid-no-result" style="position: absolute;">'+$i18n("jalor.common.label.noresult")+"</div>");var n=t.find(".grid-no-result"),l=(t.width()-n.width())/2;n.css({left:l,top:22})}else{var u=s.parents(".jalor-igrid").find(".jalor-igrid-body");var r=s.parents(".jalor-igrid").manager().op;var v="jalor.common.label.noresult";if(r&&null!=r.noResultI18n){v=r.noResultI18n}!u.find(".grid-no-result").length&&u.append('<div class="grid-no-result">'+$i18n(v)+"</div>")}}else{var p=$("#"+o.id).parent();if(p.attr("gtgrid_init")){p.find(".grid-no-result,.grid-no-result").remove()}else{p.parent().find(".igrid-no-result,.grid-no-result").remove()}}q.totalRows&&g.updateStatus(o,k,q)},triggerChanged:function(k,n,l){var o=k.op;if(g.checkPage(o)){g.setPager(k,n);var l=o.fnPageChanged;l&&l(n,k)}if(o.scrollContainer||o.anchorPanel){g.scrollToAnchor(k,o)}},scrollToAnchor:function(l,p){var o=p.scrollContainer?$(p.scrollContainer):$(window),k=p.anchorPanel&&$(p.anchorPanel).offset(),n=k?k.top-30:0;o.scrollTop(n)}};g.Builder={init:function(k,n){var l=[];l.push('<div class="jalor-pager-panel">');this.renderMessage(l,n);this.renderPageSizes(l,n);this.renderBtn(l,n);this.renderGoTo(l,n);n.showMessage&&l.push('</div><div class="jalor-pager-text hide">',$i18n(""),"</div>");k.dom.addClass("jalor-pager").html(l.join(""));this.end(k,n)},renderMessage:function(k,l){},renderPageSizes:function(o,q){var p=[];var k="jalor-pager-group pagesizes";if(q.pageSizes.length==1){k="jalor-pager-group msg";p.push(q.pageSizes[0])}else{p.push("<select class='jalor-pager-pagesize'>");for(var n=0,l=q.pageSizes[0];l;n++,l=q.pageSizes[n]){p.push("<option type='psize' ",q.pageInf.pageSize==l?"selected ":"","value='",l,"'>",l,"</option>")}p.push("</select>")}o.push('<div class="',k,'">',q.text.pageSizes.formatText(p.join("")),"</div>")},renderBtn:function(k,l){},renderGoTo:function(k,l){k.push('<div class="jalor-pager-group goto hide">','<input class="jalor-pager-page" type="text" value="">','<a class="jalor-pager-numbtn"><span type="goto">{0}</span></a>'.formatText(l.text.goTo),"</div>")},end:function(k,l){}};var h={renderMessage:function(k,l){if(l.showLast){if(l.noTotalRows){k.push('<div class="jalor-pager-group msg">',l.text.curPage.formatText("<font class='curPage'>"+l.pageInf.curPage+"</font>"),"</div>")}else{k.push('<div class="jalor-pager-group msg">',l.text.message.formatText("<font class='curPage'>"+l.pageInf.curPage+"</font>","<font class='totalPage'>"+l.pageInf.totalPages+"</font>","<font class='total'>"+l.pageInf.totalRows+"</font>"),"</div>")}}},renderBtn:function(k,l){k.push('<div class="jalor-pager-group btns">',g.createBtn("first",l),g.createBtn("prev",l),g.createBtn("next",l));if((l.showLast)&&(!l.noTotalRows)){k.push(g.createBtn("last",l))}k.push("</div>")},end:function(k,l){g.setBtnState(k,l.pageInf)}};var j={renderMessage:function(k,l){if((l.showLast)&&(!l.noTotalRows)){k.push('<div class="jalor-pager-group msg">',l.text.total.formatText("<font class='total'>"+l.pageInf.totalRows+"</font>"),"</div>")}},renderBtn:function(k,l){l.modeOp.showLast=l.showLast;k.push('<div class="jalor-pager-group numbtns">',g.buildNumBtns(l,l.pageInf,l.text,l.modeOp),"</div>")},end:function(k,l){k.dom.addClass("jalor-pager-number")}};g.EventBinder={init:function(k,l){this.bindGroupBtnsClick(k,l);this.bindPagesizesChange(k,l);this.bindGotoInputKeydown(k,l)},bindGroupBtnsClick:function(k,l){k.getPagerPanel().delegate("a","click",function(o){var n=$(this);k.pageChange(n,k,l)})},bindPagesizesChange:function(k,l){k.getPagesizesSelect().change(function(n){k.pageSizeChange(k,l)})},bindGotoInputKeydown:function(k,l){k.getGotoInput().keydown(function(n){if(n.keyCode==13){k.getGotoBtn().click()}})}};var c={preInit:function(k,l){l.pageSizes=l.pageSizes||Jalor.UI.Config.pager.pageSizes;if(!l.pageInf.totalPages){l.pageInf.totalPages=g.getTotalPage(l.pageInf)}},init:function(k,o){var n=k.dom.width(),l=n==0?0:n<500;$.extend(g.Builder,h);if(!l&&o.mode=="number"&&o.modeOp){$.extend(g.Builder,j)}},build:function(k,l){g.Builder.init(k,l)},bindEvent:function(k,l){g.EventBinder.init(k,l)},initComplete:function(k,l){l.isInitChange&&g.triggerChanged(k,l.pageInf)},initAjax:function(k,n,l){},preBindData:function(k,o,n,l){},bindData:function(k,n,l){},bindDataComplete:function(k,l){},complete:function(k,l){k.dom.data("builded",true)}};var f={getPagerPanel:function(){return DomClass.getProp(this,this.dom,"pagerPanel",".jalor-pager-panel")},getPagerText:function(){return DomClass.getProp(this,this.dom,"pagerText",".jalor-pager-text")},getGroupMsg:function(){return DomClass.getProp(this,this.getPagerPanel(),"groupMsg",".jalor-pager-group.msg")},getRecordsTotal:function(){return DomClass.getProp(this,this.getGroupMsg(),"recordsTotal","font.total",false)},getCurrentPage:function(){return DomClass.getProp(this,this.getGroupMsg(),"currentPage","font.curPage",false)},getTotalPages:function(){return DomClass.getProp(this,this.getGroupMsg(),"totalPages","font.totalPage",false)},getGroupPagesizes:function(){return DomClass.getProp(this,this.getPagerPanel(),"groupPagesizes",".jalor-pager-group.pagesizes")},getPagesizesSelect:function(){return DomClass.getProp(this,this.getGroupPagesizes(),"pagesizesSelect",".jalor-pager-pagesize")},getGroupNumBtns:function(){return DomClass.getProp(this,this.getPagerPanel(),"groupNumBtns",".jalor-pager-group.numbtns")},getGroupBtns:function(){return DomClass.getProp(this,this.getPagerPanel(),"groupBtns",".jalor-pager-group.btns")},getFirstBtn:function(){return DomClass.getProp(this,this.getGroupBtns(),"firstBtn",".jalor-pager-first",false)},getPrevBtn:function(){return this.getFirstBtn().next()},getNextBtn:function(){return this.getPrevBtn().next()},getLastBtn:function(){return this.getNextBtn().next()},getGroupGoto:function(){return DomClass.getProp(this,this.getPagerPanel(),"groupGoto",".jalor-pager-group.goto")},getGotoInput:function(){return DomClass.getProp(this,this.getGroupGoto(),"gotoInput","input.jalor-pager-page",false)},getGotoBtn:function(){return this.getGotoInput().next().children()},getPageInf:function(){return this.op.pageInf},changePage:function(l){var k=this.op.pageInf;$.extend(k,l);g.triggerChanged(this,k)},pageChange:function(n,o,t){var q=n.children("[type]").attr("type");if(q&&!n.hasClass("disabled")){var p=t.pageInf,k=p.totalPages,v=p.curPage,s=t.fnBeforeChanged;switch(q){case"first":p.curPage=1;break;case"prev":p.curPage-=1;break;case"next":p.curPage+=1;break;case"last":p.curPage=p.totalPages;break;case"goto":var r=o.getGotoInput(),u=r.val()*1;if(v==u||isNaN(u)||u<1||!/^[0-9\ ]+$/.test(u)){r.val(v);return}p.curPage=u;break;case"num":var l=n.parent();l.siblings(".cur").removeClass("cur");l.addClass("cur");p.curPage=n.text()*1;break;default:return}if(!s||s(o,p,v,p.pageSize,g.triggerChanged,k)!==false){g.triggerChanged(o,p)}}},pageSizeChange:function(k,n){var r=n.pageInf;if(r){var q=r.totalPages,p=r.curPage,o=r.pageSize;r.curPage=1;r.pageSize=k.getPagesizesSelect().val()*1;r.totalPages=g.getTotalPage(r);var l=n.fnBeforeChanged;if(!l||l(k,r,p,o,g.triggerChanged,q)!==false){g.triggerChanged(k,r)}}},reInit:function(k){k=$.extend(this.op,k);k.pageInf.totalPages=g.getTotalPage(k.pageInf);g.setPager(this,k.pageInf)}};var d={};var b=Jalor.UI.XControl("XPager",c,e,f);$.fn.pager=function(s,k){var r=function(w,v){if(!w.data("builded")){new b(w,v)}else{w.manager().reInit(v)}};var l,o,q;if((!k)||((k)&&(s.pageInf.hasOwnProperty("resultMode")))){if(!s.noTotalRows){if(s.hasOwnProperty("asynTotalRows")){l=s.asynTotalRows.URL;o=s.asynTotalRows.searchCache}}}if(l){var p,n;if(k){var u=k.op._loadType;q=this.data("searchVO");if(q==undefined){q={params:"",filter:""}}if((k.op.operation.search)&&(k.op.operation.search.panel)){p=$(k.op.operation.search.panel).jsonData()}if(k.op.allowFilter){n=s.pageInf.filter}l=l.formatField(s.pageInf)}else{l=l.formatText(Jalor.UI.Config.pager.defaultSize,1,0)}if((!o)||(JSON.stringify(p)!=JSON.stringify(q.params))||(n!=q.filter)){if((u==undefined)||(u=="search")){q.params=p;q.filter=n;this.data("searchVO",q);var t=this;Jalor.doGet(l,p,function(v){s.pageInf.totalRows=v.pageVO.totalRows;t.data("totalRows",s.pageInf.totalRows);r(t,s)})}}else{if((s.pageInf.curPage==1)&&(this.manager().op.pageInf.curPage!=s.pageInf.curPage)){this.manager().op.pageInf.curPage=s.pageInf.curPage}else{this.manager().op.pageInf.totalRows=this.data("totalRows")}r(this,this.manager().op)}}else{if(s.noTotalRows){if(k){if(k.getAllRecords().length<s.pageInf.pageSize){s.pageInf.totalRows=s.pageInf.curPage*s.pageInf.pageSize}else{s.pageInf.totalRows=s.pageInf.endIndex+1}}}r(this,s)}}})(Jalor.UI.Pager);Jalor.UI.Repeat={};(function(g){var d={ajax:null,tmpl:null,showPager:true,pagerTarget:null,pagerOp:{pageInf:{pageSize:Jalor.UI.Config.pager.defaultSize,curPage:1}},startIndex:0};var c=g.Factory={initPager:function(k,n){var h;if(!n.pagerTarget){var l=k.id+"_pager";$.create("div",null,l).insertAfter(k.dom);n.pagerTarget="#"+l}h=k.getPager();var j=n.pagerOp.fnPageChanged;n.pagerOp.fnPageChanged=function(o){if(!j||j(o)!==false){n.pagerOp.pageInf=o;k.request()}};h.pager(n.pagerOp);n.handler.afterBindData.add(function(o,p){o.getPager().pager(p.pagerOp)})}};var b={preInit:function(h,j){},init:function(h,j){},build:function(h,j){},bindEvent:function(h,j){},initComplete:function(h,j){j.showPager&&j.pagerTarget&&c.initPager(h,j)},initAjax:function(j,l,h){var k=h.setAjax;h.setAjax=function(n){if((!k||k(n)!==false)&&n.url){n.url=n.url.formatText(l.pagerOp.pageInf.pageSize,l.pagerOp.pageInf.curPage)}};h.error=function(){}},preBindData:function(k,n,j,h){h&&(n.pagerOp.pageInf=h);var l=n.pagerOp.pageInf;n.startIndex=(l.curPage-1)*l.pageSize+1;l.totalRows==0&&n.dataset&&n.dataset.length&&(l.totalRows=n.dataset.length)},bindData:function(j,k,h){j.dom.jalorTemplate(k,h)},bindDataComplete:function(h,j){},complete:function(h,j){}};var e={getPager:function(){var h=this.op.pagerTarget;return h?$(h):null},reload:function(h){var j=this.getPager();if(j.length){j.manager().changePage(h)}}};var f={};var a=Jalor.UI.XControl("XRepeat",b,d,e,"Table");$.fn.repeat=function(h){return new a(this,h)}})(Jalor.UI.Repeat);(function(){var c="placeholder" in document.createElement("input");$.fn.validVal=c?$.fn.val:function(){var e=this.val();return e==this.data("addEmptyOption")?"":e};var d={index:0,setSelector:function(f,e,j){var h=f.id();if(!h){h="dropdown_"+(this.index++)+"";f.id(h)}e.data("callerId",h);h+="_ddl";e.id(h).data("op",j);if(j.appendAfter){e.insertAfter(f);j._offset="position"}else{e.appendTo(Jalor.UI.getPopupPanel());j._offset=true}f.bindDestory(function(){var k=d.getSelector($(this));k.length&&k.remove()});j.richMode||this.bindSelectorClick(e,j);j.allowDel&&this.bindSelectorHover(e,j);if(!j.emptyText&&j.multi){j.emptyText="jalor.common.dropdown.all"}var g=$.create("div","jalor-selector-head").appendTo(e);if(j.emptyText||(j.addEmptyOption&&!j.multi)){j.emptyText===true&&(j.emptyText="jalor.common.dropdown.empty");$.create("div","jalor-selector-empty"+(j.multi?" ddl-multi":"")).text($i18n(j.addEmptyOption||j.emptyText)).appendTo(g).click(function(k){d.cancelClick(k);if(j.multi){d.selectedAll(f,e,j,$(this).toggleClass("ddl-selectAll").hasClass("ddl-selectAll"))}else{d.selected(j,"",j.addEmptyOption&&!c?j.addEmptyOption:"",null,e,f)}})}$.create("div","jalor-selector-body").appendTo(e);$.create("div","jalor-selector-foot").appendTo(e);j.fnBuildSelector&&j.fnBuildSelector(e,j);return"#"+h},clearSelector:function(e){this.getSelectorBody(e).empty()},getSelector:function(e){return $(e.data("selector"))},getSelectorBody:function(e){return e.children(".jalor-selector-body")},getInput:function(f){f=$(f);if(!f.hasClass("jalor-dropdown")){var e;if(f.hasClass("jalor-selector")){var e=f.data("input");if(!e){var g=f.id();e=$("#"+g.substr(0,g.length-4))}}else{e=f.prevAll(".jalor-dropdown:first")}return e}return f},setCombobox:function(e,f){e.hasClass("jalor-combobox")||e.addClass("jalor-combobox");f.fnMatchInput&&Jalor.UI.delayEvent2(e,"keyup",f.fnMatchInput,f.delay,Jalor.UI.isKeyDownValue)},cancelClick:function(g,f){if(g){}},cancelClick1:function(g,f){if(g){g.stopPropagation()}},keydown:function(o){var s=$(this),k=d.getSelector(s),n=k.data("op"),r,f;var g=d.getTrigger(s);if(g.hasClass("history")&&Jalor.History.hasHistory(n)){setTimeout(function(){if(s.validVal()){g.addClass("hide")}else{g.removeClass("hide")}},0)}setTimeout(function(){s.data("lastFocusIndex",Jalor.UI.getInputFocus(s))},0);if(n._type=="sgt"){var j=s.data("oldvalue");if(s.validVal()!==j){r=true;s.data("oldvalue",s.validVal()).data("haschanged",true)}if(!r){f=setTimeout(function(){if(s.validVal()!==j){s.data("oldvalue",s.validVal()).data("haschanged",true)}})}}if(k.length){s.hasClass("error-ctr")&&s.clearValid();n.sgtMulti&&a.cacheFocus(s);var x=o.keyCode;if((x==38||x==40)&&k.isVisiable()){var t=k.find("."+n.preSelected),h;if(t.length==0){h=k.find("."+n.itemClass+":visible:"+(o.keyCode==38?"last":"first"))}else{t.removeClass(n.preSelected);if(x==38){h=t.prevAll(":visible:first");if(h.length==0){h=k.find("."+n.itemClass+":visible:last")}}else{h=t.nextAll(":visible:first");if(h.length==0){h=k.find("."+n.itemClass+":visible:first")}}}if(h.length){h.addClass(n.preSelected);var q=h.position().top,l=k.find(n.scrollBody);if(q){var v=h.outerHeight()+q-l.height();v&&l.scrollTop(v+l.scrollTop()+100)}else{l.scrollTop(0)}}return false}else{if(x==13||x==9){if(x===13){d.clearInterval(n)}x!=9&&o.stopPropagation();var n=k.data("op"),w=k.find(":not(.hide)."+n.preSelected+":first");if(k.isVisiable()&&w.length&&x==13){if(!n.multi){k.hide()}f&&window.clearTimeout(f);if(n.fnKeyEnter){n.fnKeyEnter(w,s,k,n)}else{!s.data("INPUTING")&&d.itemSeleted(k,w,n)}}else{if(s.validVal().length||x==9){if(!s.data("called")&&n.fnCallSelector){s.data("called",1);n.fnCallSelector.call(s)}}else{var g=d.getTrigger(s);g.length&&g.click()}}if(x===13&&s[0].tagName=="TEXTAREA"){return false}}else{if(n.multiDisabled&&x===8||x===46){var p=k.find("."+n.itemClass);p.filter(".selected").removeClass("selected");var u=s.validVal().trim();s.dataValue(u)}if(n._type=="sgt"&&Jalor.UI.isKeyDownValue(o)){!k.data("cached")&&k.hide().children(".jalor-selector-foot").hide()}}}}},setWidth:function(h,k,n){var g=h.find(".list");if(g.length){if(!n){n=this.getInput(h)}var p=g.width(),l=n.outerWidth()-2,e=l>k.minWidth?l:k.minWidth;if(k.overflow){h.width(e);e=g.height()>h.height()?e-25:e;h.find(".list .list-item").each(function(){$(this).attr("title",$(this).text()).width(e)});g.width(e)}else{var f=Jalor.DataHelper.getRangeValue(p,e,k.maxWidth);if(g.height()>h.height()){if(p>l-17){h.width(f+17);g.width(f)}else{h.width(f);g.width(f-17)}}else{h.width(f);if(f>p){g.width(f)}}}}var o=g.outerHeight(),j=this.getSelectorBody(h);if(o&&g.width()>j.width()){o+=20}j.height(o||"auto")},mergeHistory:function(n,e,g,h){if(!this.checkHistorySupport(n,g)){return e}var f=[],j=Jalor.History.getHistory(n.historyKey||(n.ajax&&n.ajax.url));if(j.length==0){return e}var l={},k={};e&&$.each(e,function(){l[this[n.valueField]]=this});$.each(j,function(){k[this.value]=true;var o=l[this.value];if(o){f.push($.extend({_history:"history-item"},o))}else{if(this.data&&n._type=="sgt"&&(h||e.length==n.suggestNum)){this.data._history="history-item";this.data._novalid=true;f.push(this.data)}}});if(f.length>0){$.each(e,function(){if(!k[this[n.valueField]]){f.push(this)}});return f}else{return e}},validSgtHistory:function(f,h,g,e){if(h.getTextAjax){d.ajax($.extend({type:"POST"},h.getTextAjax,{data:[f],success:function(j){e.data("called",0);g&&g(j&&(!$.isArray(j)||j.length>0)?true:false)},error:function(){e.data("called",0);g&&g(false);return true}}),e)}else{g(true)}},checkHistorySupport:function(f,e){if(e.hasClass("jalor-user")){return false}return !f.richMode&&!f.sgtMulti&&Jalor.History.isSupport(f)},buildSelector:function(g,h,j,p){if(!j){j=g.data("op")}if(j){if(h.length>j.suggestNum){h=h.slice(0,j.suggestNum)}var n=this.getInput(g);n.removeData("haschanged");if(h.length>1&&!h[0]._history){h=d.mergeHistory(j,h,this.getInput(g))}if(h.length>1){n.data("multiMatch",true)}else{n.removeData("multiMatch");a.validStyle(n)}if(!j.fnBeforeBinded||j.fnBeforeBinded(g,h,j)!==false){var k=this.getSelectorBody(g);k.html(j.panelBegin+Jalor.UI.tmplList(j.item,h,null,null,null,null,1)+j.panelEnd);if(j.defaultSelect===false){a.validStyle(n);var o=g.find("."+j.itemClass+":first");n.jalorGetValue()&&o.addClass(j.preSelected)}else{k.find("."+j.itemClass+":first").addClass(j.preSelected)}h.length&&g.removeClass("selector-data");if(h.length&&g.isVisiable()){this.setWidth(g,j,n);n.length&&j._offset!="position"&&Jalor.UI.checkPopuperPosition(n,g)}var f=n.jalorGetValue();if(!n.hasClass("jalor-user")){if(f){if(j.multi){var e=f.split(j.valueSplit);$.each(e,function(){if(this){k.find("li.list-item[val='"+this.replace(/\\/g,"\\\\")+"']").not(".selected").addClass("selected")}})}else{k.find("li.list-item[val='"+f.replace(/\\/g,"\\\\")+"']").not(".selected").addClass("selected  selected-pre")}}}}j.fnBinded&&j.fnBinded(g,h);j.dataset=Jalor.Format.convertArrayToObject(h,j.valueField,true);j.total=h.length;var l=g.data("initInput");if(l){l=$(l);if(j.showfirstItem&&!l.getValue()){j.showfirstItem=null;this.selectedFirst(l,g,j)}else{d.initInputValue(l,g)}}else{if(h.length==1&&h[0]&&!h[0]._history&&j.defaultSelect!==false){if(n.length){if(j.connectFill||j.showfirstItem||(j._type=="sgt"&&j.showfirstItem!==false)){j.showfirstItem=null;this.selectedFirst(n,g,j);if(n.parents(".gt-grid").length&&n.hasClass("jalor-user")){n.removeClass("error");n.next("label.error").hide()}}}}else{if(h.length>0&&j.showfirstItem===true){j.showfirstItem=null;this.selectedFirst(n,g,j)}}}if(n.length&&n[0]!=document.activeElement||!h.length){if(h.length){g.data("isDel")==true?g.data("isDel",false):g.hide()}else{setTimeout(function(){g.hide()},1000)}(j._type=="sgt")&&a.validStyle(n);if(p!==false&&d.getSelector(n).data("op")){if(j.lazyload){!g.data("notValid")&&n.valid()}n.hasClass("error")&&g.removeClass("selector-data");if(n.parents(".gt-grid").length&&n.hasClass("jalor-user")&&!h.length){n.addClass("error");var q=n.next("label.error");if(q.length==0){q=$.create("label","error").click(function(){$(this).hide().addClass("er-handle")})}q.html($i18n("jalor.jquery.validate.jalorUser")).css({top:23,left:0});n.after(q);q.show();return}}}}},initInputValue:function(f,e){e.removeData("initInput");$(f).each(function(){var g=$(this),h=g.getValue();if(h){if(g.hasClass("grid-editor")){d.setValue(g,h,null,null,null,true)}else{d.setValue(g,h)}}})},getItemText:function(e){return $(e.find(".list-text").get(0)).text()},selectedFirst:function(f,e,h){e.removeData("initInput");var g=e.find("."+h.itemClass+":eq(0)");d.selected(h,g.attr("val"),d.getItemText(g),g,e,f);if(h.multi){e.hide()}},selectedAll:function(g,e,k,j){var h="."+k.itemClass+(j?"":".selected");var f=k.multiDisabled?e.find(h+":not('.hide')"):e.find(h);if(j){this.itemSeleted(e,f.length>1?f.addClass("selected"):f,k)}else{f.removeClass("selected");this.setValue(g,"","")}},bindSelectorClick:function(e,f){e.delegate("."+f.itemClass,"click",function(g){d.cancelClick1(g);d.itemSeleted(e,$(this),f)}).mousedown(function(){$(this).data("notValid",true)})},bindSelectorHover:function(e,f){e.delegate("."+f.itemClass,"mouseover",function(g){$(this).find(".allow-del").show()}).delegate("."+f.itemClass,"mouseout",function(g){$(this).find(".allow-del").hide()});e.delegate(".del","click",function(n){var g=$(this).parents(".jalor-selector"),p=g.data("op");if(p.fnBeforeRemoveItem){var l=p.dataset,j=$(this).parents("li"),o=j.attr("val"),h=[];for(var k in l){if(k!=o){h.push(l[k])}}p.fnBeforeRemoveItem.call(this,l[o],p,g);g.data("isDel",true);d.buildSelector(g,h,p)}return false})},itemSeleted:function(r,u,h){var k,q,p,l=d.getInput(r);if(h.sgtMulti&&h.dedupLication){var w=l.dataValue().split(h.valueSplit),v=l.val().split(h.multiSplit),f=d.getItemText(u),g=u.attr("val"),s=$.inArray(g,w),n=s==$.inArray(f,v);if(n&&s!=-1){w.splice(s,1);v.splice(s,1);var e=w.join(h.valueSplit),x=v.join(h.multiSplit)+h.multiSplit,j=l.data("datas");j.splice(s,1);l.dataValue(e).val(x).data("datas",j)}}if(h.multi){u.length==1&&u.toggleClass("selected");var o=[],t=[];(u.length==1?r.find(".selected"):u).each(function(){var y=$(this);o.push(y.attr("val"));t.push(d.getItemText(y))});p=t.join(h.multiSplit);t.length&&(p+=h.multiSplit);q=o.join(h.valueSplit)}else{p=d.getItemText(u);q=u.attr("val")}if(u.hasClass("history-item")){d.validSgtHistory(q,h,function(y){if(y){d.selected(h,q,p,u,r,l)}else{u.remove();if(r.find(".list-item").length==0){r.hide()}Jalor.History.delInvalidHistory(h.historyKey||(h.ajax&&h.ajax.url),q)}},l)}else{d.selected(h,q,p,u,r,l);Jalor.UI.setInputFocus(l,(h.multi||h.sgtMulti)?null:0,false)}},selected:function(l,o,q,r,g,n,h,f){if(o==void 0){o=""}if(q==void 0){q=""}d.getTrigger(n.removeClass("error").removeData("multiMatch").removeData("haschanged")).removeClass("warning");d.clearInterval(l);d.fillContainer(r,l);var k=l.dataset&&o?l.dataset[o]:null;if(!l.fnBeforeSelected||l.fnBeforeSelected.call(n,o,q,r,g,k)!==false){var e=n.dataValue();n.dataValue(o).val(q);if(!l.sgtMulti){n.removeData("haschanged").data("oldvalue",q)}n.data("curText",o!=null&&q.length?q.trim():"");if(!l.multi&&!h){g.hide()}if(l.multi){g.find(".jalor-selector-empty:first").toggleClass("ddl-selectAll",o!==""&&o.split(l.valueSplit).length==g.find("."+l.itemClass+"").length||o.split(l.valueSplit).length==g.find("."+l.itemClass+":visible").length)}d.addTip(n,q);if(q&&!n.data("lazyload")){n.valid()}if(!l.fnSelected||l.fnSelected.call(n,o,q,e,r,g,k,f)!==false){if(d.checkHistorySupport(l,n)){if(l.multi){var p=o.split(l.valueSplit);for(var j=0;j<p.length;j++){Jalor.History.save(l.historyKey||(l.ajax&&l.ajax.url),p[j],l._type=="sgt"?k:null)}}else{Jalor.History.save(l.historyKey||(l.ajax&&l.ajax.url),o,l._type=="sgt"?k:null)}}if(e!=o){if(l.fnChanged){l.fnChanged.call(n,o,q,e,r,g,k)}else{if(n.length&&n[0].onchange){n[0].onchange()}}}}else{return false}}else{return false}},addTip:function(e,f){if(e.length&&e[0].tagName=="INPUT"){if(f.length>20){e.attr("title",f)}else{e.removeAttr("title",f)}}},foramtParam:function(e,g,f){var h=$.extend({},e);h.url=e.url.formatURI(g);if(e.data){h.data=e.data.formatURI(g)}else{if(f){h.data={};h.data[f]=g}}return h},sort:function(e,h,g,f){if(f){$.each(e,function(){this[g]=$i18n(this[g])})}return Jalor.DataHelper.sort(g,h!=="desc"?"asc":"desc",e)},sendRequest:function(g,f,l,j){var k=$.extend(true,{},f);g.removeData("lazyload");d.clearSelector(g);var e=new Date();var o=l.data("caller");Jalor.UI.ajax.setFnSuccess(k,function(p){if(o&&l.data("caller")&&l.data("caller")[0]!=o[0]){return}var r=p?(p.result||p):[];var s=g.data("op");if(s.sort&&r&&r.length){r=d.sort(r,s.sort,s.displayField||"text",s.i18n)}d.buildSelector(g,r,null,j);k.fnSuccess&&k.fnSuccess(g,p);var q=new Date();Jalor.Hwa.send($i18n("jalor.hwa.message.dropdownTime"),q-e,window.location.href.split("#")[0]+k.url)},true);var h=k.error;k.error=function(s,r,q,p){if(p=="403"&&q.indexOf("huawei.jalor5.security.00010002")>-1){l.removeData("called").removeData("cached").removeData("calledText");g.hide();Jalor.Component.Session.openRebuildDialog(function(){d.sendRequest(g,f,l)});return}g.data("isDefault",0);l.removeData("_matching").removeData("haschanged").removeData("called").valid();if(h){return h()}};var n;if(k.beforeRequest){n=k.beforeRequest(k,l,g);if($.isPlainObject(n)&&!$.isEmptyObject(n)){return d.ajax(n,l)}else{if(n===false){l.removeData("called").removeData("_matching");if(!$(l).attr("disabled")){!g.data("notValid",false)&&l.valid();g.removeData("notValid")}return}else{if(n.length){$.each(n,function(q,p){d.ajax(n[q],l)});return}}}}this.clearInterval(g.data("op"));d.ajax(k,l)},ajax:function(g,e){if(e.data("ddl_locked")){e.data("calledText",null).removeData("called");return}e.data("called",1);var f=e.next(".jalor-dropdown-btn");if(e.next("label.error").length){f=e.next().next(".jalor-dropdown-btn")}if(g.loading==void 0){g.loading="ui"}Jalor.UI.ajax(g,f.length?f:e.parent())},clearInterval:function(e){if(e.interval){clearInterval(e.interval);e.interval=null}},callSelector:function(k){d.cancelClick(k);var h=d.getInput(this);var f=d.getSelector(h),n=f.data("op"),l;if(n.connector){l=d.connectDdl(h,f,n)}else{if(f.data("lazyload")){d.sendRequest(f,n.ajax,h);l=false}}if(l!==false){var j=h.dataValue(),g=f.find("."+n.itemClass);g.filter(".selected").removeClass("selected");g.filter("."+n.preSelected).removeClass(n.preSelected);g.first().addClass(n.preSelected);if(n._copy){g.filter(".pre").removeClass("pre");delete n._copy}if(n.combo){g.filter(".hide").removeClass("hide")}if(j){if(n.multi){Jalor.UI.matchText(j,g,function(e,o){if(e){o.addClass("selected")}},n.valueSplit,"val")}else{f.find("."+n.itemClass+'[val="'+j.replace(/\\/g,"\\\\")+'"]').addClass("selected").addClass(n.preSelected)}}if(g.length==1&&h.data("connectFill")){d.selectedFirst(h,f,n);return}if(n.multiDisabled){f.find(".jalor-selector-empty:first").toggleClass("ddl-selectAll",j!==""&&j.split(n.valueSplit).length==f.find("."+n.itemClass+"").length||j.split(n.valueSplit).length==f.find("."+n.itemClass+":visible").length)}}if(k.which==1||event.which==1||event.wheelDelta==0||!event.code=="Enter"){d.popup(h,f,n)}},popup:function(g,f,k,j){if(g.hasClass("jalor-user")){f.addClass("selector-data")}if(k.defaultSelect===false){var h=f.find("."+k.itemClass+":first");h.removeClass(k.preSelected)}if(g.attr("ddl_locked")){f.hide();return}if(g.isVisiable()&&(document.activeElement==g[0]||j||k._type!="sgt")){k.onlyone&&f.data("input",g);var e={};$.extend(e,k.css);e.top=(e.top||0)+g.outerHeight();f.show();this.setWidth(f,k,g);Jalor.UI.popup(g,f,e,null,k._offset,null,true);this.setWidth(f,k,g);(document.activeElement!==g[0])&&!$(document.activeElement).hasClass("jalor-dropdown")&&g.focus()}else{f.isVisiable()&&Jalor.UI.popupClose(f)}if(g.hasClass("jalor-suggest")){$(f).find(".list-item").length==1&&f.hide()}if(g.hasClass("jalor-user")){!f.find("."+k.itemClass+":visible:first").length?f.addClass("selector-data"):f.removeClass("selector-data")}},setTrigger:function(f,e,h,j){var g=$.create("a").addClass("jalor-dropdown-btn").attr("style","margin-right:0px;").insertAfter(f);if(j.showTrigger!==false){if(j.readOnly===true){f.unbind("click.trigger").bind("click.trigger",function(){g.click()})}if(j.dataPopup===true){f.unbind("click.trigger").bind("click.trigger",function(){g.click()})}g.click(function(l){if(g.hasClass("warning")){f.focus();return}var k=d.getSelector(f).data("isDefault",0);if(k.data("isColse")){k.data("isColse",null);return}if(k.isVisiable()){k.hide()}else{e.call(f,l)}(document.activeElement!==f[0])&&f.focus()}).mousedown(function(l){var k=d.getSelector(f).data("isDefault",0);k.data("notValid",true);if(k.isVisiable()){k.data("isColse",true)}});f.addClass("dropdown-trigger");f.is("textarea")&&g.addClass("dropdown-areabtn");h&&f.bind("click",function(k){e.call(this,k)})}else{if(d.checkHistorySupport(j,f)){g.addClass("history hide").attr("title",$.i18n.prop("jalor.dropdown.ldap.historyrecord")).click(function(o){var n=$(this);if(n.hasClass("warning")){f.focus()}else{var k=d.getSelector(f),p=k.data("op");d.clearSelector(k);var l=d.mergeHistory(p,[],f,true);if(l.length>0){f.focus();d.buildSelector(k,l,p);d.popup(f,k,p)}}})}else{g.addClass("hide").attr("title",$.i18n.prop("jalor.dropdown.ldap.historyrecord")).click(function(k){f.focus()})}}},getTrigger:function(e){var f=e.next(".jalor-dropdown-btn");return f.length>0?f:e.next().next(".jalor-dropdown-btn")},fillContainer:function(e,g){if(e&&!g.multi&&g.fillContainer){var f=e.attr("fill");if(f){f=jQuery.parseJSON(f)}$(g.fillContainer).jsonData(f||{})}},validInput:function(f){var h=d.getSelector(f).data("op");var e=true,g=f.validVal().trim();if(g.length){e=f.data("curText")==g}else{f.removeData("curText")}if(!e){var h=d.getSelector(f).data("op");if(h.valid===false){f.removeData("curText");this.setValue(f,g,g);return true}}return e},matchInput:function(n){var s=$(this);if(s.data("copy")){s.removeData("copy");return}var v=s.val(),h=d.getSelector(s),l=h.data("op"),k=true;if(l.multi&&n.keyCode==13){return}if(h.data("lazyload")||l.connector){var r=$.extend({},l.ajax);if(r.fnSuccess){var u=r.fnSuccess;r.fnSuccess=function(e){l.connector&&s.val(v);d.matchInput.call(s,n);u(e)}}else{r.fnSuccess=function(e){l.connector&&s.val(v);d.matchInput.call(s,n)}}if(l.connector){if(d.connectDdl(s,h,l,r)!==false){k=true}}else{d.sendRequest(h,r,s);k=null}}if(k){if(h.length){var p=h.find("."+l.itemClass);if(p.length){var g=0,q;if(v){if(l.multiDisabled&&l.multi){var f=s.dataValue(),o=v.split(l.multiSplit);v=o[o.length-1];o.splice(o.length-1,1);if(o.length){var t=[],j=[l.multiSplit,o.join(l.multiSplit),l.multiSplit].join("");p.each(function(e,w){if(l.multi){if(j.indexOf(l.multiSplit+l.dataset[$(this).attr("val")][l.displayField]+l.multiSplit)!=-1){$(this).addClass("selected");t.push($(this).attr("val"))}else{$(this).removeClass("selected")}}});s.dataValue(t.join(l.valueSplit)).data("curText",s.val().trim())}if(!v){return}}l.cacheReqest!==false&&Jalor.UI.matchText(v.trim(),p,function(e,w){if(e){g==0&&(q=w);g++}w.toggleClass("hide",!e).removeClass(l.preSelected)})}else{p.removeClass("selected");h.find("."+l.itemClass+".hide").removeClass("hide").removeClass(l.preSelected);d.selected(l,"","",null,h,s,1)}if(l.multiDisabled&&l.multi&&s.dataValue()&&q&&$.inArray(q.attr("val"),s.dataValue().split(l.valueSplit))!=-1){d.popup(s,h,l);s.data("curText",(o.join(l.multiSplit)+l.multiSplit).trim());return}if(g==1&&!("richMode" in l)&&l.showfirstItem!==false&&l.defaultSelect!==false){d.itemSeleted(h,q,l)}else{p.eq(0).addClass(l.preSelected);if(h.css("display")=="none"){if(l.onlyone){h.data("input",s)}}d.popup(s,h,l);!p.filter(":visible").length&&s.valid();if(s.val()&&s.hasClass("error")||s.val()==""){h.hide()}}}}}},setConnector:function(f,e){if(typeof(e)=="string"){d.setConEvent($(e),f)}else{if(e.length){$.each(e,function(g,h){d.setConEvent($(h.target),f)})}}},setConEvent:function(f,h){if(f.hasClass("jalor-dropdown")){var e=d.getSelector(f),j=e.data("op"),g=j.fnSelected;j.fnSelected=function(q,r,n,o,k,p,l){!l&&d.validConnectValue(h,q);if(g){g.call(this,q,r,n,o,k,p)}}}},setConnetctAjax:function(f){var e=f.ajax.setAjax;f.ajax.setAjax=function(j,g){var h=f.fnGetConnectValue?f.fnGetConnectValue(g,f):d.getConnectValues(f.connector);if(h){j.url=f._type=="sgt"?j.url.formatField({connect:h}):j.url.format(h);if(e){return e(j,g)}}else{return false}}},getConnectValues:function(e){if(typeof(e)=="string"){return($(e).dataValue()+"").encodeURI()}else{var f=[];$.each(e,function(h,k){var g=$(k.target),j=g.hasClass("jalor-dropdown")?g.dataValue():g.val()||g.text();if(j.length==0){if(k.defaultValue==null){f=null;return false}else{j=k.defaultValue}}if(j!=null){f.push(k.paramName+"="+(j+"").encodeURI())}});return f?f.join("&"):null}},connectDdl:function(f,e,j,h){var g=j.fnGetConnectValue?j.fnGetConnectValue(f,j):d.getConnectValues(j.connector);if(f.data("conVal")!=g||j.cache===false){f.data("conVal",g);if(h==null){h=j.ajax}if(h){if(g&&g.length){if(f.getValue()){e.data("initInput",f)}d.sendRequest(e,h,f);return false}else{d.clearSelector(e)}}else{if(g){Jalor.UI.matchText(g,e.find("."+j.itemClass),function(k,l){l.toggleClass("list-hide",!k)},j.valueSplit,"val")}else{e.find(".list-hide").removeClass("list-hide")}}}},validConnectValue:function(f,e){$(f).each(function(k){var o=$(this),j=d.getSelector(o),l=j.data("op"),g=o.data("conVal");if(!l){return}if(l._type=="sgt"){o.removeData("calledText");j.removeData("isDefault")}if(g!=void 0&&g!==""){var n=l.fnGetConnectValue?l.fnGetConnectValue(o,l):d.getConnectValues(l.connector);if(g!=n||l.cache===false){if(l._type=="sgt"){o.data("conVal",n)}var p=o.dataValue(),q=j.find('[val="'+p+'"].'+l.itemClass+":visible");if(p){var h=d.getItemText(q);if(h.toLowerCase()!=o.val().toLowerCase()){d.selected(l,"","",q,j,o)}}else{d.selected(l,"","",null,j,o)}}}else{if(!j.data("lazyload")&&l._type!="sgt"){d.connectDdl(o,j,l)}else{if(o.val().length){d.selected(l,"","",null,j,o)}}}if(l.connectFill&&e){if(d.currConTimeout){window.clearTimeout(d.currConTimeout);d.currConTimeout=false}else{d.currConTimeout=setTimeout(function(){if(o.is(":visible")){o.data("connectFill",true);d.getTrigger(o).click();o.data("connectFill",false);d.currConTimeout=false}},100)}}})},setValue:function(k,l,o,f,e,j){var g=d.getSelector(k),h=g.data("op"),p,n;if(!o&&l!=null&&l!==""){l+="";if(!h.richMode){if(g.data("lazyload")||(f&&h.connector&&h.lazyload==false)){if(h.connector==null||(f&&h.lazyload==false)){g.data("initInput",k);k.dataValue(l);n=true;d.sendRequest(g,h.ajax,k)}else{g.removeData("lazyload")}}else{if(h.multi){o=[];Jalor.UI.matchText(l,g.find("."+h.itemClass),function(q,r){if(q){o.push(d.getItemText(r))}},h.valueSplit,"val");o=o.join(h.multiSplit)}else{p=g.find("."+h.itemClass+'[val="'+l+'"]');if(p.length){o=d.getItemText(p)}}if(!o&&h.valid===false){o=l}}}}if(!n){d.selected(h,l,o,p,g,k,true,j)}return k},reBind:function(g,k,f){var e=d.getSelector(g),n=e.data("op"),j=g.dataValue();if(n.richMode){e.data("step",1);n.richMode.op.url=k.url}if(f){d.clearSelector(e);d.buildSelector(e,f,n,false);if(j){d.setValue(g,j)}}else{var h={};$.extend(h,n.ajax,k);var l=j||g.val();g.val(l);if(Jalor.DataHelper.isEmpty(l)){d.sendRequest(e,h,g,false)}else{d.setValue(g,l)}}},disabled:function(e,f,g){if(!g){g=$(e.data("selector")).data("op")}if(f){g.fnGetTrigger(e).show();e.removeAttr("disabled")}else{g.fnGetTrigger(e).hide();e.attr("disabled","disabled")}},readonly:function(e,f,g){if(!g){g=$(e.data("selector")).data("op")}if(f){g.fnGetTrigger(e).show();e.removeAttr("readonly")}else{g.fnGetTrigger(e).hide();e.attr("readonly","readonly")}},dataPopup:function(e,f,g){if(!g){g=$(e.data("selector")).data("op")}if(f){g.fnGetTrigger(e).show();e.removeAttr("dataPopup")}},checkEmpty:function(h){var g=$(this);if(Jalor.DataHelper.isEmpty(g.val())&&!Jalor.DataHelper.isEmpty(g.dataValue())){var f=d.getSelector(g);d.selected(f.data("op"),"","",null,f,g,true)}},onPaste:function(j){var g=$(this),h=g.val(),f=d.getSelector(g),k=f.data("op");g.removeData("initInput");setTimeout(function(){var e=g.val();if(e&&e.trim()){if(k.multi){if(f.data("lazyload")){var l=$.extend(true,{},k.ajax);Jalor.UI.ajax.setFnSuccess(l,function(){d.matchPaste(g,f,k,h,e)});d.sendRequest(f,l,g)}else{d.matchInput.call(g,j,true);d.matchPaste(g,f,k,h,e)}}else{d.matchInput.call(g,j,true);if(k._type=="sgt"){g.data("copy",1)}}}},10)},matchPaste:function(q,h,n,f,g){if(n.multiDisabled){var e=h.find("."+n.itemClass+":visible");if(e.length==1){d.selectedAll(q,h,n,false)}else{if(e.length>1){return}}}else{d.selectedAll(q,h,n,false)}g=g.split(n.multiSplit.trim());var p=h.find("."+n.itemClass);for(var k=0,o=g.length;k<o;k++){var r=g[k].trim(),s,l=0;if(r){Jalor.UI.matchText(r,p,function(t,v,u){if(t){if(l>0){v.addClass("pre")}else{s=v}l++}});if(l){if(l==1){d.itemSeleted(h,s,n);p=p.filter(":not(.selected)")}else{s.addClass("pre")}}}}n._copy=true;if(n.multiDisabled){p.filter(".pre").removeClass("pre");var j=h.find("."+n.itemClass+":visible");if(j.length<1){h.hide()}}}};$.fn.dropdown=function(f,h){var j=$.extend(true,{appendAfter:Jalor.UI.Config.dropdown.appendAfter,container:null,_type:null,multi:false,onlyone:true,combo:true,delay:Jalor.UI.Config.dropdown.comboDelay,emptyText:null,ajax:null,lazyload:true,initInput:true,cssname:null,panelBegin:"<ul class='list'>",item:'<li class="{0} ${&data._history}" val="${&{1}}" {3}  ><span class="list-text">${{2}}</span></li>',panelEnd:"</ul>",itemClass:"list-item",preSelected:"selected-pre",scrollBody:".jalor-selector-body",css:{top:-1},valueField:"value",displayField:"text",showfirstItem:null,fillField:null,fillContainer:null,minWidth:30,maxWidth:800,multiSplit:Jalor.Config.Format.textSplit,valueSplit:Jalor.Config.Format.valueSplit,connector:null,pasteMatch:true,fnBinded:null,fnBeforeBinded:null,fnSelected:null,fnBeforeSelected:null,fnChanged:null,fnSetTrigger:null,fnGetTrigger:d.getTrigger,fnCallSelector:d.callSelector,fnMatchInput:d.matchInput,fnKeyEnter:null,fnBuildSelector:null,fnInitComplete:null,addEmptyOption:Jalor.UI.Config.dropdown.addEmptyOption},f);if(j.allowDel===true){j.item='<li class="{0} ${&data._history}" val="${&{1}}" {3}  ><span style="float:left;" class="list-text">${{2}}</span><span style="float:right;display:none;" class="allow-del"><a class="jalor-icon del"></a></span></li>'}h||j.dataset&&(h=j.dataset);var k=$(this).val();if(k&&typeof k=="string"&&k.trim().length==0){$(this).val("")}if(j.addEmptyOption){if(c){this.attr("placeholder",j.addEmptyOption)}else{this.data("addEmptyOption",j.addEmptyOption);!this.val()&&this.val(j.addEmptyOption).dataValue("")}}if(h||j.ajax||j.richMode){j.item=j.item.formatText(j.multi?j.itemClass+" list-mulit":j.overflow?j.itemClass+" overflow":j.itemClass,j.valueField,j.displayField,(j.fillField?" fill='${#"+j.fillField+"}'":""));var g=$.create("div","jalor-selector").attr("tabindex",-1),l,n=this.first(),e;if(j.cssname){g.addClass(j.cssname)}l=d.setSelector(n,g,j);b.init(g,j);var o=this.validVal();if(h){d.buildSelector(g,h,j)}else{if(j.ajax){if(j.showfirstItem&&o.length==0){j.lazyload=false;g.data("initInput",this.selector||this)}else{if(j.initInput&&o.length){g.data("initInput",this.selector||this)}}if(j.connector){d.setConnetctAjax(j)}if(j.ajax.success){Jalor.UI.ajax.setFnSuccess(j.ajax)}if(j.lazyload){var o=this.validVal();if(j.initInput&&o.length){e=false}else{g.data("lazyload",true);e=true}}e||d.sendRequest(g,j.ajax,n)}}j.connector&&d.setConnector(this,j.connector);return this.each(function(q){var p=$(this).addClass("jalor-dropdown").attr("autocomplete","off").managerReg("dropdown",true),r=p.validVal();j.fnSetTrigger?j.fnSetTrigger(p,j.fnCallSelector,j.clickTrigger,j):d.setTrigger(p,j.fnCallSelector,j.clickTrigger,j);if(j.combo){p.bind("keydown",function(s){if(s.ctrlKey&&s.keyCode==86){p.removeData("copy");return}if(j.multiDisabled&&j.multi){return}if(j.multi&&Jalor.UI.isKeyDownValue(s)){s.stopImmediatePropagation();return false}});if(j.multiDisabled&&j.multi){d.setCombobox(p,j);p.prop("readonly")&&d.disabled(p,0,j)}if(!j.multi){d.setCombobox(p,j);p.prop("readonly")&&d.disabled(p,0,j)}}else{p.prop("readonly","readonly")}if(!j.onlyone&&q>0){g=g.clone(true);l=d.setSelector(p,g,j)}p.data("selector",l);p.keydown(d.keydown).blur(d.checkEmpty);j.pasteMatch&&j.combo&&p.bind("paste",d.onPaste);if(r.length&&!p.dataValue()){p.dataValue(r);if(p.data("setValue")!=0){if(e==null){d.setValue(p,r)}else{if(!j.initInput){p.one("click",function(u){var t=$(this),s=d.getSelector(t),v=s.data("op");s.data("initInput",t);v.fnCallSelector.call(t,u)})}}}}p.click(d.cancelClick);(j.richMode&&j.richMode.mode=="dialog")||Jalor.UI.bindPopupClose(p,g);typeof j.fnInitComplete=="function"&&j.fnInitComplete.call(p,p);j.readOnly===true&&p.attr("readonly","readonly")})}return this};Jalor.UI.regManager("dropdown",{setValue:function(e,f){return d.setValue(this.ctr,e,f,true)},reBind:function(f,e,g){return d.reBind(this.ctr,f,e,g)},getSelector:function(){return d.getSelector(this.ctr)},disabled:function(e){return d.disabled(this.ctr,e)},lock:function(f,e){f.data("ddl_locked",e)},revisionPosition:function(){var f=this.ctr,e=d.getSelector(this.ctr),g=e.data("op");d.popup(f,e,g)},valid:function(){return d.validInput(this.ctr)},resetLazyLoad:function(){this.ctr.data("lazyload",1)},hide:function(f){var e=f?"show":"hide";this.ctr[e]();f||Jalor.UI.popupClose(d.getSelector(this.ctr));d.getTrigger(this.ctr)[e]()},readonly:function(e){return d.readonly(this.ctr,e)}});$.validator.addMethod("jalor-combobox",function(f,e){return d.validInput($(e))});var a={setTrigger:function(h,f,l,n){var g,k,j=h.data("delay")/1000;j=j>1?j-1:1;h.removeData("delay");var e="";h.bind("keydown",function(){e=$(this).val()});Jalor.UI.delayEvent2(h,"keyup",function(q){if(q.keyCode===13){$(this).data("round",0);return false}if(e==$(this).val()){return false}var p=$(this),o=d.getSelector(p),r=o.data("op");if(!p.val()){a.validStyle(p)}if(p.hasClass("placeholder")){p.attr("search",p.val())}if(q.ctrlKey&&q.keyCode==86){p.removeData("calledText");a.callSelector.call(p)}else{if(Jalor.UI.isKeyDownValue(q)){k=0;if(!r.interval){if(p.data("nocall")){p.removeData("nocall")}else{q.keyCode!==13&&p.data("_matching",true);r.interval=setInterval(function(){if(p.data("called")){d.clearInterval(r);k=0;p.removeData("_matching")}else{if(k==j||k>j){a.matchKeydown(p,o,r);r.interval=null;r.defaultSelect===false&&a.validStyle(p);k=0}else{k++}}},200)}}}}},n.delay)},matchKeydown:function(f,e,h){h.interval&&clearInterval(h.interval);var g=h.sgtMulti?a.getCurrentText(f,h.multiSplit,h.valueSplit).text:f.val();if(a.checkSuggestText(f,e,h,g)&&h.onlyOneRequest!==false){f.removeData("_matching");h.interval&&clearInterval(h.interval);if(a.filter(g,e,h,f)){d.popup(f,e,h)}return}a.callSelector.call(f,true)},cacheFocus:function(e,f){e.data("pos",f||Jalor.UI.getInputFocus(e))},selectedBinded:function(f,e){var k=f.data("op");f.data("total",e.length);if(e.length==k.suggestNum||e.length==0){this.showMessage(f,e.length>0?"overNum":"noMatch",k)}else{this.showMessage(f)}var h=d.getInput(f);if(k.suggestMulti){var g=h.jalorGetValue();g=g.split(k.valueSplit);var j=f.find(".jalor-suggest-body tr");f.find(".jalor-suggest-head .suggestSelectAll").unbind("click").bind("click",function(){if($(this).parent("tr").hasClass("suggest-selectAll")){$(this).parent("tr").removeClass("suggest-selectAll");j.find("td:first").click()}else{$(this).parent("tr").addClass("suggest-selectAll");for(var l=0;l<j.length;l++){if($(j[l]).find("td:first").hasClass("suggest-multi-noSelect")){$(j[l]).find("td:first").click()}}}});j.find("td:first").addClass("suggestSelect").addClass("suggest-multi-noSelect");$.each(g,function(l,n){for(var o=0;o<j.length;o++){if(n==$(j[o]).attr("val")){$(j[o]).addClass("suggest-selected");$(j[o]).find("td:first").removeClass("suggest-multi-noSelect").addClass("suggest-multi-select");break}}})}this.checkDelayValid(d.getInput(f))},showMessage:function(e,g,j){var h,f=e.children(".jalor-selector-foot");if(g){switch(g){case"noMatch":h=Jalor.UI.Config.dropdown.text.noMatch;break;case"overNum":h=Jalor.UI.Config.dropdown.text.suggestNum.formatText(j.suggestNum);break}}if(h){f.text(h).show()}else{f.hide()}},getCurrentText:function(p,n,r){var s=p.val(),e,t,v,g,h=n.trim(),o=Jalor.UI.getInputFocus(p);if(!o){o=p.data("pos")||0}if(o>s.length){o=s.length}if(s.length){t=s.split(h);e=p.dataValue().split(r);for(var j=0,u;u=t[j];j++){t[j]=u.trim()}var f=t.length;if(Jalor.DataHelper.isEmpty(t[f-1])){t.splice(f-1,1)}if(t.length<e.length){this.checkText(p,t,r)}if(o==s.length){g=f-1;if(g==0){g=null}else{v=g<t.length?t[g].trim():""}}else{if(f>0&&t.length>0){var l=0,k=n.length;for(var j=0,q;j<t.length;j++){q=t[j].trim();l+=q.length+k;if(o<l){v=q;g=j;break}}}}}else{p.dataValue("").data("datas",[])}return{text:v==void 0?s:v,index:g,arrText:t,arrValue:e}},checkText:function(k,x,p){var f=k.data("datas");var g=$("<div>&nbsp;</div>").text();if(f&&f.length){var r=[],l=[],o={};for(var v=0,n=x[0];v<x.length;v++,n=x[v]){n=n.trim();if(n){for(var t=0,y,w=f.length;t<w;t++){y=f[t];var e=new RegExp(String.fromCharCode(160),"g");if(n.replace(g," ").replace(e," ")==y.text.trim()&&!o[t]){r.push(y);l.push(y.value);o[t]=true;break}}}}var s=l.join(p),q=k.dataValue();if(q!=s){k.data("datas",r).dataValue(s);var u=d.getSelector(k),h=u.data("op");if(h.fnSelected){h.fnSelected.call(k,s,k.val(),q,null,u)}}}},getData:function(n,q,o,p,k,l){var g=n.data("datas"),j,e=[];if(g&&n.val().split(l).length==1){var h=[];h.push({text:q,value:o});return h}if(!g){g=[]}if(g.length){for(var f=0,r=g[0];r;f++,r=g[f]){if(o==r.value){j=true;break}}}if(!j){g.push({text:q,value:o})}return g},getSortValue:function(k,h){var g=[],f={};if(h!=null){for(var j=0,e=k.length;j<e;j++){var l=k[j];if(l){l=l.trim();$.each(h,function(n,o){if(o.text==l&&!f[n]){o.value&&g.push(o.value);f[n]=true;return false}})}else{k.splice(j,1);j--;e--}}}return g},filter:function(k,f,n,h){f.data("cached",1);var g=f.find("."+n.itemClass);n.cacheReqest!==false&&Jalor.UI.matchText(k,g,function(o,p){p.toggleClass("hide",!o).removeClass(n.preSelected)});var l=g.filter(":not(.hide)"),j=true;h.removeData("haschanged");if(l.length>1){h.data("multiMatch",true)}else{h.removeData("multiMatch");a.validStyle(h)}if(l.length){var e=l.eq(0);if(l.length==1&&n.defaultSelect!==false){d.itemSeleted(f,e,n);f.hide();j=false}else{e.addClass(n.preSelected);this.showMessage(f);d.setWidth(f,n,h)}}else{j=false;f.hide();h.valid()}h.removeData("called").removeData("cached");if(h.data("_matching")){h.removeData("_matching").valid()}return j},selected:function(v,r,B,x,C,k){var p=$(this),o=x.data("op");var q={};$.each(k||[],function(D,E){q[E.value]==undefined&&(q[E.value]=E.text)});if(p.hasClass("jalor-user")){var A=v.split(o.valueSplit),y=r.split(o.multiSplit),j=[],l=[];if(A.length>1){$.each(A,function(E,D){if($.inArray(D,j)==-1){j.push(D);l.push(q[D])}else{y.splice(E,1)}});l.push("");v=j.join(o.valueSplit);r=l.join(o.multiSplit)}}if(v!=""&&!k){var g=a.getCurrentText(p,o.multiSplit,o.valueSplit);if(g.index!=void 0){if(g.arrText.length>=g.index){g.arrText[g.index]=r;k=a.getData(p,r,v,o.valueSplit,g.index,o.multiSplit);v=a.getSortValue(g.arrText,k).join(o.valueSplit);var f=[];if(k.length&&g.arrText.length>k.length){$.each(k,function(E,D){f.push(D.text)})}r=f.length?f.join(o.multiSplit):g.arrText.join(o.multiSplit);if(r.lastIndexOf(o.multiSplit)<r.length-o.multiSplit.length){r+=o.multiSplit}}}else{if(v){k=[{text:r,value:v}];r+=o.multiSplit}}}if(v){var z=r.replaceText(" "," ").split(o.multiSplit),n=v.split(o.valueSplit);if(Jalor.DataHelper.isEmpty(z[z.length-1])){z.splice(z.length-1,1)}if(z.length!=n.length){var u=[];$.each(k,function(E,D){u.push(D.text)});r=u.join(o.multiSplit)}}if(!o.fnCusBeforeSelected||o.fnCusBeforeSelected.call(p,v,r,B,x,C)!==false){if(r&&(r.length!=r.lastIndexOf(o.multiSplit)+o.multiSplit.length)){r+=o.multiSplit}var s=p.dataValue();d.addTip(p,r);p.dataValue(v).val(r).data("datas",k);p.removeData("haschanged").data("oldvalue",r);if(r&&!p.data("lazyload")){p.valid()}if(o.fnSelected){o.fnSelected.call(p,v,r,s,B,x,C)}}if(o.suggestMulti&&B){var h=p.data("datas");if(B.children("td.suggestSelect").hasClass("suggest-multi-select")){B.removeClass("suggest-selected");x.find(".jalor-suggest-head .suggestSelectAll").parent("tr").removeClass("suggest-selectAll");B.children("td.suggestSelect").removeClass("suggest-multi-select").addClass("suggest-multi-noSelect");$.each(h,function(D,E){if((E?E.value:E)==B.attr("val")){h.remove(E)}})}else{B.addClass("suggest-selected");B.children("td.suggestSelect").removeClass("suggest-multi-noSelect").addClass("suggest-multi-select");var e=x.find(".jalor-suggest-body tr");if(!e.find("td:first").hasClass("suggest-multi-noSelect")){x.find(".jalor-suggest-head .suggestSelectAll").parent("tr").addClass("suggest-selectAll")}}var t="";var w="";$.each(h,function(D,E){t+=E.value+",";w+=E.text+o.multiSplit});p.dataValue(t.substring(0,t.length-1)).val(w)}else{x.hide()}return false},callDefault:function(l){d.cancelClick(l,1);var h=d.getInput(this);if(h.isVisiable()){var f=d.getSelector(h),n=f.data("op");a.cacheFocus(h,h.val().length);if(!h.data("called")&&!f.data("isDefault")){f.data("isDefault",1);h.data("getDefault",1);h.data("calledText","");h.data("called",true);h.data("round",0);n.ajax.success=function(e){var q=e?(e.result||e):[];if(q&&q.length<=1&&n.defaultSelect!==false){return}if(n._type!="sgt"||f.find(".list-item").length>0||h.data("calledText")=="%"){d.popup(h,f,n,true);if(n.suggestMulti){var p=n.dataset||[];var r=[];var o=h.val().split(n.multiSplit).length-1;$.each(p,function(t,s){r.push(s)});if(o!=r.length){f.find(".suggest-selectAll").removeClass("suggest-selectAll")}}}};d.sendRequest(f,n.ajax,h)}else{if(n._type!="sgt"||f.find(".list-item").length>0||h.data("calledText")=="%"){d.popup(h,f,n,true);var j=n.dataset||[];var k=[];var g=h.val().split(n.multiSplit).length-1;$.each(j,function(o,e){k.push(e)});if(g!=k.length){f.find(".suggest-selectAll").removeClass("suggest-selectAll")}}}}},callSelector:function(e){var k=$(this),l;if(k.next("a.history").hasClass("hide")){k.next("a.history").removeClass("hide")}if(k.isVisiable()){var n=k.validVal(),g=d.getSelector(k);if(g.length){var h=g.data("op"),j=k.data("calledText"),o=true,f=g.data("isDefault");e||a.cacheFocus(k);if(n&&j==n&&h.onlyOneRequest!==false){o=a.filter(n,g,h,k)}else{if(j!==n||f||g.data("cached")||h.onlyOneRequest===false){if(n){if(h.sgtMulti){n=a.getCurrentText(k,h.multiSplit,h.valueSplit).text}if(!f&&a.checkSuggestText(k,g,h,n)&&h.onlyOneRequest!==false){o=a.filter(n,g,h,k)}else{l=true;d.sendRequest(g,h.ajax,k);k.removeData("cached")}}else{k.removeData("called").removeData("cached").removeData("_matching")}f&&g.data("isDefault",0)}}n&&o&&d.popup(k,g,h);if(h&&h.isFocusOutSelector){$(k).bind("focusout",function(q){var r=g.data("op"),p=g.find(":not(.hide)."+r.preSelected+":first");if(g.isVisiable()&&p.length){if(!r.multi){g.hide()}if(r.fnKeyEnter){r.fnKeyEnter(p,k,g,r)}else{d.itemSeleted(g,p,r)}$(k).unbind("focusout")}})}}}l||a.checkDelayValid(k)},checkSuggestText:function(f,e,j,h){var g=f.data("calledText");return g&&e.data("total")<j.suggestNum&&j.cacheReqest&&h.indexOf(g)==0},beforeRequest:function(l,f,e){var k,n=e.data("op"),j=f.data("getDefault");if(j){k=n.defaultFilter;f.removeData("getDefault")}else{if(l.multi){k=a.getCurrentText(f,n.multiSplit,n.valueSplit).text}else{k=f.val()}}if(f.hasClass("placeholder")){k=f.attr("search")}if(!f.dataValue()&&l.multi&&f.hasClass("jalor-user")){k=f.val().split(n.multiSplit.trim());if(Jalor.DataHelper.isEmpty(k[k.length-1])){k.splice(k.length-1,1)}f.data("calledText",k[k.length-1].trim())}else{f.data("calledText",k)}if((k&&!Jalor.DataHelper.isEmpty(k))&&(j||(k.len?k.len():k.join().len())>n.suggestLength-1)){var h;if(l.fnSetRequest){h=l.fnSetRequest(l,f,e,k);if($.isPlainObject(h)&&!$.isEmptyObject(h)){return h}}if(h!==false){if(typeof k=="object"&&k.length){var g=[];$.each(k,function(p,o){g.push(d.foramtParam(l,k[p].trim(),n.displayField))});return g}else{return d.foramtParam(l,k,n.displayField)}}}return false},setValue:function(f,g,h){var e=d.getSelector(f),j=e.data("op");if(Jalor.DataHelper.isEmpty(g)){d.selected(j,"","",null,e,f)}else{g+="";if(f.dataValue()!==g){f.dataValue(g);if(h==void 0){f.val(g);if(j.initInput){if(j.getTextAjax){if(!j.getTextAjax.type){j.getTextAjax.type="POST"}j.getTextAjax.data=g.split(j.valueSplit);if(!j.getTextAjax.success){j.getTextAjax.success=function(l){if(j.sgtMulti&&j.sort=="default"){var q=new Array(),p=f.data("value").split(j.valueSplit);for(var n=0;n<p.length;n++){$.each(l,function(r,k){if(k[f.attr("valueField")]==p[n]){q.push(k)}})}}var o=Jalor.UI.getValueText(q?q:l,j);f.removeData("called");a.setCurValue(j,o.value,o.text,null,e,f)}}d.ajax(j.getTextAjax,f)}else{e.data("initInput",f);j.fnCallSelector.call(f)}}else{d.selected(j,g,g,null,e,f)}}else{this.setCurValue(j,g,h,null,e,f)}}}return f},setCurValue:function(o,r,s,u,j,q){if(o.sgtMulti){if(r&&s){var t=s.split(o.multiSplit.trim()),e=r.split(o.valueSplit),k,n=[];var f=t.length;if(Jalor.DataHelper.isEmpty(t[f-1])){t.splice(f-1,1)}var p=t.length>e.length?e.length:t.length;for(var l=0;l<p;l++){if(k=e[l]){n.push({value:k,text:t[l].trim()})}}var h=s.length-o.multiSplit.length,g=s.lastIndexOf(o.multiSplit.trim())==h;!g&&(s+=o.multiSplit)}q.dataValue(r).val(s).data("datas",n).removeClass("error").removeData("multiMatch");q.removeData("haschanged").data("oldvalue",s);a.validStyle(q)}else{d.selected(o,r,s,null,j,q)}},checkDelayValid:function(e){var f=d.getSelector(e).data("op");e.removeData("called");if(e.data("_matching")){e.removeData("_matching");if(e[0]==document.activeElement){if(!f){e.clearValid()}else{if(f.defaultSelect!==false){e.clearValid()}}}else{e.valid()}}},validInput:function(p){var q=p.validVal().trim(),t=true;if(q){var h=d.getSelector(p).data("op");if(!h){return true}if(h.nopending!==true){if(p.data("_matching")||p.data("haschanged")){p.data("_delayValid",true);p.removeData("multiMatch");a.validStyle(p);return"pending"}else{p.removeData("_delayValid")}}if(h.sgtMulti){var g=p.data("datas"),k;var o=h.multiSplit.trim(),e,s=[];if(g&&g.length){var n=[],r=$.extend([],g);$.each(g,function(w,y){y.text=y.text.replaceText(" "," ");if(y.text.indexOf(h.multiSplit)!=-1&&y.value.indexOf(h.valueSplit)!=-1){var u=y.text.split(h.multiSplit),v=y.value.split(h.valueSplit);if(Jalor.DataHelper.isEmpty(u[u.length-1])){u.splice(u.length-1,1)}if(Jalor.DataHelper.isEmpty(v[v.length-1])){v.splice(v.length-1,1)}if(u.length==v.length){r.splice(w,1);for(var j=0,x=u[0];x;j++,x=u[j]){r.push({value:v[j],text:x});s.push(x.trim())}}}else{s.push(y.text.trim())}});g=r;p.data("datas",g);s=o+s.join(o)+o;q=q.replaceText(h.multiSplit,o).split(o);for(var f=0,l=q.length;f<l;f++){var e=q[f].replaceText(" "," ").trim();if(e){if(s.indexOf(o+e+o)<0){n.push(e)}}}if(n.length){k=n.join(";");t=false}}else{t=false}a.checkText(p,q,h.valueSplit)}else{t=d.validInput(p)}}a.validStyle(p);if(!t){if(d.getTrigger(p).hasClass("warning")){return""}else{p.attr("error_msg",k||q)}}return t},keyEnter:function(h,f,e,k){var g=f.data("calledText"),j;if(k.sgtMulti){j=a.getCurrentText(f,k.multiSplit,k.valueSplit).text}else{j=f.validVal()}if(j.length&&g!=k.defaultFilter&&j.indexOf(g)<0){f.data("called",1);k.fnCallSelector.call(f)}else{d.itemSeleted(e,h,k)}},onPaste:function(j){var g=$(this),h=g.validVal(),f=d.getSelector(g),k=f.data("op");if(g.hasClass("placeholder")){g.attr("search",g.val())}setTimeout(function(){if(k.sgtMulti){f.removeData("lazyload");g.removeData("initInput");var e=g.validVal(),l=k.multiSplit.trim();e=e.replaceText(k.multiSplit,l).split(l);if(e.length>1){g.val(h).data("nocall",1);a.matchPaste(g,f,k,e,h)}else{f.data("lazyload",true);d.matchInput.call(g,j,true)}}else{f.data("lazyload",true);d.matchInput.call(g,j,true)}},10)},matchPaste:function(q,h,l,g,e){var t,f=0,r={values:[],errors:[],choose:[]},k=q.data("datas");if(this.checkMatchText(g,k)>l.maxParseMatch){q.val(e);Jalor.UI.showMessage($i18n("jalor.common.validate.suggestParse").format(l.maxParseMatch),"error");return false}for(var j=0,n=g.length;j<n;j++){var s=g[j].trim();if(s.length&&Jalor.Format.getArrayItem(s,k,"text")==null){var p=d.foramtParam(l.ajax,s,l.displayField),o=function(){if(r.values.length+r.errors.length+r.choose.length+f==n){a.endParseMatch(q,h,l,r,g)}};this.setParseAjax(q,l,p,s,r,o,j);q.parent().loading();Jalor.UI.ajax(p)}else{f++}}if(f==n){a.endParseMatch(q,h,l,r,g)}},checkMatchText:function(f,h){var g=0;for(var j=0,e=f.length;j<e;j++){var k=f[j].trim();if(k.length&&Jalor.Format.getArrayItem(k,h,"text")==null){g++}}return g},setParseAjax:function(f,l,j,k,e,h,g){j.success=function(n){var o=n?(n.result||n):[];if(o.length){if(o.length==1){e.values.push({index:g,value:o[0][l.valueField],text:o[0][l.displayField],oldText:k,data:o[0]})}else{e.choose.push({index:g,text:k,data:o})}}else{e.errors.push({index:g,text:k})}f.data("calledText",k);h()};j.error=function(){e.errors.push({index:g,text:k});h();return true};j.loading=false},endParseMatch:function(h,f,j,e,g){h.removeData("_matching").parent().loadingClose();if(e.choose.length||e.errors.length){this.openChoose(e,h,f,j,g)}else{this.setChooseValue(h,f,j,g,e)}h.removeData("nocall").removeData("copy")},setChooseValue:function(n,g,k,f,p){var e,l=[],q=[];var j={};$.each((n.data("datas")||[]),function(r,s){j[s.value]=true});if(p.values.length){$.each(p.values,function(r,s){if(s.text!=null){f[s.index]=s.text;!j[s.value]&&l.push({value:s.value,text:s.text});q.push(s.data)}else{f[s.index]=null}})}var h=(n.data("datas")||[]).concat(l),o=a.getSortValue(f,h).join(k.valueSplit);this.selected.call(n,o,f.length>0?(f.join(k.multiSplit)+k.multiSplit):"",null,g,q,h)},openChoose:function(f,h,e,j,g){Jalor.UI.dialog(null,"jalor.common.suggest.parseConfirm",{width:600,content:"<div id='suggest_parseResult' class='jalor-selector-body'><dl id='suggest_choose'></dl></div>",fnLoad:function(k){h.data("ctr_locked",true).focus();a.buildChooseList(k,f,g,h,e,j)},okClick:function(k){h.data("ctr_locked",false).focus();a.getChoose(k,f,h,e,j,g,this);this.close()}})},buildChooseList:function(g,f,j,h,e,l){var k=[];$.each(f.values,function(o,p){k.push("<dt class='matched' _index='",o,"'>[√] ",p.oldText.encode()," : <span>",p.text.encode(),'</span><a class="jalor-icon del"></a></dt>')});$.each(f.errors,function(o,p){k.push("<dt class='non-match' _index='",o,"'>[×] ",p.text.encode(),'<a class="jalor-icon del"></a></dt>')});$.each(f.choose,function(o,p){k.push("<dt class='choose-match' _index='",o,"'>[...] <samp class='toggle-choose'>",p.text.encode(),' : </samp><span></span><a class="jalor-icon del"></a></dt><dd>',l.panelBegin,Jalor.UI.tmplList(l.item,p.data),l.panelEnd,"</dd>")});g.find("#suggest_choose").html(k.join("")).delegate(".list-item","click",function(){var q=$(this),o,r,n=q.parents("dd:first"),p=n.prev();if(q.hasClass("selected")){q.removeClass("selected");r=""}else{o=true;q.parent().children(".selected").removeClass("selected");q.addClass("selected");r=q.find(".list-text").text();p.addClass("closed");n.hide()}p.children("span").text(r)}).delegate(".toggle-choose","click",function(){var o=$(this).parent().toggleClass("closed"),n=!o.hasClass("closed");o.next().toggle(n)}).delegate(".del","click",function(o){var n=$(this).parent();a.deleteItem(n,f,j);o.stopPropagation()})},deleteItem:function(j,e,f){var g=j.attr("_index")*1,k,h;if(j.hasClass("matched")){h=e.values[g]}else{if(j.hasClass("non-match")){h=e.errors[g]}else{if(j.hasClass("choose-match")){k=true;h=e.choose[g]}}}f[h.index]=null;h.text=null;k&&j.next().remove();j.remove()},getChoose:function(g,f,j,e,n,h,l){var k;$("#suggest_choose > dt.choose-match").each(function(q){var s=$(this),o=s.attr("_index")*1,u=s.children("span").text();if(u.length){var r=f.choose[o],p=Jalor.Format.getArrayItem(u,r.data,n.displayField);if(p){var t=p[n.valueField];f.values.push({index:r.index,value:t,text:u,data:p})}}else{k=s}});if(k){Jalor.UI.confirm("jalor.common.suggest.confirmNonChoose",function(o){if(o){a.setChooseValue(j,e,n,h,f);Jalor.UI.dialog.triggerCancel(l)}else{k.parent().parent().scrollTop(k.position().top-20)}})}else{a.setChooseValue(j,e,n,h,f);Jalor.UI.dialog.triggerCancel(l)}},validStyle:function(e){var f=d.getTrigger(e);if(e.data("multiMatch")&&e.validVal().trim()&&e.data("calledText")!="%"&&d.validInput(e)!==true){!e.hasClass("error")&&e.addClass("error");!f.hasClass("warning")&&f.addClass("warning")}else{f.removeClass("warning")}}};$.fn.suggestion=function(g){var k=$.extend(true,{delay:Jalor.UI.Config.dropdown.suggestDelay,multi:false,showTrigger:true,suggestLength:0,defaultFilter:"%",pasteMatch:true,suggestNum:Jalor.UI.Config.dropdown.suggestNum,maxParseMatch:Jalor.UI.Config.dropdown.maxParseMatch,clearRepeating:Jalor.UI.Config.dropdown.clearRepeating,cacheReqest:true,initInput:false,suggestMulti:false,isFocusOutSelector:false,getTextAjax:null},g);var j=k.multi;k.sgtMulti=j;$.extend(k,{multi:false,onlyone:false,combo:false,lazyload:true,fnSetTrigger:a.setTrigger,fnCallSelector:a.callSelector,fnKeyEnter:a.keyEnter,_type:"sgt",css:null});if(k.ajax&&k.ajax.url){k.ajax.url=k.ajax.url.formatField({suggestNum:k.suggestNum,connect:"${connect}"});if(k.ajax.beforeRequest){var f=k.ajax.beforeRequest;k.ajax.fnSetRequest=f}k.ajax.beforeRequest=a.beforeRequest;var e=k.fnBinded;k.fnBinded=function(n,l){a.selectedBinded(n,l);e&&e(n,l)};if(j){k.ajax.multi=true;if(k.fnBeforeSelected){var h=k.fnBeforeSelected;k.fnCusBeforeSelected=h}k.fnBeforeSelected=a.selected}return this.each(function(){var n=$(this);n.dropdown(k).removeProp("readonly").managerReg("suggestion",true);k.readOnly&&n.attr("readonly","readonly");if(!n.hasClass("jalor-suggest")){n.addClass("jalor-suggest")}$(n.data("selector")).removeData("lazyload");var l="";n.bind("focus",function(){l=n.val();var o=d.getSelector($(this));o.removeData("notValid");if(n.hasClass("placeholder")){if(n.val()==n.attr("placeholder")){$(this).val("").removeClass("filter-gray")}}var r=$(this),t=r.val().trim();var q=r.attr("focustime");if(q&&new Date()-q*1<100){return}var p=d.getTrigger(r);if(!r.val()&&p.hasClass("history hide")&&Jalor.History.hasHistory(k)){var s=Jalor.History.getHistory(k.historyKey||(k.ajax&&k.ajax.url));if(s.length>1||s[0].data){p.removeClass("hide")}}if(!t){r.removeData("haschanged").removeData("multiMatch");a.validStyle(r);return}setTimeout(function(){r.data("_delayValid")&&r.data("_matching")&&r.removeData("_delayValid");if(d.getTrigger(r).hasClass("warning")&&!d.getSelector(r).is(":visible")){Jalor.UI.setInputFocus(r.attr("focustime",new Date().getTime()));if(!r.data("called")&&k.fnCallSelector){Jalor.UI.setInputFocus(r,r.data("lastFocusIndex"));k.fnCallSelector.call(r,true)}}},0)}).bind("blur",function(q){var p=$(this),t=d.getSelector(p).data("op"),s=p.val().trim();if(p.hasClass("placeholder")){if(!s){setTimeout(function(){p.addClass("filter-gray").val(p.attr("placeholder"));p.removeData("haschanged").removeData("multiMatch").removeClass("error")},50);return}}if(!p.data("called")&&document.activeElement!==p[0]&&l!=n.val()){var r=a.getCurrentText(p,t.multiSplit,t.valueSplit).text;if(!r.length||r.length<t.suggestLength){p.removeData("haschanged").removeData("multiMatch").removeClass("error");var o=d.getSelector(p);!o.data("notValid")&&p.valid();o.removeData("notValid");if(p.parents(".gt-grid").length){p.next("label.error").remove()}return}if(p.data("haschanged")&&!p.data("called")&&t.fnCallSelector){p.removeData("calledText").data("round",0);d.clearInterval(t);t.fnCallSelector.call(p,true)}if(p.data("haschanged")){a.validStyle(p)}if(p.parents(".gt-grid").length&&p.hasClass("error")){p.next("label.error").show()}}});d.setTrigger(n,a.callDefault,null,k);k.pasteMatch&&n.bind("paste",a.onPaste)})}};$.validator.addMethod("jalor-suggest",function(f,e){return a.validInput($(e))});Jalor.UI.regManager("suggestion",{setValue:function(e,f){return a.setValue(this.ctr,e,f)},getText:function(){var f=this.ctr.val();if(f){var g=d.getSelector(this.ctr).data("op");if(g.sgtMulti&&g.clearRepeating!==false){var e=f.split(g.multiSplit);if(e.length>1){return e.clearRepeating().join(g.multiSplit)}}}return f},getValue:function(){var f=this.ctr.dataValue();if(f){var g=d.getSelector(this.ctr).data("op");if(a.validInput(this.ctr)!==true){if(!g.sgtMulti){return""}}if(g.sgtMulti&&g.clearRepeating!==false){var e=f.split(g.valueSplit);if(e.length>1){return e.clearRepeating().join(g.valueSplit)}}}return f},getSelector:function(){return d.getSelector(this.ctr)},valid:function(){return a.validInput(this.ctr)},disabled:function(e){return d.disabled(this.ctr,e)},lock:function(f,e){f.data("ddl_locked",e)},hide:function(f){var e=f?"show":"hide";this.ctr[e]();f||d.getSelector(this.ctr).hide();d.getTrigger(this.ctr)[e]()},readonly:function(e){return d.readonly(this.ctr,e)}});var b={init:function(e,j){if(j.richMode){if(j.richMode.url){j.combo=false;if(j.richMode.mode=="dialog"){j.fnCallSelector=b.callDialog}else{b.createLoad(e,j)}}else{if(j.richMode.mode){e.addClass("jalor-selector-"+j.richMode.mode).data("step",1);var g=d.getInput(e),h=e.id()+"_con",f=$.create(j.richMode.mode=="tree"?"ul":"div").id(h).appendTo(d.getSelectorBody(e)).click(function(k){k.stopPropagation()});if(j.delay<1000){j.delay=1000}j.multi=false;j.fnCallSelector=b.callSelector;if(j.combo){j.fnMatchInput=null;g.data("setValue",0);Jalor.UI.delayEvent(g,"keyup",b.callSelector,j.delay,Jalor.UI.isKeyDownValue)}if(j.richMode.mode=="grid"){j.itemClass="gt-row";j.preSelected="gt-row-selected";j.fnKeyEnter=function(n,l,k,o){b.gridRowClick(n,l,k)}}}}}},callSelector:function(j){if(j&&j.type=="click"){d.cancelClick(j,1)}var g=d.getInput(this),f=d.getSelector(g),k=f.data("op"),h=f.data("step");f.data("_inpop",true);if(j&&j.type=="click"||f.is(":visible")||g.val().trim()){if(k.richMode&&k.richMode.mode=="tree"){b.initTree(g,f,k,h,(j&&j.type=="click"))}else{b.initGrid(g,f,k,h)}if(h==1){if(k.combo){f.data("step",2)}else{f.removeData("step")}}g.data("round",false);d.popup(g,f,k);f.removeData("_inpop")}},initGrid:function(h,f,k,j){if(j==1){var g=k.richMode.op;g.onRowClick=b.gridRowClick;if(k.combo){var e=g.operation.search.filterField;if(e){g.operation.search.fnload=function(n,o,l){o={};o[e]=h.val();Jalor.doGet(n,o,l)}}}d.getSelectorBody(f).children().jalorGrid(g);f.width(k.richMode.op.width);k.richMode=null}else{if(j==2){d.getSelectorBody(f).children().jalorGridSearch()}}},gridRowClick:function(k,f,l,o){var h=$(o||k);if(h.length){var k=h.find("span.jalor-selector-value").text(),n=h.find("span.jalor-selector-text").text();var e=h.parents(".jalor-selector"),g=e.data("op"),j=d.getInput(e);d.selected(g,k,n,h,e,j)}},initTree:function(n,f,g,e,k){if(e==1||g.connector){var p=g.richMode.op,h=d.getSelectorBody(f);p.setting||(p.setting={});p.setting.onClick=b.TreeClick;p.setting.beforeCollapse=p.setting.beforeExpand=function(){setTimeout(function(){f.focus()},0)};var j=p.url;if(g.connector){var l=g.fnGetConnectValue?g.fnGetConnectValue(n,g):d.getConnectValues(g.connector);j=j.format(l);if(l){h.children().jalorTree(j,p.setting,p.callback)}}else{var o=n.val().trim();if(o!=(n.data("oldFilterValue")||"")){n.data("oldFilterValue",o);p.setting.filterDataValue=o;n.data("round",false)}h.children().jalorTree(j,p.setting,p.callback)}f.width(g.richMode.op.width)}else{if(e==2&&!k){var o=n.val().trim();if(o!=(n.data("oldFilterValue")||"")){n.data("oldFilterValue",o);Jalor.UI.treeFilter(d.getSelectorBody(f).children(),o,true,false);n.data("round",false)}}}b.initTreeMoveEvent(n,f,false)},initTreeMoveEvent:function(f,e,h){var g;!f.attr("treemove")&&f.attr("treemove",true).bind("keydown.treemove",g=function(v){var n=$(this),q,x,w=v.keyCode;if(!(w>=37&&w<=40||w==13||w==32)){return}if(n.is("input")){x=n;q=d.getSelector(x);if(w>=37&&w<=40||w==13){q.data("_active",true);q.show().focus().show();setTimeout(function(){q.show().focus();q.data("_active",null);var B=q.find(".ztree:first"),D=B.getJalorTreeManager(),C=B.find("a[treeNode_a].curSelectedNode");if(!C.is(":visible")){C.removeClass("curSelectedNode");C.not("a")}if(C.length==0){if(h){q.find(".ztree:first").find("a[treeNode_a]:first").click()}else{q.find(".ztree:first").find("a[treeNode_a]:first").addClass("curSelectedNode")}}},200);return false}}else{q=n}if(q.length==0||!q.is(":visible")){return}var A=q.find(".ztree:first"),r=A.getJalorTreeManager(),k=A.find("a[treeNode_a].curSelectedNode"),s,j;if(!k.is(":visible")){k.removeClass("curSelectedNode");k.not("a")}var t=k.parent("li"),u;if(t.length&&(w==37||w==39)){var p=r.getNodeByTId(k.parent().prop("id")),y=w==39;if(p.isParent){y&&!p.open&&t.find("button[treeNode_switch]:first").click();!y&&p.open&&t.find("button[treeNode_switch]:first").click()}else{if(!y){var l=t.parent().parent();if(l.length>0){if(h){l.children("a:first").click()}else{l.children("a:first").addClass("curSelectedNode");t.children("a:first").removeClass("curSelectedNode")}}}}q.focus();return false}else{if(w==38){if(t.length>0){u=b.treeMove(t,"prev",A,h)}else{A.find("a[treeNode_a]:first").addClass("curSelectedNode")}}else{if(w==40){if(t.length>0){u=b.treeMove(t,"next",A,h)}else{A.find("a[treeNode_a]:first").addClass("curSelectedNode")}}else{if(w==13){if(q.find(".jalor-selector-operate > input").length>0){q.find(".jalor-selector-operate > input").click()}else{t.find("a:first").click()}}else{if(w==32){t.children("button[treeNode_check]").click();return false}}}}}var z=25;if((w==38||w==40)&&u&&u.length>0){if(h){var o=q.find(".jalor-selector-page");if(u.position().top<0){o.scrollTop(o.scrollTop()+u.position().top)}else{if(u.position().top+z>o.height()){o.scrollTop(o.scrollTop()+u.position().top+z-o.height())}}}else{if(A.offset().top-u.offset().top>0){A.scrollTop(A.scrollTop()-(A.offset().top-u.offset().top))}else{if(u.offset().top+z>A.offset().top+A.height()){A.scrollTop(A.scrollTop()+(u.offset().top-A.offset().top-A.height())+z)}}}}return false});!e.attr("treemove")&&e.attr("treemove",true).bind("keydown.treemove",g)},treeMove:function(f,h,e,l){var g=e.find("li:visible"),k,j=f.prop("id");g.each(function(n){if(this.id==j){k=h=="next"?g[n+1]:g[n-1];if(k){if(l){$(k).children("a:first").click();f.children("a:first").removeClass("curSelectedNode")}else{$(k).children("a:first").addClass("curSelectedNode");f.children("a:first").removeClass("curSelectedNode")}}return false}});return $(k)},TreeClick:function(j,h,k){var f=$("#"+h).parent().parent(),g=f.data("op"),l=d.getInput(f),p=g.richMode.op,n,o;f.find("a.curSelectedNode").not("#"+k.tId+"_a").removeClass("curSelectedNode");o=k[g.displayField];n=k[g.valueField];if(p.fnSelected&&!p.fnSelected(k)){return null}d.selected(g,n,o,k,f,l);setTimeout(function(){l.focus()},300)},createLoad:function(e,j){j.fnCallSelector=b.callPage;var h=e.addClass("jalor-selector-load").children(".jalor-selector-body").width(j.richMode.width).height(j.richMode.height+30);var g=$.create("div").addClass("jalor-selector-page").height(j.richMode.height).appendTo(h),f=$.create("div").addClass("jalor-selector-operate").html(Jalor.UI.button("jalor.common.button.ok")).appendTo(h)},callPage:function(k){d.cancelClick(k,1);var g=d.getInput(this),f=d.getSelector(g),l=f.data("op"),j;if(l.richMode.url){f.find(".jalor-selector-page").jalorLoad(l.richMode.url,function(){var e=f.data("fnSetSelected");e&&e(g.dataValue(),g.val());if(f.find("div.ztree,ul.ztree").length){f.find(".jalor-selector-page").css("margin-bottom",30);b.initTreeMoveEvent(g,f,true)}},true);l.richMode.url=null}else{j=true}d.popup(g,f,l);if(j){var h=f.find(".jalor-selector-operate > input");if(h.data("fnSetSelected")){h.data("fnSetSelected")()}}},callDialog:function(h){d.cancelClick(h,1);var g=d.getInput(this),f=d.getSelector(g),j=f.data("op");if(j.richMode.url){Jalor.UI.dialog(j.richMode.url,"Selector",{width:j.richMode.width,height:j.richMode.height,okClick:function(){}});Jalor.UI.dialog._caller=g}}};Jalor.UI.Selector={register:function(e,j,h){if(j){var f,g=$(e).parents(".jalor-selector");if(g.length){f=g.find(".jalor-selector-operate > input");if(h){f.data("fnSetSelected",h)}}else{g=$(e).parents(".jalor-dialog-body").next();f=g.children("input.jalor-dialog-button:first")}f.click(function(){var n=j();if(n){var k,l;if(f.hasClass("jalor-dialog-button")){if(Jalor.UI.dialog._caller){l=Jalor.UI.dialog._caller;k=d.getSelector(l);Jalor.UI.dialog._caller=null;$(this).next().click()}}else{k=$(this).parents(".jalor-selector");l=d.getInput(k)}Jalor.UI.Selector.selected(n,k,l)}})}},selected:function(j,e,f){var l=e.data("op"),h,k;if(j.length){var g=Jalor.UI.getValueText(j,l);h=g.value;k=g.text}else{h=j[l.valueField];k=j[l.valueField]}d.selected(l,h,k,j,e,f);f.focus()},getInput:function(f){var e=$(f).parents(".jalor-selector");if(e.length){return d.getInput(e)}else{if(Jalor.UI.dialog._caller){return Jalor.UI.dialog._caller}}},setGridSelected:function(f){var f=$(f),e=Jalor.UI.Selector.getInput(f);if(e){var g=e.dataValue(),j=$(e.data("selector")).data("op"),h=f.getJalorGridManager();h.selectedRows=[];Jalor.UI.matchText(g,f.find(".gt-body-div .jalor-selector-value"),function(k,l){var n=l.parents("tr.gt-row");h.checkRow(n[0],k)},j.valueSplit,null,null,1)}}}})(jQuery);function _stopDefasultEvent(a){if(a.preventDefault){a.preventDefault()}else{a.returnValue=false}}Jalor.Layout.urlCache={};Jalor.menuHandle=function(c){var b=c.children,f,e=Jalor.Layout.Config.LeftMenu.Target;f=c.target||e.self;if(c.url){Jalor.Layout.urlCache[c.url]=c.siteNodeId;c.click="_stopDefasultEvent(event);";if(f==e.frame){c.target=e.self;if(c.url.indexOf("?")>0){c.url="#!"+c.url+"&__target="+e.frame}else{c.url="#!"+c.url+"?__target="+e.frame}}else{if(!/^http:|^https:|^\.|^\//.test(c.url)){if(c.url.indexOf("#!")==-1){c.url="#!"+c.url}}}}if(b){for(var a=0,d;d=b[a];a++){Jalor.menuHandle(d)}}};Jalor.Layout.refreshNavigationBar=function(c){var a=Jalor.Layout.getRootParentByNode(c);a.push(c);var b="";$.each(a,function(f){var e='href="{0}"'.formatValue(this.url);var d=this.url?"a":"span";if(f<a.length-1){b+=("<{0} "+e+">{1}</{2}> > ").formatValue(d,this.name,d)}else{b+=("<{0} "+e+">{1}</{2}> ").formatValue(d,this.name,d)}});$("#jalor_page_nav").empty();$("#jalor_page_nav").html(b);Jalor.Layout.renderTitle(c);$("#jalor_page_nav").find("a").click(function(){Jalor.Page.forward($(this).prop("href"))})};Jalor.Layout.getRootParentByNode=function(c){if(!c.getParentNode){return[]}var b=[],a=c;while(a=a.getParentNode()){b.push(a)}b.reverse();return b};Jalor.Layout.refreshLeftMenu=function(e,b){var a=$("#leftSiteMapTree").getJalorTreeManager();var c=Jalor.Layout.getRootParentByNode(e);var d=c.length>0?c[0]:e;$.each(Jalor.Layout.treeData,function(){var f=a.getNodeByParam("siteNodeId",this.siteNodeId);if(f.siteNodeId!=d.siteNodeId&&f.open){a.expandNode(f,false,true)}});if(e.isParent&&!b){a.expandNode(e)}Jalor.Layout.refreshScroller()};Jalor.Init.AfterUI.add(function(){var a=["<DIV id=filter_leftSiteMapTree  class=jalor-tree-filter>",'<INPUT id="filterInput_leftSiteMapTree" style="width:100%" maxLength=100 type=text ></div>','<div id="nanoscroller" class="nano"><div  class="content"><ul id="leftSiteMapTree"  ></ul></div></div>'];if(workspaceVO.config.IsFixedMenu&&workspaceVO.config.IsFixedMenu!=0&&$("#leftSiteMapTree").length){$("#leftMenuContent").html(a.join(""))}});Jalor.Layout.initMenuScroll=function(){if(workspaceVO.config.IsFixedMenu&&workspaceVO.config.IsFixedMenu!=0&&$("#leftSiteMapTree").length){Jalor.UI.Resizes.add(function(){Jalor.Layout.refreshScroller()});$(document.body).id("bodyfixed");var b=$("#leftSiteMapTree").getJalorTreeManager().setting;var a=window.innerHeight||document.documentElement.clientHeight;Jalor.Layout.refreshScroller();b.callback.onExpand=b.callback.onCollapse=function(){Jalor.Layout.refreshScroller()};$("#nanoscroller").bind("mousewheel",function(h){var d=$(this).children(".content"),g=d.scrollTop(),f=h.originalEvent.wheelDelta,c=$("#leftSiteMapTree").height()-d.height();if($("#leftSiteMapTree").height()<=$("#leftSiteMapTree").parent().height()){return true}if(g<=0&&f>0){return false}if(g+d.height()-$("#leftSiteMapTree").height()>0&&f<0){return false}})}};Jalor.Layout.refreshScroller=function(){if(workspaceVO.config.IsFixedMenu&&workspaceVO.config.IsFixedMenu!=0&&$("#leftSiteMapTree").length){var a=window.innerHeight||document.documentElement.clientHeight;var d=$("#c_layout").position().top+parseInt($("#c_layout").css("margin-top")),c=d+($("#foot_div").is(":visible")?$("#foot_div").height():0);$("#leftMenuContent").css("top",d);$("#leftMenuContent").height(parseInt(a)-c-5);var b=40;$("#nanoscroller").height(parseInt(a)-c-b).nanoScroller();$("#jalorMainPanel").css("padding-bottom",$("#foot_div").height());$("#leftSiteMapTree").parent().css("height","")}setTimeout(function(){$("#c_layout").css("min-height",$("#leftMenuContent").height())})};Jalor.Init.Complete.add(Jalor.Layout.initMenuScroll);Jalor.Layout.selectMenuByUrl=function(){var k=$("#leftSiteMapTree").getJalorTreeManager();if(k){var a=Jalor.Page.getRequest(),c=window.location.href,b=c.split("#!")[1]||"",e;if(!b){k.selectNode(k.getNodes()[0],false);Jalor.Layout.refreshNavigationBar(workspaceVO.leftMenuNode);return}var h=a.jalorNode;if(h){e=k.getNodeByParam("location",h);if(e){k.selectNode(e,false);Jalor.Layout.refreshNavigationBar(e);Jalor.Layout.refreshScroller();return}}if(c.indexOf("#!")>0){c=b}var j=k.getSelectedNodes();if(j.length>0){var f=j[0];if("#!"+c==f.url||c==f.url){Jalor.Layout.refreshNavigationBar(f);return}}var d=Jalor.Layout.getCacheId(c),e;if(d){e=k.getNodeByParam("url","#!"+c);if(!e){var g=c.indexOf("?");if(g>0){e=k.getNodeByParam("url","#!"+c.substring(0,g))}}if(e){k.selectNode(e,false);Jalor.Layout.refreshNavigationBar(e);Jalor.Layout.refreshScroller();return}}}};Jalor.Layout.getCacheId=function(b){Jalor.Core.log("find nodeId by url:"+b);if(b){var a=b.lastIndexOf("&");a<0&&(a=b.lastIndexOf("?"));if(a>0){return Jalor.Layout.urlCache[b]||Jalor.Layout.getCacheId(b.substring(0,a))}else{return Jalor.Layout.urlCache[b]}}};Jalor.Layout.renderRoleSelect=function(){var b=Jalor.WorkspaceVO.user,c=workspaceVO.config.MergePermission2CurrentRole*1;workspaceVO.user.roleDefaultUrl={};if(!c){var a=new Array();a.push("<span>{0}</span>：".formatValue($i18n("jalor.home.label.currrole")));a.push("<select id='currentrole' name='currentrole' onchange='Jalor.Permission.changeRole($(this).val());'>");var d=b.currentRole.roleId;$.each(b.validRoles,function(e,g){g.defaultUrl&&(workspaceVO.user.roleDefaultUrl[g.roleId+""]=true);var f=(g.roleId===d)?("<option value='${roleId}' selected>${roleName}</option>").formatField(g):("<option value='${roleId}'>${roleName}</option>").formatField(g);a.push(f)});a.push("</select>");$("#s_switch_role").append(a.join(" "))}else{$("#s_switch_role").hide()}};Jalor.Layout.renderHeader=function(){$("#firstLoading").remove();var d=Jalor.Layout.Config.W3MenuSettings;if(!workspaceVO.switchLanguageEnabled){delete d.switch_lan}d.mylinks=false;d.app_setting.en.name=d.app_setting.cn.name=$i18n("app.common.label.applicationName");d.lan_parameter={default_lan:Jalor.Local.getCurrLanguage(true)},window.w3&&w3.inner.ui.init(d);var a=$(".W3AppTop_gray_Bar_Content_right ul li").find("a[href='#']");a.attr("href","javascript:;");var f=$(".W3AppTop_gray_Bar_Content_right >ul >li:eq({0})".formatValue(workspaceVO.switchLanguageEnabled?4:3));!f.length&&(f=$(".W3AppTop_gray_Bar_Content_right >ul >li:last"));var b=$("<li><span class='W3AppTop_dot'><a id='fullScreen_a'  href='javascript:Jalor.Common.toggleScreen();'>{0}</a></span></li>".formatValue($i18n("jalor.home.label.fullscreen")));f.before(b);if(workspaceVO.switchLanguageEnabled){var g=$("#W3AppTop_Container a[href*='Jalor.Local.changeLanguage']").parent();var e=[],h=Jalor.Format.getLangugaeList();for(var c=0;len=h.length,c<len;c++){e.push('<option value="{0}" {1}>{2}</option>'.formatValue(h[c].id,h[c].id==workspaceVO.currentLanguage?'selected="selected"':"",$i18n(h[c].text)))}g.html('<select onchange="Jalor.Local.changeLanguage(this.value)">'+e.join("")+"</select>")}};Jalor.Layout.renderLanguageCSS=function(){$("head").append(Jalor.Local.getCurrLanguage()=="en_US"?"<style type='text/css'>.zh_CN {display:none}</style>":"<style type='text/css'>.en_US {display:none}</style>")};Jalor.Layout.renderMenu=function(){Jalor.UI.loading();$(document).bind("keydown",function(j){Jalor.Core.forbidBackSpace(j)});$(document).bind("keypress",function(j){Jalor.Core.forbidBackSpace(j)});$("#midPanel").bind("click",function(){var e=$("#leftPanel").toggle();var j=$("#menuHideNarrow").toggleClass("narrow");Jalor.UI.Resizes.fire("menu")});var f={filter:"#filterInput_leftSiteMapTree",urlMode:true,onClick:function(j,n,l){$("#globalloading").remove();var k=Jalor.Layout.Config.LeftMenu.Target,o=l.target,e;if(l.url&&l.url.length>2){if(l.url==window.location.hash){Jalor.Page.forward(l.url)}else{if(o==k.self){if(l.url.indexOf("#!")==0){Jalor.Page.forward(l.url.substring(2));Jalor.Layout.renderTitle(l)}else{window.location=l.url}}else{if(o==k.blank){Jalor.Layout.selectMenuByUrl();window.open(l.url).focus();return}else{if(o==k.frame){}else{Jalor.Layout.selectMenuByUrl();window.open(l.url,o);return}}}}}Jalor.Layout.refreshLeftMenu(l)},beforeExpand:function(j,e){Jalor.Layout.refreshLeftMenu(e,true)}};var a=workspaceVO.leftMenuNode;Jalor.Page.homePath=a.url;Jalor.menuHandle(a);var b=$("#W3AppTop_Header .W3AppTop_Header_title_app");var d=$('<a style="color:inherit;font-size:inherit;font-weight:inherit;text-decoration:none;"></a>').text(b.text()).attr("href",a.url);d.click(function(){var e=$("#leftSiteMapTree").getJalorTreeManager();if(e&&e.selectNode){e.selectNode(e.getNodes()[0],false)}Jalor.Layout.refreshNavigationBar(workspaceVO.leftMenuNode)});b.html(d);var c=location.href.indexOf("#!");if(c<0||c==location.href.length-2){try{if(workspaceVO.user.currentRole.defaultUrl){Jalor.Page.forward(workspaceVO.user.currentRole.defaultUrl)}}catch(g){}}$("#jalor_page_nav").html("<a href='{0}'>{1}</a> >".formatValue(a.url,a.name));if(a.children){var h=[{name:a.name,url:a.url,target:a.target,click:"_stopDefasultEvent(event);"}];h=h.concat(a.children);Jalor.Layout.treeData=a.children;$("#leftSiteMapTree").delegate("li","click",function(j){if(j.target.tagName.toLowerCase()!="li"){return}$(this).children("a:first").click();j.stopPropagation()}).delegate("li","mouseover",function(j){$(this).addClass("li_mouseover");j.stopPropagation()}).delegate("li","mouseout",function(j){$(this).removeClass("li_mouseover");j.stopPropagation()});$("#leftSiteMapTree").jalorTree(h,f)}};Jalor.Layout.renderTitle=function(a){document.title=a.name+" - "+$i18n("app.common.label.title")};window.onbeforeunload=function(){var a=$(".jalor-fullscreen-full"),b;if(a.length>0){b=a.find(".jalor-igrid");if(b.length>0&&b.manager().op.fullOutTip){return $i18n("jalor.common.messag.fullOutTip")}}};function _getMapper(a){var b=a.data("mapper");return b||null}function _setMapper(a,b){return a.data("mapper",b)}$.fn.jalorSetValue=function(a){if(!Jalor.DataHelper.hasValue(a)){a=""}var b=_getMapper(this);if(b&&b.setValue){b.setValue(a,this)}else{this.manager().setValue(a)}return this};$.fn.jalorGetValue=function(){var a=_getMapper(this);if(a&&a.getValue){return a.getValue()}else{return this.manager().getValue().trim()}};$.fn.jalorReset=function(){this.find("input[type='hidden']").val("");this[0].reset();var a=this.data("validator");if(a&&a.reset){a.reset();a.resetForm()}this.find("input.jalor-dropdown,textarea.jalor-dropdown").each(function(){$(this).jalorSetValue(this.value)});this.find(".jalor-user").each(function(){$(this).jalorSetValue("")});this.find(".error-ctr").removeClass("error error-ctr");this.find("label.error").hide();return this};$.fn.jalorDisabled=function(a){var b=_getMapper(this);if(b&&b.setEnabled){a?b.setEnabled():b.setDisabled()}else{this.manager().disabled(a)}};$.fn.jalorDatepicker=function(a){return this.calendar(a)};$.fn.jalorHasPermission=function(){return this.each(function(){var b=$(this),a=b.attr("jalorPermission")||"";Jalor.Permission.check(a)?b.show():b.remove()})};$.fn.jalorNoPermission=function(){return this.each(function(){var b=$(this),a=b.attr("jalorPermission")||"";Jalor.Permission.check(a,"noPermission")?b.show():b.remove()})};$.fn.jalorI18n=function(){return this.each(function(){var e=$(this),b=$.trim(e.attr("i18nKey")),d=$.i18n.prop(b);if(!b||b==d){var a=e.attr(workspaceVO.currentLanguage)||e.attr("en_US");if(a){d=a}}if(e.prop("tagName")==="INPUT"){e.val(d);return}var c=e.attr("i18nfor");if(!c){e.text(d)}else{e.attr(c,d)}})};$.nodeEach=function(a,c,d){if(!a){return}c=c||"children";if($.isArray(a)){for(var b=0,e;e=a[b];b++){$.nodeEach(e,c,d)}}else{if(a[c]){d.call(a);$.nodeEach(a[c],c,d)}else{d.call(a)}}};$.nodeQuery=function(e,c,b,d){var a=null;$.nodeEach(e,c,function(){if(this&&this[b]===d){a=this;return false}});return a};$.fn.jalorLoad=function(a,j,e,f){var b=a;this.empty().html("");var d=this.attr("module");var g=d?Jalor.Core.Namespace.register(d).closeDialog:"";var c=d?Jalor.Core.Namespace.register(d).context:"";if(d){Jalor.Module.remove(d);g&&(Jalor.Core.Namespace.register(d).closeDialog=g);c&&(Jalor.Core.Namespace.register(d).context=c)}this.attr("module",a);if(Jalor.Permission.res&&Jalor.Permission.res.get(a.split("?")[0])){Jalor.UI.loadingClose();map=new Jalor.HashMap();Jalor.doGet("services/jalor/registry/query/list/{0}/{1}".formatURI("Jalor.Security.NoPermissionMsg",false),"",function(l){for(var k=0;k<l.length;k++){map.put(l[k].name,l[k].value)}if(map.get("MessageType")==1){Jalor.Page.forward("jalor/security/noPermission/noPermissionMessage.html?paramUrl="+encodeURIComponent(a))}else{Jalor.UI.showMessage("jalor.common.message.noPrivilegeError","error")}});return}var h=this;if(Jalor.Static.isXDRCross){this.data("xdrCallback",function(){Jalor.Page.afterLoad(h);if(typeof j==="function"){j()}var k=Jalor.Core.Namespace.get(b);if(!(k&&k.closeDialog)&&!e){window.scroll(0,0);$("#hidFocus").focus()}var l=h.parent(".jalor-dialog");l=l.length>0?l:h;Jalor.Component.Helper&&Jalor.Component.Helper.showHelper(Jalor.Page.register(a),l);Jalor.Component.InfoTip&&Jalor.Component.InfoTip.init(Jalor.Page.register(a))})}this.load(Jalor.Page.register(a),null,function(n,q,o){if(q=="error"){f&&f();Jalor.UI.loadingClose(true);var l={target:h,url:a,callback:j};Jalor.Component.handleError(n,q,o,reloadResource,l)}else{if(Jalor.Static.isXDRCross){return}Jalor.Page.afterLoad(h);if(typeof j==="function"){j()}var k=Jalor.Core.Namespace.get(b);if(!(k&&k.closeDialog)&&!e){window.scroll(0,0);$("#hidFocus").focus()}var p=h.parent(".jalor-dialog");p=p.length>0?p:h;Jalor.Component.Helper&&Jalor.Component.Helper.showHelper(Jalor.Page.register(a),p);Jalor.Component.InfoTip&&Jalor.Component.InfoTip.init(Jalor.Page.register(a))}})};$.fn.jalorInputHistory=function(){var b=$(this);var g=b.id(),d=0,c="valueText";if(!g){g="listoryInput_"+(d++)+"";b.id(g)}try{var a=[];b.attr("init",true);Jalor.UI.delayEvent(b,"blur",function(){var h=JSON.parse(Jalor.LocalStorage.getItem(c));if(b.val()!==""){if(h===null){Jalor.LocalStorage.setItem(c,JSON.stringify([$(this).val()]))}else{var e=[];for(var j=0;j<h.length;j++){if(b.val()!=h[j]){e.push(h[j])}}if(e.length==h.length){e.push(b.val());Jalor.LocalStorage.setItem(c,JSON.stringify(e))}}}});b.keydown(checkInput.keydown);Jalor.UI.delayEvent2(b,"keyup",function(o){var n=o.keyCode;if(n!=40&&n!=38&&n!=13&&n!=9){var l=JSON.parse(Jalor.LocalStorage.getItem(c)),j=$(this).val(),h=[];$(".selectorList").remove();if(this.val()==""&&l!=null){if($(".selectorList").length==0){checkInput.buildStyle(this,l.splice(0,100))}}else{if(this.val()!=""&&l!=null){var p=[];for(var k=0;k<l.length;k++){datas=findLocal(j,l[k]);if(datas>=0){p[p.length]=l[k]}}checkInput.buildStyle(this,p);if($(".selectorList ul li").length==0){$(".selectorList").remove()}}}}});Jalor.UI.delayEvent(b,"click",function(j){var h=JSON.parse(Jalor.LocalStorage.getItem(c));if(b.val()==""&&h!=null){$(".selectorList").remove();if($(".selectorList").length==0){checkInput.buildStyle(b,h.splice(0,100))}}j.stopPropagation()});$(document).bind("click",function(){$(".selectorList").hide()})}catch(f){}};var checkInput={buildStyle:function(j,c){var f=$.create("div","jalor-selector selectorList"),b="<ul class='list'>",h="</ul>";var a=j.id();a+="_ddl1";f.id(a);f.appendTo(Jalor.UI.getPopupPanel());$.create("div","jalor-selector-body").appendTo(f);var g=f.children(".jalor-selector-body");g.html(b+h);for(var d=0;d<c.length;d++){$('<li class="list-item" ><span class="list-text">'+(c[d]+"").encode()+"</span></li>").appendTo(f.find(".list"))}g.find(".list-item:first").addClass("selected-pre");if(j.isVisiable()){var e={};e.top=(e.top||0)+j.outerHeight();f.show();Jalor.UI.popup(j,f,e,null,true,null,true);checkInput.setWidth(f,j,g);f.delegate(".list-item","click",function(k){var l=$($(this).find(".list-text").get(0)).text();if(l==void 0){l=""}j.val(l);j.focus();f.hide();k.stopPropagation()})}},setWidth:function(c,d,b){var f=c.find(".list");if(f.length){childWidth=f.width(),inputWidth=d.outerWidth(),minWidth=inputWidth;var e=Jalor.DataHelper.getRangeValue(childWidth,minWidth,0);if(f.height()>c.height()){if(childWidth>inputWidth-17){c.width(e+17);f.width(e)}else{c.width(e);f.width(e-17)}}else{c.width(e);if(e>childWidth){f.width(e)}}}var a=f.outerHeight();if(a&&f.width()>b.width()){a+=20}b.height(a||"auto")},keydown:function(g){var b=$(".jalor-selector"),k=$(this),j="selected-pre",f=$(".selectorList").length;if(b.length){var r=g.keyCode;if(r==38||r==40&&f){var n=b.find("."+j),a;if(n.length==0){a=b.find("."+c.itemClass+":visible:"+(g.keyCode==38?"last":"first"))}else{n.removeClass(j);if(r==38){a=n.prevAll(":visible:first");if(a.length==0){a=b.find("."+c.itemClass+":visible:last")}}else{a=n.nextAll(":visible:first");if(a.length==0){a=b.find("."+c.itemClass+":visible:first")}}}if(a.length){a.addClass(j);var h=a.position().top,d=b.find(".jalor-selector-body");if(h){var p=a.outerHeight()+h-d.height();p&&d.scrollTop(p+d.scrollTop()+100)}else{d.scrollTop(0)}}}else{if(r==13||r==9){if(r===13){}r!=9&&g.stopPropagation();var c=b.data("op"),q=b.find(":not(.hide)."+j+":first");if(f&&q.length&&r==13){var o,l;o=$(q.find(".list-text").get(0)).text();if(o==void 0){o=""}k.val(o);b.hide()}}else{if(k.validVal().length||r==9){if(!k.data("called")){k.data("called",1)}}}}}}};function findLocal(d,f){var e=d.length,c=f.length,b;if(e<=c){for(var a=0;a<=c-e+1;a++){b=f.substring(a,a+e);if(b==d){return a}}}return -1}function reloadResource(a){a.target.jalorLoad(a.url,a.callback)}function setHighShow(a,b){if(!b){return}var d=b.setting.filterDataValue;if(!d){a.find("li span font").each(function(){$(this).replaceWith($(this).text())});return}var c=b.setting;a.find("li span").each(function(){if(/<.*>/g.test($(this).text())){return}var g=$(this).text();try{var f=new RegExp(d.toLowerCase(),"gi");g=g.replace(f,function(h){return"<font style='background:"+(c.highShowBackGround||"yellow")+";color:"+(c.highShowColor||"inherit")+";'>"+h+"</font>"});$(this).html(g)}catch(e){}})}$.fn.jalorTree=function(j,l,h){l=l||{};if(!$(l.filter).is("input")){$("#filter_"+this.prop("id")).remove()}var n,d=this.empty().addClass("ztree");l.data=l.data||{};var k={highShow:l.highShow,highShowBackGround:l.highShowBackGround,highShowColor:l.highShowColor,expandByCount:l.expandByCount||1000,expandLevel:l.expandLevel,selectItems:l.selectItems,selectField:l.selectField,callback:{beforeDrag:function(p,o){if(!l.onDrop){return false}else{l.onDrag&&l.onDrag(p,o)}},beforeDrop:l.beforeDrop,onDrop:function(p,r,q,s,o){if(l.onDrop){l.onDrop(p,r,q,s,o)}else{return false}},beforeRemove:function(p,o){l.onRemove&&l.onRemove(p,o);return false},beforeRename:l.beforeRename,onRename:l.onRename,onClick:function(p,r,q){if(l.click2Check){var o=q.checked?false:true;$("#"+r).getJalorTreeManager().checkNode(q,o,l.checkboxType)}l.onClick&&l.onClick(p,r,q)},onDblClick:l.onDblClick,beforeCheck:l.beforeCheck,onCheck:l.onCheck,beforeCollapse:l.beforeCollapse,onCollapse:l.onCollapse,beforeExpand:l.beforeExpand,onExpand:function(o,q,p){l.highShow!==false&&setHighShow($("#"+p.tId),$("#"+q).getJalorTreeManager());l.onExpand&&l.onExpand(o,q,p)}},edit:{editNameSelectAll:l.editNameSelectAll,enable:true,showRenameBtn:l.showRenameBtn||false,showRemoveBtn:l.showRemoveBtn||false,removeTitle:l.removeTitle||"Remove",renameTitle:l.renameTitle||"Rename"},data:{key:l.key||{checked:l.checked||"checked",name:l.displayName||"name",title:l.title,children:l.children||"children"},simpleData:l.simpleData},view:{showLine:l.showLine,showTitle:l.showTitle,expandSpeed:l.expandSpeed||"",fontCss:l.fontCss||{},addHoverDom:function(p,o){l.addHoverDom&&l.addHoverDom(p,o)},removeHoverDom:function(p,o){l.removeHoverDom&&l.removeHoverDom(p,o)},txtSelectedEnable:l.txtSelectedEnable},check:{enable:l.checkType||false,chkStyle:l.checkType=="single"?"radio":"checkbox",chkboxType:l.checkboxType||{Y:"p",N:"s"},radioType:"all"}};k.data.key=l.data.key||k.data.key;if(l.urlMode){k.edit.enable=false}if(k.data.simpleData){k.data.simpleData.enable=true}if(typeof j=="string"){/\{0\}/g.test(j)&&(k.filterDataByParameter=true);k.treeFilterData=function(p,o){Jalor.UI.ajax({url:j.formatURI(p),loading:"ui",success:function(r){if(l.chkDisableds||l.keepParent||k.selectField&&l.selectItems){$.nodeEach(r,l.children,function(){if(k.selectField&&($.isArray(k.selectItems)?k.selectItems.contains(this[k.selectField]):l.selectItems==this[k.selectField])){this[k.data.key.checked]=true}if(l.keepParent){this.isParent=true}if(l.chkDisableds&&l.chkDisableds.contains(this[l.selectField])){this.chkDisabled=true;$.nodeEach(this,l.children,function(){this.chkDisabled=true})}})}k.filterDataLength=($.isArray(r)?r:[r]).length;n=$.fn.zTree.init(d,k,$.isArray(r)?r:[r]);_setMapper(d,n);if(k.expandLevel||k.expandLevel===0){for(var q=0;q<=parseInt(k.expandLevel);q++){d.find("li.level"+q).each(function(){n.expandNode(n.getNodeByTId(this.id),true,null,false)})}}if(k.check.chkStyle=="radio"&&k.selectItems){n.selectNode(n.getNodeByParam(k.data.key.checked,true))}if(!o){return}Jalor.Core.log("before call");(typeof h=="function")&&h(r);r=h=null}},d.parent())};k.treeFilterData(l.filterDataValue||"",true)}else{if(typeof j=="object"){var b=j;if(l.chkDisableds||l.keepParent||k.selectField&&l.selectItems){$.nodeEach(b,l.children,function(){if(k.selectField&&($.isArray(k.selectItems)?k.selectItems.contains(this[k.selectField]):l.selectItems==this[k.selectField])){this[k.data.key.checked]=true}if(l.keepParent){this.isParent=true}if(l.chkDisableds&&l.chkDisableds.contains(this[l.selectField])){this.chkDisabled=true;$.nodeEach(this,l.children,function(){this.chkDisabled=true})}})}k.filterDataLength=b.length;n=$.fn.zTree.init(d,k,b);_setMapper(d,n);if(k.expandLevel){for(var c=0;c<=parseInt(k.expandLevel);c++){d.find("li.level"+c).each(function(){n.expandNode(n.getNodeByTId(this.id),true,null,false)})}}if(k.check.chkStyle=="radio"&&k.selectItems){n.selectNode(n.getNodeByParam(k.data.key.checked,true))}(typeof h=="function")&&h(b);b=h=null}}if(l.filter){var g;if($(l.filter).is("input")){g=$(l.filter)}else{var f=$('<div id="filter_'+this.prop("id")+'" class="jalor-tree-filter" ><input type="text" style="width:100%" maxlength="100" /></div>');f.insertBefore(this);g=f.find("input")}g.attr("search","");var e;var a=$('<a href="javascript:;" class="jalor-tree-filter-clear">×</a>');g.after(a);a.click(function(){g.val("").focus();e.call(g)});Jalor.UI.delayEvent2(g,"keyup",e=function(){var o=this.parent().parent().find(".ztree");var p=this.val().trim();p?a.show():a.hide();g.attr("search",p.toLowerCase());Jalor.UI.treeFilter(o,p,l.showFilterChildren);if(o.id()=="leftSiteMapTree"){Jalor.Layout.refreshScroller()}},500,function(){return g.attr("search")!=g.val().trim().toLowerCase()});g.bind("paste",function(o){setTimeout(function(){e.call(g)},20)});if("placeholder" in document.createElement("input")){g.attr("placeholder",$i18n("jalor.home.label.filter"))}else{g.addClass("filter-gray").val($i18n("jalor.home.label.filter")).focus(function(){if(this.value==$i18n("jalor.home.label.filter")){$(this).val("").removeClass("filter-gray")}}).focusout(function(){if(!this.value.trim()){$(this).addClass("filter-gray").val($i18n("jalor.home.label.filter"))}})}}return this};$.fn.getJalorTreeManager=function(){var a=_getMapper(this);return a};Jalor.UI.treeFilter=function(l,j,k,f){l.children("li.nomatchresult").remove();l.removeClass("nobottom");if(j===$i18n("jalor.home.label.filter")){j=""}var g=l.getJalorTreeManager();if(!g){return}if(g.setting&&g.setting.filterDataByParameter){g.setting.treeFilterData(j);return}g.setting.filterDataValue=j.toLowerCase();l.find("style[id^='hideCss_']").remove();if(!j){(l.attr("id")=="leftSiteMapTree"||g.setting.filterDataLength<g.setting.expandByCount)&&g.expandAll(false);g.setting.highShow!==false&&setHighShow(l,l.getJalorTreeManager());if(g.getSelectedNodes().length>0&&f!==false){setTimeout(function(){var n=document.activeElement;g.selectNode(g.getSelectedNodes()[0],true);n.focus()},500)}return}j=j.toLowerCase();var h=g.setting.data.key.name;var a=g.getNodes();var c=new Array();function b(o,n,p){if(p){return 0}var q=0;$.each(n,function(t,s){var u=s[h].toLowerCase().indexOf(j),r=false;if(u>-1){r=true;q++}if(!s.children&&u==-1&&!r){c.push("#"+s.tId)}if(s.children){q+=b(s,s.children,r)}});if(!o){return q}if(o[h].toLowerCase().indexOf(j)>-1){q++}if(!q){c.push("#"+o.tId)}return q}b(null,a);(l.attr("id")=="leftSiteMapTree"||g.setting.filterDataLength<g.setting.expandByCount)&&g.expandAll(true);g.setting.highShow!==false&&setHighShow(l,l.getJalorTreeManager());var e=0;while(c.length){var d="<style id='hideCss_"+l.attr("id")+"'>"+c.splice(0,1000).join(",")+"{display:none !important;}</style>";l.append(d);e++}if(!l.children("li:not(.nomatchresult):visible").length){l.addClass("nobottom");$('<li class="nomatchresult"></li>').text($i18n("jalor.common.tree.noMatch")).appendTo(l)}};$.fn.loading=function(d,f,b){var c=d?$(document.body):this;var g=c.children("div.loading");var e=this.outerWidth(),a=this.outerHeight();if(g.length==0){g=$(document.createElement("div")).addClass("loading").appendTo(c);d&&g.id("globalloading")}if(!b){if(f==void 0&&this.parents("div.jalor-dialog:first,div.jalor-igrid-editpanel,div.gt-editor-container:first,div.jalor-selector:first,.jalor-popup:first").length>0){f=true}b=f?this.position():this.offset();if(!d&&(e<50||a<50)){if(e<30||a<30){g.addClass("loading_min")}else{g.addClass("loading_small")}}}g.css({width:e,height:a||"",top:b&&b.top>0?b.top:0,left:b&&b.left>0?b.left:0}).show();return this};$.fn.loadingClose=function(){var a=this.children("div.loading");if(a.length==0){a=$("#globalloading")}a.length&&a.remove();return this};$.fn.jalorUserInfo=function(){this.each(function(b,a){var c=$(this);c.attr("href","#");var d=c.data("w_user_info");if(!d){c.click(function(){Jalor.Component.popUserInfo(c.attr("title")||c.text(),c.attr("url"));return false});c.data("w_user_info",true)}})};$.fn.jalorGroupInfo=function(){this.each(function(b,a){var c=$(this);c.attr("href","#");var d=c.data("w_group_info");if(!d){c.click(function(){Jalor.Component.popGroupInfo(c.attr("title")||c.text());return false});c.data("w_group_info",true)}})};$.fn.jalorValidate=function(c){if(!c){c={}}this.removeData("validator");var b,a=0;if(!c.errorPlacement){c.errorPlacement=function(d,e,f){if(d.text()){a++;Jalor.UI.toggleValid(false,e,d,false,c,a,f)}}}if(!c.success){c.success=function(d){Jalor.UI.toggleValid(true,d.prev(),d,false,c)}}b=this.bind("invalid-form.validate",function(){a=0}).validate(c);return this};Jalor.UI.toggleValid=function(r,e,q,g,j,n,f){if(r){if(q.length>0){e.removeClass("error");q.remove()}}else{if(e.length==0){Jalor.UI.showMessage(q.text(),"warn")}else{if(n>1){e.isVisiable()||Jalor.UI.Validator.check(e.parents(".jalor-hideValid"))}else{if(n==1){setTimeout(function(){if(!e.isVisiable()){Jalor.UI.Validator.check(e.parents(".jalor-hideValid"));e.valid()}var s=e.offset().top-30,t=document.documentElement;if(s<(t.scrollTop||document.body.scrollTop)){window.scrollTo(null,s<t.clientHeight?0:s-100)}},500)}}if(f){return}var h=e.position(),d=e.outerWidth();if(e.is(":visible")){q.addClass("error").css({top:h.top,left:h.left+d+5}).click(function(){$(this).hide().addClass("er-handle")});g&&q.addClass("er-server");e.addClass("error-ctr").after(q);var k=e.parents(".jalor-popup"),p=e.parents(".jalor-igrid-body:first"),o=h.top,l=h.left+d+5;if(k.length&&k.hasClass("jalor-dialog")){var b=k.manager().getBody(),c=b.scrollTop();o+=c?c:0}else{if(p.length){o+=p.scrollTop()}}var a=q.show().offsetParent();if(a.length>0&&q.position().left+q.width()>a.width()||a.length==0&&q.position().left+q.width()>screen.width||e.attr("errorInfoBottom")){o+=e.height()+5;l=h.left+1}q.css({left:l,top:o})}else{e.addClass("error-ctr")}}}};Jalor.UI.Validator={modes:[{css:"l-tab-content-item",check:function(c){var a=c.attr("tabid");if(a){var b=c.parents(".jalor-tab:first").getJalorTabManager();b&&b.selectItem(a)}}}],check:function(c){if(c.length){var b=c.attr("validHandler");if(b){b=Jalor.DataHelper.getObj(b);b&&b(c)}else{var a;$.each(this.modes,function(d,e){if(e.css&&c.hasClass(e.css)){e.check&&e.check(c);a=true;return false}});a||c.show()}}}};Jalor.UI.dialog=function(b,e,a){if(typeof e=="object"){a=e;e=$i18n("jalor.common.label.select")}a=a||{};a.width=a.width||480;a.fnLoad=a.fnLoad||a.callback;a.fnBeforeClose=a.fnBeforeClose||a.beforeClose;var c=false;if(b&&Jalor.Page.has(b)){c=Jalor.Core.Namespace.register(b)}a.fnDestory=function(){Jalor.Module.remove(b)};$("#jalorContentPanel").css("visibility","inherit");var d=$().dialog($.extend({url:b,title:e},a));d.close=function(){d.find(".jalor-dialog-closeimg").click()};if(c){c.context=d;c.closeDialog=d.close}if(a.content){d.jalorRender()}return d};Jalor.UI.dialog.triggerCancel=function(a){$(a).parent().parent().children(":first").children(":first").click()};Jalor.UI.showMessage=function(f,d,g,a,e,b){if(typeof f=="object"){d=f.style;g=f.callback;a=f.hideClose;e=f.encode;b=f.dialogOp;f=f.content}var c={width:250,content:f,messageBox:{type:"message",style:d,encode:e!==false},showCloseImg:!a,fnClose:g};$().dialog($.extend(c,b))};Jalor.UI.confirm=function(e,f,b,d,a){var c={width:250,content:e,messageBox:{type:"confirm",focusYes:b,encode:d!==true},fnClose:function(g,h){f&&f(h.result)}};$().dialog($.extend(c,a))};Jalor.UI.topBox=function(p,k,l,h,t,r,o){var f={},g=Jalor.Local.getCurrLanguage();if(typeof p=="object"){f=p;k=p.isHtml;l=p.autoClose;h=p.css;t=p.delay;r=p.style;o=p.dialogOp;p=p.content}if(p){p=k!==true?$i18n(p):p;p=(f.encode!==false)?p.encode():p}if(r){p=("<div class='jalor-dialog-image image-{0}' style='margin:-12px 0px;'></div>"+p).formatValue(r)}else{if(f.type){if(f.type=="big_sim"){p='<div class="image-success-big" style="height:50px"></div><div class="content-big-sim"><h1>{0}</h1><div>&nbsp;</div></div>'.formatValue(p?p:$i18n("jalor.workflow.message.submitSucess"))}else{var a=(g=="zh_CN")?'<label id="time" class="count-down">3</label>  秒后自动跳转  或者   ':'You will be redirected in <label id="time" class="count-down">3</label> seconds,Or ';p='<div class="image-success-big"></div><div class="content-big-com"><h1>{0}</h1><samp class="smallcontent">{1}</samp>'.formatValue(p?p:$i18n("jalor.workflow.message.submitSucessLong"),f.character?$i18n(f.character):"");p+="<samp>"+a+'</samp><samp class="jump-tip"><a class="big-top-jump">{0}</a></samp></div>'.formatValue($i18n("jalor.bigTopBox.forward.tip"))}}}var b=$("#jalor_tip"),j=Jalor.UI.Config.topBox.timer;if(b.length==0||(b.attr("type")!=f.type)){if(b.length){$("#jalor_tip").remove()}var c={title:f.noTitle!==true?(f.title||"jalor.common.message.msgtitle"):"",id:"jalor_tip",content:p,show:false,target:null,showHead:true,width:Jalor.UI.Config.topBox.width+50,modal:false,fixed:true,fnBeforeClose:function(){this.dom.hide();return false}};if(f.type){c.width=c.width+150;if(f.type=="big_sim"){c.height=60;j=1000}else{if(f.type=="big_com"){c.height=85;j=3000}}}var b=$().dialog($.extend(c,o)).removeClass("jalor-dialog")}else{b.manager().getBody().html(p)}h&&(typeof h=="object"?b.css(h):b.addClass(h));var e=$(window),u=$(Jalor.Config.Panel.leftPanel).width(),d=e.width()/2-b.width()/2+e.scrollLeft()+(u>300?0:u)/2,n=e.scrollTop()+Jalor.UI.Config.topBox.top;b.css({left:(o&&o.left)?o.left:d,top:(o&&o.top)?o.top:Jalor.UI.Config.topBox.top}).fadeIn(300);if(f.type){b.manager().getBody().css("text-align","center")&&b.manager().getHead().css("border-bottom","none");if(f.type=="big_com"&&g!="zh_CN"){b.manager().getBody().find(".smallcontent").css("width",b.width()*0.8+"px")}}b.attr("type",f.type?f.type:"");var q=3,s;if(l!==true){if(f.type&&f.type=="big_com"){s=setInterval(function(){q--;if(q==0){var v=$("div.jalor-popup[type='big_com']:visible").length;clearInterval(s);if(v){b.hide();f.forwardUrl&&Jalor.Page.forward(f.forwardUrl)}}$("#time").text(q)},1000)}else{b.delay(j).fadeOut(t||300)}}b.find(".big-top-jump").click(function(){clearInterval(s);b.hide();f.forwardUrl&&Jalor.Page.forward(f.forwardUrl)});return b};Jalor.UI.openMainLoading=function(){Jalor.UI.loading(1)};Jalor.UI.closeMainLoading=function(){Jalor.UI.loadingClose(1)};Jalor.UI.bodyLoading=function(){var a=$("#body_loding");if(!a.length){a=$('<span id="body_loding" class="loading" style="position:fixed"></span>').appendTo(document.body)}a.show()};Jalor.UI.bodyLoadingClose=function(){$("#body_loding").hide()};Jalor.UI.loading=function(c){if(c){var a=$("div.jalor-dialog").not(".message-box,#jalor_infoTip"),d=1;if(!a.length){a=$(Jalor.Config.Panel.globalLoading)}else{if(a.css("display")=="none"){d=0}}return a.loading(d)}else{var h=$("#loading_msg");if(h.length==0){$().dialog({title:$i18n(Jalor.UI.Config.loading.title),id:"loading_msg",target:null,showHead:false,content:$i18n(Jalor.UI.Config.loading.content),modal:false,drag:false,show:false,width:Jalor.UI.Config.loading.width,fnBeforeClose:function(){this.dom.hide();return false}}).removeClass("jalor-dialog");h=$("#loading_msg").hide()}var g=$(window),b=$(Jalor.Config.Panel.leftPanel).width(),f=g.width()/2-h.width()/2+g.scrollLeft()+(b>300?0:b)/2,e=g.scrollTop()+Jalor.UI.Config.loading.top;return h.css({top:e,left:f,width:Jalor.UI.Config.loading.width,position:"absolute"}).show()}};Jalor.UI.loadingClose=function(b){if(b){var a=$("div.jalor-dialog:last");if(!a.length){a=$("#"+Jalor.Config.Panel.centent)}a.loadingClose()}else{if(Jalor.Core_ajaxCount.get<=0){$("#loading_msg").hide()}}};Jalor.UI.button=function(l,n,o,h,a,f,g){if($.isPlainObject(l)){var e=l,l=e.text,n=e.click,o=e.permission,h=e.type,a=e.imgtype,f=e.isI18n,g=e.attr,d=e.css||""}n=n?'onclick="{0}"'.formatValue(n):"";if(o&&!Jalor.Permission.check(o)){return""}if(g==void 0){g=""}if(f!==false){l=$i18n(l)}var j=Jalor.UI.Config.button;var b="";if(g&&typeof g=="object"){for(var c in g){b+=c+'="'+g[c]+'" '}}g=(b||g);switch(h){case"img":return j.img.formatText(a,n,l,g,d);case"link":return j.link.formatText(n,encode(l),g,d);case"imgBtn":return j.imgBtn.formatText(a,n,encode(l),g,d);default:d&&(g+=' class="{0}"'.formatValue(d));return j.input.formatText(l,n,g)}};Jalor.UI.newButton=function(d,c){if(d.permission&&!Jalor.Permission.check(d.permission)){return""}if(d.id){if(d.attr){d.attr.id=d.id}else{d.attr={id:d.id}}}d.prop="";if(d.attr){var b=[];$.each(d.attr,function(e,f){if(f!=""){b.push(e+"='"+f+"' ")}});d.prop=b.join("")}d.text=$i18n(d.text);if(c!=false){d.text=encode(d.text)}var a=Jalor.UI.Config.newButton[d.type]||Jalor.UI.Config.newButton.input;return a.formatField(d)};Jalor.UI.buttonBuilder=function(c){var b=[];for(var a=0;a<c.length;a++){b.push(Jalor.UI.newButton(c[a]))}return b.join("")};Jalor.UI.showImage=function(d,c){d=$(d);var j=d.attr("alt")||d.attr("title"),a=d.attr("src")||d.attr("img"),b=d.attr("openWay")||"";var h=$("#show_image");if(!h.length){var g=new Jalor.StringBuilder();if(b&&b==="lock"){g.append('<div class="jalor-overlay" id="jalor_dialog_overlay_img" style="display: block; z-index: 999;"></div>')}g.append("<div id='show_image' class='loading jalor-image-show'>").append("<div class='jalor-image-head'><span>").append($i18n(j)).append("</span>");if(c!=false){g.append("<a class='jalor-image-view' target='_blank' title='view source' href='").append(a).append("'></a>")}g.append("<a class='jalor-image-close' title='close'></a></div>").append("<div class='jalor-image-body'><img onload='Jalor.UI.autoImage(this,true);$(this).parent().parent().show()' src='").append(a).append("' /></div></div>");Jalor.Page.getContentPanel().append(g.toString());$("a.jalor-image-view").attr("title",$i18n("jalor.workflow.message.viewSource"));$("a.jalor-image-close").attr("title",$i18n("jalor.workflow.message.close"));var f=$(window);h=$("#show_image").css("top",f.scrollTop()+200).css("overflow","auto");h.find("a.jalor-image-close").click(function(){$("#show_image").hide();b==="lock"&&$("#jalor_dialog_overlay_img").hide()})}else{b==="lock"&&$("#jalor_dialog_overlay_img").show();var e=h.find("img"),k=e.attr("src");if(a!=k){h.find(".jalor-image-view").attr("href",a);e.attr("src","").attr("src",a);h.height("auto").width("auto").loadingClose();h.children(".jalor-image-head").children("span").text($i18n(j))}else{h.show()}}};Jalor.UI.autoImage=function(f,c){f=$(f).css("visibility","visible");var b=f.width();if(b){var g=$(window),e=g.width();if(!c){var j=e*0.8,k=g.height()*0.8-100;if(b>j){b=j;f.width(b)}var l=f.height();if(l>k){f.width("").height(k);b=f.width()}}var d=e/2-b/2+g.scrollLeft(),h=g.scrollTop()+100;var a=f.parent().parent().height("auto").css({top:h>0?h:0,left:d>0?d:0,width:b}).removeClass("loading");if($.browser.msie&&$.browser.version==6){a.children(":first").width(b)}}};Jalor.UI.clearValidError=function(){$("label.error").hide()};$.fn.jalorCombobox=function(a){this.each(function(r){var d=$(this);if(d.attr("init")){return}d.attr("init",true);var l=d.attr("ingrid");if(l){l=$("#"+l)}var h=l?false:true;var b=d.attr("valueField")||"value",q=d.attr("displayField")||"text";var u=d.attr("service").split(":");var p=d.attr("multi")=="true";var k=d.attr("emptyText");var c=d.attr("connector");var t=d.attr("combo")!=="false",e=d.attr("initInput")!=="false";var f=d.attr("fnChange")?Jalor.Core.Namespace.getVariable(d.attr("fnChange")):"";var n=u[0];var v=d.attr("historySupport")?d.attr("historySupport")!=="false":d.attr("historySupport");var s=$.extend({},{container:l,emptyText:k,multi:p,initInput:e,fnChange:f,combo:t,connector:c,valueField:b,displayField:q,historyKey:d.attr("service"),historySupport:v},a,d.getConfig());var o=u[1];!s.multiDisabled&&s.multi&&d.attr("readonly","readonly");if(n=="LOOKUP"||n=="LOOKUP2"||n=="LOOKUP3"){s.valueField="itemCode";s.displayField="itemName"}if(a&&a.dataset){if(n==="SYNC"){var j=a.dataset;s.ajax={url:"",beforeRequest:function(y,w,x){j(y.success,w);return false}};delete s.dataset}else{s.dataset=a.dataset;if(typeof s.dataset=="function"){s.dataset=s.dataset()}}}else{if(n==="REST"){s.ajax={url:o}}else{if(n==="SYNC"){var g=Jalor.Core.Namespace.getVariable(o);s.ajax={url:"",beforeRequest:function(y,w,x){g(y.success,w);return false}}}else{s.dataset=Jalor.UI.getStaticData({service:d.attr("service"),supportLang:d.attr("supportLang")})}}}d.dropdown(s)});return this};Jalor.UI.getStaticData=function(g){var d=g.service;if(d){if(typeof(d)=="string"){if(d.indexOf(":")>0){var e=d.split(":"),c=e[0],f=e[1].replace(/(^\s*)/,"");if(c==="FN"){return Jalor.DataHelper.getObj(f)()}else{if(c==="LOOKUP"||c==="LOOKUP2"){var b,a=f.split("&");b=a.length>1?f.split("&")[1]:"";return Jalor.Component.Lookup.getList(f,b,((c=="LOOKUP2")||g.supportLang))}else{if(c==="LOOKUP3"){return Jalor.Component.Lookup.getLookup3List(f,g.supportLang)}}}}else{return Jalor.DataHelper.getObj(d)}}else{return d}}return null};$.fn.jalorLdap=function(a){a=a||{};this.each(function(h,e){var l=$(this);if(l.attr("init")){return}l.attr("init",true);var o=l.attr("valueField")||"userId",k=l.attr("asyncCreate")=="true";var j="<tr class='{0} ldap-suggest  ${&data._history}' val='${&"+o+"}' dept='${&dept}' userid=${&userId} userAccount=${&userAccount} userCN='${&userCN}'><td><span><font class='list-text'>${userCN}</font>(${userAccount})</span></td><td><span class=ldap_dept_span>${dept}</span></td></tr>";var f=l.attr("multi")=="true";var g=l.attr("localUser")=="true";var n,d="services/jalor/security/user/list/byids";if(f&&l.attr("sortBy")&&(jQuery.inArray(l.attr("sortBy"),["userAccount","userCN"])!=-1)){n=l.attr("sortBy")}var c=$.extend({valueField:o,sortBy:n,displayField:"userCN",defaultFilter:"%",multi:f,delay:1000,cacheReqest:null,showTrigger:false,initInput:true,multiSplit:", ",fnBeforeSelected:function(z,B,C,u,r){if(C&&(!r||!r.creationDate)){var w=r.userId;var y="services/jalor/security/user/single/{0}".formatURI(C.attr("userAccount"));if(!f&&Jalor.Config.Ldap.isSingleSearchSpeed){var q=C.attr("userAccount"),A=C.attr("dept"),p=C.attr("usercn");y="services/jalor/security/user/singleother/{0}/{1}/{2}".formatURI(q,A,p)}var t={url:y,async:k,success:function(D){if(o=="userId"&&z.indexOf(D.userId)==-1){z=z.replace(w,D.userId);setTimeout(function(){l.dataValue(z)},0)}},error:function(){return true}};Jalor.doGet(t)}else{if($.isArray(r)){var s=[],x={};for(var v=0;v<r.length;v++){if(!r[v].creationDate){s.push(r[v].userAccount);x[r[v].userAccount]=r[v].userId}}if(s.length>0){Jalor.doPost({url:"services/jalor/security/user/create/w3Account",async:k,data:s,success:function(D){var E=false;if(o=="userId"){$.each(D,function(H){var F=this,G=x[F.userAccount];if(G!==F.userId){E=true;z=z.replace(G,H.userId)}});E&&setTimeout(function(){l.dataValue(z)},0)}}})}}}},fnBinded:function(q,p){var r=q.find(".suggest_body_div table").height();if(r<160){q.find(".suggest_body_div").height(r)}},panelBegin:"<div class=suggest_body_div  style='overflow:visible' ><table class=list><tbody>",panelEnd:"</tbody></table></div>",item:j,suggestLength:4,ajax:{url:g?"services/jalor/security/user/local/page/100/1/{0}":(!f&&Jalor.Config.Ldap.isSingleSearchSpeed?"services/jalor/security/user/suggestsingleone/{0}":"services/jalor/security/user/suggest/{0}"),error:function(){return true}},getTextAjax:{url:"services/jalor/security/user/list/byids",error:function(){return true}}},a,l.getConfig());if(o=="userAccount"){c.historyKey="ldap_useraccount";c.getTextAjax.url="services/jalor/security/user/list/byaccounts"}else{if(o=="employeeNumber"){c.getTextAjax.url="services/jalor/security/user/list/byemployee"}}var b=l.attr("ingrid");if(b){c.nopending=true;c.container=$("#"+b);c.appendAfter=false}l.suggestion(c);l.removeClass("jalor-suggest")});return this};$.validator.addMethod("jalor-user",function(c,b){var a=$(b).manager();return a.valid?a.valid():true});$.fn.jalorSuggest=function(n){try{if(this.attr("init")){return}if(n.placeholder){this.attr("placeholder",$i18n(n.placeholder));if(!("placeholder" in document.createElement("input"))){this.addClass("filter-gray").val($i18n(n.placeholder));this.addClass("placeholder");this.attr("search","")}}this.attr("init",true);this.addClass("jalor-suggest");var f=$.extend({valueField:"name",displayField:"name",defaultFilter:"%",panelBegin:"",panelEnd:"</tbody></table>",ajax:{url:n.url,setAjax:function(q,e){var r=n.queryParam||n.queryParams;if(typeof r=="function"){r=r(q.data)}if(r){q.data=$.extend(q.data||{},r)}}},fnBinded:function(r,q){var s=r.find("div.jalor-suggest-head table thead tr:first td");var e=r.find("div.jalor-suggest-body table tbody tr:first td");if(s.length>0){e.each(function(t){if(t<e.length-1){var u=$(s[t]);if(u.children("span").width()<$(this).width()){u.width($(this).width())}}})}}},n,this.getConfig());var h=n.fieldMapper;var g=[],j=[];if(n.suggestMulti){j.push("<td class='suggestSelectAll'><span></span></td>")}var o=0;if(n.suggestMulti){g.push("<td class='suggestSelect suggest-multi-noSelect'><span></span></td>")}if(h){for(var p in h){if(p==f.displayField){g.push('<td><span><font class="list-text jalor-suggest-font"  title = "${&{2}}" >${{2}}</font></span></td>')}else{g.push('<td ><span><font class="jalor-suggest-font" title="${&'+p+'}">${'+p+"}</font></span></td>")}o++;j.push("<td><span><font>"+h[p]+"</font></span></td>")}}else{g.push('<td><span><font class="list-text jalor-suggest-font"  title = "${&{2}}" >${{2}}</font></span></td>');o=1}var l='<tr  class="{0} ${&data._history}" val="${&{1}}">'+g.join("")+"</tr>";if(o==1){l=l.replace("jalor-suggest-font","")}var a=o>1?"<table><thead><tr>"+j.join("")+"</tr></thead></table>":"";var d=l+"</tbody></table>";var c="<table class=list><tbody>";f.panelBegin=c;f.fnBuildSelector=function(q,e){q.find("div.jalor-selector-head").addClass("jalor-suggest-head").html(a);q.find("div.jalor-selector-body").addClass("jalor-suggest-body");n.fnBuildSelector&&n.fnBuildSelector(q,e)};f.item=l;var b=this.attr("ingrid");if(b){f.nopending=true;f.container=$("#"+b);f.appendAfter=false}this.suggestion(f)}catch(k){Jalor.Core.log("联想框 suggest 配置错误，控件 name:"+this.prop("name")+", errMsg:"+k.message)}};Jalor.UI.txtChange=function(d){var a=$.getEventTarget(d),c=(a.attr("maxheight")*1||500);var b=a[0].scrollHeight*1;if(c>a[0].scrollHeight*1){a.css("height",a[0].scrollHeight+"px")}else{a.css("overflow-y","auto")}};Jalor.UI.ieTxtChange=function(f){var b=$.getEventTarget(f);var g=b.attr("maxheight");var d=(g*1||500);var c=b[0].scrollHeight*1;var a=b[0].style.height;a=a.substring(0,a.indexOf("p"));setTimeout(function(){if(d>c){if(c>a||c==a){b.css("height",c+"px")}}else{b.css("overflow-y","auto")}},0)};$.fn.jalorTextarea=function(){if(this.attr("init")){return}this.attr("init",true);if($.browser.msie){this.bind("paste keyup",Jalor.UI.ieTxtChange)}else{this.bind("input",Jalor.UI.txtChange)}};$.fn.jalorRender=function(){Jalor.UI.init(this)};Jalor.UI.init=function(f){f=f||window.document.body;f=f.jquery?f:$(f);f.find(".hasPermission[jalorPermission]").jalorHasPermission();f.find(".noPermission[jalorPermission]").jalorNoPermission();var d=$(".init,.i18n",f);d.filter(".i18n").jalorI18n();d.filter("form").each(function(){var j=$(this);j.jalorValidate(j.getConfig()).submit(function(){return false})});var e=d.filter("input.jalor-combobox");var c=[],g=[],h=[],b=[];e.each(function(){var k=$(this).attr("service")||"";var l=k.split(":"),j=l[0],n=l[1];if(j=="LOOKUP3"&&!$(this).attr("init")){if($(this).attr("supportLang")==="true"||$(this).attr("supportLang")===undefined){h.push(n);b.push(this)}else{c.push(n);g.push(this)}}else{$(this).jalorCombobox()}});if(g.length){var a=Jalor.UI.getStaticData({service:"LOOKUP3:"+c.join(",")});$.each(g,function(l,p){var k=$(this).attr("service")||"";var n=k.split(":"),j=n[0],o=n[1];$(this).jalorCombobox({dataset:a.length?a:(a[o]||[])})})}if(b.length){var a=Jalor.UI.getStaticData({service:"LOOKUP3:"+h.join(","),supportLang:true});$.each(b,function(l,p){var k=$(this).attr("service")||"";var n=k.split(":"),j=n[0],o=n[1];$(this).jalorCombobox({dataset:a.length?a:(a[o]||[])})})}d.filter(".jalor-user").jalorLdap();d.filter(".PersonInfo").jalorUserInfo();d.filter(".GroupInfo").jalorGroupInfo();d.filter(".jalor-menubutton.init").jalorMenuButton();d.filter(".jalor-autosize").jalorTextarea();Jalor.UI.initFormContent(f);Jalor.UI.Renders.fire(d,f)};Jalor.UI.initFormContent=function(a){Jalor.UI.InitForm(a.find("form"))};Jalor.UI.InitForm=function(f){f.find(":reset,.jalor-operate .jalor-button.reset,.jalor-toolbar .jalor-button.reset").click(function(){var h=$(this),g=h.parents("form");g.jalorReset();return false});f.keydown(function(k){if(k.keyCode==13){var j=$.getEventTarget(k),h=j.attr("type");if(h!="reset"&&h!="button"){var g=$(this).find(":button.default:first");if(g.length){k.stopPropagation();g.click()}var l=$(this).find(".jalor-button.default:first");if(l.length){k.stopPropagation();l.click()}}}});f.filter(".longtitle").find("samp").each(function(){var h=$(this),g=h.text().trim();if(g.replace(/[^x00-xff]/g,"**").length>20){h.attr("title",g)}});var a=f.find(".jalor-form-whole textarea[textarea-maxlength]").css("height","80px"),e=Jalor.Local.getCurrLanguage()=="zh_CN"?"<span>还可以输入</span><span class='only-count'>1</span><span>字</span>":"<span class='only-count'>1</span><span>characters remained</span>";curr_div="<div class='textarea-maxlength'>"+e+"</div>";if(a.length){var d=a.parent(),b,c;d.append(curr_div).css("height","109px");d.prev("samp").css("height","109px");$.each(a,function(h,g){b=$(g);c=b.next(".textarea-maxlength");c.find("span.only-count").text(b.attr("textarea-maxlength"))});a.on("keypress",function(l){var n=l.keyCode,g=$(this),k=g.val(),h=g.attr("textarea-maxlength"),j=0;if(k.trim().length>=h){if(document.selection){j=document.selection.createRange().text.length}else{if(this.selectionStart||this.selectionStart===0){j=this.selectionEnd-this.selectionStart}}if(j){setTimeout(function(){if(k.trim().length>h){g.val(k.substr(0,h))}},10)}else{l.preventDefault();return}}}).on("keyup",function(){var g=$(this),j=g.val(),h=g.attr("textarea-maxlength");var k=$(this).attr("textarea-maxlength")-$(this).val().trim().length;if(j.trim().length>h){g.val(j.substring(0,h))}$(this).next(".textarea-maxlength").find("span.only-count").text(k<0?0:k)});if(navigator.userAgent.toLowerCase().match(/(msie\s|trident.*rv:)([\d.]+)/)&&$.browser.version<9){a.on("select",function(k){var g=$(this),j=g.val(),h=g.attr("textarea-maxlength");if(j.trim().length>h){g.val(j.substring(0,h))}var l=h-g.val().trim().length;g.next(".textarea-maxlength").find("span.only-count").text(l<0?0:l)})}else{a.on("input",function(k){var g=$(this),j=g.val(),h=g.attr("textarea-maxlength");if(j.trim().length>h){g.val(j.substring(0,h))}var l=h-g.val().trim().length;g.next(".textarea-maxlength").find("span.only-count").text(l<0?0:l)})}}if(workspaceVO.themeName!="default"&&f.hasClass("jalor-form")){f.each(function(){var g=$(this),j=g.children();if(j.length==0||j.filter(".jalor-form-content,.jalor-table").length>0||g.find(".jalor-form-body:first,.jalor-form-custom:first").length==0){return}var h=j.filter(".jalor-operate"),l=$.create("div","jalor-form-content");if(h.length){var k;j.each(function(){k=$(this);if(k.hasClass("jalor-operate")){return false}k.appendTo(l)})}else{l.append(j)}l.prependTo(g)})}};Jalor.UI.Renders.add(function(b,a){Jalor.UI.IData.init(b)});Jalor.UI.IData={init:function(a){a.filter("input.jalor-hrapprover,input.jalor-hrdept").jalorHRSelector();a.filter("input.jalor-customer").jalorCustomer();a.filter("input.jalor-country").jalorCountry();a.filter("input.jalor-currency").jalorCurrency();a.filter("input.jalor-company").jalorCompany();a.filter("input.jalor-area").jalorArea();a.filter("input.jalor-location").jalorLocation()}};$.fn.jalorHRSelector=function(){Jalor.Page.register("Jalor.Component.HRSelector","jalor/web/resource/common/component/idata/HRSelector.html");this.each(function(){var e=$(this);if(e.attr("init")){return}if(e.hasClass("jalor-hrdept")){_setMapper(e,{setValue:function(f){if(f){IData.HRDeptInfo.getName({code:f,lang:IData.Util.getLanguage()},function(g){e.data("value",f).val(g)})}else{e.data("value","").val("")}}})}if(e.attr("readonly")||e.attr("disabled")){var d=e.val();if(d&&e.hasClass("hrdept")){e.jalorSetValue(d)}return}e.attr("readonly",true).attr("init",true);var b={user:e.attr("user"),lockLevel:e.attr("lockLevel")||-1,category:e.attr("category")||"0301"};var c=$('<input type="button" value="..." />').click(function(){var f=e.hasClass("jalor-hrapprover")?"HRApprover":"HRDept";b.callback=function(g,h){e.data("value",g);e.val(h)};if(f=="HRApprover"){b.initApprover=e.getValue();Jalor.Component.selectHRApprover(b)}else{b.initDept=e.getValue();Jalor.Component.selectHRDept(b)}});c.insertAfter(e);var a=$('<input type="button" value="C" />').click(function(){e.data("value","").val("")});a.insertAfter(c)})};$.fn.jalorCountry=function(){this.each(function(a){var b=$(this);if(b.attr("init")){return}b.attr("init",true);if(b.attr("readonly")){return}b.dropdown({valueField:"territory_short_name",displayField:"territory_short_name",ajax:{url:"null",beforeRequest:function(e,c,d){IData.Country.get({language:"US"},function(f){e.success(f.country||[])});return false}}})})};$.fn.jalorCurrency=function(){this.each(function(a){var b=$(this);if(b.attr("init")){return}b.attr("init",true);if(b.attr("readonly")){return}b.dropdown({valueField:"currency_code",displayField:"currency_code",ajax:{url:"null",beforeRequest:function(e,c,d){IData.Currency.get({},function(f){e.success(f.currency||[])});return false}}})})};$.fn.jalorCompany=function(){var b=Jalor.Local.getCurrLanguage()=="zh_CN"?"CN":"EN";var a=b=="CN"?"tx_corporation_cn":"tx_corporation";this.each(function(c){var d=$(this);if(d.attr("init")){return}d.attr("init",true);d.data("mapper",{setValue:function(){IData.Company.get({language:b,tx_coa:d.getValue()},function(e){if(e.company){d.val(e.company[0][a])}})}});if(d.attr("readonly")){d.getValue()&&d.jalorSetValue(d.getValue());return}d.dropdown({valueField:"tx_coa",displayField:a,ajax:{url:"null",beforeRequest:function(g,e,f){IData.Company.get({language:b},function(h){g.success(h.company||[])});return false}}})})};$.fn.jalorArea=function(a){this.each(function(f,g){var k=$(g);if(k.attr("init")){return}var j=Jalor.Local.getCurrLanguage()=="zh_CN"?"name_cn":"name_en";j=k.attr("displayField")||j;var l=k.attr("valueField")||"dept_code";var h=k.attr("areaLabel");var e=k.attr("connector");var c=k.attr("combo")!=="false";k.attr("init",true);_setMapper(k,{setValue:function(n){if(n){if(l!="dept_code"){n={valueField:l,code:n}}IData.Area.getByDept(n,k.attr("areaLabel"),function(p){if(p[l]){k.data("value",p[l]).val(p[j])}else{var o=p.area;if(o&&o instanceof Array&&o.length&&(o=o[0])){o[l]&&k.data("value",o[l]).val(o[j]);k.data("curText",o[j])}}})}else{k.data("value","").val("")}}});if(k.attr("readonly")||k.attr("disabled")){var b=k.val();if(b&&k.hasClass("hrdept")){k.jalorSetValue(b)}return}var d=$.extend({combo:c,valueField:l,displayField:j,connector:e,ajax:{url:"",beforeRequest:function(p,n,o){IData.Area.get({area_label:k.attr("areaLabel"),parent:e?$(e).jalorGetValue():""},function(q){p.success(q.area)});return false}}},a);k.dropdown(d)})};$.fn.jalorLocation=function(){this.each(function(b,c){var f=$(this);if(f.attr("init")){return}f.attr("init",true);var g=f.attr("level"),d=f.attr("parent")||"";var a=f.attr("connector");var e=f.attr("combo")!=="false";f.dropdown({connector:a,combo:e,valueField:"locationName",displayField:"locationName",ajax:{url:"",beforeRequest:function(k,h,j){var l={level:g,parent:$(a).val()};if(!l.parent){l.key="%"}IData.Location.get(l,function(n){if(!n.errorInfo){k.success(n.locations)}});return false}}})});return this};$.fn.jalorCustomer=function(){this.each(function(d,f){var h=$(this);if(h.attr("init")){return}h.attr("init",true);var c=h.attr("valueField")||"accountid";if(c!=="account"){_setMapper(h,{setValue:function(j){if(j){var k={};k[c]=j;k.page=1;IData.Customer.get(k,function(l){if(l.customer&&l.customer.length>0){h.data("value",j).val(l.customer[0].account)}})}else{h.data("value","").val("")}}})}if(h.attr("readonly")||h.attr("disabled")){var g=h.val();if(g){h.jalorSetValue(g)}return}h.attr("readonly",true).attr("init",true);var b={valueField:h.attr("valueField")||"accountid"};var e=$('<input type="button" value="..." />').click(function(){b.callback=function(j,k){h.data("value",j).val(k)};Jalor.Component.selectCustomer(b)});e.insertAfter(h);var a=$('<input type="button" value="C" />').click(function(){h.data("value","").val("")});a.insertAfter(e)});return this};Jalor.UI.XDialog={};(function(a){var d={title:"jalor.common.label.select",target:"#jalorContentPanel",width:0,height:0,maxHeight:0,top:0,fixY:70,fixX:20,load:true,buttons:[],modal:true,show:true,showFoot:true,showCloseImg:true,btnAlign:"right",drag:true,handler:{},closeRemove:true,reSizable:false};var c=a.Factory={initStyle:function(h,l){var k=h.dom;if(!l.drag||l.fixed){k.find(".jalor-dialog-title").css("cursor","default")}l.height&&h.getBody().css({height:l.height});l.maxHeight&&h.getBody().css({maxHeight:l.maxHeight});l.minHeight&&h.getBody().css({minHeight:l.minHeight});if(l.title==="jalor.common.igrid.customSetting"){h.getBody().css({maxHeight:"380px"})}if(l.modal){var j=1000+a.Helper.lives*10;k.css("z-index",j).addClass("modal");h.getOverlay().show().css("z-index",j-1);a.Helper.lives++}if(l.infoTip){var j=995+a.Helper.lives*10;k.css("z-index",j)}if(l.fixed){k.addClass("fixed")}if(!l.showCloseImg){k.find("div.jalor-dialog-close").hide()}},updateStyle:function(p,n){var l=p.dom;var o=$(window),j=n.fixed?0:o.scrollTop(),h=(n.width*1||l.width())+n.fixX,r=n.height||l.height();var q=(n.top||(o.height()-n.fixY-r)/2)+j;var k=n.left||(o.width()-n.width)/2;q=q<0?0:q;l.css({top:q,left:k,width:h});if(n.show){l.show()}p.focus()}};c.Builder={init:function(j,l){var h=[];this.buildHead(h,l);this.buildBody(h,l);l.showFoot&&this.buildFoot(h,l);l.reSizable&&this.buildResizable(h,l);j.dom.html(h.join(""));var k=l.target&&$(l.target).length?$(l.target):document.body;j.dom.appendTo(k);l.showFoot&&this.buildFootContent(j,l);if(l.modal){this.buildFocusInput(j,l)}j.getHead().find("div.jalor-dialog-title").prepend($i18n(l.title));this.buildBodyContent(j,l);this.buildOverlay(j,l);return j},buildHead:function(h,j){if(j.showHead===false){h.push("<div class='jalor-dialog-close'><div class='jalor-dialog-closeimg'></div></div>")}else{h.push("<div class='jalor-dialog-head unselect'><div class='jalor-dialog-close'>");h.push("<div class='jalor-dialog-closeimg'></div></div>");if(j.reSizable){h.push("<div class='jalor-dialog-max'><div class='jalor-dialog-maximg'></div></div>")}h.push("<div class='jalor-dialog-title'></div></div>")}},buildBody:function(h,j){h.push("<div class='jalor-dialog-body'></div>")},buildFoot:function(h,j){h.push("<div class='jalor-dialog-foot'></div>")},buildResizable:function(h,k){var j=["e","s","se"];$.each(j,function(l,n){if(n=="se"){n="se resizable-icon"}h.push('<div class="jalor-dialog-resizable resizable-'+n+'"></div>')})},buildFootContent:function(l,n){var j="<input type=button   value='{0}' class='jalor-dialog-button {1}'>";if(n.imgBtn){j='<span class="jalor-button" tabIndex=0><a class="jalor-icon {1}"></a><label>{0}</label></span>'}var k=l.getFoot(),h=[];if(n.buttons){h=h.concat(n.buttons)}if(typeof n.okClick=="function"){h.push({text:n.okText||"jalor.common.button.ok",icon:"confirm",onClick:n.okClick,cls:"jalor-icon"})}if(typeof n.okClick=="function"||n.cancelClick){h.push({text:n.cancelText||"jalor.common.button.cancel",icon:"cancel",cls:"jalor-icon",onClick:typeof n.cancelClick=="function"?n.cancelClick:function(){this.close(l,l.op)}})}$.each(h,function(p,o){o.icon=o.icon||"";$(j.formatValue($i18n(o.text),o.icon)).addClass(o.cls).bind("click",function(q){o.onClick&&o.onClick.call(l,q);q.stopPropagation()}).appendTo(k)});k.addClass(n.btnAlign)},buildFocusInput:function(k,l){var j=k.getHead(),h=k.getFoot();j.find("div.jalor-dialog-title").append($.create("input","jalor-dialog-focus","z","button"));h.append($.create("input","jalor-dialog-focus","focusInputEnd","button"))},buildBodyContent:function(j,n){var h=j.getBody();n.fnBeforeLoad&&n.fnBeforeLoad.call(j,j.dom,n);var l=n.content?"dom":(n.load?"ajax":"iframe");if(l=="dom"){typeof n.content=="string"?h.html(n.content):h.append($(n.content).show());n.fnLoad&&n.fnLoad.call(j,j.dom,n)}else{if(l==="ajax"&&n.url){n.ajax={};n.autoLoad=false;var k=new Date();h.jalorLoad(n.url,function(){n.fnLoad&&n.fnLoad.call(j,j,n);var o=new Date();Jalor.Hwa.send($i18n("jalor.hwa.message.popupTime"),o-k,Jalor.Page.getForwardUrl(Jalor.Page.register(n.url)))},true)}else{if(l==="iframe"&&n.url){h.html("<iframe src='{0}' class='jalor-dialog-iframe' width=100% height={1}px  frameborder=0 />".formatValue(n.url,n.height-10))}}}},buildOverlay:function(j,k){if(k.modal){var h=$("#jalor_dialog_overlay");if(h.length==0){h=$('<div class="jalor-overlay" id="jalor_dialog_overlay"></div>').prependTo($(document.body)).click(function(){a.Helper.focus()})}return h}}};c.EventBinder={init:function(h,j){this.bindDrag(h,j);this.bindClick(h,j);this.bindFocus(h,j);this.bindScroll(h,j);j.reSizable&&this.bindReSize(h,j)},bindDrag:function(h,k){if(k.drag&&!k.fixed){var j=h.dom;j.find("div.jalor-dialog-title").drag({handler:j,onDroped:function(){h.focus();k.fnDraged&&k.fnDraged.call(this,h.dom,k)}})}},bindClick:function(h,j){h.dom.find("div.jalor-dialog-closeimg").click(function(k){k&&k.stopPropagation&&k.stopPropagation();h.close()});h.getHead().find(".jalor-dialog-max").click(function(){$(h.dom).css("height","").fullScreen();var k=$(this).children(".jalor-dialog-maximg");k.toggleClass("small-maximize");var p=h.getHead(),o=h.getFoot(),n=h.getBody(),l=o.outerHeight()+p.outerHeight();if(k.hasClass("small-maximize")){n.data("originalHeight",n.height());n.height($(h.dom).height()-l-9)}else{n.height(n.data("originalHeight"))}})},bindFocus:function(h,j){h.dom.find("#focusInputEnd").focus(function(){h.focus()});if(j.infoTip){$(document).bind("mousedown.infoTip",function(k){if(h.dom.find(".jalor-dialog-pinimg.pin").length>0||h.dom.data("notClose")){return}if(h.dom.find(k.srcElement).length<1){h.close();$(document).unbind("mousedown.infoTip")}})}},bindReSize:function(h,j){$(".jalor-dialog-resizable").mousedown(function(r){$(document).bind("selectstart.resize",function(){return false});var s=$(this),l=h.dom,q=l.offset().left,p=l.offset().top,w=h.getHead(),k=h.getFoot(),t=h.getBody(),o=k.outerHeight()+w.outerHeight(),v=j.minHeight,u=j.maxHeight,n=9;if(v){v=v+o+n}if(u){u=u+o+n}$(document).bind("mousemove.resize",function(C){var z=C.clientX+$(window).scrollLeft(),D=C.clientY+$(window).scrollTop(),B=z-q,A=D-p;B<100&&(B=100);A<100&&(A=100);if(v&&(A<v)){A=v}if(u&&(A>u)){A=u}if(s.hasClass("resizable-e")){l.css({width:B});return}else{if(s.hasClass("resizable-s")){l.css({height:A})}else{l.css({width:B,height:A})}}t.css({height:A-o-n})});$(document).mouseup(function(){$(document).unbind("mousemove.resize").unbind("selectstart.resize")})})},bindScroll:function(h,j){h.getBody().scroll(function(){var k=Jalor.Page.getContentPanel().children("#popupPanel").children(".jalor-popup:visible");if(k){k.filter(":not(.jalor-popup-lock)").each(function(){Jalor.UI.popupClose($(this))})}$("#jalor_calendar_div:visible").each(function(){Jalor.UI.popupClose($(this))})})}};a.Helper={index:0,zIndex:1000,lives:0,idprex:"jalor_dialog",newId:function(){return this.idprex+(++this.index)},close:function(h){h?$("div.jalor-dialog").remove():$("div.jalor-dialog.modal").remove();getDialog().lives=0;$("#jalor_dialog_overlay").hide()},focus:function(){$("div.jalor-dialog.modal:last").find("#focusInputBegin").focus()}};var e={getHead:function(){return DomClass.getProp(this,this.dom,"head",".jalor-dialog-head")},getBody:function(){return DomClass.getProp(this,this.dom,"body",".jalor-dialog-body")},getFoot:function(){return DomClass.getProp(this,this.dom,"foot",".jalor-dialog-foot")},getOverlay:function(){return $("#jalor_dialog_overlay")},focus:function(){this.dom.find("#focusInputBegin").focus()},fixPosition:function(){c.updateStyle(this,this.op)},fullScreen:function(h,j,k){if(k){h.css("width")&&h.data("ow",h.css("width"));h.css("left")&&h.data("ol",h.css("left"));h.css("top")&&h.data("ot",h.css("top"));h.css("width","").css("left","").css("top","")}else{h.data("ow")&&h.css("width",h.data("ow"));h.data("ol")&&h.css("left",h.data("ol"));h.data("ot")&&h.css("top",h.data("ot"))}},close:function(){var j=this.op;if(j.reSizable&&this.getHead().find(".jalor-dialog-maximg.small-maximize").length){$(this.dom).fullScreen()}if(j.status!=="closing"){if(typeof j.fnBeforeClose=="function"){if(j.fnBeforeClose.call(this,this.dom,j)!==false){j.status="closing";j.fnClose&&j.fnClose.call(this,this.dom,j);this.destory(this,j);try{document.selection&&document.selection.empty()}catch(h){}}}else{j.status="closing";j.fnClose&&j.fnClose.call(this,this.dom,j);this.destory(this,j)}}else{this.destory(this,j)}},destory:function(){var h=this.op;if(h.closeRemove){h.content=null;h.fnDestory&&h.fnDestory.call(this);this.dom.remove()}else{this.dom.hide()}if(h.modal){a.Helper.lives--;if(a.Helper.lives>0){this.getOverlay().css("z-index",1000+a.Helper.lives*10-11)}else{this.getOverlay().hide()}}this.op.infoTip&&$(document).unbind("mousedown.infoTip")}};var b={init:function(h,j){},build:function(h,j){c.Builder.init(h,j)},bindEvent:function(h,j){c.EventBinder.init(h,j)},initComplete:function(h,j){c.initStyle(h,j)},initAjax:function(h,j){this.base.complete.call(this,h,j)},complete:function(h,j){c.updateStyle(h,j);j.handler.complete.fire(h,j)}};var g=Jalor.UI.XControl("XDialog",b,d,e);$.fn.dialog=function(k){if(!k){k={}}if(this.length>0&&!k.closeRemove){k.closeRemove=false}k=$.extend({content:this[0]},k);k.btnAlign=k.btnAlign||Jalor.UI.Config.dialog.btnAlign;if(this.attr("dialogInit")){var h=this.parents(".jalor-dialog:first").manager(),k=h.op;c.initStyle(h,k);c.updateStyle(h,k);k.fnReopen&&k.fnReopen.call(h,h.dom,k);return h.dom}k.id=k.id||a.Helper.newId();var j=$.create("div","jalor-dialog jalor-popup",k.id).attr("init",true);this.attr("dialogInit",true);var h=new g(j,k);k.inited=true;return j};$.dialogClose=function(h){var j=h?$("div.jalor-dialog"):$("div.jalor-dialog.modal");j.each(function(){$(this).manager().close()})};$.fn.getParentDialogManager=function(){return this.parents(".jalor-dialog:first").manager()};Jalor.UI.XControl.addPlugin("XDialog","messageBox",{preInit:function(h,l){var k=l.fnClose;l.fnClose=function(n,o){$(document).unbind("keydown.message.lock");k&&k.call(this,n,o)};if(l.messageBox&&l.messageBox.type){var j=$("div.jalor-dialog.message-box.onlyone");if(j.length>0){j.manager().close()}f[l.messageBox.type].preInit(h,l)}},build:function(h,k){if(k.messageBox&&k.messageBox.type){$(document).unbind("keydown.message.lock").bind("keydown.message.lock",function(l){if(l.keyCode==9){return false}});var j=h.dom.addClass("message-box");k.handler.complete.add(f[k.messageBox.type].complete)}}});var f={message:{preInit:function(h,j){j.title=j.title&&j.title!==d.title?j.title:$i18n(Jalor.UI.Config.messageTitle.title);j.target=null;j.content=("<div class='jalor-dialog-message'><div class='jalor-dialog-image image-{0}'></div><div class='jalor-dialog-content'>").formatValue(j.messageBox.style)+(j.messageBox.encode?$i18n(""+j.content).encode():$i18n(""+j.content)).replace(/\n/g,"<br/>")+"</div></div>";j.buttons=[{icon:"confirm",text:"jalor.common.button.ok",cls:"default",onClick:function(){h.close()}}];j.imgBtn=true},complete:function(h,l){var k=h.dom.addClass("onlyone");k.css("z-index",4010);var j;if(l.imgBtn){j=k.find(".jalor-button.default")}else{j=k.find("input.default")}k.bind("keydown",function(o){var n=o.keyCode;if(n==27||n==13){j.click()}});j.focus()}},confirm:{preInit:function(h,j){j.result=false;j.target=null;j.title=j.title&&j.title!==d.title?j.title:$i18n(Jalor.UI.Config.messageTitle.confirm);j.content="<div class='jalor-dialog-message'><div class='jalor-dialog-image image-question'></div><div class='jalor-dialog-content'>{0}</div></div>".formatText(j.messageBox.encode?$i18n(j.content).encode():j.content);j.okClick=function(){j.result=true;h.close()};j.cancelClick=function(){j.result=false;h.close()};j.imgBtn=true},complete:function(k,o){var n=k.dom,j=k.getFoot(),h=j.find(".jalor-button,input:button");var l=o.messageBox.focusYes?0:1;h.eq(l).addClass("default").focus();n.css("z-index",4010);n.bind("keydown",function(q){var p=q.keyCode;if(p==13){if(h.filter(":focus").length==1){h.filter(":focus").click()}else{h.eq(l).click()}}else{if(p==89){h.eq(0).click()}else{if(p==27||p==78){h.eq(1).click()}}}})}}};Jalor.UI.XControl.addPlugin("XDialog","toolbar",{build:function(h,j){if(typeof j.toolbar=="object"){h.getFoot().jalorToolbar(j.toolbar).find("#focusInputEnd").appendTo(h.getFoot())}}});Jalor.UI.XControl.addPlugin("XDialog","infoTip",{preInit:function(h,k){if(k.infoTip){k.showFoot=false;k.target=document.body;var j=$("#jalor_infoTip");if(j.length>0){j.manager().close()}}},build:function(j,k){if(k.infoTip){var h=$("<div class='jalor-dialog-pin' title='{0}'><div class='jalor-dialog-pinimg' ></div></div>".formatValue($i18n("jalor.common.infotip.pin")));j.getHead().find(".jalor-dialog-title").before(h);h.click(function(){$(this).children().toggleClass("pin");j.dom.toggleClass("pin")})}}})})(Jalor.UI.XDialog);Jalor.UI.XCalendar={};(function(b){var f=Jalor.Local.getCurrLanguage(),k=({zh_CN:{_SDN:["日","一","二","三","四","五","六"],_MN:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],_SMN:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],_Today:"今天",_GoToday:"跳至今天",_PreY:"上一年",_NextY:"下一年",_PreM:"上一月",_NextM:"下一月",_Close:"关闭",_Click:"（CTRL-）点击改变值",_Select:"选择日期",_SelectMonth:"选择月份",_Time:"时间:"},en_US:{_SDN:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],_MN:["January","February","March","April","May","June","July","August","September","October","November","December"],_SMN:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],_Today:"Today",_GoToday:"Go to today",_PreY:"Prev. year",_NextY:"Next year",_PreM:"Prev. month",_NextM:"Next month",_Close:"Close",_Click:"( CTRL- )Click to change value",_Select:"Select date",_SelectMonth:"Select Month",_Time:"Time:"}})[f]||{_SDN:[$i18n("Jalor.Calendar.SDN.Sun"),$i18n("Jalor.Calendar.SDN.Mon"),$i18n("Jalor.Calendar.SDN.Tue"),$i18n("Jalor.Calendar.SDN.Wed"),$i18n("Jalor.Calendar.SDN.Thu"),$i18n("Jalor.Calendar.SDN.Fri"),$i18n("Jalor.Calendar.SDN.Sat")],_MN:[$i18n("Jalor.Calendar.MN.January"),$i18n("Jalor.Calendar.MN.February"),$i18n("Jalor.Calendar.MN.March"),$i18n("Jalor.Calendar.MN.April"),$i18n("Jalor.Calendar.MN.May"),$i18n("Jalor.Calendar.MN.June"),$i18n("Jalor.Calendar.MN.July"),$i18n("Jalor.Calendar.MN.August"),$i18n("Jalor.Calendar.MN.September"),$i18n("Jalor.Calendar.MN.October"),$i18n("Jalor.Calendar.MN.November"),$i18n("Jalor.Calendar.MN.December")],_SMN:[$i18n("Jalor.Calendar.SMN.Jan"),$i18n("Jalor.Calendar.SMN.Feb"),$i18n("Jalor.Calendar.SMN.Mar"),$i18n("Jalor.Calendar.SMN.Apr"),$i18n("Jalor.Calendar.SMN.May"),$i18n("Jalor.Calendar.SMN.Jun"),$i18n("Jalor.Calendar.SMN.Jul"),$i18n("Jalor.Calendar.SMN.Aug"),$i18n("Jalor.Calendar.SMN.Sep"),$i18n("Jalor.Calendar.SMN.Oct"),$i18n("Jalor.Calendar.SMN.Nov"),$i18n("Jalor.Calendar.SMN.Dec")],_Today:$i18n("Jalor.Calendar.Button.Today"),_GoToday:$i18n("Jalor.Calendar.Button.GoToday"),_PreY:$i18n("Jalor.Calendar.Button.PrevYear"),_NextY:$i18n("Jalor.Calendar.Button.NextYear"),_PreM:$i18n("Jalor.Calendar.Button.PrevMonth"),_NextM:$i18n("Jalor.Calendar.Button.NextMonth"),_Close:$i18n("Jalor.Calendar.Button.Close"),_Click:$i18n("Jalor.Calendar.Button.ClickChangeValue"),_Select:$i18n("Jalor.Calendar.Button.SelectDate"),_SelectMonth:$i18n("Jalor.Calendar.Button.SelectMonth"),_Time:$i18n("Jalor.Calendar.Time.Time")},j=['<div class="calendar jalor-popup jalor-calendar" active=false id="jalor_calendar_div" onselectstart="return false;"><table class="current"><thead> <tr>','<td class=button navtype=300></td> <td class="button title" colspan="5"  navtype=300 ></td>','<td class=button ttip="',k._Close,'" navtype=200><div>×</div></td></tr>','<tr class="headrow"><td class="button nav" navtype="-2" ttip="',k._PreY,'"> <div>«</div></td>','<td class="button nav"  navtype="-1" ttip="',k._PreM,'"><div>‹</div> </td>','<td class="button" id="btnToday"    style="min-width:30px"    navtype="0"  colspan=3 ttip="',k._GoToday,'"><div>',k._Today,"</div> </td>",'<td class="button nav"  navtype="1" ttip="',k._NextM,'"><div>›</div> </td>','<td class="button nav"  navtype="2" ttip="',k._NextY,'"> <div>»</div></td></tr>','<tr class="daynames"><td class="day name weekend">',k._SDN[0],'</td><td class="day name">',k._SDN[1],'</td><td class="day name">',k._SDN[2],"</td>",'<td class="day name">',k._SDN[3],'</td><td class="day name">',k._SDN[4],'</td><td class="day name">',k._SDN[5],'</td><td class="day name weekend">',k._SDN[6],"</td>",'</tr></thead><tbody></tbody><tfoot><tr class="footrow">','<td class="ttip"  colspan=7 navtype=301  >',k._Select,"</td></tr></tfoot></table></div>"].join(""),l=["<tr class=time><td class=time colspan=2 >",k._Time,"</td><td class=time colspan=3>",'<span class=hour   navtype="24" ttip="',k._Click,'">&nbsp;</span>','<span class=colon>:</span><span class=minute navtype="60" ttip="',k._Click,'">&nbsp;</span>',"</td><td class=time colSpan=2>&nbsp;</td></tr>"].join(""),g=['<tr class="timezone"><td colspan=7 class="time_zone"><input type="text" name="timeZone_calendar" id="timeZone_calendar" service="LOOKUP2:LOOKUP_TIMEZONE"/></td></tr>'].join("");var c={format:Jalor.Config.Format.date,showDate:true,wmindate:new Date(1900,0,1),wmaxdate:new Date(9999,11,31)};var h=b.Factory={initOp:function(q,r){var u=q.dom,v=u.attr("format")||r.format;if(v==="datehm"||v==="datetime"||(typeof v=="string"&&v.indexOf("hh:mm")!=-1)){r.showTime=true}if(u.attr("isDataOK")==="true"){r.isDataOK=true}if(u.attr("showDate")==="false"){r.showDate=false}if(r.showSecond||u.attr("showSecond")||(typeof v=="string"&&v.indexOf("hh:mm:ss")!=-1)){r.showSeconds=true}if(v==="datetime"&&!r.showSeconds){v=Jalor.Config.Format.datehm}if(u.attr("timezone")==="true"){r.showTimeZone=true}if(u.attr("timezoneop")==="true"){r.timezoneop=true}v=Jalor.Config.Format[v]||v;r.format=v;r.dblmonth=u.attr("dblmonth")||r.dblmonth;var t=u.attr("wmindate")||r.wmindate,o=u.attr("wmaxdate")||r.wmaxdate;r.wmindate=t&&b.Helper.copyDate(t)||c.wmindate;r.wmaxdate=o&&b.Helper.copyDate(o)||c.wmaxdate;if(undefined!=u.attr("defaultdate")&&u.attr("defaultdate").length>=8&&u.attr("defaultdate").validDate(r.format)==true){r.today=u.attr("defaultdate").toDate().getUTCTime();r.isDefaultDate=true}else{r.today=b.Helper.copyDate(new Date().getUTCTime())}if(u.attr("maxGap")){var s=u.attr("maxGap"),n=u.attr("compareTo");if(!isNaN(s)&&n){var p=$(n).jalorGetValue();p&&(r.wmaxdate=p.toDate().addMonth(s*1))}}r.initDate=u.val().toDate(v)}};h.Builder={buildPopup:function(n,o){this.buildPopupPanel(n,o);this.buildDateArea(n,o);this.buildTimeArea(n,o);this.buildTimeZoneArea(n,o)},buildDateArea:function(p,r){var s=p.getPopup(),t=p.dom,q=r.navDate||r.initDate,u=p.dom.val();r.navDate=null;s.find("tbody").empty();s.find("table.second").remove();if(!q&&u.length>=8&&u.validDate(r.format)!==true){r.selectDate=q=r.today}else{r.selectDate=q=q||u&&u.toDate(r.format)||r.today}if(!b.Helper.inSelectRange(r,q)){r.selectDate=q=q>r.wmaxdate?r.wmaxdate:r.wmindate}this.buildMonthForTable(s.find("table.current"),q,r);if(r.dblmonth){var n=$(s.find("table.current").parent().html()).addClass("second").removeClass("current");if(r.dblmonth=="prev"){s.addClass("dblmonth").find("table").before(n.addClass("prev"))}else{s.addClass("dblmonth").find("table").after(n.addClass("next"))}var v=(r.dblmonth=="prev")?-1:1;var o=new Date(q.getFullYear(),q.getMonth()+v,1);this.buildMonthForTable(s.find("table.second"),o,r)}else{s.removeClass("dblmonth")}},buildTimeArea:function(q,r){var o=q.getPopup();if(r.showTime||r.showSecond||r.isDataOK){if(o.find("tr.time").length==0){var p=r.initDate||(new Date().getUTCTime());if(r.isDefaultDate){p=r.today}o.find("tbody").append($(l));this.buildInputTime(q,r,p)}}else{o.find("tr.time").hide()}var n=q.dom;Jalor.UI.popup(n,o,{top:n.height()+4},true,true,null,true)},buildInputTime:function(r,s,q){var o=r.getPopup();var n=r.dom;function p(u){var z=$("#jalor_timespinner_input_{0}".formatValue(u));var v=0,w=[q.getHours(),q.getMinutes()];s.showSeconds&&w.push(q.getSeconds());function y(C){return C<10?"0"+C:C}function B(D){if(v>=6&&v<=8&&s.showSeconds){w[2]+=D;w[2]>59&&(w[2]=0);w[2]<0&&(w[2]=59)}else{if(v>=3&&v<=5){w[1]+=D;w[1]>59&&(w[1]=0);w[1]<0&&(w[1]=59)}else{w[0]+=D;w[0]>23&&(w[0]=0);w[0]<0&&(w[0]=23)}}var C=[];$.each(w,function(E,F){C.push(y(F))});z.val(C.join(":"))}B(0);function t(C){if(C>=6&&C<=8){return[6,8]}else{if(C>=3&&C<=5){return[3,5]}else{return[0,2]}}}function A(E){if(typeof E.selectionStart=="number"){v=E.selectionStart}else{if(E.createTextRange){var D=E.createTextRange();var C=document.selection.createRange();C.setEndPoint("StartToStart",D);v=C.text.length}}return v}function x(E,F){var C=t(F);if(E.setSelectionRange){E.setSelectionRange(C[0],C[1])}else{if(E.createTextRange){var D=E.createTextRange();D.collapse();D.moveEnd("character",C[1]);D.moveStart("character",C[0]);D.select()}}z.focus()}z.parent().bind("click mousedown mouseup",function(C){C.stopPropagation()}).on("mouseover",function(){n.data("ctr_locked",true)}).on("mouseout",function(){n.data("ctr_locked",false)});z.bind("click",function(){v=A(this);x(this,v)}).bind("blur",function(){var D=s.showSeconds?"^([0-9]{2}):([0-9]{2}):([0-9]{2})$":"^([0-9]{2}):([0-9]{2})$";var G=new RegExp(D);var I=$(this).val();if(G.test(I)){var J=I.match(G);J.splice(0,1);var F=true,H=[];for(var E=0;len=J.length,E<len;E++){var C=parseInt(J[E],10);H.push(C);if((E==0&&C>23)||(E>0&&C>59)){F=false}}F&&(w=H)}B(0);$(this).find("input").focus()}).bind("keydown keyup",function(C){C.stopPropagation()});$("#jalor_timespinner_up_{0}".formatValue(u)).click(function(){B(1);x(z[0],v)});$("#jalor_timespinner_down_{0}".formatValue(u)).click(function(){B(-1);x(z[0],v)})}o.find("tr.time").each(function(t){$(this).children(":eq(1)").html('<div class="timespinner"><input type="text" id="jalor_timespinner_input_{0}" /><span class="timespinner-arrow"><i class="up" id="jalor_timespinner_up_{0}"></i><i class="down" id="jalor_timespinner_down_{0}"></i> </span></div>'.formatValue(t));p(t)});if(s.isDataOK){o.find("tr.time").children(":last").html('<input type="button" value="确定" />')}},buildTimeZoneArea:function(p,q){var n=p.getPopup();if(q.showTimeZone){if(n.find("tr.timezone").length==0){n.find("tbody").append($(g));var o=$("#timeZone_calendar");o.jalorCombobox({fnSelected:function(w,x,t,v,r){if(w){var u=Jalor.Personalized.global.common.timeZone,s=w.substring(3,w.length);u=u.substring(3,u.length);if(w!==t){if(!q.timezoneop&&s!==u){Jalor.Personalized._settings.get("global").common.timeZone=w;Jalor.Personalized.saveItem({settingKey:"global",settingContent:JSON.stringify(Jalor.Personalized._settings.get("global"))},function(){Jalor.Personalized.init();b.Helper.reInitPopup(w,u,p,q)})}else{if(q.timezoneop&&w!==q.curTimeZone){q.curTimeZone=w;q.initDate=new Date();b.Helper.reInitPopup(w,"+8",p,q)}}}}}});o.jalorSetValue(q.curTimeZone||Jalor.Personalized.global.common.timeZone)}}else{n.find("tr.timezone").hide()}},buildMonthForTable:function(B,y,x){var v=B.find("tbody");var A=new Date(y.getFullYear(),y.getMonth()+1,0).getTime();var o=new Date(y.getFullYear(),y.getMonth(),1).getTime();var t=new Date(o).getDay();B.find("thead td.title").text(f=="zh_CN"?y.format("yyyy 年  MM 月"):k._MN[y.getMonth()]+","+y.getFullYear());var w=[],q=true,n=1,s=o;for(var u=0;u<6;u++){w.push("<tr class=daysrow>");for(var r=0;r<=6;r++){if(q&&r<t||s-A>60*60*1000){w.push('<TD class="disabled"  pos="{0}" class="day">&nbsp;</TD>'.formatValue(r))}else{if(!b.Helper.inSelectRange(x,s)){w.push('<TD class="day disabled" disabled  pos="{0}" caldate={1}>{2}</TD>'.formatValue(r,s,n++));s+=24*60*60*1000}else{var p=r<1||r>5?"day valid weekend":"day valid";var z=b.Helper.copyDate(x.selectDate).getTime()-s;if(z<=3600*1000&&z>3600*(-1000)){p+=" selected"}if(s==x.today.getTime()){p+=" today"}w.push('<TD class="{0}" ttip="_" pos="{1}" caldate={2}>{3}</TD>'.formatValue(p,r,s,n++));s+=24*60*60*1000}}}q=false;w.push("</tr>");if(s-A>60*60*1000&&!x.dblmonth){break}}v.html(w.join(""))},buildPopupPanel:function(n,o){if(j){popuper=$(j).appendTo($(document.body)).focusout(function(q){var p=$(this);if(p.attr("active")==="false"){if(!(o.showTimeZone&&$("#timeZone_calendar_ddl:visible").length)){p.hide()}}});j=null}n.getPopup().attr("for",o.popupId)}};h.EventBinder={init:function(n,o){this.bindClick(n,o);this.bindBlur(n,o);this.bindKeyDown(n,o)},bindClick:function(n,o){n.dom.bind("click",function(p){n.getPopup().find("table.current").find("tr.daynames").show();n.isPopup()?n.hidePopup():b.Helper.showPopup(n,o);p.stopPropagation()})},bindBlur:function(n,o){n.dom.bind("focusout",function(r){if(!(o.showTimeZone&&$("#timeZone_calendar_ddl:visible").length)){if(n.isPopup()&&n.getPopup().attr("active")==="false"){n.hidePopup()}var p=$.trim(this.value);var q=!$(this).attr("format")||!Jalor.Config.Format[$(this).attr("format")]?o.format:null;if(p&&p.validDate(q,o.showTime)){this.value=p.toDate(q).format(o.format)}}})},bindKeyDown:function(n,o){n.dom.bind("keydown",function(p){if(n.isPopup()){switch(p.keyCode){case 37:case 38:case 39:case 40:$("#selectMonth").length?b.Helper.move(n,p.keyCode,p):h.EventBinder.move(n,p.keyCode,p);break;case 32:b.Helper.goToday(n,true,p);break;case 27:n.hidePopup();break;case 13:b.Helper.selected(n);break;case 17:break;default:n.hidePopup();return true}return false}});n.dom.bind("focusout",function(t){var q=n.dom.val();if(""!=q&&/^\d{8}$/.test(q)&&"yyyy-MM-dd"==n.op.format){var u=q.substring(0,4);var p=q.substring(4,6);var r=q.substring(6,q.length);q=u+"-"+p+"-"+r;n.dom.val(q)}})},initPopup:function(n,o){this.bindPopuerClick(n,o);this.bindPopuerMouseEvent(n,o)},bindPopuerClick:function(o,p){var n=o.getPopup();n.bind("click",false);n.undelegate("td.time_zone","click").delegate("td.time_zone","click",function(q){$(this).find("input").focus()});n.undelegate("td[class!='time_zone']","click").delegate("td[class!='time_zone']","click",function(x){x.stopPropagation();var t=$(this);if(t.hasClass("disabled")){o.dom.focus();return}if(p.dblmonth&&t.hasClass("title")){return}var y=$.getEventTarget(x),B=t.attr("navtype")||y.attr("navtype");var s,A,r=$("#selectMonth").length;if(!r){s=n.find("tbody td.selected").attr("caldate");s=!isNaN(s)?s*1:0}else{A=n.find("td.title").text();if(f!="zh_CN"){var q=A.split(",")[0],w=0,C=A.split(",")[1];while(w<k._MN.length){if(k._MN[w]==q){q=w<10?("0"+w):w;break}w++}s=new Date(C,q).getTime()}else{s=new Date(A.substr(0,4)*1,A.substr(8,2)*1-1).getTime()}}var z=new Date(s||p.selectDate.getTime());if(B){switch(B*1){case 200:o.hidePopup();return;case 300:b.Helper.getAllMonth(o);break;case 0:b.Helper.goToday(o,false,x);break;case -1:z=z.addMonth(-1);break;case 1:z=z.addMonth(1);break;case -2:z.setFullYear(z.getFullYear()-1);break;case 2:z.setFullYear(z.getFullYear()+1);break;case 24:n.find("span.hour").text(b.Helper.plusTime(y.text(),24,!x.ctrlKey));break;case 60:n.find("span.minute").text(b.Helper.plusTime(y.text(),60,!x.ctrlKey));break}if(B==0){}else{if(B==24||B==60){b.Helper.setValue(o,z)}else{if(B!=300&&(b.Helper.inSelectRange(p,new Date(z.getFullYear(),z.getMonth()+1,0))||b.Helper.inSelectRange(p,new Date(z.getFullYear(),z.getMonth(),1)))){p.navDate=z;if(r){b.Helper.getAllMonth(o);$("#selectMonth td.selected").removeClass("selected");$("#selectMonth td:eq("+p.navDate.getMonth()+")").addClass("selected");var u=new Date(p.navDate.getTime());n.find("thead td.title").text(f=="zh_CN"?u.format("yyyy 年  MM 月"):k._MN[u.getMonth()]+","+u.getFullYear())}else{h.Builder.buildPopup(o,p)}if(p.showDate==false){b.Helper.setValue(o,z)}}}}}else{if(t.hasClass("day")){if(p.isDataOK){$("tr.daysrow td.selected").removeClass("selected today");t.addClass("selected")}var v=t.attr("caldate");if(r){var D;A=n.find("table.current").find("td.ttip").html();if(f!="zh_CN"){var q=A.split(",")[1],w=0,C=A.split(",")[0];while(w<k._SMN.length){if(k._SMN[w]==q){q=w<10?("0"+w):w;break}w++}D=new Date(C,q).getTime()}else{D=new Date(A.substr(0,4)*1,A.substr(7,2)*1-1).getTime()}if(p.navDate==null||(p.navDate.toString()===p.selectDate.toString())||s!==D||p.navDate.toString().indexOf("NaN")>-1){z=new Date(D);p.navDate=z}}if(v){b.Helper.selected(o,t)}}else{if(t.hasClass("time")&&p.isDataOK){if(t.children("input[type='button']")){b.Helper.selected(o,$("tr.daysrow td.selected"),true)}}}}o.dom.focus()})},move:function(t,q,s){var p=t.getPopup(),u=t.op,r=p.find("tbody td.selected");if(r.length>0){var o=new Date(r.attr("caldate")*1);if(q==37){o.setDate(o.getDate()-1)}else{if(q==39){o.setDate(o.getDate()+1)}else{if(q==38){_stopDefasultEvent(s);o.setDate(o.getDate()-7)}else{if(q==40){_stopDefasultEvent(s);o.setDate(o.getDate()+7)}}}}if(b.Helper.inSelectRange(u,o)){var n=p.find("tbody td[caldate='"+o.getTime()+"']");if(n.length>0){r.removeClass("selected");n.addClass("selected")}else{u.navDate=o;h.Builder.buildPopup(t,u)}}}},bindPopuerMouseEvent:function(o,p){var n=o.getPopup();n.bind("mousedown",false);n.delegate("td","mouseover",function(w){var x=$.getEventTarget(w),s=$(this),r=$("#selectMonth").length;if(s.hasClass("button")){s.addClass("active");n.find("td.ttip").text(s.attr("ttip")||(r?k._SelectMonth:k._Select))}else{if(s.hasClass("valid")){var y=new Date(s.attr("caldate")*1+1000*60*60);var v=f=="zh_CN"?y.format("yyyy 年MM 月dd 日"):k._SDN[y.getDay()]+",  "+k._SMN[y.getMonth()]+" "+s.text();if(r){var A=n.find("td.title").text(),B=f=="zh_CN"?A.substr(0,4):A.split(",")[1],t;v=f=="zh_CN"?B+" 年"+y.format(" MM 月"):B+","+k._SMN[y.getMonth()];if(f!="zh_CN"){var q=A.split(",")[0],u=1,B=A.split(",")[1];while(u<k._MN.length){if(k._MN[u-1]==q){q=u<10?("0"+u):u;break}u++}t=new Date(B,q)}else{t=new Date(A.substr(0,4)*1,A.substr(8,2)*1-1)}var z=new Date(t.getTime()||p.selectDate.getTime());z=z.addMonth(y.getMonth()-t.getMonth());p.navDate=z}n.find("td.ttip").text(v);s.addClass("hilite")}else{if(x.hasClass("hour")||x.hasClass("minute")){x.addClass("hilite");n.find("td.ttip").text(x.attr("ttip"))}}}});n.delegate("td","mouseout",function(r){var q=$.getEventTarget(r),s=$(this);if(s.hasClass("button")){s.removeClass("active")}else{if(s.hasClass("valid")){s.removeClass("hilite")}else{if(q.hasClass("hour")||q.hasClass("minute")){q.removeClass("hilite")}}}n.find("td.ttip").text($("#selectMonth").length?k._SelectMonth:k._Select)});n.bind("mouseover",function(){$(this).attr("active",true)});n.bind("mouseout",function(){$(this).attr("active",false)});this.bindPopuerMouseEvent=function(){}}};b.Helper={copyDate:function(n){var n=Jalor.Format.toDate(n);return new Date(n.getFullYear(),n.getMonth(),n.getDate())},inSelectRange:function(p,n){var o=this.copyDate(n);if(o>p.wmaxdate||o<p.wmindate){return false}return true},plusTime:function(p,o,n){p=p*1;if(n){p++;p=p%o}else{p--;p=(o+p)%o}return(""+p).fillChar(2)},selected:function(s,o,n){var p=s.getPopup(),t=s.op;if($("#selectMonth").length&&t.showDate){p.find("tr.daynames").show();h.Builder.buildPopup(s,t)}else{var r=o||p.find("tbody td.selected");var q=b.Helper.copyDate(new Date(r.attr("caldate")*1+1000*60*60));if(n||!t.isDataOK){this.setValue(s,q);s.hidePopup()}}},setValue:function(t,r){var p=t.dom,u=t.op,o=t.getPopup();if(u.showTime){var q=$("#jalor_timespinner_input_0").val();var s=q?q.split(":"):[0,0,0];r.setHours(parseInt(s[0],10));r.setMinutes(parseInt(s[1],10));u.showSeconds&&r.setSeconds(parseInt(s[2],10))}if(b.Helper.inSelectRange(u,r)){p.val(r.format(u.format));r=r.getUTCTime("+8",u.curTimeZone);if(u.timezoneop){var n=(p.attr("showDate")=="false"||p.attr("datatype")=="string");if(!u.format||(u.format&&n)){p.data("value",r.format(u.format))}else{if(u.format&&!n){p.data("value",r.toDate(u.format))}}}if(typeof p.valid=="function"){p.valid()}p.change()}},goToday:function(p,q,o){var r=p.op,n=r.today.getTime();if(b.Helper.inSelectRange(r,n)){this.setValue(p,b.Helper.copyDate(new Date(n)));p.hidePopup()}},showPopup:function(n,o){h.initOp(n,o);h.Builder.buildPopup(n,o);h.EventBinder.initPopup(n,o);n.showPopup()},reInitPopup:function(p,o,r,s){s.today=b.Helper.copyDate(new Date().getUTCTime(p.substring(3,p.length)),o);if(s.initDate){var q=s.initDate;s.initDate=s.initDate.getUTCTime(p.substring(3,p.length),o);r.dom.val(s.initDate.format("yyyy-MM-dd hh:mm"));if(s.timezoneop){var n=(r.dom.attr("showDate")=="false"||r.dom.attr("datatype")=="string");if(!s.format||(s.format&&n)){r.dom.data("value",q.format(s.format))}else{if(s.format&&!n){r.dom.data("value",q)}}}}h.Builder.buildPopup(r,s);r.getPopup().show();r.dom.focus()},getAllMonth:function(r){var y=r.getPopup(),C=y.find("table.current"),s=C.find("tbody");var v=r.op,t=v.navDate||v.selectDate,x=t.getFullYear();C.find("tr.daynames").hide();C.find("td.ttip").text(k._SelectMonth);var B="<tr rowspan='4'><td colspan='7'><table id='selectMonth'><tr class='daysrow'>"+"<td class='day valid' caldate='{0}'>".format((new Date(x,0,1)).getTime())+k._SMN[0]+"</td>"+"<td class='day valid' caldate='{0}'>".format((new Date(x,1,1)).getTime())+k._SMN[1]+"</td>"+"<td class='day valid' caldate='{0}'>".format((new Date(x,2,1)).getTime())+k._SMN[2]+"</td>"+"<td class='day valid' caldate='{0}'>".format((new Date(x,3,1)).getTime())+k._SMN[3]+"</td></tr><tr class='daysrow'>"+"<td class='day valid' caldate='{0}'>".format((new Date(x,4,1)).getTime())+k._SMN[4]+"</td>"+"<td class='day valid' caldate='{0}'>".format((new Date(x,5,1)).getTime())+k._SMN[5]+"</td>"+"<td class='day valid' caldate='{0}'>".format((new Date(x,6,1)).getTime())+k._SMN[6]+"</td>"+"<td class='day valid' caldate='{0}'>".format((new Date(x,7,1)).getTime())+k._SMN[7]+"</td></tr><tr class='daysrow'>"+"<td class='day valid' caldate='{0}'>".format((new Date(x,8,1)).getTime())+k._SMN[8]+"</td>"+"<td class='day valid' caldate='{0}'>".format((new Date(x,9,1)).getTime())+k._SMN[9]+"</td>"+"<td class='day valid' caldate='{0}'>".format((new Date(x,10,1)).getTime())+k._SMN[10]+"</td>"+"<td class='day valid' caldate='{0}'>".format((new Date(x,11,1)).getTime())+k._SMN[11]+"</td></tr></table></td></tr>";s.html(B).show();var z=r.dom;Jalor.UI.popup(z,y,{top:z.height()+4},true,true,null,true);if(v.wmindate){var q=new Date(v.wmindate);var A=q.getFullYear();var w=q.getMonth();if(A==x){$("#selectMonth td:lt("+w+")").addClass("disabled")}}if(v.wmaxdate){var n=new Date(v.wmaxdate);var u=n.getFullYear();var p=n.getMonth();if(u==x){$("#selectMonth td:gt("+p+")").addClass("disabled")}}var o=$("#selectMonth td");o.css("text-align","center");$(o.get(r.op.today.getMonth())).addClass("today");$(o.get(r.op.selectDate.getMonth())).addClass("selected")},move:function(s,q,u){var y=s.getPopup(),t=s.op,v=y.find("tbody td.selected");if(v.length>0){var x=y.find("td.title").text(),o,w;if(f!="zh_CN"){var n=x.split(",")[0],r=0,z=x.split(",")[1];while(r<k._MN.length){if(k._MN[r]==n){n=r<10?("0"+r):r;break}r++}o=new Date(z,n).getTime()}else{o=new Date(x.substr(0,4)*1,x.substr(8,2)*1-1).getTime()}w=new Date(o);if(q==37){w=w.addMonth(-1)}else{if(q==39){w=w.addMonth(1)}else{if(q==38){w=w.addMonth(-4)}else{if(q==40){w=w.addMonth(4)}}}}t.navDate=w;$("#selectMonth td.selected").removeClass("selected");$("#selectMonth td:eq("+t.navDate.getMonth()+")").addClass("selected");var p=new Date(t.navDate.getTime());y.find("thead td.title").text(f=="zh_CN"?p.format("yyyy 年  MM 月"):k._MN[p.getMonth()]+","+p.getFullYear())}}};var e={getPopup:function(){return $("#jalor_calendar_div")},focus:function(){this.dom.focus()},hidePopup:function(){this.dom.removeData("ctr_locked",true);this.getPopup().hide();$("#timeZone_calendar_ddl").hide()},isPopup:function(){var n=this.getPopup();return(this.op.popupId==n.attr("for")&&n.css("display")!="none")},showPopup:function(){var q=this.op,o=this.getPopup(),n=this.dom;if(!q.showDate){o.find("tbody,tr.dayNames").hide();b.Helper.getAllMonth(this)}else{o.find("tbody,tr.dayNames").show()}o.css("width",q.dblmonth?430:215);if(q.dblmonth){if(o.hasClass("dblmonth")){var p=o.find("table td.title");p.hasClass("button")&&p.removeClass("button")}}else{o.find("table td.title").addClass("button")}Jalor.UI.popup(n,o,{top:n.height()+4},true,true,null,true)}};var a={init:function(n,o){o.popupId=$.newGuid("CAL");h.initOp(n,o);n.dom.attr("calendar",o.popupId)},bindEvent:function(n,o){h.EventBinder.init(n,o)}};var d=Jalor.UI.XControl("XCalendar",a,c,e);$.fn.calendar=function(n){this.each(function(){var o=$(this);if(!o.attr("init")){o.attr("init",true);calendar=new d(o,n)}});return this}})(Jalor.UI.XCalendar);Jalor.UI.Renders.add(function(b,a){b.filter(".jalor-calendar").jalorDatepicker()});(function(e){var c={type:null,count:5,showMore:true,template:"<li ><span class='cms_data_span' >${releasedDate}</span><a id='${id}'  title='${title}'  class='link-content'>${title}</a></li>"};var b={init:function(f,g){a.Init(f,g)},build:function(f,g){a.buildBody(f,g)},bindEvent:function(f,g){a.bindEvent(f,g)},initComplete:function(f,g){},initAjax:function(f,h,g){},requestComplete:function(f,j,h,g){},bindData:function(f,h,g){},bindDataComplete:function(f,g){},complete:function(f,g){}};var d={reload:function(){this.dom.loading();a.buildBody(this,this.op)}};var a={Init:function(f,g){},getCmsObj:function(f){return $(f).manager("XCms")},buildBody:function(f,h){var g=f.dom;h.type=g.attr("type")||h.type;h.count=g.attr("count")||h.count;h.showMore=g.attr("showMore")||h.showMore;h.template=g.attr("template")||h.template;Jalor.doGet("services/jalor/cms/list/index",{language:workspaceVO.currentLanguage=="zh_CN"?1:0,firstLevelType:h.type},function(n){var l=h.count<n.length?h.count:n.length;var o=new Array();for(var k=0;k<l;k++){var j=Jalor.Format.toDateStr(n[k].releasedDate).split("-");j="["+j[1]+"/"+j[2]+"]";n[k].releasedDate=j;o.push(n[k])}g.jalorTemplate({tmpl:h.template},o)},null,null,false)},bindEvent:function(f,h){var g=f.dom;g.delegate("a","click",function(j){var j=$(this);Jalor.Common.openPage("jalor.common.label.view","jalor/cms/viewCms.html",{width:1000,height:550,reSizable:true,buttons:[{text:"jalor.common.button.cancel",onClick:function(){this.close()}}]},function(){Jalor.cms.ViewCms.init(j.id())})})}};var e=Jalor.UI.XControl("XCms",b,c,d);$.fn.jalorCms=function(f){return new e(this,f)}})(Jalor.UI.XCms);(function(f){var b={panelBegin:"<ul>",item:'<li class="jalor-menubutton-item ${itemCSS}" ${attr}><a class="jalor-icon ${icon}"></a><span>${text}</span></li>',panelEnd:"</ul>",defaultItemClass:"defautl-item",css:{top:-1,left:5}};var a={init:function(g,h){if(g.dom.hasClass("init")){h._init=true;return}g.dom.addClass("jalor-menubutton");if(h.jalorPermission){g.dom.attr("jalorPermission",h.jalorPermission)}if(h.uClass){g.dom.addClass(h.uClass)}g.dom.append("<div class='jalor-menubutton-body'></div>")},build:function(h,j){var g="";if(j._init){g=h.dom.children(".jalor-menubutton-selector")}else{g=$.create("div").addClass("jalor-menubutton-selector")}j.selectorClass&&g.addClass(j.selectorClass);e.buildDefaultMenu(g,h,j);e.buildSelector(g,h,j);e.buildTrigger(h,j)}};var c={getMenuItemList:function(){return e.getSelector(this).children("ul").children()},getMenuItemCount:function(){return this.op.itemCount},addMenuItem:function(j){if(j.permission&&Jalor.Permission.check(j.permission)===false){return}var g=e.getSelector(this).children();j.attr=e.attrConvert(j.attr)||"";j.itemCSS=j.itemCSS||"";g.append(Jalor.UI.tmplList(this.op.item,[j]));var h=g.children(":last");e.setItemEvent(h,j.click);this.op.itemCount++},removeMenuItem:function(h){var g=e.getSelector(this).children();g.children("#"+h).remove()},disabled:function(g){if(g){this.dom.children().attr("disabled","disabled").addClass("disabled")}else{this.dom.children().removeAttr("disabled").removeClass("disabled")}}};var e={index:0,popup:function(k,l,h){var j=k.dom.width();if(h.width()<j){h.width(j)}var g={};$.extend(g,l.css);g.top=(g.top||0)+k.dom.outerHeight();Jalor.UI.popup(k.dom,h,g)},buildDefaultMenu:function(h,j,n){if(n._init){var g=j.dom.children(".jalor-menubutton-body");if(!g.attr("onclick")){g.click(function(){$(this).next(".jalor-menubutton-btn").click()})}return}var l=false;if(n.defaultImg){j.dom.children().append($("<a class='jalor-icon "+n.defaultImg+"'></a>"))}j.dom.children().append($i18n(n.defaultText));for(var k=0;k<n.menus.length;k++){if(n.menus[k].isDefaultMenu==true){if(n.menus[k].permission&&Jalor.Permission.check(n.menus[k].permission)){l=n.menus[k].click;break}}}if(n.defaultEvent){this.setItemEvent(j.dom.children(".jalor-menubutton-body"),n.defaultEvent)}if(!n.defaultEvent&&l){this.setItemEvent(j.dom.children(".jalor-menubutton-body"),l)}if(!n.defaultEvent&&!l){j.dom.children(".jalor-menubutton-body").click(function(){$(this).next(".jalor-menubutton-btn").click()})}},popupEvent:function(j,g,h,k){j.click(function(){this.focus();if(!g.is(":hidden")){g.hide()}else{e.popup(h,k,g)}return false}).blur(function(l){setTimeout(function(){if(!$(l.target).is(":focus")){if(!g.data("inpopup")){g.hide();g.data("inpopup",false)}}},150)});g.mousedown(function(){g.data("inpopup",true)});g.click(function(){setTimeout(function(){g.hide();g.data("inpopup",false)},150)})},buildTrigger:function(j,k){var h="",g="";if(k._init){h=j.dom.children(".jalor-menubutton-btn");g=j.dom.children(".jalor-menubutton-selector")}else{h=$.create("a","jalor-menubutton-btn").attr("tabIndex","-1");h.insertAfter(j.dom.children(".jalor-menubutton-body"));g=e.getSelector(j)}this.popupEvent(h,g,j,k)},buildSelector:function(g,h,o){if(o._init){o.itemCount=this.getSelector(h).children().length;return}var l=h.dom,n=l.id();if(!n){n="menu_button_"+(this.index++);l.id(n)}n+="_menulist";g.id(n).data("op",o);o.selectorId=n;var k=this;for(var j=0;j<o.menus.length;j++){o.menus[j].text=$i18n(o.menus[j].text||"");if(o.menus[j].id){if(o.menus[j].attr){o.menus[j].attr.id=o.menus[j].id}else{o.menus[j].attr={id:o.menus[j].id}}}o.menus[j].icon=o.menus[j].icon||"";o.menus[j].itemCSS=o.menus[j].itemCSS||"";o.menus[j].attr=o.menus[j].attr&&this.attrConvert(o.menus[j].attr)||""}g.append(o.panelBegin+Jalor.UI.tmplList(o.item,o.menus)+o.panelEnd);g.appendTo(l);o.itemCount=0;g.find(".jalor-menubutton-item").each(function(p){var q=$(this);if(!q.id()){q.removeAttr("id")}if(o.menus[p].permission){if(Jalor.Permission.check(o.menus[p].permission)){o.itemCount++;if(!o.defaultEvent&&o.menus[p].isDefaultMenu){q.addClass(o.defaultItemClass)}k.setItemEvent(q,o.menus[p].click)}else{q.remove()}}else{o.itemCount++;if(!o.defaultEvent&&o.menus[p].isDefaultMenu){q.addClass(o.defaultItemClass)}k.setItemEvent(q,o.menus[p].click)}})},getSelector:function(g){if(g.op._init){return $(".jalor-menubutton-selector",g.dom)}return $("#"+g.op.selectorId,g.dom)},setItemEvent:function(h,g){if(typeof g=="string"){h.attr("onclick",g)}else{h.click(g)}},attrConvert:function(j){if(j){var g=[];for(var h in j){g.push(h+'="'+j[h]+'"')}return g.join(" ")}else{return""}}};var d=Jalor.UI.XControl("XMenuButton",a,b,c);$.fn.jalorMenuButton=function(g){if(this.length==0){return}else{return this.each(function(){new d($(this),g)})}}})(Jalor.UI.XMenuButton);Jalor.UI.XToolbar={};(function(e){var c={css:"jalor-toolbar",hasItemDiv:true,toolbarItem:"<div class='toolbar-item ${itemCSS}' ></div>",flow:false};var a={init:function(g,h){g.dom.addClass("init").addClass(h.css);h.flow&&g.dom.addClass("toolbar-flow");h.width&&g.dom.css("width",h.width);h.height&&g.dom.css("height",h.height);h.operation||(h.operation={});h._itemCount=0},build:function(g,h){f.buildBtn(g,h)},bindEvent:function(g){g.dom.on("click","[_eno]",function(l){var j=$(this),h=j.attr("_eno");if(h){var k=g.op.operation[h];k&&k.call(j,l,g)}})}};var d={getItem:function(g){if(this.op.hasItemDiv){return g.parent()}else{return g}},addItem:function(h){var g=document.createDocumentFragment();f.addBtn(this,this.op,h,g);this.dom.append(g)},removeItem:function(g){this.getItem(g).remove();this.op._itemCount--},hide:function(g){if(g){this.getItem(g).hide()}else{return this.dom.hide()}},show:function(g){if(g){this.getItem(g).show()}else{return this.dom.show()}},getItemCount:function(){return this.op._itemCount}};var b=Jalor.UI.XControl("XToolbar",a,c,d);$.fn.jalorToolbar=function(g){this.length&&new b(this,g);return this};var f={buildBtn:function(h,j){if(j.items&&j.items.length){var g=document.createDocumentFragment();$.each(j.items,function(k,l){f.addBtn(h,j,l,g)});h.dom.append(g)}},addBtn:function(k,n,l,g){if(l.permission&&!Jalor.Permission.check(l.permission)){return}n._itemCount++;var j=k.dom;if(n.hasItemDiv){j=$(n.toolbarItem.formatField(l)).id("_item"+(n._itemCount));g.appendChild(j[0])}l.type=l.type||n.type;switch(l.type){case"menuButton":var h=$.create("div","jalor-menubutton",l.id).appendTo(j);h.jalorMenuButton(l);break;case"html":j.append(l.htmlContent);break;default:f.regEvent(n,l);j.append(Jalor.UI.newButton(l));$(".jalor-button.reset").click(function(){$(this).closest("form").jalorReset()});break}},regEvent:function(j,h){var g;if(h.opType){g=h.opType}else{if(h.click&&typeof(h.click)!="string"){g=h.id||$.newGuid("toolbar_");j.operation[g]=h.click;delete h.click}}h.attr?h.attr._eno=g:h.attr={_eno:g}}}})(Jalor.UI.XToolbar);(function(d){var c={action:"hover",show:false,tipProp:"title",addTipStyle:null,autoClose:null,delayClose:null,target:null,url:null,child:null,width:200,height:null,content:null,container:null,fnBoforeClose:null,fnClose:null,global:false,offset:false,showOverflow:false};var a={init:function(f,g){b.Init(f,g)},build:function(f,g){},bindEvent:function(f,g){b.EventBinder.Init(f,g)}};var e={getTip:function(){this.op._tip||(this.op._tip=this.createTip(this,this.op));return this.op._tip},showTip:function(g,j){var f=this,j=j||f.dom,k=f.op;k._show=true;var h=f.getTip();if(h&&h.length){if(g!=null){this.setContent(g)}else{if(k.url){this.getTipBody(h).loading(0,1).load(k.url,function(){h.loadingClose();f.popup(j,h)});k.url=null;return h}}if(j.is(":visible")&&(g==null||g)){f.popup(j,h)}else{f.closeTip()}}return h},showTipByAuto:function(j){var g=j.attr(this.op.tipProp);if(!g){if(j.text()){g=j.html()}else{this.closeTip();return}if(this.op.showOverflow){if(typeof this.op.showOverflow=="function"){if(this.op.showOverflow(j)){this.closeTip();return}}else{var f=$('<div style="float:left;height:0px;"></div>').css({"font-size":j.css("font-size")}).html(g).appendTo($(document.body));var h=!!navigator.userAgent.match(/Trident.*rv[ :]*11\./);if((h?f.width()+2:f.width())<=j.width()){f.remove();this.closeTip();return}f.remove()}}}this.showTip(g,j)},closeTip:function(g){var h=this.op;if(h._show){var f=this;if(!h.fnBeforeClose||h.fnfnBeforeClose.call(f)!==false){h._show=false;g==null&&(g=h.delayClose);if(g){var f=this;setTimeout(function(){f.getTip().hide();h.fnClose&&h.fnClose.call(f)},g)}else{this.getTip().hide();h.fnClose&&h.fnClose.call(f)}}}},setContent:function(f){this.getTipBody(this.getTip()).html(f)},getTipBody:function(f){return f.children(".jalor-tip-content")},createTip:function(g,k){var j="_tip_"+(typeof this.id=="undefined"?"content":this.id);$("#"+j).remove();var f=$.create("div","jalor-tip",j);if(k.global){$("body").prepend(f.addClass("global"))}else{if(k.container){f.appendTo(k.container)}else{f.insertAfter(this.dom)}}f.html("<div class='jalor-tip-arrow' ></div><div class='jalor-tip-content' ></div>");f.width(k.width).height(k.height);k.action=="hover"&&Jalor.UI.bindPopupHover(f,null,function(){setTimeout(function(){!f.data("_inpop")&&g.closeTip()},100)});var h=this.getTipBody(f).width(k.width-19).height(k.height);if(!k.child){if(k.content){h.html(k.content);k.content=null}else{if(k.target){h.append($(k.target).show())}}}return f},popup:function(k,o){if(k.length){o||(o=this.getTip());var j=this.op,h=j.global||j.offset;if(h&&j.position=="cursor"&&j._e){o.css({left:j._e.pageX,top:j._e.pageY,position:"absolute"}).show()}else{Jalor.UI.popup(k,o,this.getPosition(k,o),true,h)}var l=k.offset().top-$(window).scrollTop();var g=$(window).height();var n=g-l;var p=o.find(".jalor-tip-content").height();if(n<p){var f=o.offset().top-p+k.height();o.css({top:f+6});o.find("div.jalor-tip-arrow").css({top:p-k.height()})}else{o.find("div.jalor-tip-arrow").css({top:6})}j._e=null}},getPosition:function(l,j){var o=l.offset(),g=$(window).width(),f=j.outerWidth(),k,h=l.outerWidth();if(!this.op.global){var n=l.parents(".jalor-dialog:first");if(n.length){g=n.width();o.left=o.left-n.offset().left}}if(o.left+f+h>g){k=-f-5;j.addClass("jalor-tip-left")}else{k=h+5;j.removeClass("jalor-tip-left")}return{left:k}},unbind:function(){this.getTip().remove();this.dom.removeData("XTip_op");this.dom.unbind(this.op.action=="click"?"click.tip":"mouseenter.tip mouseleave.tip");this.op=this.ctr=null}};var b={Init:function(f,g){g.addTipStyle!==false&&g.action!="once"&&f.dom.addClass("jalor-tip-trigger");if(!g.child&&!g.content){if(!(g.url=f.dom.attr("url"))){if(!(g.target=f.dom.attr("target"))){g.content=f.dom.attr(g.tipProp);f.dom.removeAttr(g.tipProp)}}}f.dom.removeAttr("title")},getTipObj:function(f){return $(f).manager("XTip")},EventBinder:{Init:function(f,g){g.child?this.bindTargetEvent(f,g):this.bindEvent(f,g)},bindEvent:function(k,n){if(n.action=="click"){k.dom.unbind("click.tip").bind("click.tip",function(o){if(k){if(k.op._show){k.closeTip()}else{k.op._e=o;k.showTip()}}})}else{if(n.action=="once"){var l=k.showTip();l.click(function(){k.closeTip(0)});n.autoClose&&k.closeTip(n.delayClose||4000)}else{var j,g,h,f=function(p,o){return setTimeout(function(){if(j){o.op._e=p;o.showTip();g=true;h=null}else{if(g){if(!o.getTip().data("_inpop")){o.closeTip();g=false}}}},100)};k.dom.unbind("mouseenter.tip mouseleave.tip").bind("mouseenter.tip",function(o){j=true;h&&clearTimeout(h);h=f(o,k)}).bind("mouseleave.tip",function(o){j=false;if(!h){h=f(o,k)}})}}if(n.action!="once"&&n.show){var l=k.showTip();l.click(function(){k.closeTip(0)})}},bindTargetEvent:function(k,l){if(l.action=="click"){k.dom.delegate(l.child,"click.tip",function(o){var n=$(this);if(k.op._show){k.closeTip()}else{k.op._e=o;k.showTipByAuto(n)}})}else{var j,g,h,f=function(p,n,o){return setTimeout(function(){if(j){n.op._e=p;n.showTipByAuto(o);g=true;h=null}else{if(g){if(!n.getTip().data("_inpop")){n.closeTip();g=false}}}},100)};k.dom.delegate(l.child,"mouseover",function(n){j=true;h&&clearTimeout(h);h=f(n,b.getTipObj(n.delegateTarget),$(this))}).delegate(l.child,"mouseout",function(n){j=false;if(!h){h=f(n,b.getTipObj(n.delegateTarget),$(this))}})}}}};var d=Jalor.UI.XControl("XTip",a,c,e);$.fn.tip=function(f){return this.each(function(){new d($(this),f)})};$.fn.jalorTip=function(f){if($.isPlainObject(f)){if(f.content){f.content=$i18n(f.content)}return this.tip(f)}else{return this.tip({content:$i18n(f)})}};$.fn.jalorRemoveTip=function(){return this.manager("XTip").closeTip()}})(Jalor.UI.XTip);(function(b){var e={itemMaxCount:10,tabCSS:"jalor-tab",tabLinkCSS:"tab-link",tabUlCSS:"tab-ul",tabContentCSS:"tab-content",tabContenItemCSS:"tab-content-item",tabItemCloseBtnCSS:"tab-item-close",tabLeftBtnCSS:"nav-btn left-btn",tabRightBtnCSS:"nav-btn right-btn",tabSelectedItemCSS:"tab-selected"};var d={init:function(g,h){g.dom.addClass(h.tabCSS).addClass("l-tab");h.width&&g.dom.width(h.width);h.height&&g.dom.height(h.height)},build:function(g,h){c.buildBody(g,h)},bindEvent:function(g,h){c.eventBinder(g,h)},complete:function(g,j){var h=g.dom.find(".tab-content-item[selected]:first");if(j.defaultItemId||h.length){g.selectItem(j.defaultItemId||h.attr("tabid"))}else{g.selectItem(g.getItems().first().attr("tabid"))}g.moveItem("toFirst")}};var f={getPanelLink:function(){return DomClass.getProp(this,this.dom,"panelLink","."+this.op.tabLinkCSS)},getPanelDiv:function(){return DomClass.getProp(this,this.getPanelLink(),"panelDiv","div")},getPanelUl:function(){return DomClass.getProp(this,this.getPanelDiv(),"panelUl","."+this.op.tabUlCSS)},getItems:function(){return this.getPanelUl().children("li")},getItemByTabId:function(g){return this.getPanelUl().children("li[tabid="+g+"]")},getSelectedItem:function(){return this.getPanelUl().children("."+this.op.tabSelectedItemCSS)},getContent:function(){return DomClass.getProp(this,this.dom,"tabContent","."+this.op.tabContentCSS)},getContentItem:function(g){return this.getContent().children("."+this.op.tabContenItemCSS+"[tabid="+g+"]")},getNavButton:function(){return this.getNavButtonContainer().children(".nav-btn")},getNavButtonContainer:function(){return this.getPanelLink().children(".tab-nav-btn")},reloadItem:function(g,h){this.getItemByTabId(g).children("a").html($i18n(h.title));h.url&&this.getContentItem(g).jalorLoad(h.url,h.fnAfterAddItem,true)},isConfirm2Close:function(j){var h=this,g=j.attr("tabid");if(j.attr("isConfirm")){Jalor.UI.confirm("jalor.tab.tabitem.confirm2close",function(k){if(k){h.confirmRemoveItem(g)}})}else{h.confirmRemoveItem(g)}},addItem:function(h){var g=this.addItemOnly(h);if(g&&h.selected!==false){this.selectItem(g.attr("tabid"));this.setItemVisiable(g)}this.setNavButton();this.getNavButton().removeClass("disabled");if(h.addItemAtAfter){g.insertAfter($("li[tabid='"+h.addItemAtAfter+"']"))}},addItemOnly:function(h){var o=this,k=h.tabId||h.tabIndex,r,j=h.helperTip;if(k==null){k="_tabitem"+(this.op._tempTabItemCount+1)}if(this.op.fnBeforeAddItem&&this.op.fnBeforeAddItem.call(this,k)===false){return false}if(o.isItemExist(k)){if(h.isOpenConfirm==true){Jalor.UI.confirm("jalor.tab.tabitem.add.warn",function(s){if(s){o.reloadItem(k,h)}},true)}else{o.reloadItem(k,h)}}else{if(this.getItemCount()+1>this.op.itemMaxCount){Jalor.UI.showMessage($i18n("jalor.tab.tabitem.maxcount.warn").formatValue(this.op.itemMaxCount),"warn");return}this.op._tempTabItemCount++;var n,l;var q=$i18n(h.title||h.text);if(!h.closeByConfirm){l=""}else{l="isConfirm="+h.closeByConfirm}if(h.showClose==null||h.showClose){n="<li tabid={0} {1}><a>{2}</a><div class='{3}'></div></li>".formatValue(k,l,q,this.op.tabItemCloseBtnCSS)}else{n="<li tabid={0} {1}><a>{2}</a></li>".formatValue(k,l,q)}if(h.addItemAtAfter){this.getPanelUl().find("[tabid='"+h.addItemAtAfter+"']").after(n)}else{this.getPanelUl().append(n)}if(j){this.getPanelUl().find("[tabid='"+k+"'] a").attr("id",j);var p=location.href.split("#!")[1]||"";p&&Jalor.Component.InfoTip.init(p)}var g=$.create("div",this.op.tabContenItemCSS).attr("tabid",k);this.getContent().append(g.hide());h.content&&g.html(h.content);h.url&&g.jalorLoad(h.url,h.fnAfterAddItem,true)}this.op.fnAfterAddItem&&this.op.fnAfterAddItem.call(this,k);return this.getItemByTabId(k)},setItemVisiable:function(j){var l=j.position().left,g=this.dom.width(),h=this.getPanelUl(),k=j.width();if(l+k>g){h.animate({left:-(h.width()-g+24)})}else{h.animate({left:0})}},removeItem:function(g){var j=this,k;if(!g){k=this.getSelectedItem();g=k.attr("tabid")}if(j.op.fnBeforeRemoveItem&&j.op.fnBeforeRemoveItem.call(this,g)===false){return false}var h=k?k:j.getItemByTabId(g);j.isConfirm2Close(h);j.op.fnAfterRemoveItem&&j.op.fnAfterRemoveItem.call(this,g)},confirmRemoveItem:function(g){var j=this.getItemByTabId(g);var h=this.getContentItem(g);if(j.hasClass(this.op.tabSelectedItemCSS)){j.prev().length?this.selectPrevItem():this.selectNextItem()}if(h.attr("module")){Jalor.Module.remove(h.attr("module"))}h.remove();j.remove();this.setNavButton()},isItemExist:function(g){return this.getItemByTabId(g).length>0},selectItem:function(g){var l=this.op;if(l.fnBeforeSelectItem&&l.fnBeforeSelectItem.call(this,g)===false){return}var k=this.getItemByTabId(g);if(k.length){var h=this.getContentItem(g),j=k.attr("url");h.show().siblings().hide();k.addClass("l-selected "+l.tabSelectedItemCSS).siblings().removeClass("l-selected "+l.tabSelectedItemCSS);if(l.fnOnceSelectItem&&!k.hasClass("once-loaded")){l.fnOnceSelectItem.call(this,g);k.addClass("once-loaded")}if(j&&!k.hasClass("url-loaded")){h.jalorLoad(j,null,true);k.addClass("url-loaded")}}else{return}l.fnAfterSelectItem&&l.fnAfterSelectItem.call(this,g)},selectPrevItem:function(){var g=this.getSelectedItem().prev();g.length&&this.selectItem(g.attr("tabid"))},movePrev:function(){this.selectPrevItem()},moveNext:function(){this.selectNextItem()},moveLast:function(){this.moveItem("toLast")},selectNextItem:function(){var g=this.getSelectedItem().next();g.length&&this.selectItem(g.attr("tabid"))},setNavButton:function(){var g=this;setTimeout(function(){var j=g.getPanelUl().width(),h=g.dom.width();if(j+16>h){if(g.getNavButtonContainer().length==0){g.getPanelUl().addClass("tab-hasnav");g.getPanelLink().append("<div class='tab-nav-btn'><div class='{0}'></div><div class='{1}'></div></div>".formatValue(g.op.tabLeftBtnCSS,g.op.tabRightBtnCSS));g.getPanelLink().delegate(".nav-btn","click",function(){$(this).hasClass(g.op.tabLeftBtnCSS)?g.moveItem("toPrev"):g.moveItem("toNext")})}}else{g.getPanelUl().animate({left:0}).removeClass("tab-hasnav");g.getNavButtonContainer().remove()}},100)},getSelectedItemId:function(){return this.getSelectedItem().attr("tabid")},getItemCount:function(){return this.getItems().length},moveItem:function(g){this.setNavButtonEvent(g)},moveToPrevItem:function(){this.setNavButtonEvent("toPrev")},moveToNextItem:function(){this.setNavButtonEvent("toNext")},moveToFirstItem:function(){this.setNavButtonEvent("toFirst")},moveToLastItem:function(){this.setNavButtonEvent("toLast")},setNavButtonEvent:function(l){var q=this.getPanelUl(),p=this.getItems(),o=this.getNavButton().width(),v=q.width(),s=this.dom.width(),g=new Array(),r,h=-1*parseInt(q.css("left")),t=this.getNavButton(),y=$(t[0]),B=$(t[1]);switch(l){case"toFirst":q.animate({left:17});y.addClass("disabled");B.removeClass("disabled");break;case"toLast":if(v>s){q.animate({left:-1*(v-s+o)});B.addClass("disabled");y.removeClass("disabled")}break;case"toPrev":r=-1*o;if(y.hasClass("disabled")){break}p.each(function(C){var j=$(this);if(C>0){r=parseInt(g[C-1])+j.prev().width()+3*C}g.push(r)});var w=false,k=0;for(var A=0;A<g.length-1;A++){var z=g[A]<h&&g[A+1]>=h;if(z){A==0&&(w=true);k=g[A];break}}if(z){q.animate({left:-1*parseInt(k)});B.hasClass("disabled")&&B.removeClass("disabled")}if(w){y.addClass("disabled")}break;case"toNext":r=v-s+o;if(B.hasClass("disabled")){break}for(var A=p.length-1;A>=0;A--){if(A!=p.length-1){r=parseInt(g[p.length-2-A])-$(p[A+1]).width()-2}g.push(r)}var n=false,u=0;for(var x=1;x<g.length;x++){var z=(g[x]<=h)&&(g[x-1]>h);if(z){x==1&&(n=true);u=(g[x-1]);break}}if(z){q.animate({left:-1*(parseInt(u)+g.length*1)});y.hasClass("disabled")&&y.removeClass("disabled")}if(n){B.addClass("disabled")}break}}};$.fn.getJalorTabManager=$.fn.manager;$.fn.jalorTabRemoveItem=function(j){if(this.length==0){return}var g=j?":eq("+j+")":"li.tab-selected";var h=this.find(".tab-link").find(".tab-ul "+g).attr("tabid");this.getJalorTabManager().removeItem(h);$(document.body).click();return this};var a=Jalor.UI.XControl("XTab",d,e,f);$.fn.jalorTab=function(g){return this.each(function(){if(!$(this).hasClass("jalor-tab")||!$(this).hasClass("l-tab")){new a($(this),g)}})};var c={buildBody:function(j,n){var l,h=[];j.dom.append('<div class="{0}"><div class="link-container"><ul class="{1}"></ul></div></div><div class="{2}"></div>'.formatValue(n.tabLinkCSS+" l-tab-links",n.tabUlCSS,n.tabContentCSS));var g=j.dom.children("div[title]");n._tempTabItemCount=g.length;if(g.length>n.itemMaxCount){Jalor.UI.showMessage($i18n("jalor.tab.tabitem.maxcount.warn").formatValue(n.itemMaxCount),"warn");return}var k=j.getContent().addClass("l-tab-content");g.each(function(q){var t=$(this),s=$i18n(t.attr("title")),p=t.attr("url"),o=t.attr("tabid");if(o==null){o="_tabitem"+(q+1)}if(String(t.attr("showClose"))=="true"){l="<div class='{0}'></div>".formatValue(n.tabItemCloseBtnCSS)}else{l=""}h.push('<li tabid="',o,p?'" url="'+p+'"':'"'," ><a ",t.attr("helperTip")?'id="'+t.attr("helperTip")+'"':"",">",s,"</a>",l,"</li>");var r=t.addClass(n.tabContenItemCSS).addClass("l-tab-content-item").attr("tabid",o).removeAttr("title");k.append(r)});j.getPanelUl().append(h.join(""));j.setNavButton()},eventBinder:function(g,h){g.getPanelUl().delegate("li","click",function(k){var j=$(k.target);if(!j.hasClass(h.tabItemCloseBtnCSS)){g.selectItem(j.attr("tabid")||j.parent().attr("tabid"))}});g.getPanelUl().delegate("."+h.tabItemCloseBtnCSS,"click",function(k){var j=$(k.target);g.removeItem(j.parent().attr("tabid"))})}}})(Jalor.UI.XTab);(function(h){var a;var d={decimalLen:Jalor.Config.Format.decimalfraction,maxLen:15,negative:true,align:"right",currencyCode:"CNY",isCurrentDate:true,readOnly:{}};var e=["<a class='jalor-money-btn'></a>","<input name='${currencyCodeName}' type='hidden'/>","<input name='${exchangeDateName}' type='hidden'/>","<input name='${amountName}' type='hidden'/>"].join("");var g={initOp:function(k,l){l.decimalLen=k.dom.attr("decimalLen")||l.decimalLen;l.maxLen=k.dom.attr("maxLen")||l.maxLen;l.align=k.dom.attr("align")||l.align;d.align!=l.align&&k.dom.css("text-align",l.align);l.currencyCode=k.dom.attr("currencyCode")||l.currencyCode;k.dom.attr("negative")=="false"&&(l.negative=false);k.dom.attr("isCurrentDate")=="false"&&(l.isCurrentDate=false);l.exchangeDate=l.isCurrentDate?Jalor.Core.getServerTime():"";l.currencyCodeName=k.dom.attr("currencyCodeName")||l.currencyCodeName;l.exchangeDateName=k.dom.attr("exchangeDateName")||l.exchangeDateName;l.amountName=k.dom.attr("amountName")||l.amountName},build:function(k,l){k.dom.after(Jalor.UI.template(e,l))},bindEvent:function(k,l){k.dom.focus(function(n){var o=c.amountFormat(Jalor.DataHelper.getObj(l.amountName,k.getValue()),l.decimalLen);$(this).val(o)}).blur(function(n){k.setValue($(this).val())}).next().click(function(n){c.showPopup(k)});c.keyup(k.dom,l);c.keypress(k.dom,l)}};var c={setPopupData:function(k,l){k.setValue({popupCurrencyCode:l.codeValue,popupExchangeDate:l.dateValue,popupAmount:c.amountFormat(l.amountValue,a.op.decimalLen)});a.op.readOnly.code?k.dom.find("#popupCurrencyCode").manager().disabled(false):k.dom.find("#popupCurrencyCode").manager().disabled(true);a.op.readOnly.date?k.dom.find("#popupExchangeDate").attr("disabled","disabled"):k.dom.find("#popupExchangeDate").removeAttr("disabled");a.op.readOnly.amount?k.dom.find("#popupAmount").attr("disabled","disabled"):k.dom.find("#popupAmount").removeAttr("disabled")},getPopupData:function(k){a.setValue(k.popupAmount,k.popupCurrencyCode,k.popupExchangeDate)},amountFormat:function(n,k){if(!n){return""}var l=n.split(".");if(l[1]&&(l[1].length>k)){l[1]=l[1].substring(0,k);n=l.join(".")}n=Jalor.Format.toNumber(n);return Jalor.Format.toCurrency(isNaN(n)?0:n,k)},getSelectText:function(k){if(document.selection){return document.selection.createRange().text.length}else{if(k.selectionStart||k.selectionStart===0){return k.selectionEnd-k.selectionStart}}return 0},getPopup:function(){var l=$("#jalor-money-popup").manager();if(l.dom){return l}var n=Jalor.Modal.create({modalName:"moneyModel",fields:[{field:"popupCurrencyCode",editorOp:{id:"popupCurrencyCode"},name:$i18n("jalor.common.money.currencyCode"),type:"enum",format:{valueField:"currencyCode",displayField:"currencyCode",service:"REST:servlet/proxy/params/eFinance"}},{field:"popupExchangeDate",editorOp:{id:"popupExchangeDate"},name:$i18n("jalor.common.money.exchangeDate"),type:"date"},{field:"popupAmount",editorOp:{id:"popupAmount"},name:$i18n("jalor.common.money.amount")}]});var k={modal:n,showHead:false,renderType:"edit",buttons:[{type:"imgBtn",icon:"yes",text:"jalor.common.button.ok",attr:{eno:"ok"}},{type:"imgBtn",icon:"reset",text:"jalor.common.label.reset",attr:{eno:"reset"}}],operation:{ok:function(p,o){if(!o.valid()){return}c.getPopupData(o.getValue());a.dom.focus();a=null;o.hide()},reset:function(p,o){c.setPopupData(o,a.dom.data("values"));o.dom.find(".error-ctr").removeClass("error error-ctr").next("label.error").hide()}}};l=$.create("div",null,"jalor-money-popup").attr("tabIndex","-1").appendTo(Jalor.UI.getPopupPanel()).xForm(k);l.dom.focusout(function(q){var o=$(this);var p=true;o.focusin(function(r){p=false});setTimeout(function(){if(p){var r=$($("#popupCurrencyCode").data("selector")).isVisiable()||$("#popupExchangeDate").manager("XCalendar").isPopup();if(!r&&o.isVisiable()){if(!l.valid()){return}c.getPopupData(l.getValue());a=null;l.hide()}}},10)}).click(function(o){o.stopPropagation()});Jalor.UI.delayEvent2($("#popupAmount"),"keyup",function(){a&&$(this).val(c.amountFormat($(this).val(),a.op.decimalLen))});this.keypress($("#popupAmount"),a.op);return l},showPopup:function(n){a=n;var l=this.getPopup(),k=a.dom;Jalor.UI.popup(k,l.dom,{top:k.height()+4},true,true,null,true);!a.dom.data("values")&&a.setValue("");this.setPopupData(l,a.dom.data("values"));l.dom.focus()},keyup:function(k,l){},keypress:function(k,l){k.keypress(function(t){var s=$(k).val(),r=t.keyCode,u=[44];if(l.negative){u.push(45)}var p=s.indexOf(".");if(p==-1){u.push(46)}if(r==13||r==108){$(this).val(c.amountFormat($(this).val(),l.decimalLen));return}if((r<48||r>57)&&$.inArray(r,u)==-1){t.preventDefault();return}var q=c.getSelectText(k);var n=Jalor.UI.getInputFocus(k);if(r==45&&(n!=0||/\-/.test(s))&&!q){t.preventDefault();return}var o=s.replace(/[,-]/g,"");if(p!=-1){o=o.substr(0,o.indexOf("."))}if(o.length>=l.maxLen&&!q){if(p!=-1&&p+1>n&&r!=45){t.preventDefault();return}if(p==-1&&$.inArray(r,[45,46])==-1){t.preventDefault();return}}})}};var b={init:function(k,l){g.initOp(k,l)},build:function(k,l){g.build(k,l)},bindEvent:function(k,l){g.bindEvent(k,l)}};var f={setValue:function(o,p,n){var k=this.dom.data("values")||{};o=(o&&o.replace(/,/g,""))||"";p=p||k.codeValue||this.op.currencyCode;n=n||k.dateValue||this.op.exchangeDate;this.dom.data("values",{amountValue:o,codeValue:p,dateValue:n});this.findByName(this.op.amountName).val(k.amountValue);this.findByName(this.op.currencyCodeName).val(k.codeValue);this.findByName(this.op.exchangeDateName).val(k.dateValue);var l=c.amountFormat(o,this.op.decimalLen);if(l!==""&&this.dom[0]!=document.activeElement){l=p+l}this.dom.jalorSetValue(l);this.op.callback&&this.op.callback.call(this,this.getValue())},getValue:function(){var k=this.dom.data("values")||{},l={};Jalor.DataHelper.setObj(this.op.amountName,l,k.amountValue);Jalor.DataHelper.setObj(this.op.currencyCodeName,l,k.codeValue);Jalor.DataHelper.setObj(this.op.exchangeDateName,l,k.dateValue);return l},setReadOnly:function(k){$.extend(this.op.readOnly,k)},findByName:function(k){return this.dom.siblings('[name="'+k+'"]')}};var j=Jalor.UI.XControl("XMoney",b,d,f);$.fn.jalorMoney=function(k){return this.each(function(){var l=$(this);if(!l.attr("init")){l.attr("init",true);new j(l,k)}})};Jalor.UI.Renders.add(function(l,k){l.filter(".jalor-money").jalorMoney()})})(Jalor.UI.XMoney);(function(b){var a=b.FullScreen={init:function(c){c.dom.addClass("jalor-fullscreen");if(!$("#jalor_fullscreen_overlay").length){$("body").append('<div class="jalor-overlay" id="jalor_fullscreen_overlay" style="z-index: 993;display: none;"/>')}},execute:function(c,d,e){c.manager().fullScreen&&c.manager().fullScreen(c,d,e);c.find(".jalor-fullscreen").each(function(){$(this).manager().fullScreen(c,d,e)})}};$.fn.fullScreen=function(){this.toggleClass("jalor-fullscreen-full jalor-dialog");$(document.documentElement).toggleClass("hidden-scroll");a.execute(this,this.height(),this.hasClass("jalor-fullscreen-full"))}})(Jalor.UI);Jalor.UI.Popbox={};(function(){$.fn.jalorPopBox=function(c){var b=this,e=c.suggestOp||{},f=c.popOp||{};e.queryParam=typeof c.queryParam=="function"?c.queryParam:$.extend(true,{},c.queryParam);f.queryParam=typeof c.queryParam=="function"?c.queryParam:$.extend(true,{},c.queryParam);e.valueField=f.valueField=c.valueField;e.displayField=f.displayField=c.displayField;e.multi=f.isMultiSelect=c.multi||false;c.callback&&(f.isMultiSelect?(e.fnSelected=c.callback):(e.fnChanged=c.callback),f._callback=c.callback);var g=e.valueSplit||Jalor.Config.Format.valueSplit,d=e.multiSplit||Jalor.Config.Format.textSplit;a.buildSuggest(e,this);f.beforeClose=function(){b.manager().lock(b,false);b.data("ctr_locked",false).focus();if(c.box){c.box.$ctr_locked=false}};f.callback=function(h){a.popopCallback(f,h,b,g,d);b.manager().lock(b,false)};this.nextAll(".jbutton").first().click(function(){a.buildPopop(b,f,g,d,c)})};var a={buildSuggest:function(b,c){c.after('<input type="button" class="jbutton popup-trigger" value="..." style="margin-left:0px;"/>');c.jalorSuggest(b);c.addClass("jalor-suggest jalor-dropdown jalor-popbox")},popopCallback:function(g,c,h,j,f){var k="",e="";if(g.isMultiSelect){var d=[],b=[];$.each(c,function(){d.push(Jalor.DataHelper.getObj(g.valueField,this));b.push(Jalor.DataHelper.getObj(g.displayField,this))});k=d.join(j);e=b.join(f)}else{k=Jalor.DataHelper.getObj(g.valueField,c);e=Jalor.DataHelper.getObj(g.displayField,c)}g._callback&&g._callback(k,e,c);h.manager().setValue(k,e)},buildPopop:function(d,g,j,f,e){d.data("ctr_locked",true);d.manager().lock(d,true);var b=d.manager().getValue();g.defaultParam={};if(g.isMultiSelect){g.selectedItems=b.split(j);var h=d.manager().getText().split(f).pop();if($.trim(h).length>0){g.defaultParam[g.displayField]=h}}else{g.selectedItems=b;var c=d.manager().getText();if(b.length==0&&$.trim(c).length>0){g.defaultParam[g.displayField]=c}}if(e.box){e.box.$ctr_locked=true}g.igrid=true;Jalor.Component.popup(g,g.title,g.isMultiSelect,g.width,g.height)}}})(Jalor.UI.Popbox);(function(){var c;function a(){var k=navigator.userAgent.toLowerCase(),j=["ipad","iphone os","midp","rv:1.2.3.4","ucweb","android","windows ce","windows mobile"];$.each(j,function(n,l){if(k.indexOf(l)>-1){c=true;return false}});return c}a();var d={onstart:(c?"touchstart":"mousedown")+".drag",onmove:(c?"touchmove":"mousemove")+".drag",onend:(c?"touchend":"mouseup")+".drag"};function h(j){if(c){var k=j.originalEvent.touches[0];j.pageX=k.pageX;j.pageY=k.pageY}return j}$.fn.drag=function(p){p=$.extend({handler:null,panel:null,css:null,fixed:null,offset:null,clickable:null,virtual:true,lock:true,fnFiexdPosition:null,onDragStart:null,onMoving:null,onDroped:null},p);var k,l,o,j,n={start:function(s){s.stopPropagation();var q=this,r=$(document).one(d.onend,n.drop);$.browser.msie&&r.one("selectstart",function(){return false});if(p.clickable){j=setTimeout(function(){$.browser.msie||b.show();n.dragStart.call(q,s);j=null},200)}else{n.dragStart.call(q,s)}},dragStart:function(s){$("div .jalor-selector:visible").hide();var q=$(this),r=p.handler?$(p.handler):q,t;if(f(p,q)){o=true;t=p.offset?r.offset():r.position();k=g(r,p.css);k.data("trigger",r)}else{o=null;t=p.offset?q.offset():q.position();k=r.addClass("jalor-mover").data("trigger",q)}if(k[0].setCapture){k[0].setCapture()}else{s.preventDefault()}p.fnFiexdPosition&&(t=p.fnFiexdPosition(q,t,k,p,s));h(s);if(!p.onDragStart||p.onDragStart.call(this,s,t,k,q||k,p)!==false){$(document).on(d.onmove,n.moving);k.css(t).show();l={y:t.top-s.pageY,x:t.left-s.pageX};if(p.fixed){t.top+=(p.fixed.y||0);t.left+=(p.fixed.x||0);l.y+=(p.fixed.y||0);l.x+=(p.fixed.x||0)}}},moving:function(q){q.preventDefault();if(!$.browser.msie||$.browser.version>8||q.button){h(q);var r={top:q.pageY+l.y,left:q.pageX+l.x};if(!p.onMoving||p.onMoving(q,r,k,k.data("trigger")||k,p)!==false){k.css(e(k,r,p.panel))}}else{n.drop(q)}},drop:function(r){if(j){clearTimeout(j);j=null;return}r.preventDefault();if(k){k[0].releaseCapture&&k[0].releaseCapture();var q,s=k.position();if(o||p.handler){q=k.data("trigger");k.removeData("trigger")}if(o){q.css(s);k.hide().attr("class","jalor-mover jalor-mover-vbox").empty()}else{k.removeClass("jalor-mover")}$(document).off(d.onmove);p.onDroped&&p.onDroped(r,s,k,q||k,p);k=null;l=null;b.hide()}}};if(p.target){this.delegate(p.target,d.onstart,n.start)}else{this.bind(d.onstart,n.start)}return this};var g=function(k,l){var j=$("#drag_mover");if(j.length==0){j=$.create("div","jalor-mover jalor-mover-vbox","drag_mover").appendTo(document.body)}if(!l){l={width:k.outerWidth(),height:k.outerHeight()}}return j.css(l)},f=function(k,j){if(k.virtual){if(typeof(k.virtual)=="function"){return k.virtual(j,k)}return true}},b={show:function(){$(document.body).addClass("unselect")},hide:function(){$(document.body).removeClass("unselect")}},e=function(p,q,j,l){var o={x:0,y:0},r;if(j){var q=j.position();o.x=q.left;o.y=q.top}else{j=$(window)}r={x:o.x+j.outerWidth()+j.scrollLeft(),y:o.y+j.outerHeight()+j.scrollTop()};if(!q){q=p.position()}var k=p.outerWidth(),s=p.outerHeight(),n={left:q.left>o.x?(q.left+k>r.x?r.x-k:q.left):o.x,top:q.top>o.y?(q.top+s>r.y?r.y-s:q.top):o.y};n.left<0&&(n.left=0);n.top<0&&(n.top=0);return l?l(n,q,o,r):n}})();(function(){$.fn.drop=function(g){g=$.extend({activePanelCss:"jalor-drop-activepanel",fnCheckPanel:null,onDragStart:null,onMoving:null,onDroped:null},g);a.createSignPlace();var f=g.target,d,c=g.onMoving,e=g.onDroped;g.onMoving=function(k,n,h,j,l){if(c&&c(k,n,h,j,l)===false){return false}if(!d&&l.panels){if(typeof(l.panels)=="function"){d=l.panels()}else{d=$(l.panels)}}a.findActivePanel(k,d,j,l)};g.onDroped=function(k,n,h,j,l){b.hide();d=null;if(!e||e(k,n,h,j,l)===true){if(l.actives){if(l.actives.item){if(l.actives.item[0]!=j[0]){l.actives.item.before(j)}}else{l.actives.panel.append(j)}}}if(l.actives){l.activePanelCss&&l.actives.panel.removeClass(l.activePanelCss);l.actives=null}if(!l.virtual){h.css({top:"",left:""})}};return this.drag(g)};var b,a={createSignPlace:function(){if(!b){b=$.create("div",null,"dropper_signPlace").appendTo(document.body)}},getActivePanel:function(h,f,d,l){var k,c,j,g;f.each(function(){if(this==d[0]){return}c=$(this);j=c.getOffsetInf();if(a.checkCursor(h,j)){if(a.checkActive(c,d,l)){k=c}if(l.fnGetChildPanels){if(g=a.findActiveChild(c,h,l.fnGetChildPanels,l,d)){k=g}}return false}});return k},findActiveChild:function(c,n,d,k,g){var f=d(c),j,h,l;f.length&&f.each(function(){childPanel=$(this);h=childPanel.getOffsetInf();if(a.checkCursor(n,h)){if(a.checkActive(childPanel,g,k)){j=childPanel}if(l=a.findActiveChild(childPanel,n,d,k,g)){j=l;return false}}});return j},findActivePanel:function(j,f,d,l){var c,k,h=l.activePanelCss,g=l.actives&&l.actives.panel;if(l.fnGetMatchPanel){c=l.fnGetMatchPanel(j,f,d,a,l)}else{c=a.getActivePanel(j,f,d,l)}if(c){if(!g||(c[0]!==g[0])){c.addClass(h);g&&g.removeClass(h);l.actives={panel:c,offset:c.getOffsetInf()}}else{l.actives.item=null}a.setPlaceSign(j,c,l.actives.offset,d,l)}else{g&&g.removeClass(h);l.actives=null}if(!l.actives){b.hide()}},setPlaceSign:function(p,d,g,h,l){var n,q=l.getSignTarget?l.getSignTarget(d):d.find(l.target+":not(.jalor-mover)"),o=q.length;if(o){var f,r,j,k,c=d.width();q.each(function(e){if(this==h[0]){return}r=$(this);j=r.getOffsetInf();k=l.signMode?l.signMode=="ver":a.checkPlaceMode(c,j);if(f=a.checkItem(p,j,k,e)){if(a.checkPart(p,j,k)){if(e<o-1){r=q.eq(e+1);j=r.getOffsetInf()}else{return false}}l.actives.item=r;n=k?{height:j.height,width:5,top:j.top,left:j.left-5}:{height:5,width:g.width,left:g.left,top:j.top-5};return false}});if(f){n=k?{height:j.height,width:5,top:j.top,left:j.left-5}:{height:5,width:g.width,left:g.left,top:j.top-5};if(!l.actives.item&&r){if(k){n.left=j.right}else{n.top=j.bottom}}b.show();n&&b.css(n)}}n||b.hide()},checkCursor:function(c,d){return Jalor.DataHelper.inRange(c.pageY,d.top,d.bottom)&&Jalor.DataHelper.inRange(c.pageX,d.left,d.right)},checkActive:function(c,d,e){return e.fnCheckActive?e.fnCheckActive(c,d,e):true},checkPart:function(d,f,c){if(c){return d.pageX>(f.right-f.left)/2+f.left}else{return d.pageY>(f.bottom-f.top)/2+f.top}},checkPlaceMode:function(c,d){return d.width<c},checkItem:function(d,f,c){if(c){if(Jalor.DataHelper.inRange(d.pageY,f.top,f.bottom)){return f.right>=d.pageX}}else{if(Jalor.DataHelper.inRange(d.pageX,f.left,f.right)){return f.bottom>=d.pageY}}}}})();(function(){$.fn.scrollLoad=function(g){g=$.extend({target:null,itemHeight:null,pageInf:null,mode:null,dataParam:null,showTip:true,delay:200,fnScrollStart:null,fnTriggeOver:null,fnScrollEnd:null,fnLoad:null},g);var d=parseInt(this.height()/g.itemHeight+1),h=$(g.target).height(g.pageInf.total*g.itemHeight),n=$.create("div","jalor-scrollLoad-topPlace").prependTo(h),b=0,f,k,c,e,l,j;g.pageInf.showStart=0;g.pageInf.showEnd=0;g.showTip&&(l=a.getTip());a.setDataFilter(g);this.scroll(function(q){var p=$(this);k=p.scrollTop();c=parseInt(k/g.itemHeight)+1;e=c+d;g.pageInf.showStart=c;g.pageInf.showEnd=e;g.showTip&&(j=a.setTip(p,l,k/g.itemHeight+1-c>0.9?c+1:c,k,j));b=0;g.fnTriggeOver&&(e>g.pageInf.end||c<g.pageInf.start)&&g.fnTriggeOver(p,c,e,k);if(f==null){g.fnScrollStart&&g.fnScrollStart(p,c,e,k);f=setInterval(function(){if(b>1){b=0;var r;if(e>g.pageInf.end||c<g.pageInf.start){r=true;a.setPosition(g.pageInf,c,e).load(g,n)}if(g.showTip){l.fadeOut(300);j=null}clearInterval(f);f=null;g.fnScrollEnd&&g.fnScrollEnd(p,g.pageInf,r)}else{b++}},g.delay||10)}});var o=this;return{setTotal:function(s){if(s!=g.pageInf.total){g.pageInf.total=s;h.height(s*g.itemHeight)}var u=g.pageInf,q=n.next().height(),r=n.height(),t,p;if(u.end>u.total){t=(u.total-u.start+1)*g.itemHeight}else{t=(u.end-u.start+1)*g.itemHeight}if(g._changeHeight){p=q-g._changeHeight-t;delete g._changeHeight}else{p=q-t}if(p>0&&k>0){r-=p;g._changeHeight=p;n.height(r)}},reset:function(){g.pageInf.total=0;g.pageInf.start=1;g.pageInf.end=g.pageInf.pageSize;o.scrollTop(0);a.setTopPlace(g,n);h.height(0)},load:function(){g.fnLoad(g.pageInf);a.setTopPlace(g,n)}}};var a={getTip:function(){var b=$("#scrollLoad_tip");b.length||(b=$.create("div",null,"scrollLoad_tip").appendTo(document.body));return b},setTip:function(b,c,g,e,f){if(f==null){f=b.offset();f.right=$(document.body).width()-f.left-b.width()+20}var d=f.top+e/b[0].scrollHeight*(b.height()-40)+10;c.css({right:f.right,top:d}).text(g).show();return f},setDataFilter:function(b){if(b.mode){if(b.mode=="ajax"){b.dataParam.setAjax=function(d){var c=d.url;if(c){if(c.indexOf("{0}")>0){d.url=c.formatText(b.pageInf.start,b.pageInf.end,b.pageInf.total)}else{b.pageInf.orderBy="${orderBy}";if(c.indexOf("${filter}")>0){b.pageInf.filter="${filter}"}d.url=c.formatField(b.pageInf)}}}}else{b.dataParam.add(function(){return a.getRangeData(this,b.pageInf)})}}},getRangeData:function(b,c){if(b&&b.length>c.start-1){return b.slice(c.start-1,c.end)}},setPosition:function(c,d,b){c.start=(parseInt(d/c.pageSize)-(d%c.pageSize?0:1))*c.pageSize+1;c.end=c.start+c.pageSize*2-1;return this},load:function(c,b){c.fnLoad(c.pageInf);this.setTopPlace(c,b)},setTopPlace:function(d,b){var c=(d.pageInf.start-1)*d.itemHeight;b.height(c)}}})();(function(){$.fn.enableContextMenu=function(c){var d=this.data("contextMenuOp");d._stop=!c};$.fn.contextMenu=function(h){h=$.extend({menus:null,target:null,container:null,panelBegin:"<ul>",item:"<li class='jalor-contextmen-item ${css}' ${click}>${#text}${#children}</li>",panelEnd:"</ul>",fixed:null,offset:true,fnHover:null,fnGetData:null,fnCallMenu:null,selectClose:null,setBorder:true},h);if(h.menus){h.menus=Jalor.DataHelper.copyArray(h.menus)}if(h.mode=="click"){b(h,this);this.data("contextMenuOp",h);return}var g=$.newGuid("cm_"),c=a.buildList(this,h,g),f=a.buildTrigger(this,h,g,c),e=function(s){if(h._stop){return}var r=$.getEventTarget(s,function(p){return p.hasClass(h.target)});if(r.hasClass(h.target)){if(!r.data("cm_active")){if(!h.fnHover||h.fnHover(r,f)!==false){var k=r.outerHeight(),n={left:r.outerWidth()-f.outerWidth(),top:-1},l=r.offset();h.fnGetTarget&&(r=h.fnGetTarget(r,f,n,h));if(s.pageY>=l.top&&s.pageY<=l.top+k){if(h.fixed){var j=$(r).fixedPosition();n.left+=j.left;n.top+=j.top}r.addClass("jalor-contextmenu-active");var o=f.data("target");o&&o.removeData("cm_active").removeClass("jalor-contextmenu-active");r.data("cm_active",1);f.data("target",r).children(".jalor-contextmenu-hover").css({height:k,"line-height":(k+2)+"px"});Jalor.UI.popup(r,f,n,true,h.offset);h.setBorder&&a.popupBorder(r,h,f);if(!h._lastTarget||h._lastTarget[0]!=r[0]){h._lastTarget=r;c.hide()}}else{f.hide();c.hide()}}}}else{if(!r.hasClass("jalor-contextmenu-trigger")&&!r.hasClass("jalor-contextmenu-list")&&!r.parent().hasClass("jalor-contextmen-item")){var q=r.parent();if(!q.hasClass("jalor-contextmenu-trigger")&&!q.hasClass("jalor-contextmenu-list")){a.close(f,c,h)}}}},d=function(j){if(h._stop){return}a.close(f,c,h)};if(h.target){this.bind("mouseover._contextmenu",e).bind("mouseleave._contextmenu",d)}this.data("contextMenuOp",h);return this};var b=function(g,e){var f=$.newGuid("cm_"),c=a.buildList(e,g,f).attr("tabIndex",-1).focusout(function(j){var h=$(this);setTimeout(function(){var k=$(".jalor-popup.jalor-selector:visible, .jalor-popup.jalor-calendar:visible").length>0;if(h.is(":focus")||h.find(":focus").length>0||(k&&h.find("input").length)||$(document.activeElement).hasClass("jalor-contextmenu-list")){if(k){var l=h.find(".jalor-dropdown");l.length&&l.focus()}g.selectClose=false}else{g.selectClose=true}g.selectClose&&h.hide()},150)});var d=$.create("div","jalor-contextmenu",f);e.delegate(g.target,"click",function(n){var l=$(this),k;d.data("target",l);k=g.fnGetData?g.fnGetData(l):null;if(!g.fnCallMenu||g.fnCallMenu(l,d,c,k)!==false){if(g.fnCustomMenu){if(g.fnCustomMenu(l,c,g,k,a)){return false}}if(g.fnDynamicMenu){var j=g.fnDynamicMenu(l,g,k,n);if(j){a.buildItems(c,j,g,true)}}else{a.checkList(l,c,g,k)}if(!j){return}Jalor.UI.popup(this,c,{top:l.outerHeight(),left:l.outerWidth()-c.outerWidth()});if(g.fixPanel&&l.parents(g.fixPanel).length>0){var h=l.parents(g.fixPanel);if(c.position().left+c.outerWidth()>h.width()){c.css({left:h.width()-c.outerWidth()})}}c.focus();g.callback&&g.callback.call(this,l,c,g)}});d.appendTo(g.container||e);g.setBorder&&a.buildBorder(d)};var a={buildTrigger:function(g,j,h,c){var f=$.create("div","jalor-contextmenu",h),e=$.create("div","jalor-contextmenu-hover").appendTo(f);var d=$.create("div","jalor-contextmenu-trigger"+(j.setBorder?"":" noborder")).html("<a/>").appendTo(e).click(function(r){var q=f.data("target"),p;if(!q){return}p=j.fnGetData?j.fnGetData(q):null;if(!j.fnCallMenu||j.fnCallMenu(q,f,c,p)!==false){if(j.fnCustomMenu){if(j.fnCustomMenu(q,c,j,p,a)){return false}}if(j.fnDynamicMenu){var o=j.fnDynamicMenu(q,j,p);if(o){a.buildItems(c,o,j,true)}}else{a.checkList(q,c,j,p)}var l=$(this).parent().parent(),n={left:l.outerWidth()-c.outerWidth(),top:l.outerHeight()};var k=l.fixedPosition();if(c.outerHeight()+k.top+l.outerHeight()>g[0].scrollTop+$(g[0]).height()){n={left:l.outerWidth()-c.outerWidth(),top:-(c.outerHeight()-1)}}j.setBorder||(n.top-=1);Jalor.UI.popup(l,c,n,true,j.offset)}});f.appendTo(j.container||g);j.setBorder&&a.buildBorder(f);return f},callMenu:function(c,f){var e=cMenu.data("target"),d=op.fnGetData?op.fnGetData(e):null},buildList:function(d,f,e){f._eList={};f._checkFn=[];var c=$.create("div","jalor-contextmenu-list",e+"_list").click(function(n){f.selectClose=true;var l=$.getEventTarget(n).parent(),k=l.attr("_ecode"),j=$(this),g=$("#"+e);if(k){var h=f._eList[k];h&&h(g.data("target"),l,f)}if(l.hasClass("input-filter-div")||l.find("input").length>0){f.selectClose=false}f.selectClose!==false&&a.close(g,j,f)});this.buildItems(c,f.menus,f).appendTo(f.container||d);return c},buildItems:function(d,f,g,c){if(c){d.empty();g._eList={};g._checkFn=[]}var e=[];this.addMenus(e,f,g);return d.html(e.join(""))},addMenus:function(d,f,h){if(f){d.push(h.panelBegin);var e,c,g;$.each(f,function(j,k){k.text&&(k.text="<a class='context-item'>"+$i18n(k.text)+"</a>");k.icon=k.icon||"noicon";k.children?k.icon="":k.icon="<a class='jalor-icon "+k.icon+"'></a>";if((c=k.children)&&c.length){k.parent="parent";g=[];a.addMenus(g,c,h);k.children=g.join("")}if(e=k.click){if(typeof(e)=="string"){k.click="onclick='"+e+"'"}else{var l=$.newGuid("e_");h._eList[l]=e;k.click="_ecode='"+l+"'"}}k.fnCheck&&h._checkFn.push(k.fnCheck);d.push(h.item.formatField(k))});d.push(h.panelEnd)}},checkList:function(e,c,f,d){c.find(".jalor-contextmen-item").each(function(h){var j=$(this),g=f._checkFn[h];(!g||g(e,j,d))?j.show():j.hide()})},close:function(d,c,f){var e=d.data("target");if(e){e.removeData("cm_active").removeClass("jalor-contextmenu-active");d.removeData("target")}d.hide();c.hide();f.setBorder&&a.closeBorder(d)},buildBorder:function(d){var c=[];$.each(["left","top","bottom"],function(f,e){c.push("<div class='jalor-contextmenu-border",e,"' />")});d.after(c.join(""))},popupBorder:function(h,g,k){var d=h.outerWidth(),l=k.outerHeight(),j=parseInt(k.css("top")),e=parseInt(k.css("left"))-d+k.outerWidth(),c=k.next().css({left:e,top:j,height:l}).show(),f=c.next().css({left:e,top:j,width:d}).show();f.next().css({left:e,top:j+l,width:d}).show()},closeBorder:function(c){c.next().hide().next().hide().next().hide()}}})();(function(a){a._Renderer={setOption:function(b){if(this.css){b.cssName=this.css+" "+(b.cssName||"")}this.initFormat(b.format);b.content=this.getFormat(b.displayField||b.field,b.format)},initFormat:function(b){},getFormat:function(c,b){return"${"+c+"}"},getValue:function(c,b){return this.parse(this.getText(c),b)},getText:function(b){return b[0].tagName=="INPUT"?b.val():b.text()},parse:function(b){return b||""},format:function(b,c){return(b!=null)?b:""},render:function(d,b,c){var b=this.format(b,c);d[0].tagName=="INPUT"?d.val(b):d.html(Jalor.Format.formatSpace(b))}};a.Renderer=$.IAdapter(a._Renderer,null,true);(function(b){b.add("integer",{css:"num",getFormat:function(d,c){return"${Jalor.Format.toInt({0})}".formatText(d)},parse:function(c){return Jalor.Format.toNumber(c)}});b.add("number",{css:"num",getFormat:function(d,c){return"${#Jalor.Format.toDecimal({0},{1})}".formatText(d,c.fraction||"null")},format:function(c,d){if(!d){d={}}return Jalor.Format.toDecimal(c,d.fraction)},parse:function(c){return Jalor.Format.toNumber(c)}});b.add("listoryInput",{setOption:function(c){c.valueField||(c.valueField=c.field);this.callParent("setOption",[c])},initFormat:function(c){if(c){if(!c.data){c.data=a.getStaticData(c)}}},getValue:function(e,d){var c=e.attr("val"),f=e.text();return{value:c||"",text:f||""}},render:function(d,e,c){d.attr("val",e.value).text(e.text)}});b.add("currency",{css:"cur",getFormat:function(d,c){return"${#Jalor.Format.toCurrency({0},{1},'{2}')}".formatText(d,c.fraction||Jalor.Config.Format.decimalfraction,c.flag||"")},format:function(c,d){if(!d){d={}}return Jalor.Format.toCurrency(c,d.fraction||Jalor.Config.Format.decimalfraction,d.flag)},parse:function(c){return Jalor.Format.toNumber(c)}});b.add("currencystr",{css:"cur",getFormat:function(d,c){return"${#Jalor.Format.toCurrencyStr({0},{1},'{2}')}".formatText(d,c.fraction||Jalor.Config.Format.decimalfraction,c.flag||"")},format:function(c,d){if(!d){d={}}return Jalor.Format.toCurrencyStr(c,d.fraction||Jalor.Config.Format.decimalfraction,d.flag)},parse:function(c){return c}});b.add("date",{css:"date",getFormat:function(d,c){return"${#Jalor.Format.toDateStr({0},'{1}','{2}')}".formatText(d,c.dateFormat||"",c.renderFormat||"")},format:function(c,d){if(!d){d={}}return Jalor.Format.toDateStr(c,d.dateFormat,d.renderFormat)},parse:function(c){return Jalor.Format.toDate(c)}});b.add("datetime",{css:"date",getFormat:function(d,c){return"${#Jalor.Format.toDateTimeStr({0},'{1}','{2}')}".formatText(d,c.dateFormat||"",c.renderFormat||"")},format:function(c,d){if(!d){d={}}return Jalor.Format.toDateTimeStr(c,d.dateFormat,d.renderFormat)},parse:function(c){return Jalor.Format.toDate(c)}});b.add("dateym",{css:"date",getFormat:function(d,c){return"${#Jalor.Format.toDateYMStr({0},'{1}','{2}')}".formatText(d,c.renderFormat||c.dateFormat||Jalor.Config.Format.dateym||"",c.renderFormat||"")},format:function(c,d){if(!d){d={}}return Jalor.Format.toDateYMStr(c,d.renderFormat||d.dateFormat,d.renderFormat)},parse:function(c){return Jalor.Format.toDate(c)}});b.add("datehm",{css:"date",getFormat:function(d,c){return"${#Jalor.Format.toDateTimeStr({0},'{1}','{2}')}".formatText(d,c.dateFormat||Jalor.Config.Format.datehm,c.renderFormat||Jalor.Config.Format.datehm)},format:function(c,d){if(!d){d={}}return Jalor.Format.toDateTimeStr(c,d.dateFormat||Jalor.Config.Format.datehm,d.renderFormat||Jalor.Config.Format.datehm)},parse:function(c){return Jalor.Format.toDate(c)}});b.add("bool",{css:"bool",setOption:function(c){c.valueField=c.field;this.callParent("setOption",[c])},getFormat:function(f,e){var d=(e.htmlView!=null)?e.htmlView:true,c=(e.noFork!=null)?e.noFork:false;return"${#Jalor.Format.toBoolView({0},{1},{2})}".formatText(f,d,c)},getValue:function(d,c){return this.parse(d.attr("val"),c)},parse:function(d,e){if(e&&e.nullValue){if(d==null||d==""){return null}}var c=typeof(d);if(c!="boolean"){if(d=="true"||d=="1"){d=true}else{d=false}}if(e&&e.isBool){return d?true:false}else{return d?1:0}},format:function(e,f){!f&&(f={});var d=(f.htmlView!=null)?f.htmlView:true,c=(f.noFork!=null)?f.noFork:false;return Jalor.Format.toBoolView(e,d,c)},render:function(e,c,d){c=this.parse(c,d);e.attr("val",c);e.html(this.format(c,d))}});b.add("ellipsis",{getFormat:function(d,c){return"${#Jalor.Format.toEllipsis({0}, {1})}".formatText(d,c.len||"null")},getValue:function(c){return c.children().attr("title")},format:function(c,d){if(!d){d={}}return Jalor.Format.toEllipsis(c,d.len||"null")},render:function(e,c,d){e.html(this.format(c,d))}});b.add("longtext",{getFormat:function(d,c){return"<div class='jalor-renderer-textarea' style='height:{1};'>{0}</div>".formatValue("${"+d+"}",c.height||"100%")},format:function(c,d){if(!d){d={}}return"<div class='jalor-renderer-textarea' style='height:{1};'>{0}</div>".formatValue(Jalor.Format.formatSpace(c),d.height||"100%")},render:function(e,c,d){e.html(this.format(c,d))}});b.add("ldap",{css:"ldap",setOption:function(c){c.valueField||(c.valueField=c.field);this.callParent("setOption",[c])},initFormat:function(c){if(c){c.valueField=c.valueField||"userId"}},getValue:function(d,c){return{value:d.attr("val")||"",text:d.text().replace(/\s/g," ")||""}},render:function(d,e,c){d.attr("val",e.value).text(e.text)}});b.add("lookup",{css:"enum",setOption:function(c){c.valueField||(c.valueField=c.field);this.callParent("setOption",[c])},initFormat:function(c){if(c){c.valueField="itemCode";c.displayField="itemName";c.cacheKey=$.newGuid("render_");c.service=(c.supportLang?"LOOKUP2:":"LOOKUP:")+c.code;if(!c.data){c.data=a.getStaticData(c)}}},getFormat:function(e,d){if(d.data){var c;if($.isArray(d.data)){c=Jalor.Format.convertArrayToObject(d.data,d.valueField,d.displayField)}Jalor.Cache.put(d.cacheKey,c||d.data);return"${#Jalor.Format.getObjectText({0},'{1}')}".formatText(e,d.cacheKey)}return this.callParent("getFormat",[e,d])},getValue:function(d){var c=d.attr("val"),e=d.text();return{value:c||"",text:e||""}},render:function(d,e,c){!c&&(c={});e=Jalor.Format.toValueObj(e,c.data,c.valueField,c.displayField);d.attr("val",e.value).text(e.text)}});b.add("enum,suggest,popbox",{css:"enum",setOption:function(c){c.valueField||(c.valueField=c.field);this.callParent("setOption",[c])},initFormat:function(c){if(c){c.valueField=Jalor.Format.getField(c.valueField,"value");c.displayField=Jalor.Format.getField(c.displayField,"display");c.cacheKey||(c.cacheKey=typeof(c.service)=="string"?c.service:$.newGuid("render_"));if(!c.data){c.data=a.getStaticData(c)}}},getFormat:function(e,d){if(d.data){var c;if($.isArray(d.data)){c=Jalor.Format.convertArrayToObject(d.data,d.valueField,d.displayField)}Jalor.Cache.put(d.cacheKey,c||d.data);return"${#Jalor.Format.getObjectText({0},'{1}')}".formatText(e,d.cacheKey)}return this.callParent("getFormat",[e,d])},getValue:function(c){return{value:c.attr("val")||"",text:c.text()||""}},render:function(d,e,c){!c&&(c={});e=Jalor.Format.toValueObj(e,c.data,c.valueField,c.displayField);d.attr("val",e.value).text(e.text)}});b.add("enumExtend,popup,popupProgramInfo",{css:"enumExtend",setOption:function(c){c.valueField||(c.valueField=c.field);this.callParent("setOption",[c])},getValue:function(c){return{value:c.attr("val")||"",text:c.text()||""}},render:function(d,e,c){e=Jalor.Format.toValueObj(e,c?c.data:null);d.attr("val",e.value).text(e.text)}});b.add("childRender",{render:function(d,c){d.find(".child-render").text(c)}});b.add("rate",{css:"rate",setOption:function(c){c.valueField=c.field;this.callParent("setOption",[c])},getFormat:function(d,c){return"${#Jalor.Format.toRate({0},{1},{2},{3},'{4}',{5})}".formatText(d,c.total||"null",c.fraction||"null",c.htmlView||"null",c.section,c.isViewEmpty||false)},getValue:function(d,c){if(c.isViewEmpty){return d.attr("val")?d.attr("val")*1:""}return d.attr("val")*1},format:function(c,d){if(!d){d={}}return Jalor.Format.toRate(c,d.total,d.fraction,d.htmlView,d.section,d.isViewEmpty)},render:function(e,c,d){e.attr("val",d.isViewEmpty?(c?c:""):(c?c:0));e.html(this.format(c,d))}});b.add("filesize",{css:"num",getFormat:function(d,c){return"${#Jalor.Format.toFileSize({0},null,'{1}')}".formatText(d,c.unit||"K")},getValue:function(c){return c.attr("val")||c.text()},format:function(c,d){if(!d){d={}}return Jalor.Format.toFileSize(c,null,d.unit||"K")},render:function(e,c,d){e.attr("val",c);e.text(this.format(c,d))}});b.add("country",{getValue:function(c){return c.text()||""},parse:function(c){return c},render:function(d,e,c){d.attr("val",e).text(e)}});b.add("company",{setOption:function(c){c.valueField||(c.valueField=c.field);this.callParent("setOption",[c])},getValue:function(c){return{value:c.attr("val")||"",text:c.text()||""}},render:function(d,e,c){e=Jalor.Format.toValueObj(e);d.attr("val",e.value).text(e.text)}});b.add("area",{setOption:function(c){c.valueField||(c.valueField=c.field);this.callParent("setOption",[c])},getValue:function(c){return{value:c.attr("val")||"",text:c.text()||""}},render:function(d,e,c){e=Jalor.Format.toValueObj(e);d.attr("val",e.value).text(e.text)}});b.add("iCurrency",{getValue:function(c){return c.text()||""},parse:function(c){return c},render:function(d,e,c){d.attr("val",e).text(e)}});b.add("location",{getValue:function(c){return c.text()||""},parse:function(c){return c},render:function(d,e,c){d.attr("val",e).text(e)}});b.add("pbi",{getValue:function(c){return c.text()||""},parse:function(c){return c},render:function(d,e,c){d.attr("val",e).text(e)}});b.add("personInfo",{getFormat:function(d,c){return"${#Jalor.Format.showPersonInfo('{0}', '{1}', data)}".formatValue(c.valueField||d,c.displayField||d)}});b.add("groupInfo",{getFormat:function(d,c){return"${#Jalor.Format.showGroupInfo('{0}', '{1}', data)}".formatValue(c.valueField||d,c.displayField||d)}});b.add("money",{setOption:function(c){c.format.amountField=c.editorOp.amountName;c.format.codeField=c.editorOp.currencyCodeName;c.format.decimalLen=c.editorOp.decimalLen;this.callParent("setOption",[c])},getFormat:function(d,c){return"${#Jalor.Format.formatAmount('{0}','{1}','{2}','{3}',data)}".formatValue(d,c.amountField,c.codeField,c.decimalLen||2)},parse:function(c){return c},render:function(e,c,d){if(c.text){e.attr("val",c.text).text(c.text)}}})})(a.Renderer)})(Jalor.UI);Jalor.UI.Config.Editor={rules:{number:{number:true},floatRequ:{number:true},integer:{digits:true},currency:{number:true},date:{date:true},datetime:{dateISO:true},dateym:{dateym:true},dateHM:{datetime:true},rate:{number:true,max:1,min:0}}};Jalor._Editor={render:function(a,d,c){var b=this.build(a,d);this.setAttr(b,d);this.setValid(d);c&&this.setValue(b,c);return b},build:function(a,b){return $.create("input",null,b&&b.id,"text").appendTo(a)},setAttr:function(a,b){if(a&&b){b.cssName&&a.addClass(b.cssName);b.field&&a.attr("name",b.field);b.style&&a.attr("style",b.style);if(b.prop){$.each(b.prop,function(c,d){a.attr(c,d)})}}},getValue:function(a){return a.manager().getValue()},setValue:function(b,a){b.manager?b.manager().setValue(a):b.val(a)},setValid:function(b){if(b.valid!==false&&b.type){var a=Jalor.UI.Config.Editor.rules[b.type];if(a){b.rule=$.extend(true,{},a,b.rule)}}},valid:function(a){if(!a.valid()){return !a.hasClass("error")}return true}};Jalor.Editor=$.IAdapter(Jalor._Editor,{build:function(b,a,c){this.get(b).render(a,c);return this}},true);(function(b){b.add("bool,checkbox",{build:function(e,g){var f=$.create("input","jalor-editor-checkbox",g&&g.id,"checkbox").appendTo(e);g.shortChecked&&f.attr("shortChecked",true);return f},getValue:function(e){return e.attr("checked")?true:false},setValue:function(f,e){f.attr("shortChecked")?(e?f.removeAttr("checked"):f.attr("checked","checked")):(e?f.attr("checked","checked"):f.removeAttr("checked"))},valid:function(e){return true}});b.add("listoryInput",{build:function(e,g){var f=$.create("input","jalor-listory","","text").appendTo(e);f.jalorInputHistory();c(f);return f},getValue:function(e){return{value:e.manager().getValue()||"",data:e.data("data"),text:e.val()||""}},setValue:function(e,f){f=Jalor.Format.toValueObj(f);e.manager().setValue(f.value,f.text)}});b.add("longtext,textarea",{build:function(e,g){var f=$.create("textarea","jalor-editor-textarea",g&&g.id).appendTo(e);g.width&&f.css("width",g.width);return f.css("height",g.height||"50px")}});b.add("rate",{setValid:function(f){this.callParent("setValid",[f]);if(f.format&&f.format.limitMax===false){var e=arguments.callee.caller.arguments.callee.caller.arguments[1];delete f.rule.max;e&&e.rule&&(delete e.rule.max)}else{if(f.format&&f.format.total){f.rule.max=f.format.total}}}});b.add("datetime,date,dateym,datehm",{build:function(e,g){var f=$.create("input","jalor-calendar",g&&g.id||$.newGuid("grid_editor_"),"text").appendTo(e);f.attr("format",(g.format&&(g.format.renderFormat||g.format.dataFormat||g.type))||g.type);g.wmindate&&f.attr("wmindate",g.wmindate);g.wmaxdate&&f.attr("wmaxdate",g.wmaxdate);g.dblmonth&&f.attr("dblmonth",g.dblmonth);g.type=="dateym"&&f.attr("showDate",false);g.type=="datehm"&&(g.showSecond=false);g.compareto&&f.addClass("dateCompare").attr("compareto",g.compareto);f.jalorDatepicker(g);return f},getValue:function(e){var f=e.attr("format")||null;f=f&&Jalor.Config.Format[f]?null:f;return Jalor.Format.toDate(e.val(),f)},setValue:function(g,f){var e=g.attr("format");g.val(Jalor.Format.toDateStr(f,Jalor.Config.Format[e]||e))}});b.add("filesize",{build:function(e,g){var f=$.create("input","filesize",g&&g.id||$.newGuid("grid_editor_"),"text").appendTo(e);f.attr("unit",g.unit||"KB");return f},getValue:function(h){var g=h.val(),f=h.attr("unit"),e=g[g.search(/[BKMGT]/i)]||f;if(g==""){return""}return parseFloat(Jalor.Format.toFileSize(parseFloat(g),f,e.toUpperCase())||0)},setValue:function(g,f){if(f&&(typeof f=="number"||f.search(/[BKMGT]/i)!=-1)){g.val(f)}else{var e=g.attr("unit")||"K";g.val(Jalor.Format.toFileSize(f,null,g.attr("unit"))||(f?"0"+e:""))}}});function c(f){var e=$("#"+f.id()+"_ddl");e.on("mouseover",function(){f.data("ctr_locked",true)}).on("mouseout",function(){f.data("ctr_locked",false);f.focus()})}b.add("combobox,enum,lookup",{build:function(f,j){var g=$.create("input","jalor-combobox",j&&j.id,"text").appendTo(f),h=j.format,e=j.conf||{};if(!e.valueField&&h.valueField){e.valueField=h.valueField}if(!e.displayField&&h.displayField){e.displayField=h.displayField}if(h.service){g.attr("service",h.service);g.jalorCombobox(e)}else{if($.isArray(h.data)){h.data=Jalor.Format.convertSimpleArrayToObject(h.data,e.valueField,e.displayField)}g.dropdown(e,h.data)}c(g);return g},getValue:function(g,e){var f=g.manager().getValue();if(e){return f!=null?{value:f,text:g.val()}:null}return f},setValue:function(e,f){f=Jalor.Format.toValueObj(f);e.manager().setValue(f.value,f.text)}});b.add("suggest",{build:function(f,j){var h=$.create("input","jalor-suggest",j&&j.id,"text").appendTo(f),e=j.conf||{},g=e.fnSelected;e.fnSelected=function(p,q,l,n,k,o){h.data("data",o);g&&g.call(this,p,q,l,n,k,o)};h.jalorSuggest(e);c(h);return h},getValue:function(e){return{value:e.manager().getValue()||"",data:e.data("data"),text:e.val()||""}},setValue:function(e,f){f=Jalor.Format.toValueObj(f);e.manager().setValue(f.value,f.text)}});b.add("popbox",{build:function(f,j){var g=$.create("input","",j&&j.id,"text").appendTo(f),e=j.conf||{},h=e.callback;e.callback=function(p,r,q,n,k,o){var l=$.type(o)=="object"?o:q;if($.type(q)=="array"){l=q[q.length-1]}g.data("data",l);h&&h.call(this,p,r,q,n,k,o);g.focus()};g.jalorPopBox(e);g.addClass("igrid-popbox");c(g);return g},getValue:function(e){return{value:e.manager().getValue()||"",data:e.data("data"),text:e.val()||""}},setValue:function(e,f){f=Jalor.Format.toValueObj(f);e.manager().setValue(f.value,f.text)}});b.add("hrdept",{build:function(f,j){var h=$.create("input",null,j&&j.id||$.newGuid("ctr_editor_"),"text").appendTo(f),g=$.create("input","jbutton",null,"button").attr("value","...").appendTo(f),e=j.conf||{};j.readonly&&h.attr("readonly","readonly");g.click(function(){e.initDept=h.data("value");h.data("ctr_locked",true);Jalor.UI.fireCtrHandler(h,"fnLocked",true);e.callback=function(k,l){h.data("value",k).val(l)};e.fnBeforeClose=function(){h.data("ctr_locked",false).focus();Jalor.UI.fireCtrHandler(h,"fnLocked",false);return true};Jalor.Component.selectHRDept(e)});return h},getValue:function(e){return{value:e.manager().getValue()||"",text:e.val()||""}},setValue:function(e,f){e.data("value",f.value);this.callParent("setValue",[e,f.text])}});b.add("hrapprover",{build:function(f,l){var h=$.create("input","hrapprover-input",l&&l.id||$.newGuid("ctr_editor_"),"text").appendTo(f),g=$.create("input","hrapprover-trigger jbutton","","button").attr("value","...").appendTo(f),e=l.conf||{};var k=this,j=$.create("input","hrapprover-clear","","button").val("×").appendTo(f).click(function(){k.setValue(h,{value:"",text:""})});l.readonly&&h.attr("readonly","readonly");g.click(function(){e.initApprover=h.data("value");h.data("ctr_locked",true);Jalor.UI.fireCtrHandler(h,"fnLocked",true);e.callback=function(n,o){h.data("value",n).val(o)};e.fnBeforeClose=function(){h.data("ctr_locked",false).focus();Jalor.UI.fireCtrHandler(h,"fnLocked",false);return true};Jalor.Component.selectHRApprover(e)});return h},getValue:function(e){return{value:e.manager().getValue()||"",text:e.val()||""}},setValue:function(e,f){f=Jalor.Format.toValueObj(f);e.data("value",f.value);this.callParent("setValue",[e,f.text])}});b.add("ldap",{build:function(e,h){var g=(h.conf&&h.conf.showType)=="textarea"?"textarea":"input";var f=$.create(g,"jalor-user",h&&h.id,"text").appendTo(e);f.attr("valueField",h.format.valueField);f.jalorLdap(h.conf);c(f);return f},getValue:function(e){return{value:e.manager().getValue()||(e.attr("valueField")=="userId"?0:""),text:e.val()||""}},setValue:function(e,f){f=Jalor.Format.toValueObj(f);e.manager().setValue(f.value,f.text)}});function a(g,f){g.data("ctr_locked",true);Jalor.UI.fireCtrHandler(g,"fnLocked",true);f.splitChar=f.splitChar||Jalor.Config.Format.valueSplit;var h=f.callback,e;f.callback=function(l){var k=[],n=[];if(f.multiSelect){for(var j=0,o;o=l[j];j++){k.push(o[f.uniqueKey]);n.push(o[f.displayField])}k=k.join(f.splitChar);n=n.join(f.splitChar)}else{k=l[f.uniqueKey];n=l[f.displayField]}h&&(e=h(l));if(e!==false){g.data("data",l).data("value",k).val(n)}return e};f.beforeClose=function(){g.data("ctr_locked",false).focus();Jalor.UI.fireCtrHandler(g,"fnLocked",false);f.fnSelect&&f.fnSelect();return true};if(f.multiSelect){f.selectedItems=g.data("value").split(f.splitChar)}else{f.selectedItems=g.data("value")}}b.add("popup",{build:function(f,n){var k=$.create("input","popup-input",n&&n.id||$.newGuid("ctr_editor_"),"text").appendTo(f),h=$.create("input","popup-trigger jbutton","","button").attr("value","...").appendTo(f),e=n.conf||{},g=f.parents(".jalor-igrid:first").manager();var j=this,l=$.create("input","popup-clear","","button").val("×").appendTo(f).click(function(){j.setValue(k,{value:"",text:""})});n.readonly&&k.attr("readonly","readonly");h.click(function(){k.focus();var o=$.extend({},e);var p=g.getRowData(g.getCellRow(k.data("caller")));o.servicePath&&(o.servicePath=o.servicePath.formatField(p));a(k,o);Jalor.Component.popup(o,o.title,o.multiSelect,o.width,o.height)});return k},getValue:function(e){return{value:e.manager().getValue()||"",data:e.data("data"),text:e.val()||""}},setValue:function(e,f){f=Jalor.Format.toValueObj(f);e.data("value",f.value);this.callParent("setValue",[e,f.text])}});b.add("popupProgramInfo",{build:function(f,l){var j=$.create("input","popup-input",l&&l.id||$.newGuid("ctr_editor_"),"text").appendTo(f),g=$.create("input","popup-trigger jbutton","","button").attr("value","...").appendTo(f),e=l.conf||{};var h=this,k=$.create("input","popup-clear","","button").val("×").appendTo(f).click(function(){h.setValue(j,{value:"",text:""})});l.readonly&&j.attr("readonly","readonly");g.click(function(){j.focus();a(j,e);Jalor.Component.popupProgramInfo(e,e.title,e.multiSelect,e.width,e.height)});return j},getValue:function(e){return{value:e.manager().getValue()||"",data:e.data("data"),text:e.val()||""}},setValue:function(e,f){f=Jalor.Format.toValueObj(f);e.data("value",f.value);this.callParent("setValue",[e,f.text])}});b.add("popupDimension",{build:function(f,l){var j=$.create("input","floatleft",null,"checkbox").attr("name","checkboxAll").appendTo(f);$.create("span","floatleft").html($i18n("jalor.security.label.programAll")).appendTo(f);var h=$.create("input","floatleft",l&&l.id||$.newGuid("ctr_editor_"),"text").appendTo(f);j.click(function(){if(j.attr("checked")){h.removeData("data");h.data("value","@ALLCONDITION@").val("All");k&&k.removeAttr("checked")}else{h.data("value","").val("")}h.focus()});var e=l.conf||{};l.readonly&&h.attr("readonly","readonly");if(e&&e.servicePath){var g=$.create("input","floatleft","","button").attr("value","...").appendTo(f);g.click(function(){h.focus();a(h,e);var n=e.beforeClose;e.beforeClose=function(){h.data("data")&&h.parent().find("input:checked").removeAttr("checked");e.beforeClose&&n()};Jalor.Component.popup(e,e.title,e.multiSelect,e.width,e.height)})}if(e&&(!e.dimensionType||e.dimensionType=="1")){var k=$.create("input","floatleft",null,"checkbox").attr("name","checkboxLoginId").appendTo(f);$.create("span").html($i18n("jalor.program.label.loginId")).appendTo(f);k.click(function(){if(k.attr("checked")){h.removeData("data");h.data("value","@CURRENTUSERID@").val("loginId");j.removeAttr("checked")}else{h.data("value","").val("")}h.focus()})}return h},getValue:function(e){return{value:e.manager().getValue()||"",data:e.data("data"),text:e.val()||""}},setValue:function(e,f){f=Jalor.Format.toValueObj(f);e.data("value",f.value);this.callParent("setValue",[e,f.text]);e.parent().find("input:checked").removeAttr("checked");if(f&&f.value=="@ALLCONDITION@"){e.parent().find("input[name = checkboxAll]").attr("checked","checked")}else{if(f&&f.value=="@CURRENTUSERID@"){e.parent().find("input[name = checkboxLoginId]").attr("checked","checked")}}}});b.add("hidden",{build:function(e,f){return $.create("input",null,f&&f.id,"hidden").appendTo(e)}});b.add("country",{build:function(e,g){var f=$.create("input","init jalor-country",g&&g.id,"text").appendTo(e);f.jalorCountry();c(f);return f},getValue:function(e){return e.val()||""},setValue:function(e,f){e.manager().setValue(f,f)}});b.add("company",{build:function(e,g){var f=$.create("input","init jalor-country",g&&g.id,"text").appendTo(e);f.jalorCompany();c(f);return f},getValue:function(e){return{value:e.manager().getValue()||"",text:e.val()||""}},setValue:function(e,f){f=Jalor.Format.toValueObj(f);e.manager().setValue(f.value,f.text)}});b.add("area",{build:function(e,g){var f=$.create("input","init jalor-area",g&&g.id,"text").attr("areaLabel",g.format.areaLabel).appendTo(e);g.connector&&f.attr("connector",g.connector);g.valueField&&f.attr("valueField",g.valueField);g.displayField&&f.attr("displayField",g.displayField);f.jalorArea();c(f);return f},getValue:function(e){return{value:e.manager().getValue()||"",text:e.val()||""}},setValue:function(e,f){f=Jalor.Format.toValueObj(f);e.manager().setValue(f.value,f.text)}});b.add("iCurrency",{build:function(e,g){var f=$.create("input","init jalor-currency",g&&g.id,"text").appendTo(e);f.jalorCurrency();c(f);return f},getValue:function(e){return e.val()||""},setValue:function(e,f){e.manager().setValue(f,f)}});b.add("currency",{build:function(e,g){var f=$.create("input",null,g&&g.id,"text").appendTo(e);if(g.format&&g.format.fraction){f.attr("fraction",g.format.fraction)}return f},getValue:function(e){return Jalor.Format.toCurrency(e.val(),e.attr("fraction")||Jalor.Config.Format.decimalfraction)},setValue:function(f,e){f.manager().setValue(e,e)}});b.add("currencystr",{build:function(e,g){var f=$.create("input",null,g&&g.id,"text").appendTo(e);if(g.format&&g.format.fraction){f.attr("fraction",g.format.fraction)}return f},getValue:function(e){return Jalor.Format.toCurrencyStr(e.val(),e.attr("fraction")||Jalor.Config.Format.decimalfraction)},setValue:function(f,e){f.manager().setValue(e,e)}});b.add("location",{build:function(e,h){var g=$.create("input","init jalor-location",h&&h.id||h.field+"Jalor5IgridLoactionId","text");if(h.format){if(h.format.level){g.attr("level",h.format.level)}if(h.format.connector){g.attr("connector",h.format.connector+"Jalor5IgridLoactionId")}}var f=g.appendTo(e);f.jalorLocation();c(f);return f},getValue:function(e){return e.val()||""},setValue:function(e,f){e.manager().setValue(f,f)}});b.add("pbi",{build:function(f,j){var h=$.create("input",null,j&&j.id||$.newGuid("ctr_editor_"),"text").appendTo(f),g=$.create("input","jbutton","","button").attr("value","...").appendTo(f),e=j.conf||{};if(j.format.readonly){h.attr("readonly","readonly")}g.click(function(){h.data("ctr_locked",true);Jalor.UI.fireCtrHandler(h,"fnLocked",true);e.callback=function(k){h.data("value",JSON.stringify(k)).val(JSON.stringify(k))};e.fnBeforeClose=function(){h.data("ctr_locked",false).focus();Jalor.UI.fireCtrHandler(h,"fnLocked",false);return true};Jalor.Component.selectPBI(e)});return h},getValue:function(e){return e.val()||""},setValue:function(e,f){e.manager().setValue(f,f)}});var d={setToolOp:function(e){var f={hasItemDiv:false,items:[{type:"img",icon:"add",text:"jalor.common.button.add",click:function(j,g){var k=g.dom.next().manager(),n=$.extend(true,{},e);if(k.valid()){k.op.Storage.insertItem(n);k.reload();var h=k.op.columns,l;$.each(h,function(p,o){if(!o.inner&&o.editable!==false){l=o;return false}});k.callEditor(k.getRowCell(n._index,l._i))}}}]};return f},setGridOp:function(g){var f=$.extend(true,{editMode:true,allowSort:false,allowRowDrop:true,showPager:false,showSeq:false,dataCopy:true,customSetting:false,colsort:false,storageOp:{innerStatus:false},_defaultData:{}},g),j=f.columns,e=f._defaultData;if(!j){j=f.columns=[]}if(j.length>0){if(j.length==1&&!j[0].field){var h=j[0];h.field="value";!h.header&&(h.header=h.field);!h.width&&(h.width=100);if(h.defaultValue!=null){e.value=h.defaultValue;delete h.defaultValue}else{e.value=null}f._isSimpleArray=true}else{var k=Jalor.DataHelper,l,n;$.each(j,function(p,o){n=k.getObj(o.field,o.defaultValue);k.setObj(o.field,e,(n!=null)?n:null);if(o.valueField){l=k.getObj(o.valueField,o.defaultValue);k.setObj(o.valueField,e,(l!=null)?l:null)}(o.defaultValue!=null)&&delete o.defaultValue})}}else{e.value=null;j.push({field:"value",header:"value",width:100});f._isSimpleArray=true}j.splice(0,0,{columnType:"operate",width:40,freezeable:true,btns:[{type:"img",imgtype:"del",text:"jalor.workflow.label.delete",isIi8n:true,click:function(p,o){if(o.valid()){o.op.Storage.destroyItem(p._index);o.reload()}}}]},{inner:true,width:50,freezeable:true,_ctype:"Seq",headCss:"grid-seq",header:"jalor.common.message.pri",cssName:"grid-seq",content:"<span>${# data._seq || index}</span>"});return f}};b.add("arrayEditor",{build:function(f,k){var j=$.create("div","jalor-editor-array",k&&k.id).appendTo(f),h=$.create("div").appendTo(j),g=$.create("div","control-composite").appendTo(j),e=d.setGridOp(k);h.jalorToolbar(d.setToolOp(e._defaultData));g.igrid(e);e._isSimpleArray&&j.data("simpleArray",true);return j},getValue:function(f){var e=f.children(".jalor-igrid").manager().getValue(),g=[];if(f.data("simpleArray")){$.each(e,function(h,j){g.push(j.value)});e=g}return e},setValue:function(f,e){if(e){if(f.data("simpleArray")){var g=[];$.each(e,function(h,j){g.push({value:j})});e=g}f.children(".jalor-igrid").manager().setValue(e)}}});b.add("money",{build:function(e,g){var f=$.create("input","jalor-money",g&&g.id||$.newGuid("grid_editor_"),"text").appendTo(e);f.jalorMoney(g);return f},getValue:function(g){var f=g.manager("XMoney").getValue();var e=g.data("XMoney_op");return{text:g.val(),value:f}},setValue:function(g,f){var e=g.data("XMoney_op");f=f||{};g.manager("XMoney").setValue(Jalor.DataHelper.getObj(e.amountName,f),Jalor.DataHelper.getObj(e.currencyCodeName,f),Jalor.DataHelper.getObj(e.exchangeDateName,f));g.manager().setValue(Jalor.DataHelper.getObj(e.amountName,f))}})})(Jalor.Editor);Jalor.UI.Slider={};(function(f){var d={distance:0,max:100,min:0,orientation:"horizontal",step:1,value:0,numPages:5,handle:"<a class='xslider-handle' href='#'></a>",tip:true,animate:false};var c=f.Factory={initOp:function(h,j){j._animate=true;j.Handle={refresh:$.Callbacks()}},buildHandle:function(l,o){var n=l.dom,h=(o.values&&o.values.length)||1,k=[];if(o.range){n.append("<div class='xslider-range xslider-range-{0}'> </div>".formatText(o.range))}for(var j=n.find(".xslider-handle").length;j<h;j+=1){k.push(o.handle)}n.addClass("xslider xslider-{0}".formatText(o.orientation)).append(k.join(""));l.getHandle().each(function(p){$(this).data("handle.index",p)});!$("#xsliderTip")[0]&&$("<div id=xsliderTip ></div>").appendTo(document.body)},EventBinder:{bindKeyEvent:function(h,j){h.getHandle().click(function(k){k.preventDefault()}).hover(function(){if(!j.disabled){$(this).addClass("handle-hover")}},function(k){$(this).removeClass("handle-hover")}).focus(function(k){if(!j.disabled){$(this).addClass("handle-focus")}else{$(this).blur()}}).blur(function(k){$(this).removeClass("handle-focus")});h.getHandle().keydown(function(q){if(j.disabled){return}var n=true,l=$(this).data("handle.index"),r,o,k,p=j.step;o=k=h.getValue(l);switch(q.keyCode){case 36:case 35:case 33:case 34:case 38:case 39:case 40:case 37:n=false;if(!j._keySliding){j._keySliding=true;$(this).addClass("handle-active");r=f.Helper.start(h,l);if(r===false){return}}break}switch(q.keyCode){case 36:k=j.min;break;case 35:k=j.max;break;case 33:k=f.Helper.fixValue(o-(j.max-j.min)/j.numPages,l,j);break;case 34:k=f.Helper.fixValue(o+(j.max-j.min)/j.numPages,l,j);break;case 38:case 39:if(o===j.max){return}k=f.Helper.fixValue(o+p,l,j);break;case 40:case 37:if(o===j.min){return}k=f.Helper.fixValue(o-p,l,j);break}f.Helper.slide(h,k,l);return n}).keyup(function(l){var k=$(this).data("handle.index");if(j._keySliding){j._keySliding=false;f.Helper.stop(h,k);$(this).removeClass("handle-active")}})},bindMouseEvent:function(h,l){var k=h.dom,j=h.getHandle();k.bind("mousedown",function(n){if(l.disabled){return}f.Helper.mouseStart(h,n);return false})}}};f.Helper={fixValue:function(k,j,n){if(n.values){var h=n.values[j?0:1];if((j===0&&k>h)||(j===1&&k<h)){k=h}k=k>n.max?n.max:(k<n.min?n.min:k)}else{k=k>n.max?n.max:(k<n.min?n.min:k)}if(k!=n.min&&k!=n.max){var l=(k-n.min)%n.step;if(l){k-=l;k+=(l*2>n.step)?n.step:(0)}}return k},mouseStart:function(k,h){var n=k.dom,q=k.op,r=k.getHandle(),j=0,o=n.offset(),l,j;if(q.orientation==="horizontal"){l=q.min+(h.pageX-o.left)/n.width()*(q.max-q.min)}else{l=q.max-(h.pageY-o.top)/n.height()*(q.max-q.min)}j=q.values?((l<(q.values[1]-q.values[0])/2+q.values[0])?0:1):0;$(r[j]).addClass("handle-active");var s=$.getEventTarget(h);if(!s.hasClass("xslider-handle")&&s.parents("a.xslider-handle").length==0){this.slide(k,l,j)}var p=0;q._animate=false;$(document).on("mousemove.slide",function(t){if((++p)%3===0){f.Helper.mouseMove(t,k,j);q.tip&&f.Helper.showTip(k,j)}return false}).one("mouseup.slide",function(){f.Helper.mouseStop(k,j)}).one("selectstart",function(){return false})},mouseStop:function(h,k){$(document).off("mousemove.slide");h.getTip().hide();var j=h.getHandle().removeClass("handle-active")[k];if($(j).is(":visible")){j.focus()}h.op._animate=true},mouseMove:function(k,j,q){if(!$.browser.msie||$.browser.version>8||k.button){var o=j.dom,p=j.op,l=j.getHandle(),n=o.offset(),h;if(p.orientation==="horizontal"){h=p.min+(k.pageX-n.left)/o.width()*(p.max-p.min)}else{h=p.max-(k.pageY-n.top)/o.height()*(p.max-p.min)}this.slide(j,h,q)}else{this.mouseStop(j,q)}},start:function(j,h){var k=j.op.fnStart;k&&k.call(j,{handle:$(j.getHandle()[h]),value:j.getValue(h)})},stop:function(k,j){var h=k.op.fnStop;h&&h.call(k,{handle:$(k.getHandle()[j]),value:k.getValue(j)})},slide:function(n,l,k){var p=n.op,h,j,o;l=f.Helper.fixValue(l,k,p);if(p.values){if(l!==p.values[k]){j=[].concat(p.values);j[k]=l;o=p.fnSlide&&p.fnSlide.call(n,{handle:$(n.getHandle()[k]),value:l,values:j});if(o!==false){p.values[k]=l}}}else{if(l!==p.value){o=p.fnSlide&&p.fnSlide.call(n,{handle:$(n.getHandle()[k]),value:l});if(o!==false){p.value=l}}}n.refresh()},showTip:function(k,o){var n=k.op,j=n.values?$(k.getHandle()[o]):k.getHandle();var h=j.offset(),l=n.values?n.values[o]:n.value;h.top=h.top-25;l=n.fnTip?n.fnTip.call(k,l):l;if(l!==false){k.getTip().show().css(h).text(l)}},refresh:function(k){var t=k.op,q=k.dom,s=t.range,l=t._animate?t.animate:false,o,j={},r,h=k.getHandle(),w=k.getRange().stop(1,1);if(t.values){h.each(function(x){o=(t.values[x]-t.min)/(t.max-t.min)*100;j[t.orientation==="horizontal"?"left":"bottom"]=o+"%";$(this).stop(1,1)[l?"animate":"css"](j,t.animate);if(s===true){if(t.orientation==="horizontal"){if(x===0){w[l?"animate":"css"]({left:o+"%"},t.animate)}else{if(x===1){w[l?"animate":"css"]({width:(o-r)+"%"},{queue:false,duration:t.animate})}}}else{if(x===0){w[l?"animate":"css"]({bottom:(o)+"%"},t.animate)}else{if(x===1){w[l?"animate":"css"]({height:(o-r)+"%"},{queue:false,duration:t.animate})}}}}r=o})}else{var v=k.getValue(),p=t.min,u=t.max,n;o=(p!==u)?(v-p)/(u-p)*100:0;j[t.orientation==="horizontal"?"left":"bottom"]=o+"%";h.stop(1,1)[l?"animate":"css"](j,t.animate);if(s==="min"&&t.orientation==="horizontal"){w[l?"animate":"css"]({width:o+"%"},t.animate)}else{if(s==="max"&&t.orientation==="horizontal"){w[l?"animate":"css"]({width:(100-o)+"%"},{queue:false,duration:t.animate})}else{if(s==="min"&&t.orientation==="vertical"){w[l?"animate":"css"]({height:o+"%"},t.animate)}else{if(s==="max"&&this.orientation==="vertical"){w[l?"animate":"css"]({height:(100-o)+"%"},{queue:false,duration:t.animate})}}}}}}};var e={getHandle:function(){return DomClass.getProp(this,this.dom,"handle","a.xslider-handle",true)},getRange:function(){return DomClass.getProp(this,this.dom,"range","div.xslider-range",true)},getTip:function(){return DomClass.getProp(this,$(document),"tip","#xsliderTip",true)},disabled:function(h){if(h){this.dom.removeClass("disabled")}else{this.dom.addClass("disabled")}this.op.disabled=!h},readonly:function(h){this.op.disabled=!h},setValue:function(j,h){var k=this.op;if(k.values){if($.isArray(j)){k.values=j}else{k.values[h||0]=f.Helper.fixValue(j,h||0,k)}}else{k.value=f.Helper.fixValue(j,null,k)}this.refresh()},getValue:function(h){var j=this.op;return j.values&&!isNaN(h)?j.values[h]:(j.values?j.values:j.value)},refresh:function(h){h&&$.extend(this.op,h);f.Helper.refresh(this)},resize:function(){this.op.Handle.refresh.fire(this,this.op)}};var b={init:function(h,j){c.initOp(h,j)},build:function(h,j){c.buildHandle(h,j);h.refresh()},bindEvent:function(h,j){c.EventBinder.bindKeyEvent(h,j);c.EventBinder.bindMouseEvent(h,j)}};var a=Jalor.UI.XControl("XSlider",b,d,e);$.fn.slider=function(h){this.each(function(){var j=$(this);if(!j.attr("init")){new a($(this),h);!j.attr("init",true)}});return this};Jalor.UI.XControl.addPlugin("XSlider","XScroll",{preInit:function(h,j){if(j.scroll){g.init(h,j)}},build:function(h,j){if(j.scroll){g.initStyle(h,j);g.bindEvent(h,j)}}});var g={init:function(h,j){j.handle="<div class='xslider-handle-parent'><a class='xslider-handle' href='#'><span class='handle-icon' /></a></div>";if(!j.fnSlide){j.fnSlide=this.scroll}this.buildScroll(h,j)},bindEvent:function(h,k){var j;k.Handle.refresh.add(this.initStyle);h.dom.addClass("xslider-scroll").parent().children(".scroll-button").mousedown(function(p){var o=$.getEventTarget(p).is(".scroll-left")?-k.step:k.step;var l=f.Helper.fixValue(k.value+o,0,k);var n=arguments.callee;k._buttonSliding=setTimeout(function(){n(p)},j=j?150:500);f.Helper.slide(h,l,0);return false}).bind("mouseup mouseout",function(l){window.clearTimeout(k._buttonSliding)}).one("selectstart",function(){return false});$(k.scroll.target).parent().scroll(function(n){var p=$(k.scroll.target),l=$(this),o=l.scrollLeft();if(o>0){h.setValue(o/(p.width()-l.width())*(k.max-k.min))}})},scroll:function(j){var n=this.op,l=$(n.scroll.target);var h=(j.value-n.min)/(n.max-n.min)*100;var k=h/100*(l.width()-l.parent().width());l.parent().scrollLeft(k)},initStyle:function(j,n){var l=j.dom,k=j.getHandle(),h=n.scroll.width||100;l.width(l.parent().width()-40);k.width(h).css("margin-left",-h/2);l.find("div.xslider-handle-parent").width(l.width()-h)},buildScroll:function(h,k){var j=h.dom.wrap("<div class='scroll-bar scroll-bar-{0}' />".formatValue(k.orientation));j.parent().append("<a class='scroll-button scroll-left' />").append("<a class='scroll-button scroll-right' />")}}})(Jalor.UI.Slider);(function(f,c){var a={init:function(g,h){},build:function(g,h){d.build(g,h);h.buildOperate&&d.buildOperate(g,h)},bindEvent:function(g,h){g._reIniting||g.dom.delegate(".jalor-prop-open","click",function(){var n=$(this).toggleClass("prop-close"),k=n.parent().parent(),j=k.attr("deep"),l=!n.hasClass("prop-close");n.children("a").toggleClass("close");d.toggleProp(k,l)});d.bindOperate(g,h)},complete:function(g,h){g.dom.find(".jalor-prop-name > span").tip({global:true,offset:true})}};var b={setValue:function(g){Jalor.Control.setValue(this.dom,this.op.modal,g,"edit")},getProp:function(g){var h=c.getObj(g.attr("mapping"),this.op.modal,true);return Jalor.Control.get("edit").getValue(g,h)},reset:function(){this.setValue(this.op.config)},setDefault:function(){this.setValue(this.op.defConfig)},getValue:function(){return Jalor.Control.getValue(this.dom,this.op.modal,"edit")},save:function(){if(this.valid()){var g=this.getValue(),h=this.op.getChanged===false?g:c.getDataChange(g,this.op.defConfig,this.op.arrKeys);if(this.op.fnSave&&this.op.fnSave(h)!==false){return true}}return false},reInit:function(g){this.dom.empty();return this.base.reInit.call(this,g)},valid:function(){return Jalor.Control.valid(this.dom)},find:function(g){return this.dom.find(g)}};var d=f.PropEditor={operateButtons:{save:{type:"imgBtn",icon:"save",cls:"jalor-icon",css:"jalor-botton-main",text:"jalor.common.button.save",attr:{ecode:"save"}},reset:{type:"imgBtn",icon:"reset",cls:"jalor-icon",text:"jalor.common.button.reset",attr:{ecode:"reset"}},defalutConfig:{type:"imgBtn",icon:"confirm",cls:"jalor-icon",text:"jalor.common.button.defalutConfig",attr:{ecode:"default"}},cancel:{type:"imgBtn",icon:"cancel",cls:"jalor-icon",text:"jalor.common.button.cancel",click:function(){$(this).parent().parent().parent().manager().close()}}},build:function(h,o){o.props.ePropName=o.title?$i18n(o.title):"";o.props.ePropDeep=0;o.defConfig={};var k="prop",n=Jalor.ViewLayout.build(o.layout||k),g;if(o.group){n=Jalor.ViewLayout.build(o.layout||"prop-group");d.createByGroup(o.props,n,k,o.defConfig,o.group);g=$.create("dl","jalor-propgroup")}else{n=Jalor.ViewLayout.build(o.layout||k);d.create(o.props,n,k,o.defConfig);g=$.create("table","jalor-table")}g.html(n.html.join("")).appendTo(h.dom.addClass("jalor-prop"));n.end();var l=o.modal=Jalor.Modal.create({modalName:k,fields:o.props,initField:false});this.buildView(h,o,l);var j=$.extend(true,{},o.defConfig);o.config&&c.applyChangeData(j,o.config,o.arrKeys);o.config=j;l.setData($.extend(true,{},o.config));Jalor.Control.build(h.dom,l,"edit")},create:function(p,l,q,j){if(p){p.ePropName&&l.beginPart(p);for(var h in p){var g=p[h];if(g){if(h.indexOf("eProp")<0){g.ePropField=h;if(!$.isPlainObject(g)){g=p[h]=d.buildProp(g)}g.ePropName=g.ePropName?$i18n(g.ePropName).encode():h;g.ePropDesc&&(g.ePropDesc=$i18n(g.ePropDesc).encode());var n=q+"."+h;g.ePropDeep=p.ePropDeep+1;g.ePropPadding=g.ePropDeep*20;if((g.type&&typeof(g.type)=="string")||g.ePropConf){g.field=n.substring(5);if(g.ePropConf){j[h]=g.ePropConf;delete g.ePropConf}Jalor.Control.initField(g);var o=Jalor.Control.buildCtrTag(n);l.append(g,o)}else{var k=j[h]={};arguments.callee(g,l,n,k)}}}}l.endPart(p)}},createByGroup:function(k,n,l,h,g){if(k){var j;$.each(g,function(p,o){if(o){n.beginPart(o);$.each(o,function(q,s){j=c.getObj(s,k);j.field=s;if(j.value!=null){c.setObj(s,h,j.value)}Jalor.Control.initField(j);var r=Jalor.Control.buildCtrTag(l+"."+s);n.append(j,r)});n.endPart()}})}},buildProp:function(g){var h={};if(g!=null){h.type=typeof(g);h.ePropConf=g}else{h.type="string"}return h},buildView:function(g,j,h){if(j.changeHandler){h.bindChange("everyChange",function(n,p,l,k){var o=j.changeHandler[n];if(o){o.call(k,n,p,l)}});g.controller=new Jalor.Controller({dom:g.dom,modal:h,changeTrigger:true})}},buildButton:function(j){var h=[],g=d.operateButtons;$.each(j,function(l,k){h.push($.extend(true,{},g[k]))});return h},buildOperate:function(h,k){var g=$.create("div","jalor-operate"),j={};j.items=k.buttons||d.buildButton(["save","reset","defalutConfig"]);g.jalorToolbar(j).appendTo(h.dom)},bindOperate:function(g,h){if(h.buildOperate){g.dom.children(".jalor-operate").delegate("[ecode]","click",function(){var j=$(this),k=j.attr("ecode");d.operate(j.parent().parent().parent(),k)})}else{g.dom.parent().next().delegate("[ecode]","click",function(){var j=$(this),k=j.attr("ecode");if(h.showLoading&&k=="save"){Jalor.UI.openMainLoading();setTimeout(function(){if(d.operate(j.parent().parent().prev().children(),k)){j.parent().parent().parent().manager().close()}},100)}else{if(d.operate(j.parent().parent().prev().children(),k)&&k=="save"){j.parent().parent().parent().manager().close()}}})}},operate:function(h,g){switch(g){case"save":return h.manager().save();break;case"reset":h.manager().reset();break;case"default":h.manager().setDefault();break}},getDeep:function(g){return g.attr("deep")*1},toggleProp:function(j,k){var h=this.getDeep(j);j=j.next();if(j.length){var g=this.getDeep(j);while(h<g){j.toggle(k);j=j.next();if(j&&j.length){g=this.getDeep(j)}else{return}}}}};var e=f.XControl("XPropEditor",a,null,b);$.fn.propEditor=function(g){new e(this,g);return this.manager()};Jalor.Editor.add("tableEditor",{build:function(g,j){g.css("display","block");var h=$.create("div","control-composite","propGrid").appendTo(g);return h.igrid($.extend(true,{height:255,editMode:true,allowSort:false,showSeq:false,showPager:false,dataCopy:true,customSetting:false,showToolBar:false,colsort:false,autoWhiteWidth:true,storageOp:{innerStatus:false}},j))}});Jalor.ViewLayout.add("prop",{partStart:'<tr deep="${ePropDeep}"><th class="jalor-prop-title" colspan=2 style="padding-left:${ePropPadding}px"><span class="jalor-prop-open"><a class="jalor-icon open"></a>${ePropName}</span></th></tr>',layout:'<tr deep="${item.ePropDeep}"><td style="padding-left:${item.ePropPadding}px" class="jalor-prop-name ${item.titleMark}"><span title="${item.ePropDesc}">${item.ePropName}</span></td><td class="jalor-prop-input">${item}</td></tr>',setItemOp:function(g){Jalor.Modal.isRequiredField(g)&&(g.titleMark="required");return g},checkPartEnd:function(g){g.titleMark&&delete g.titleMark}}).add("prop-simple",{layout:'<tr><td class="jalor-prop-name ${item.titleMark}"><span title="${item.ePropDesc}">${item.ePropName}</span></td><td class="jalor-prop-input">${item}</td></tr>',partEnd:"</tbody>",beginPart:function(g){g.ePropField&&this.html.push("<tbody group='"+g.ePropField+"'>")},endPart:function(g){g.ePropField&&this.html.push(this.partEnd)},setItemOp:function(g){Jalor.Modal.isRequiredField(g)&&(g.titleMark="required");return g},checkPartEnd:function(g){g.titleMark&&delete g.titleMark}}).add("prop-group",{partStart:"<dt>${group}</dt><dd><ul>",layout:'<li class="jalor-prop-item" _item="${item.field}"><span  class="jalor-prop-title ${item.titleMark}" title="${item.desc}">${item.name}</span><samp class="jalor-prop-input">${item}</samp></li>',partEnd:"</ul></dd>",setPartOp:function(g){return{group:g.name}},setItemOp:function(g){Jalor.Modal.isRequiredField(g)&&(g.titleMark="required");return g}});Jalor.UI.openPropEditor=function(j,h){var g=h?"<div id='profileDIV' style='margin-bottom:2px;'><label i18nKey='jalor.common.label.profile' class='init i18n' /><font color='red'>&nbsp;*</font>&nbsp;<input id='profileText' class='required' type='text'/></div>":"";Jalor.UI.dialog(null,j.dialogTitle,{width:j.dialogWidth,height:j.dialogHeight,target:j.dialogTarget,content:"<form>"+g+"</form>",fnLoad:function(k){this.getBody().children().propEditor(j)},toolbar:{items:j.buttons||d.buildButton(["save","reset","defalutConfig","cancel"])}})}})(Jalor.UI,Jalor.DataHelper);(function(d){$.fn.xForm=function(h){if(this[0].tagName=="FORM"){if(this.hasClass("jalor-widget-body")){return this.parent().widget(h)}else{h.convertMode=true;if(h.customSetting!==false){h.layoutItemCss="jalor-form-row";h.customSettingTarget="> samp"}}return this.widget(h)}else{if(this.hasClass("jalor-widget")){return this.widget(h)}if(h.tagName!="form"){var f=h.fnComplete;h.fnComplete=function(){Jalor.UI.InitForm(this.getBody())}}var g=d.XControl.isInited(this);!g&&!h.convertMode&&(h=b.initOp(h));var e=this.widget(h);g||b.bindEvents(e);return e}};var a={body:"<{0} class='init jalor-widget-body jalor-form'></{0}>",btns:{save:{type:"input",text:"save",attr:{eno:"save"}},reset:{type:"input",text:"jalor.common.button.reset",attr:{eno:"reset"}},search:{type:"input",css:"default",text:"jalor.common.button.search",attr:{eno:"search"}},back:{type:"input",text:"back",attr:{eno:"back"}}},operation:{save:function(g,f){if(f.valid()){var h=f.op;h.modal.setData(f.getValue()).saveSingle({success:function(e){f.proxy(h.fnSave,[e])}})}},reset:function(g,f){f.setValue({})}}};var c=a.renderBtns={view:[a.btns.back],edit:[a.btns.save,a.btns.back],search:[a.btns.search,a.btns.reset]};var b={initOp:function(e){e||(e={});e.ajax||(e.ajax=e.modal.findSingle);e.body=a.body.formatText(e.tagName||"form");if(!e.layout){e.layout="form-Flow"}else{if(e.layout=="form-Table"){e.customSetting=false}}e.operation=$.extend(true,{},a.operation,e.operation);this.initButton(e);e.renderType=="search"&&(e.renderType="edit");return e},initButton:function(k){if(k.innerButton===false){return}var h=k.buttons;if(h){var f=0,e=h.length,j;for(;f<e;f++){btn=h[f];if(btn.innerBtn){btn=h[f]=$.extend(true,a.btns[btn.innerBtn],btn);btn.click&&delete btn.attr.eno}}}else{var g=k.renderType||"view";k.buttons=c[g]}return this},bindEvents:function(e){e.getBody().on("click","[eno]",function(j){var g=$(this),f=g.attr("eno");if(f){var h=e.op.operation[f];if(h){h.call(g,j,e)}}})}}})(Jalor.UI);(function(f,d){f.Widget={};var b={};var a=f.Widget.flow={preInit:function(g,h){if(h.convertMode){g.dom.addClass("jalor-widget-body").wrap("<div class='jalor-widget'></div>");g.dom=g.dom.parent();h._builded=true}else{g.dom.addClass("jalor-widget");h.handler.buildField=$.Callbacks()}h.headOpeartion||(h.headOpeartion={});f.Widget.Commponents.fireAll("build",g,h)},initOp:function(h){var g=h.view;if(g){h=$.extend({renderType:g.renderType,modal:g.modal},h)}else{this.flow.initTmpl(h);h.view=Jalor.View.create({modal:h.modal,tmpl:h.tmpl,layout:h.layout,renderType:h.renderType,buildControlTag:h.buildControlTag});delete h.tmpl}},initTmpl:function(k,j){var h=k.fields||k.modal.fields;if(h){var j=["${=this.startLayout()}"],g=k.fnCheckField;$.each(h,function(l,n){if(!g||g(l,n,k)){k.handler.buildField.fire(n,k);j.push("${",k.modal.modalName,".",n.alias||n.field,"} ")}});j.push("${=this.endLayout()}");k.tmpl=j.join("")}},init:function(g,h){if(h.convertMode){return}this.flow.initOp.call(this,h);if(h.ajax){if($.isFunction(h.ajax)){h._request=h.ajax;ajax={}}}},build:function(k,l){var h=k.dom,j=this.flow;if(l.convertMode){h.prepend(j.buildHead(k,l))}else{var g=[];g.push(j.buildHead(k,l));l.body&&g.push(l.body);h.html(g.join(""))}},buildHead:function(h,j,g){return j.showHead!==false?"<div class='jalor-widget-head'><span>"+(j.title||"")+"</span><samp></samp></div>":null},buildFoot:function(h,j,g){return null},bindEvent:function(g,h){},initComplete:function(g,h){},initAjax:function(h,j,g){if(j._request){j.fnRequest=function(l,o){var n=o.fnBuildParam?o.fnBuildParam(o.param):o.param;if(n){if(!$.isPlainObject(n)){var k=n;n={urlParam:{}};n.urlParam[o.modal.modalKey]=k}n.success=o.ajax.success;o.modal.proxy(o._request,n)}else{o.ajax.success({})}}}else{}},preBindData:function(j,k,h,g){},bindData:function(j,k,h){k.param&&delete k.param;if(!k._builded){var g=j.getBody();k.view.render(g,k.renderType,h);k._builded=true}else{j.setValue(h)}},bindDataComplete:function(g,h){},complete:function(g,h){if(!h._hideBody){g.getBody().show();delete h._hideBody}h.showHead!==false&&g.getHeadBar().on("click","[eno]",function(n){var k=$(this),j=k.attr("eno");if(j){var l=g.op.headOpeartion[j];l&&l.call(k,n,g)}})}};var c={getHead:function(){return DomClass.getProp(this,this.dom,"pHead",".jalor-widget-head")},getHeadBar:function(){return DomClass.getProp(this,this.getHead(),"pHeadBar","samp")},getBody:function(){return DomClass.getProp(this,this.dom,"pBody",".jalor-widget-body")},getFoot:function(){return DomClass.getProp(this,this.dom,"pBody",".jalor-widget-foot")},valid:function(){return this.getBody().valid()},find:function(g){return this.dom.find(g)},findByName:function(g){return this.find('[name="'+g+'"]')},getValue:function(g){return Jalor.Control.getValue(this.dom,this.op.modal,g==null?"edit":g)},setValue:function(h,g){Jalor.Control.setValue(this.dom,this.op.modal,h,g);return this},request:function(g){this.op.param=g;this.base.reload.call(this,true)},reBuild:function(){var h=this.getValue(),k=this.op,j=k.modal.getValue(),g=ctr.getBody();g.empty();a.initTmpl(k);k.view.tmpl=k.tmpl;k.view.buildTmpl();k._builded=null;this.reload(h);k.modal.setData(j)}};var e=f.XControl("widget",a,b,c,"Data");$.fn.widget=function(g){if(!f.XControl.isInited(this)){new e(this,g)}return this.manager("widget")}})(Jalor.UI,Jalor.Control);(function(d,c){var a=c.Commponents=$.IAdapter({mapping:{build:function(f,g){if(this.check(g)){this.initCommponent(f,g,g.handler)}},check:function(f){return false},initCommponent:function(f,g){}}});a.add("toolBar",{check:function(f){return f.buttons&&f.buttons.length},initCommponent:function(g,h,f){f.complete.add(function(k,l){var j=$.create("div").appendTo(k.getBody());j.jalorToolbar({items:l.buttons});delete l.buttons})}});a.add("events",{check:function(f){return f.events},initCommponent:function(g,h,f){f.complete.add(function(k,l){var j=k.dom;$.each(l.events,function(q,p){var n=q.split(" "),r=n[0],o=n[1];j.find(r).bind(o,k,function(s){p.call(this,s,s.data)})});delete l.events})}});d.XControl.extendIManager("widget",{getCustomSetting:function(){return this.op._customSettings}});a.add("customSetting",{check:function(f){return f.customSetting!==false},initCommponent:function(g,h,f){h.noSetFields||(h.noSetFields=[]);h.layoutItemCss||(h.layoutItemCss="layout-item");h.customSettingTarget||(h.customSettingTarget=".layout-title");if(h.convertMode){g.dom.attr("config","{ignore:null}")}else{this.setHideField(g,h,f)}f.complete.add(this.initSetting)},setHideField:function(g,h,f){f.initComplete.add(function(j,k){if(k.view.validOp){k.view.validOp.ignore=null}else{k.view.validOp={ignore:null}}});f.buildField.add(function(j,k){if(j.customSetting===false||Jalor.Modal.isRequiredField(j)){k.noSetFields.push(j.field);if(j.layout){j.layout+=" widget-item-noset"}else{j.layout=" widget-item-noset"}}})},initSetting:function(j,n){if(n.convertMode){var h,f,k;j.getBody().find("."+n.layoutItemCss).each(function(){h=$(this);f=h.find("[name]:first");k=h.find(n.customSettingTarget).addClass("layout-title");f.length&&h.attr("field",f.attr("name"));if(k.hasClass("required")){h.addClass("widget-item-noset")}})}j.getHeadBar().append(Jalor.UI.newButton({type:"img",css:"setting",attr:{eno:"customSetting"},text:"jalor.common.widget.customSetting"}),Jalor.UI.newButton({css:"hide",attr:{eno:"save"},text:"jalor.common.label.save"}),Jalor.UI.newButton({css:"hide",attr:{eno:"cancel"},text:"jalor.common.button.cancel"}));$.extend(n.headOpeartion,e);var g=Jalor.Personalized.getCurrPageSettings(j.id),l;if(g){l=n._customSettings=g;if(l.hideFields){$.each(l.hideFields,function(o){j.find("."+n.layoutItemCss+'[field="'+o+'"]').addClass("widget-item-hide jalor-hideValid")})}else{l.hideFields={}}}else{n._customSettings={hideFields:{}}}}});var e={customSetting:function(l,k){var h=this.parent();this.hide().next().show().next().show();k.dom.addClass("widget-customSetting");var f=k.getBody();if(!f.data("buildMenu")){var g=k.op.layoutItemCss,j=k.op.customSettingTarget;f.data("buildMenu",true).contextMenu({target:g,menus:e.menus,fnGetTarget:function(p,o,n,r){var q=p.find(j);if(q.length){n.left=q.outerWidth()-o.outerWidth()}else{q=p}return q},fnHover:function(n){return !n.hasClass("widget-item-noset")}})}else{f.enableContextMenu(true)}k.getBody().find(".widget-item-hide:visible").css("display","")},save:function(l,j){this.hide().next().hide();this.prev().show();var h,k,g=j.op._customSettings.hideFields,f={};j.getBody().find(".widget-item-temphide,.widget-item-tempshow").each(function(n){h=$(this),k=h.attr("field");if(h.hasClass("widget-item-temphide")){h.addClass("widget-item-hide jalor-hideValid").removeClass("widget-item-temphide");g[k]=null}else{h.removeClass("widget-item-hide").removeClass("widget-item-tempshow");delete g[k]}});e.end(j);Jalor.Personalized.saveSetting(j.id,j.getCustomSetting())},cancel:function(g,f){this.hide().prev().hide().prev().show();f.getBody().find(".widget-item-temphide,.widget-item-tempshow").removeClass("widget-item-temphide").removeClass("widget-item-tempshow");e.end(f)},end:function(f){f.getBody().enableContextMenu();f.dom.removeClass("widget-customSetting")},menus:[{text:"jalor.common.widget.hideItem",css:"hidden",click:function(f){f=f.parent();if(f.hasClass("widget-item-tempshow")){f.removeClass("widget-item-tempshow")}else{f.addClass("widget-item-temphide")}},fnCheck:function(g,h,f){g=g.parent();return g.hasClass("widget-item-tempshow")||(!g.hasClass("widget-item-hide")&&!g.hasClass("widget-item-temphide"))}},{text:"jalor.common.widget.showItem",css:"show",click:function(f){f=f.parent();if(f.hasClass("widget-item-temphide")){f.removeClass("widget-item-temphide")}else{f.addClass("widget-item-tempshow")}},fnCheck:function(g,h,f){g=g.parent();return !g.hasClass("widget-item-tempshow")&&(g.hasClass("widget-item-hide")||g.hasClass("widget-item-temphide"))}}]};a.add("shrink",{check:function(f){return f.miniable!==false},initCommponent:function(g,h,f){f.complete.add(function(n,o){var j=n.getCustomSetting(),k="panel-minimize",l="panel-normal hide";if(j&&j.isShrink){k="panel-minimize hide";l="panel-normal";n.getHead().addClass("widget-mininize");o._hideBody=true}n.getHeadBar().append(Jalor.UI.newButton({type:"img",css:k,attr:{eno:"minimize"},text:"jalor.common.widget.minimize"}),Jalor.UI.newButton({type:"img",css:l,attr:{eno:"normal"},text:"jalor.common.widget.normal"}))});$.extend(h.headOpeartion,b)}});var b={minimize:function(g,f){this.hide().next().show();f.getHead().addClass("widget-mininize").next().slideUp().next().hide();b.saveShrink(f,true)},normal:function(g,f){this.hide().prev().show();f.getHead().removeClass("widget-mininize").next().slideDown().next().show();b.saveShrink(f,false)},saveShrink:function(g,f){if(g.id){Jalor.Personalized.saveSetting(g.id,{isShrink:f})}}}})(Jalor.UI,Jalor.UI.Widget);Jalor.UI.IGrid={};(function(b){var a=b.Const={inserted:{css:"igrid-newrow"},selected:{css:"igrid-selected"},halfSelected:{css:"igrid-selecthalf"},deleted:{css:"row-del"},updated:{css:"igrid-updated"},focus:{css:"igrid-actived"},I18n:{}};b.Helper={addProp:function(d,c,e){if($.isPlainObject(c)){$.each(c,function(g,f){f!=null&&d.push(" ",g,"='",f,"'")})}else{if(e){d.push(" ",c,"='",e,"'")}}return this},attrValue:function(c,d){return d==void 0?c.attr("val"):c.attr("val",d)},getGrid:function(c){return c.parents(".jalor-igrid:first")},getGridObj:function(c){return this.getGrid(c).manager("XGrid")},setRowStatus:function(d){if(d){var c=[];d._inserted&&c.push(" "+a.inserted.css);d._selected&&c.push(" "+a.selected.css);d._halfSelected&&c.push(" "+a.halfSelected.css);d._deleted&&c.push(" "+a.deleted.css);d._updFields&&c.push(" "+a.updated.css);d._focus&&c.push(" "+a.focus.css);return c.join("")}return null},setCellUpdated:function(c,f){var d=c&&c._updFields,e;if(d){$.each(d,function(h,g){if(g==f){e=true;return false}});return e?" cell-update ":null}return null}}})(Jalor.UI.IGrid);(function(f){var d=function(){return{width:null,height:null,showPager:true,showStatus:false,showFirstEditor:true,showColumnIcon:true,customSetting:false,wrapHead:true,headTip:false,isValidUpdate:true,pagerOp:{pageInf:{pageSize:Jalor.UI.Config.pager.defaultSize,curPage:1,totalRows:0,totalPage:null},pageSizes:[].concat(Jalor.UI.Config.pager.pageSizes)},autoScroll:true,allowSort:true,allowResize:true,allowFreezen:true,remoteSort:false,showSeq:true,serialSeq:true,columns:null,rowAttr:{},rowClass:["grid-row"],rowCodeBegin:[],rowCodeEnd:[],rowHeight:24,customHead:null,autoLoad:true,fnSorted:null,fnSelected:null,fnRenderRow:null,noResultI18n:null}};var c=f.Factory={initHandler:function(g){$.extend(g.handler,{setColumn:$.Callbacks(),beforeLoad:$.Callbacks(),click:$.IAdapter(),widthChange:$.Callbacks(),dataHandler:$.Callbacks(),setEditor:$.Callbacks(),scrollX:$.Callbacks(),scrollY:$.Callbacks()});return this},initStyle:function(g,h){h.width&&g.dom.width(h.width);g.dom.addClass("jalor-igrid").data("op",h);if(h.percentWidth){g.dom.addClass("jalor-igrid-percent");h.wrap=h.wrap!==false?true:false;h.allowFreezen=null;h.handler.afterBindData.add(this.fixScroll)}h.wrap&&g.dom.addClass("jalor-igrid-wrap");h.wrapWord&&g.dom.addClass("jalor-igrid-wrapword");h.wrapHead&&g.dom.addClass("jalor-igrid-wraphead");return this},initColumnMap:function(g,h){h._columnMap={};if(h.columns&&h.columns.length){$.each(h.columns,function(k,j){j.field&&(h._columnMap[j.field]=j)})}},initConnectMap:function(g,h){h._connectMap={};if(h.columns&&h.columns.length){$.each(h.columns,function(l,k){if(k.editorOp&&k.editorOp.id){!h._connectMap[k.editorOp.id]&&(h._connectMap[k.editorOp.id]={});h._connectMap[k.editorOp.id].self=k}if(k.editorOp&&k.editorOp.conf&&k.editorOp.conf.connector){var j=k.editorOp.conf.connector;if(typeof j=="string"){var n=j.substring(1);!h._connectMap[n]&&(h._connectMap[n]={});!h._connectMap[n].child&&(h._connectMap[n].child=[]);h._connectMap[n].child.push(k)}else{$.each(j,function(o,q){var p=q.target.substring(1);!h._connectMap[p]&&(h._connectMap[p]={});!h._connectMap[p].child&&(h._connectMap[p].child=[]);h._connectMap[p].child.push(k)})}}})}},fixScroll:function(h,k){var j=h.getBodyPanel().height()<h.getBodyTable().outerHeight(),g=h.getHeadTable();g.parent().css("padding-right",j?"17px":"")},parseSortSetting:function(h,l){if(l.allowSort&&l.remoteSort){var g=l._sortSetting&&l._sortSetting.sort;if(l._sortSetting&&l._sortSetting.isRemoteSort&&g){var j=[],k;$.each(g,function(o,n){if(n.field){k=n.field+(n.sort==="desc"?" desc":" asc");j.push(k)}});return j.join(",")}return l.sort}},fixScrollToFullScreen:function(h){var g=h.getContent().width(),j=h.getScroller().children().width();if(g>j){h.syncScroll(0)}}};c.EventBinder={init:function(g,h){this.bindScroll(g);this.bindResize(g,h);this.bindClick(g,h)},bindScroll:function(g){if(!g.op.percentWidth){g.getScroller().show().mousedown(function(){if(g.op.validScroller==false){g.endEdit()}}).scroll(function(j){var h=$(this);if(g.op._noScroll){setTimeout(function(){g.op._noScroll=null},10)}else{g.scrollX(h)}});g.getBodyPanel().scroll(function(){var j=$(this),l=j.scrollLeft(),n=g.op;if(l>0){if(!n.columnLazyLoad&&!n._noScroll&&!n._inEdit){var h=g.getScroller();g.scrollX(h,l+h.scrollLeft())}else{if(n._activeTd){var k=g.getColumnOp(n._activeTd);g.scrollTo(k)}}j.scrollLeft(0)}});g.getHeadPanel().scroll(function(){g.getBodyPanel().scrollLeft($(this).scrollLeft());$(this).scrollLeft(0)})}},bindResize:function(g,h){$.browser.msie&&g.dom.resize(function(j){g.updateStyle(1)})},bindClick:function(g,h){if(h.handler.click.length){g.getContent().delegate("[eno]","click",function(q){var p=$(this),l=p.attr("eno"),n;if(p.hasClass("grid-cell")){var k=g.getColumnOp(p),o=g.getCellRow(p);if(!h.onCellClick||h.onCellClick.call(g,g.cellData(p),g.getRowData(o),p,o,k._i,g.getRowIndex(o),k,g,q)!==false){if(p.parent().parent().hasClass("igrid-head")){h.onHeadClick&&h.onHeadClick.call(g,q,p,k,g)}n=true}}else{n=true}if(n){if(!h._disabled&&(!h._readonly||l!="edit")&&l&&!p.hasClass("disabled")){var j=h.handler.click.get(l);j&&j(q,p,g)}}q.stopPropagation()})}g.getBodyTable().delegate("tr.grid-row","click",function(l){var k=$(this),n=$(l.target),j=g.getColumnOp(n);h.onRowClick&&h.onRowClick.call(g,g.cellData(n),g.getRowData(k),n,k,j._i,g.getRowIndex(k),j,g,l);if(!h._disabled&&!k.hasClass("igrid-actived")&&!k.hasClass("row-noselect")){if(h._hTr){h._hTr.removeClass("igrid-actived");h._hTr.removeData("focusin")}k.addClass("igrid-actived");h._hTr=k}});g.getBodyTable().delegate("td.grid-cell","mouseover",function(l){var n=$(this),j=g.getColumnOp(n),k=g.getCellRow(n);h.onMouseOver&&h.onMouseOver.call(g,g.cellData(n),g.getRowData(k),n,k,j._i,g.getRowIndex(k),j,g,l)})}};c.Custom={Table:{buildHead:function(h,j,g){h.push("<div class='jalor-igrid-head'><div class='jalor-igrid-headplace'>","<div id='"+g.id+"Header' class='jalor-igrid-thead unselect igrid-itable-custom'></div></div></div>")},buildBody:function(h,j,g){h.push("<div class='jalor-igrid-body'");if(j.height||j.minHeight||j.maxHeight){h.push(" style='");j.height&&h.push("height:"+(isNaN(j.height)?j.height:j.height)+"px",";");j.minHeight&&h.push("min-height:"+(isNaN(j.minHeight)?j.minHeight:j.minHeight)+"px",";");j.maxHeight&&h.push("max-height:"+(isNaN(j.maxHeight)?j.maxHeight:j.maxHeight)+"px",";");h.push("'")}h.push("><div class='jalor-igrid-bodyplace'><table id='"+g.id+"Table' class='jalor-igrid-tbody igrid-itable-custom");h.push("'><tbody class='igrid-colset'><tr><td style='width: 100%;' class='grid-cell'><div></div></td></tr></tbody>");h.push("<tbody class='igrid-data ",j.contentCss||"","'></tbody></table></div>");h.push("</div>")}},Column:{bulidRowForm:function(){var g=["<div>","<div class='igrid-seq'></div>","<div class='igrid-select'></div>","<div class='igrid-icon'></div>"];g.push("<div class='igrid-columns'><ul><li class='igrid-column'><samp class='igrid-title'></samp><span class='igrid-literal'></span></li>");g.push("</ul></div></div>");return g.join("")},setHeadHtml:function(j,g,h){h.push("<li");f.Helper.addProp(h,g.headAttr);h.push("><div class='igrid-innercell'");h.push(">",g.headHtml,"</div></li>");return this},setTmpl:function(k,h,l,j){if(!k.content&&!k._renderTd){k.content=k.field?"${"+k.field+"}":""}if(j[k._module].length){if(k.inner){k.cssName&&j[k._module].addClass("${cssName}");j[k._module].attr("eno","${eNo}").text("${content}");h[k._module]=j[k._module][0].outerHTML.formatField(k,"non")}else{var n=j[k._module].clone(),g={_col:"${attr._col}",field:"${field}",eno:"${eNo}"};if(k.valueField){g.valueField="${valueField}";g.val="${attr.val}"}n.find(".igrid-title").addClass("${attr._required}").text("${header}");n.find(".igrid-literal").addClass("${attr.class}").attr(g).text("${content}");l.push(n[0].outerHTML.formatField(k,"non"))}}return this},buildHead:function(j,h,g){j.getHeadTable().html("<div class='igrid-head-operate'>"+g.join("")+"</div><div class='igrid-head-content'><ul>"+h.join("")+"</ul></div>")},buildRow:function(h,k,g){k.rowAttr._row||(k.rowAttr._row="${#data._newIndex || _rowNo}");k.rowCodeBegin.push("data.rowIdx = _rowNo;");var j=[];k.rowCodeBegin.length&&j.push("<% ",k.rowCodeBegin.join("")," %>");j.push("<tr class='",k.rowClass.join(" "),"${#index%2 ? '' : ' odd'}${#Jalor.UI.IGrid.Helper.setRowStatus(data)}'");f.Helper.addProp(j,k.rowAttr);j.push("><td class='grid-cell-custom'>",g,"</td></tr>");k.rowCodeEnd.length&&j.push("<% ",k.rowCodeEnd.join("")," %>");k.tmpl=j.join("");k.handler.changeTmpl&&k.handler.changeTmpl.fire(h,k,g)}}};c.Common={Table:{init:function(j,h,g){this.buildHead(h,j,g);this.buildBody(h,j,g);this.buildFoot(h)},buildHead:function(h,j,g){h.push("<div class='jalor-igrid-head'><div class='jalor-igrid-headplace'>","<table id='"+g.id+"Header' class='jalor-igrid-thead unselect igrid-itable'></table></div></div>")},buildBody:function(h,j,g){h.push("<div class='jalor-igrid-body'");if(j.height||j.minHeight||j.maxHeight){h.push(" style='");j.height&&h.push("height:"+(isNaN(j.height)?j.height:j.height)+"px",";");j.minHeight&&h.push("min-height:"+(isNaN(j.minHeight)?j.minHeight:j.minHeight)+"px",";");j.maxHeight&&h.push("max-height:"+(isNaN(j.maxHeight)?j.maxHeight:j.maxHeight)+"px",";");h.push("'")}h.push("><div class='jalor-igrid-bodyplace'><table id='"+g.id+"Table' class='jalor-igrid-tbody igrid-itable");h.push("'><tbody class='igrid-colset'></tbody><tbody class='igrid-data'></tbody></table></div>");h.push("</div>")},buildFoot:function(g){}},Column:{init:function(j,k){if(k.columns&&k.columns.length){k._dateFields=[];k._mappingFields=[];k.percentWidth&&this.percentInit(j,k);for(var h=0,g;g=k.columns[h];h++){g.headAttr||(g.headAttr={});g.attr||(g.attr={});g.headENo=g.eNo="cellClick";g._i=g.headAttr._col=g.attr._col=h;g._headCss=g.headCss||"";g.cssName==null&&(g.cssName="");k.handler.setColumn.fire(j,g,k);k.handler.setEditor.fire(j,g,k);g._ctype||(g._ctype=g.field);g._module||(g._module="igrid-column");!g.inner&&(g.cssName+=" ${#Jalor.UI.IGrid.Helper.setCellUpdated(data, '{0}')}".formatValue(g.field))}this.buildCol(j,k)}},percentInit:function(h,k){var g=0,j;$.each(k.columns,function(n,l){if(!l.hidden){j=parseInt(l.width)||0;g+=j}});if(g!=100){$.each(k.columns,function(n,l){if(!l.hidden&&!l.inner&&!l.columnType){j=parseInt(l.width)||0;l.width=(j*100/g)+"%"}})}},buildCol:function(g,s){var k=s.columns,h=Jalor.DataHelper,u=[],r=[];if(s.customTable){var l,y,x={},D=[],z=[];s.customTmpl||(s.customTmpl=this.bulidRowForm());l=$(s.customTmpl);y={"igrid-seq":l.find(".igrid-seq"),"igrid-select":l.find(".igrid-select"),"igrid-icon":l.find(".igrid-icon"),"igrid-column":l.find(".igrid-column")};for(var C in y){y[C].replaceWith("${"+C+"}")}for(var w=0,n;n=k[w];w++){if(!n.hidden){n._indexCss=g.id+"-col"+n._i;this.setColAttr(n,g);if(n.multi){z.push("<div");f.Helper.addProp(z,n.headAttr);z.push("><div class='igrid-innercell'><span></span></div></div>")}else{if(!n.inner&&n.field){this.setHeadHtml(g,n,u)}}this.setTmpl(n,x,D,y)}}x["igrid-column"]=D.join("");this.buildHead(g,u,z);this.buildRow(g,s,l.html().formatText(x))}else{var q=[],j=[],t=[],B=[],v=0,o=0,p=0,A=0;for(var w=0,n;n=k[w];w++){if(!n.hidden){n._curWidth=parseInt(n.width)||0;if(s.allowFreezen&&n.freezeable&&(!s.fzNum||(s.fzNum&&v<=s.fzNum))){p+=n._curWidth;n._curIndex=v++;n._indexCss=g.id+"-fzcol"+n._curIndex;this.setColAttr(n,g);s.columnLazyLoad||this.buildColHtml(g,n,q,j,B)}else{A+=n._curWidth;n._curIndex=o++;n._indexCss=g.id+"-col"+n._curIndex;this.setColAttr(n,g);s.columnLazyLoad||this.buildColHtml(g,n,r,u,t)}}}if(!s.percentWidth){s._colSet={count:o,width:A};s._fzColSet={count:v,width:p};s.fzNum=v}if(!s.columnLazyLoad){this.buildRow(g,s,r,q);this.buildHead(g,u,j,t,B)}s.columnLazyLoad&&g.initScrollLoadColumn(0);this.buildXScroll(g,s)}if(s._dateFields.length){s.handler.dataHandler.add(function(E,F,H,G){$.each(H._dateFields,function(I,J){var K=h.getObj(J.field,E),L=Jalor.Format.toDate(K,J.type);h.setObj(J.field,E,L)})})}if(s._mappingFields.length){s.handler.dataHandler.add(function(E,F,H,G){$.each(H._mappingFields,function(J,I){E[I.field]=I.func(h.getObj(I.funcParam,E),E)})})}},buildRow:function(j,l,g,h){l.rowAttr._row||(l.rowAttr._row="${#data._newIndex || _rowNo}");l.rowCodeBegin.push("data.rowIdx = _rowNo;");var k=[];l.rowCodeBegin.length&&k.push("<% ",l.rowCodeBegin.join("")," %>");k.push("<tr class='",l.rowClass.join(" "),"${#index%2 ? '' : ' odd'}${#Jalor.UI.IGrid.Helper.setRowStatus(data)}'");f.Helper.addProp(k,l.rowAttr);k.push(">",h.join(""),g.join(""),"</tr>");l.rowCodeEnd.length&&k.push("<% ",l.rowCodeEnd.join("")," %>");l.tmpl=k.join("");l.handler.changeTmpl&&l.handler.changeTmpl.fire(j,l,g,h)},buildHead:function(k,j,l,o,n){var g="<tr>"+n.join("")+o.join(""),h=k.getColSet().html(g+"</tr>"),p=h.children().children(":first");if(!k.op.percentWidth){k.op._colSet.fixed=p.outerWidth()-p.width()}k.getHeadTable().html("<tbody class='igrid-colset'>"+g+"</tr></tbody><tbody class='igrid-head'><tr>"+l.join("")+j.join("")+"</tr></tbody>")},buildXScroll:function(g,h){if(!h.percentWidth){h.handler.widthChange.add(this.setScrollWidth);this.setScrollWidth(g)}},setScrollWidth:function(g){var k=g.op._colSet,j=g.op._fzColSet,h=j.width+k.width+k.fixed*(k.count+j.count);g.getScroller().children().width(h);c.fixScrollToFullScreen(g)},setColAttr:function(g,h){g.field&&(g.headAttr.field=g.attr.field=g.field);if(g.valueField){g.headAttr.valueField=g.attr.valueField=g.valueField;g.attr.val="${#Jalor.DataHelper.getObj('"+g.valueField+"', data)}"}g.headAttr.eno=g.headENo;g.attr.eno=g.eNo;g.headAttr["class"]="grid-cell "+g._indexCss+" "+g._headCss;g.attr["class"]="grid-cell "+g._indexCss+" "+(g.cssName||"");return this},buildColHtml:function(k,h,g,j,l){this.setHeadHtml(k,h,j,l);this.setTmpl(h,g)},setTmpl:function(h,g){if(!h.content&&!h._renderTd){h.content=h.field?"${"+h.field+"}":""}g.push("<td");f.Helper.addProp(g,h.attr);g.push(">",h.content,"</td>");return this},setHeadHtml:function(j,g,h,l){var k=" style='width:"+(j.op.percentWidth?Jalor.Format.getPixe(g.width):(g._curWidth+"px"))+";'";h.push("<td");f.Helper.addProp(h,g.headAttr);h.push("><div class='igrid-innercell'");h.push(">",g.headHtml,"</div></td>");l.push("<td class='grid-cell ",g._indexCss,"'",k,"><div></div></td>");return this}}};c.Column={};c.Table={};c.Builder={init:function(h,j){var g=[];this.buildToolbar(g,j);this.buildCentent(g,j,h);this.buildButtom(g,j);h.dom.html(g.join(""))},buildToolbar:function(g,h){g.push("<div class='jalor-igrid-top'><div class='jalor-igrid-style'><div class='jalor-igrid-colstyle' /></div></div>")},buildCentent:function(h,j,g){h.push("<div class='jalor-igrid-content'>");if(j.customTable){$.extend(c.Table,c.Common.Table,c.Custom.Table)}else{c.Table=$.extend({},c.Common.Table)}c.Table.init(j,h,g);(!j.percentWidth&&!j.customTable)&&h.push("<div class='igrid-scroller'><div class='igrid-scroller-x'></div></div>");h.push("</div>")},buildButtom:function(g,h){g.push("<div class='jalor-igrid-bottom'></div>")}};var e={setFreeze:function(k,j){if(!k){return}j=!j?false:true;var g=this.op.columns;var h=0;$.each(g,function(l,n){if(k==n.field){h=l}});if(h==0){return}this.op.columns[h].freezeable=j;this.reInit(this.op)},setNoResult:function(g){this.getBodyPanel().find(".grid-no-result").text(g);return this},getHead:function(){return DomClass.getProp(this,this.dom,"head",".jalor-igrid-top")},getContent:function(){return DomClass.getProp(this,this.dom,"content",".jalor-igrid-content")},getBottom:function(){return DomClass.getProp(this,this.dom,"bottom",".jalor-igrid-bottom")},getMiniToolBar:function(){var h=this.op.toolPanel,g=h?$(h):this.getContent();return DomClass.getProp(this,g,"minitoolbar",".igrid-minitoolbar")},getStylePanel:function(){return DomClass.getProp(this,this.getHead(),"pStyle",".jalor-igrid-style")},getColStylePanel:function(){return DomClass.getProp(this,this.getStylePanel(),"colStyle",".jalor-igrid-colstyle")},getHeadPanel:function(){return DomClass.getProp(this,this.getContent(),"phead",".jalor-igrid-head")},getBodyPanel:function(){return DomClass.getProp(this,this.getContent(),"pbody",".jalor-igrid-body")},getHeadTable:function(){return DomClass.getProp(this,this.getHeadPanel().children(),"thead",".jalor-igrid-thead")},getBodyPlace:function(){return DomClass.getProp(this,this.getBodyPanel(),"bodyplace",".jalor-igrid-bodyplace")},getBodyTable:function(){return DomClass.getProp(this,this.getBodyPlace(),"tbody",".jalor-igrid-tbody")},getDataBody:function(){return DomClass.getProp(this,this.getBodyTable(),"dataBody",".igrid-data")},getColSet:function(g){return DomClass.getProp(this,g?this.getHeadTable():this.getBodyTable(),g?"pHColSet":"pColSet",".igrid-colset")},getScroller:function(){return DomClass.getProp(this,this.getContent(),"pScroller",".igrid-scroller")},refreshScroller:function(){if(this.op.allowFreezen||!this.op.percentWidth){var g=this.getScroller(),h=this.getColSet(true);g.children().width(h.outerWidth())}},updateStyle:function(j){if(j){}else{if(!this.op.percentWidth&&this.op.showSeq&&this.op.serialSeq){var g=this.getDataBody().children("tr:last").children("td:first"),h=g.children().width();h>g.width()&&this.setColWidth(g,h+2)}}return this},setColWidth:function(t,j){var g=this,r=g.op,l=g.getColumnOp(t),k;colSet=l.freezeable&&r.allowFreezen?r._fzColSet:r._colSet,widthPanel=g.getColSet(),headWidthPanel=g.getColSet(true);if(r.percentWidth&&!l.inner){var p=g.getBodyTable().width(),n,h,o,s=0,h=5000/p,q=0;j=j/p*100;j<h&&(j=h);n=(parseFloat(l._curWidth)-j)/(r._resizeColNum-1);$.each(r.columns,function(u,v){if(l._i!=v._i&&!v.hidden){o=parseFloat(v._curWidth);if(v.resizable||(!v.inner&&!v.columnType&&v.resizable!==false)){o=o+n;if(n<0){if(o<h){q+=h-o;o=h}else{if(q>0){if(o-q>=h){o+=q;q=0}else{q+=h-o+q;o=h}}}}v._curWidth=o+"%";k="> tr > td."+v._indexCss;g.getColSet().find(k).width(v._curWidth);g.getColSet(true).find(k).width(v._curWidth)}s+=o}});j=(100-s)+"%"}k="> tr > td."+l._indexCss;g.getColSet().find(k).width(j);g.getColSet(true).find(k).width(j);if(!r.percentWidth){colSet.width+=j-l._curWidth}g.op.handler.widthChange&&g.op.handler.widthChange.fire(g,j,l,t);l._curWidth=l.width=j;g.dom.find("td.grid-select span").text("");g.autoWhiteWidth();return g},getColumnIndex:function(g){var h=g.hasClass("grid-cell")?g:g.parents("td:first");return h.length?h.attr("_col")*1:-1},getCellRow:function(g){var h=g;if(g.length){h=(g[0].tagName!="TR")?g.parents("tr:first"):g}!h.length&&this.op._activeEditTr!=null&&(h=this.getRow(this.op._activeEditTr));return h},isNewRow:function(g){return g.hasClass(f.Const.inserted.css)},getRowIndex:function(g){return this.getCellRow(g).attr("_row")*1},getRowNo:function(j){var g=this.getRowData(j),h=this.op.pagerOp.pageInf;if(g._index>-1){return(h.curPage-1)*h.pageSize+g._index}return -1},getRow:function(g){return this.getBodyTable().children().children("tr[_row='"+g+"']:first")},getRowCell:function(h,g){h.jquery||(h=this.getRow(h));return h.find('[_col="'+g+'"]')},getColumnOp:function(g){var h=(typeof(g)=="number")?g:this.getColumnIndex(g);return h>-1?this.op.columns[h]:this.op.columns[0]},getRowData:function(h){var g=(typeof(h)=="number")?h:this.getRowIndex(h);if(g!=null){return this.op.Storage.at(g)}return null},cellData:function(n,k,g){var l=this.getValueField(n.attr("field")),h=Jalor.DataHelper;if(l){var j=this.getRowData(n);if(j){if(k!=null){if($.isPlainObject(k)){g||(g=this.getColumnOp(n));g.field!=l&&h.setObj(g.field,j,h.getObj("text",k));k=h.getObj("value",k)}else{k=this.renderValue(n,g,k)}this.op.Storage.updateItem(j,l,k);return j}else{return h.getObj(l,j)}}}return null},cellValue:function(k,j,r,p,g){if(!k.parent().length&&this.op._activeEditTr!=null){k=this.getRow(this.op._activeEditTr).children("td[_col='"+k.attr("_col")+"']")}var o=j.renderer;if(r==null){return this.renderValue(k,j)}else{if(p){r=this.renderValue(k,j,r);var h=j.mappingRenderField,l=this.getRowData(k),s;if(j.fnEndEdit&&!this.op.fnEndEdit){s=j.fnEndEdit.call(this,r,l,k,j,g)}else{if(!j.fnEndEdit&&this.op.fnEndEdit){s=this.op.fnEndEdit.call(this,r,l,k,j,g)}}if(s!==false){if(s==true){var q=this.getValueField(k.attr("field"));if(Jalor.DataHelper.getObj(q,l)!=($.isPlainObject(r)?r.value:r)){l=this.cellData(k,r,j);this.renderValue(k,j,r,true,l)}this.renderRow(k,l)}else{l=this.cellData(k,r,j);this.renderValue(k,j,r,true,l)}var n=$.type(r)=="date"?r.getUTCTime(8,Jalor.Personalized.global.common.timeZone):r;n!==r&&j.field&&(l[j.field]=n);h&&(l[h]=k.text());j.totalCount&&this.totalColumn();this.clearConnectData(k,j);return l}else{h&&(l[h]=k.text());return false}}}},setTdValue:function(o,p,q){if($.type(p)=="string"){var h=this,n=h.getRow(o);if(n){var k=h.getCellByField(o,p),l=h.getRowData(n),j=h.getColumnOp(k),r=k.attr("valuefield"),g=r?{value:l[r],text:l[p]}:l[p];if(Jalor.UI.IGrid.Editor.compareValue(q,"",j,h,g)){return}if($.isPlainObject(q)){l[r]=q.value;l[p]=q.text}else{l[p]=q}if(h.validRecord(l)!=false){if(h.cellValue(k,j,q,true,g)!==false){if(!h.isNewRow(n)){k.addClass("cell-update");n.hasClass(Jalor.UI.IGrid.Const.updated.css)||n.addClass(Jalor.UI.IGrid.Const.updated.css)}}}}}},renderRow:function(o,l){var k=this.getCellRow(o),j=this.getRowIndex(k),h=this.op.tmpl,n=k.children("td[rowspan]"),g=k.children("td.hide");if(this.op.rowRender!="group"){h=this.op.tmpl.substring(h.indexOf("<td"),h.lastIndexOf("td>")+3)}else{h=this.op.tmpl.substring(h.lastIndexOf("<tr"),h.lastIndexOf("tr>")+3);h=h.substring(h.indexOf("<td"),h.lastIndexOf("td>")+3)}k.html(Jalor.UI.template("<% with(data){ %>"+h+" <% } %>",{data:l},j+1,null,{_grid:this},true));n.each(function(){k.children("td[_col='"+$(this).attr("_col")+"']").attr("rowspan",$(this).attr("rowspan"))});g.each(function(){k.children("td[_col='"+$(this).attr("_col")+"']").addClass("hide")});return this},getFocusRow:function(){var g=this.getRows("tr.grid-row.igrid-actived:first");if(g.length){this.op._hTr=g}return g},setFocusRow:function(g){this.op._hTr&&this.op._hTr.removeClass("igrid-actived");g.addClass("igrid-actived");this.op._hTr=g},getRows:function(g){return this.getBodyTable().children().children(g)},getSelectRows:function(h,g){g="tr.grid-row"+(h?":not(.row-noselect):not(."+f.Const.selected.css+")":"."+f.Const.selected.css)+(g||"");return this.getRows(g)},scrollX:function(p,k,s){var g=this,o=g.op,j=0,r=0;if(k!=null){p.scrollLeft(k);if(s){o._noScroll=true}else{return}}else{k=p.scrollLeft()}if(k>0){var r,n=0,q,h=0,t=p.children().width()-p.width()+20;$.each(o.columns,function(v,u){if(!u.hidden&&!u.freezeable){h+=u._curWidth+o._colSet.fixed;q=u;if(r<k&&r<t){r=h}else{r=h;return false}}})}var l=q?q._curIndex:0;if(o.columnLazyLoad){if(g.scrollLoadColumn(q?q._i:0,t)){g.hideColumn()}else{g.hideColumn(o.columns[o._colLoad.start]._curIndex,l)}}else{g.hideColumn(0,l)}o.handler.scrollX&&o.handler.scrollX.fire(g,l,r);return g},scrollTo:function(l){var h=this,r=this.op,u=l._i;if(r.percentWidth||(r.allowFreezen&&l.freezeable)||r.customTable){return r._hTr?r._hTr.find("[_col='"+u+"']:first"):null}var n=this.getOrderColumns(true),j=0,s=r._fzColSet,o=r._colSet.fixed;$.each(n,function(w,v){if(!v.hidden){if(v._i>u){return false}j+=v._curWidth+o}});var g=h.getContent().width(),q=h.getScroller(),t=q.scrollLeft(),k=j-g;if(k>0){var p=t-g;if(k<p||k>t){h.scrollX(q,k>0?k:0,true)}}else{if(t!=k){h.scrollX(q,0,true)}}return r._hTr?r._hTr.children("td[_col='"+u+"']"):null},getScrollPanelWidth:function(){var g=this,h=this.op;return g.getContent().width()-h._fzColSet.width-(h._fzColSet.count*(h._colSet.fixed))},hideColumn:function(l,g){var h;if(g){var k=[],j="table.igrid-itable ."+this.id+"-col";for(;l<g;l++){k.push(l)}if(k.length){h="<style> "+j+k.join(","+j)+"{"+["padding:0","width:0px","border-width:0","overflow:hidden","word-break:keep-all","white-space:nowrap",""].join(" !important;")+"} "+j+k.join(" div,"+j)+" div {display:none} </style>"}}this.getColStylePanel().html(h||"");return this},hideColumns:function(n,g){var h;if(g){var l=[],k="table.igrid-itable ."+this.id+"-col";for(;n<g;n++){l.push(n)}if(l.length){h="<style> "+k+l.join(","+k)+"{"+["padding:0","width:0px","border-width:0","overflow:hidden","word-break:keep-all","white-space:nowrap",""].join(" !important;")+"} "+k+l.join(" div,"+k)+" div {display:none} </style>"}}var j=this.getHead().find(".jalor-igrid-colstyle-custom");if(j.length){j.html(h||"")}else{$.create("div","jalor-igrid-colstyle-custom").html(h||"").appendTo(this.getStylePanel())}return this},initScrollLoadColumn:function(h){var g=this.getScrollLoadColumns(h);if(g&&g.length){this.buildReloadColumns(g);return true}},scrollLoadColumn:function(h){var g=this.getScrollLoadColumns(h);if(g&&g.length){this.reloadColumn(g);return true}},getScrollLoadColumns:function(w){var r=this.op,v=0,g=0,u=[],h=[],o,p,j,k=r.columns,t=r._colLoad,s=k.length,q=r._fzColSet,n=r._colSet;n.fixed||(n.fixed=5);loadWidth=this.dom.width()-q.width-(q.count*(n.fixed));if(!t||w<t.start){loadWidth*=2;o=true;t||(t=r._colLoad={})}for(var l=w;l<s;l++){j=k[l];if(!j.hidden){if(j.freezeable){v++;h.push(j)}else{p=j._i;g+=j._curWidth+n.fixed;u.push(j);if(g>loadWidth){if(!o&&j._i>=t.end){loadWidth*=2;o=true}else{break}}}}}if(o||j._i>t.end||j._i<t.start){if(w>0&&v<q.count){v=this.getFZColumn(0,w,v,h)}if(v<q.count){this.getFZColumn(l,s,v,h)}r._colLoad={start:w,end:p};return h.concat(u)}},getFZColumn:function(n,g,j,k){var h,l=this.op;for(;n<g;n++){if(j<l._fzColSet.count){h=l.columns[n];if(!h.hidden&&h.freezeable){j++;k.push(h)}}else{return j}}return j},buildReloadColumns:function(h){var g=this,o=this.op,j=c.Column,p=[],q=[],r=[],l=[],k=[],n=[];$.each(h,function(t,s){if(o.allowFreezen&&s.freezeable){j.buildColHtml(g,s,q,l,n)}else{j.buildColHtml(g,s,p,r,k)}});j.buildRow(g,o,p,q);j.buildHead(g,r,l,k,n);g.hideColumn();return g},reloadColumn:function(h){var g=this.op._hTr,j;if(g){j=this.getRowData(g);j._focus=true}this.op._loadType="noScroll";this.buildReloadColumns(h).reload();if(j){delete j._focus;this.op._hTr=this.getFocusRow()}},syncScroll:function(h,g){h!=null&&this.scrollX(this.getScroller(),h);h==0&&this.hideColumn();g!=null&&this.getBodyPanel().scrollTop(g);return this},getPageInf:function(){return this.op.pagerOp.pageInf},reload:function(h,l,j){var k=this.op,g;if(k.ajax){if(typeof(h)=="string"){g=h;j=l;h=l=null}else{h&&(g="search");!g&&l&&(g="request")}}else{l=false}switch(g){case"operation":k.pagerOp.pageInf.totalRows=0;h=l=true;break;case"search":k.pagerOp.pageInf.curPage=1;k.pagerOp.pageInf.totalRows=0;h=l=true;break;case"request":l=true;break;default:this.base.reload.call(this);break}!k._loadType&&(k._loadType=g);if(l){if(!k.handler.beforeLoad||k.handler.beforeLoad.fire(this,k,h)!==false){this.base.request.call(this)}}if(k.sort&&j&&!k.remoteSort&&!k.lazyLoad&&k.rowRender!="tree"){k._isSort=true}return this},reBind:function(g){this.base.reload.call(this,g);return this},search:function(g){var h=this.op;if(g){if(h.ajax.params!=null){g=$.extend(true,{},h.ajax.params,g)}h.ajax.data=g}return this.reload(true)},setValue:function(g,h){if(h||this.op.dataCopy){g=$.extend(true,[],g)}return this.reBind(g)},getValue:function(){var g=["_index","rowIdx","_updFields"];return this.op.Storage.filter({copy:true,fnHandle:function(h){$.each(g,function(k,j){delete h[j]})}})},clearCache:function(){this.op.Storage.clear()},getSelectedRecords:function(g,h){return this.op.Storage.getSelectedRecords(g,h)},getSelectedRecord:function(g,h){var j=this.getSelectedRecords(g,h);return j.length?j[0]:null},disabled:function(g){if(g){this.dom.addClass("disabled");this.op._disabled=true}else{this.dom.removeClass("disabled");delete this.op._disabled}},readonly:function(g){if(g){this.op._readonly=true}else{delete this.op._readonly}},reInit:function(j){var k=Jalor.UI.XControl[this.type].fn,o=$.extend(true,{},this.op),n=this.dom,g=this.op.ajax&&this.op.ajax.data,l=this.op.rowRenderOp&&this.op.rowRenderOp.order,h;this.setOp($.extend(true,{},n.data("defGridOp")));h=this.op;n.empty();DomClass.clear(this);h.pagerOp.pageInf=o.pagerOp.pageInf;if(!$.isEmptyObject(j)){if(!j.switchMode&&o.switchMode){h.switchMode=o.switchMode}if(j._hasColSort){h.sort=o.sort;l&&(h.rowRenderOp.order=l);h.columns=j.columns}else{Jalor.DataHelper.applyChangeData(h,j,j.arrKey||{columns:"field"});this.colsort()}}h.Storage=o.Storage;if(o._treeStorage){h._treeStorage=o._treeStorage;h._treeIniting=true}o._selectTrigger&&(h._selectTrigger=o._selectTrigger);h._ajax=h.ajax;g&&!$.isEmptyObject(g)&&(h._ajax.data=g);h._reIniting=true;k.plugin.fireAll("clear",this,h,o);h.Storage.mergeNewData&&h.Storage.mergeNewData(!h._requesting,h);k.base.initCtr.call(k,this,h);h._reIniting=null},showValidResult:function(p,j,q){j=[].concat(j);var h=$.create("label","error"),k,n,o,g,l=this.getBodyPanel();this.scrollTo(this.getColumnOp(q));q.addClass("igrid-servervalid-error");k=q.position();n=q.outerHeight();h.width(q.outerWidth()-20).text(j.join("\n")).appendTo(l);o=h.outerHeight();if(k.top+n+o>=l.height()){n=-o}g={top:k.top+l.scrollTop()+n,left:k.left+l.scrollLeft()};h.css(g);h.delay(3500).hide(500,function(){q.removeClass("igrid-servervalid-error");h.remove()})},getCellByField:function(j,k){var g=this,l=g.getRow(j),n=l.find('[field="'+k+'"]'),h;if(!n.length){l.find('[valueField="'+k+'"]').each(function(){n=$(this);if(g.getColumnOp(n).editable!==false){return false}})}return n},getEditRow:function(g){var h=g.data("caller");return this.getCellRow(h)},setScrollSize:function(j){var l=this.op,h=l._scrollOp,g=Math.ceil(j/l.rowHeight),k=h.pageSize;while(k<=g){k+=h.pageSize}return k},getOrderColumns:function(g){var k=[],h=[],j=this.op;$.each(j.columns,function(n,l){if(!g&&(l.inner||l.columnType||l.hidden)){return}(j.allowFreezen&&l.freezeable?k:h).push(l)});return k.concat(h)},resize:function(){this.hideToolBar();c.fixScrollToFullScreen(this);this.op.percentWidth&&f.Editor.fixActive(this)},changeResizeTip:function(k){k=k||this;var p=k.op;if(!p.percentWidth){var j=p.columns,l=0,o=k.getScroller();for(var h=0,g;g=j[h];h++){if(!g.inner){colWidth=g._curWidth;(l<colWidth)&&(l=colWidth)}}var n=k.getScrollPanelWidth();if(l+p._colSet.fixed>n){Jalor.UI.topBox("jalor.common.igrid.resizeMsg",false,false,null,3000)}if(o.width()>=o.children().width()){k.hideColumn()}}},setSortSetting:function(g,h){var j=this.op;j._sortSetting={sort:g||Jalor.DataHelper.getObj("rowRenderOp.order",j),isRemoteSort:(h!=null?h:j.remoteSort)}},clearSortSetting:function(){this.op._sortSetting=null},getValueField:function(g){if(typeof g=="string"){g=this.op._columnMap[g]}return g?(g.valueField||g.field):""},totalColumn:function(){var j=this,g=[],k={};$.each(j.op.columns,function(p,o){if(o.hidden){return}if(o.totalCount){var n=o.valueField||o.field;g.push(n);k[n]=0}});if(g.length){j.getBodyTable().children("tfoot").remove();var h=$('<tr class="grid-row row-noselect"></tr>').appendTo($("<tfoot></tfoot>").appendTo(j.getBodyTable()));var l=j.getAllRecords();$.each(l,function(n,o){$.each(g,function(q,t){try{var s=Jalor.DataHelper.getObj(t,o);if(typeof s=="string"){var p=s.match("-?\\d+(\\.\\d+)*");if(!p){s=0}else{s=p[0]}}if(typeof s=="string"&&/^\d+$/.test(s)){k[t]+=parseFloat(s)}else{if(typeof s=="number"){k[t]+=s}}}catch(r){}})});$.each(j.op.columns,function(o,n){if(n.hidden){return}var r=$("<td></td>").addClass(n.attr["class"].replace(/\${.*}/g,"")),q=n.valueField||n.field;if(k[q]!==undefined){if(n.format){var p=n.format.fraction;if(p==void 0){if("number"==n.type||"currency"==n.type||"currencystr"==n.type){p=Jalor.Config.Format.decimalfraction}else{p=0}}k[q]=parseFloat(k[q]).toFixed(p)}r.text(k[q])}else{if(n._ctype=="Seq"&&j.op.totalText){r.text($i18n(j.op.totalText))}}h.append(r)})}},clearConnectData:function(l,g){var j=typeof l=="number"?l:this.getCellRow(l).attr("_row")*1;var k=this.op._connectMap,h=this;if(g.editorOp&&g.editorOp.id&&k[g.editorOp.id]&&k[g.editorOp.id].child){$.each(k[g.editorOp.id].child,function(o,p){var n=h.getCellByField(j,p.field);var q=h.getRowData(j);q[p.valueField||p.field]="";q[p.displayField||p.field]="";n.text("");p._editCtr&&p._editCtr.hasClass("jalor-dropdown")&&p._editCtr.data("old-val",{value:"",text:""});h.clearConnectData(j,p)})}},autoWhiteWidth:function(){if(this.op.columnLazyLoad||this.op.percentWidth||this.op.autoWhiteWidth!==true||this.dom.is(":hidden")){return}var g=this,o=g.op,p=g.getBodyPanel(),n=p[0].scrollHeight>p.height();if(n===o._isHasScroll){return}o._isHasScroll=n;var A=p.width(),z=g.getScroller(),B=z.width(),h=z.children().width(),r=A-h,l=g.getHeadTable().children("tbody.igrid-colset").find("td:last"),x=g.getBodyTable().children(".igrid-colset:first").find("td:last"),j=h-A,w=0,s=false,u,v=0,k=h-B+20;$.each(o.columns,function(D,C){if(!C.hidden&&!C.freezeable){u=C;if(s){return}if(w<j&&w<k){v+=C._curWidth+o._colSet.fixed;w=v}else{s=true}}});var q=u.width+"";if(q.indexOf("px")>-1){q=q.substring(0,q.length-2)}q*=1;if(r>=0){n&&(r=r-17);l.width(q+r);x.width(q+r);return}var t=o._colSet.width-v+o._fzColSet.width+(o._colSet.count+o._fzColSet.count)*o._colSet.fixed;var y=q+A-t;n&&(y=y-17);l.width(y);x.width(y)}};var b={preInit:function(g,h){h.showSeq&&h.columns.unshift({header:h.seqHeader,inner:true,width:h.seqWidth||(h.percentWidth?"3%":30),_module:"igrid-seq",_ctype:"Seq",headCss:"grid-seq",cssName:"grid-seq",content:"<span>${# data._seq || index}</span>",freezeable:h.allowFreezen});c.initHandler(h).initStyle(g,h).initColumnMap(g,h);c.initConnectMap(g,h);if(!h._reIniting){h.rowCodeBegin.push("_rowNo++;");h.rowCodeEnd.push("data._index = _rowNo;")}h.handler.afterBindData.add(function(j,k){j.autoWhiteWidth()})},init:function(g,h){h.handler.beforeBindData.add(function(o,r,q,p){if(r._isSort){delete r._isSort;var k=r.sort.split(" "),l=k[0],n=k[1],j=o.getHeadTable().find("td[field='"+l+"']");if(!r.fnSort||r.fnSort.call(o,l,n,j)!==false){!r._loadType&&(r._loadType="sort");r.Storage.sort(l,n)}}})},build:function(g,h){c.Builder.init(g,h);if(h.customTable){h.allowResize=h.allowFreezen=h.showColumnIcon=false;$.extend(c.Column,c.Common.Column,c.Custom.Column)}else{c.Column=$.extend({},c.Common.Column)}},bindEvent:function(g,h){c.Column.init(g,h);c.EventBinder.init(g,h)},initComplete:function(g,h){g.dom.addClass("jalor-resize");if(h.sort&&!h.remoteSort){h._isSort=true}},initAjax:function(g,k,h){var j=h.setAjax;h.setAjax=function(o){if(!j||j(o)!==false){var l=o.url,n;if(l){if(l.indexOf("{0}")>0){o.url=l.formatText(k.pagerOp.pageInf.pageSize,k.pagerOp.pageInf.curPage,k.pagerOp.pageInf.totalRows)}else{n=c.parseSortSetting(g,k);k.pagerOp.pageInf.orderBy=n||"default";k.pagerOp.pageInf.filter=k.pagerOp.pageInf.filter||encodeURIComponent("[]");o.url=l.formatField(k.pagerOp.pageInf)}}}};h.error=function(){k._errorRet=true;g.reBind([])}},preBindData:function(h,n,k,j){if(n._errorRet){delete n._errorRet;return}if(j){if(k.length||j.curPage==1){n.pagerOp.pageInf=j}else{if(n.pagerOp.noTotalRows){Jalor.UI.showMessage("jalor.common.igrid.noDatas")}else{if(j.curPage!=0){n.pagerOp.pageInf.curPage=j.totalPages;h.reload("operation",true);n._reload=true;return false}}}}if(n.pagerOp.pageInf&&n.pagerOp.pageInf.filterStr){n.pagerOp.pageInf.filter=n.pagerOp.pageInf.filterStr.encodeURI()}else{n.pagerOp.pageInf.filter="[]".encodeURI()}var l=n.pagerOp.pageInf,g=n.columns;n.startIndex=n.serialSeq?(l.curPage-1)*l.pageSize+1:1;l.totalRows==0&&n.Storage.len()&&(l.totalRows=n.Storage.len());if(g&&k&&!n._staticSort){$.each(k,function(p,o){n.handler.dataHandler.fire(o,h,n,k)})}delete n._staticSort},bindData:function(g,k,j){if(!k._reload){j=j||[];g.getHeadTable().find(".igrid-head .grid-select")[!j.length?"addClass":"removeClass"]("grid-selected-disabled");k.lastIndex=k.startIndex+j.length-1;var h=Jalor.UI.tmplList(k.tmpl,j,null,k.startIndex,null,{_rowNo:-1,_grid:g},true);g.getDataBody().html(h)}},bindDataComplete:function(g,h){if(h._reload){h._reload=null}else{g.totalColumn();if(h.fnRenderRow){g.getDataBody().children("tr.grid-row").each(function(j){var l=$(this),k=h.Storage.at(j);h.fnRenderRow&&h.fnRenderRow.call(g,l,k,j)})}if(h.autoScroll){if(!h._loadType||(h._loadType!="noScroll"&&h._loadType!="sort")){g.syncScroll(0,0)}h._loadType=null}h._prevSelCount=g.getRows(":not(.row-noselect):not(.grid-row-group)").length-1;h._prevSelCount&&g.setSelectHeader(true);g.updateStyle()}},complete:function(g,h){}};var a=Jalor.UI.XControl("XGrid",b,d,e,"Table");$.fn.igrid=function(j,g){g&&(j.dataset=g);var h=new a(this,j);return this}})(Jalor.UI.IGrid);(function(f,d){var e=f.Const.I18n.innerCol={colHeader:"jalor.common.label.operation"};Jalor.UI.XControl.extendIManager("XGrid",{unselectAllRow:function(){var g=this,h=g.getHeadTable().find("."+f.Const.selected.css);(h.length>0)&&h.removeClass(f.Const.selected.css,false);g.getSelectRows(false).each(function(j){c.rowSelected($(this),false,g)})},setSelectHeader:function(j){var h=this.getHeadTable().find(".igrid-selectAll"),k,g;if(h.length){k=h.parent();g=k.hasClass(d.selected.css);if(j&&this.getSelectRows().length==this.op._prevSelCount){!g&&k.addClass(d.selected.css);return false}g&&k.removeClass(d.selected.css,false)}},setGroupHeader:function(l,j){if(event.target){var g=event.target.tagName.toLowerCase()=="tr"?$(event.target):$(event.target).parents("tr:first");if(g[0]!=l[0]){return}}if(j){var h=l.next("tr");while(j&&h.length>0&&!h.hasClass("grid-row-group")){j=h.hasClass(d.selected.css);if(!j){break}h=h.next("tr")}var k=l.prev("tr");while(j&&k.length>0&&!k.hasClass("grid-row-group")){j=k.hasClass(d.selected.css);if(!j){break}k=k.prev("tr")}j&&l.prevAll("tr.grid-row-group:first").addClass(d.selected.css)}else{l.prevAll("tr.grid-row-group:first").removeClass(d.selected.css)}},selectRow:function(j,h){var g=this,h=h?true:false;j.each(function(){c.rowSelected($(this),h,g)})}});f.innerColumn=$.IAdapter();var c=f.innerColumn.gridSelect={selected:function(l,g,h){var k=g.parent(),j;k.hasClass("grid-cell-custom")&&(k=k.parent());j=!k.hasClass(d.selected.css);if(g.hasClass("igrid-multi")){c.multiSelected(l,k,j,h)}else{if(g.hasClass("igrid-selectAll")){c.allSelected(l,k,j,h)}else{c.singlerSelected(l,k,j,h)}}},singlerSelected:function(k,j,h,g){if(!j.hasClass(d.selected.css)){var l=j.parent().children("tr."+d.selected.css);if(l.length){this.rowSelected(l,0,g)}else{$.each(g.getSelectedRecords(),function(n,o){delete o._selected})}}this.rowSelected(j,h,g)},allSelected:function(k,j,h,g){if(g.getAllRecords().length==0){return}j.toggleClass(d.selected.css,h);g.getSelectRows(h).each(function(l){c.rowSelected($(this),h,g,k,true)});if(g.op.fnSelectedAll&&typeof g.op.fnSelectedAll==="function"){g.op.fnSelectedAll.call(this,h,g)}},multiSelected:function(n,l,j,h){this.rowSelected(l,j,h,n);if(n.shiftKey&&h.op.shiftSelectMode!==false){var g=h.getRowIndex(l);if(h.op._shiftStart!=null){var k=h.op._shiftStart<g;while((k&&g>h.op._shiftStart)||(!k&&g<h.op._shiftStart)){if(l.hasClass(d.selected.css)!=h.op._shiftChecked){c.rowSelected(l,h.op._shiftChecked,h,n)}l=k?l.prev():l.next();g=h.getRowIndex(l)}this.setShiftSelect(h.op,null,null)}else{this.setShiftSelect(h.op,g,j)}}else{this.setShiftSelect(h.op,null,null)}},setShiftSelect:function(j,g,h){j._shiftStart=g;j._shiftChecked=h},rowSelected:function(l,h,g,n,o){var p=g.op,k=g.getRowData(l),j=g.getRowIndex(l);if(!p.fnBeforeRowSelect||p.fnBeforeRowSelect.call(g,k,l,j,n)!==false){p.Storage.setItemSelected(k,h,l,o);p.fnSelected&&p.fnSelected.call(g,h,l,k,n)}}};f.innerColumn.add("select",function(h,g){var j=g.checkRender;g._module="igrid-select";if(g.multi){g._ctype="mulitSelect";g.headENo="rowSelect";g._headCss="grid-select igrid-selectAll";g.cssName="igrid-multi"}else{g._ctype="singleSelect";g.cssName="igrid-single"}if(j){g.cssName=g.cssName+"<% if("+j+") { %> grid-select<% } %>";g.eNo="<% if("+j+") { %>rowSelect<% } %>";h.op.rowClass.push("${"+j+" ? '' : 'row-noselect'}")}else{g.cssName+=" grid-select";g.eNo="rowSelect"}if(g.field){g.valueField=g.field;g.field=null}var k=h.op;g.content="<span/>";g.width=g.width||(k.percentWidth?"5%":35);g.freezeable==null&&(g.freezeable=k.allowFreezen);k.handler.click.add("rowSelect",c.selected);k.selectMode=g._ctype;k.selectField=g.valueField});f.innerColumn.add("operate",function(g,j){j._module="igrid-icon";if(!j.header){j.header=e.colHeader}if(!j.cssName){j.cssName="center"}if(j.btns&&j.btns.length){var l=[];if(j.field){j.valueField=j.field;j.field=null}for(var k=0,n=j.btns.length;k<n;k++){var h=j.btns[k],r="",p="",o=h.field||j.valueField;if(typeof(h.click)=="string"){r=h.click}else{var q=$.newGuid("operate");p='eno="'+q+'"';a(g.op,q,h.click)}o&&(p+=' val="${'+o+'}"');if(h.isShow!==false){l.push(!h.isShow?"<% if(!data._inserted) { %>":"",Jalor.UI.button(h.text,r,h.permission,h.type||"link",h.imgtype,h.isIi8n,p),!h.isShow?"<% } %>":"")}}j.content=l.join("")}});function a(j,h,g){j.handler.click.add(h,function(o,l,k){var n=f.Helper.attrValue(l);if(n==null){n=k.getRowData(l)}g.call(l,n,k)})}var b={init:function(h,g,k){if(g.columnType){var j=f.innerColumn.get(g.columnType);if(j){g.inner=true;j(h,g)}}}};Jalor.UI.XControl.addPlugin("XGrid","innerColumn",{preInit:function(h,j){if(j.columns){j.handler.setColumn.add(b.init)}if(j.clickRow2Check===true){var g;j.onCellClick&&(g=j.onCellClick);j.onCellClick=function(o,n,q,r,u,s,l,k,p){if(!r.parent().hasClass("igrid-head")){var t;if(j.rowRender=="tree"){if(p&&!$(p.target).hasClass("tree-icon")){t=r.find(".tree-chk:first");f.tree.nodeSelect(null,t,k)}}else{if(!q.hasClass("grid-select")){t=r.children(".grid-select");c.selected({},t,k)}}}g&&g.call(k,o,n,q,r,u,s,l,k,p)}}},build:function(g,h){h._selectTrigger&&h.Storage.Trigger.select.remove(h._selectTrigger);h._selectTrigger=function(k,j,l,n){l&&l.toggleClass(d.selected.css,j);h.rowRender=="group"&&l&&!l.hasClass("grid-row-group")&&g.setGroupHeader(l,j);n!==true&&g.setSelectHeader(j)};h.Storage.Trigger.select.add(h._selectTrigger)},clear:function(g,h){h.showSeq&&h.columns&&h.columns.shift()}})})(Jalor.UI.IGrid,Jalor.UI.IGrid.Const);(function(b){var a={build:function(d,f){var c={css:"jalor-igrid-minitoolbar igrid-minitoolbar",hasItemDiv:false,items:[]};Jalor.UI.XControl[d.type].fn.plugin.fireAll("miniToolBar",d,f,c.items);if(c.items.length>0){if(!f.toolPanel){$.create("div").jalorToolbar(c).appendTo(d.getContent());a.mouseInOut(d,f)}else{var e=$(f.toolPanel);if(!e.children(".igrid-minitoolbar").length){c.css="igrid-minitoolbar";$.create("div").css("float","right").jalorToolbar(c).after("<div class='clear'></div>").appendTo(e)}}}},mouseInOut:function(e,h){var g,d,f=function(j,k){return setTimeout(function(){j.showToolBar();g=null},300)},c=function(j,k){return setTimeout(function(){j.hideToolBar();d=null},5000)};e.getContent().bind("mouseover",function(j){if(d){clearTimeout(d);d=null}if(!h._showTool){g||(g=f(e,$(this)))}}).bind("mouseleave",function(j){if(g){clearTimeout(g);g=null}if(h._showTool){d||(d=c(e,$(this)))}})}};Jalor.UI.XControl.addPlugin("XGrid","miniToolBar",{build:function(c,d){d.handler.complete.add(a.build)},clear:function(c,e){delete e._showTool;if(e.toolPanel){var d=$(e.toolPanel).children(".igrid-minitoolbar");d.next().remove();d.remove()}}});Jalor.UI.XControl.extendIManager("XGrid",{showToolBar:function(){var g=this.op;if(!g.toolPanel){var c=this.getContent(),e=this.getMiniToolBar(),f=0-e.outerHeight()-5,d=g.fullPanel&&$(g.fullPanel);if(d&&d.hasClass("jalor-fullscreen-full")&&!this.dom.prev().length){f=0}if(e.width()>10){e.css({top:f,right:0}).fadeIn(100);g._showTool=true}}},hideToolBar:function(){if(!this.op.toolPanel){this.getMiniToolBar().fadeOut(500);this.op._showTool=false}}})})(Jalor.UI.IGrid);(function(b){var a={build:function(d,e){var c=e.Storage.Trigger;c.insert.add(function(f){f._newIndex&&a.updateStatus(d,e,"inserted")});c.update.add(function(){a.updateStatus(d,e,"updated")});c.remove.add(function(){a.updateStatus(d,e)});e.Storage.insertStorage&&e.Storage.insertStorage.Trigger.destroy.add(function(f){f._inserted&&a.updateStatus(d,e)})},bindEvent:function(c,d){c.getMiniToolBar().delegate(".igrid-status","click",function(){a.openPopup(c,d,$(this).attr("name"))})},buildTab:function(d,c){c.tab=$.create("div","igrid-status-tab");var f=[];for(var e in d._showStatus){f.push('<div title="{0}" tabid="{1}"></div>'.formatValue($i18n("jalor.common.igrid."+e+"status"),e))}c.popDiv.append(c.tab.append(f.join("")))},buildToolBar:function(g,f,e){e.toolbar=$.create("div",null,"igrid-status-toolbar");var d=[],c=g.op.operation;if(c){d.push({type:"html",htmlContent:"<input type='button' id='igrid-status-focus' class='igrid-status-focus'/>"});c.del&&c.del.btn&&d.push({type:"imgBtn",icon:"pre-del",text:"jalor.common.button.gridDelete",attr:{id:"igrid-status-delBtn"}});c.del&&c.del.undoBtn&&d.push({type:"imgBtn",icon:"undel",text:"jalor.common.button.gridUndoDelete",attr:{id:"igrid-status-undoDelBtn"}});c.save&&c.save.btn&&d.push({type:"imgBtn",icon:"save",text:"jalor.common.button.gridSave",click:function(){a.inputFocus();setTimeout(function(){a.closePopup(g,e.newGrid.manager(),f);$(c.save.btn).click()},400)}});d.push({type:"imgBtn",icon:"back",css:"default",text:"jalor.common.igrid.statusback",click:function(){a.inputFocus();setTimeout(function(){a.closePopup(g,e.newGrid.manager(),f)},400)}})}d.push({type:"img",icon:"dialog-close",css:"igrid-status-close",text:"jalor.common.igrid.statusback",click:function(){$("#igrid-status-focus").click();setTimeout(function(){a.closePopup(g,e.newGrid.manager(),f)},400)}});e.toolbar.jalorToolbar({items:d,hasItemDiv:false,fnComplete:function(){e.popDiv.append(e.toolbar);c&&c.del&&(f.operation={del:{btn:"#igrid-status-delBtn",undoBtn:"#igrid-status-undoDelBtn"}})}})},buildGrid:function(g,f,e,d){var c=g.dom.id()+"-status";d.newGrid=$.create("div",null,c);d.popDiv.append(d.newGrid);f.fnInitComplete=function(){setTimeout(function(){d.tab.jalorTab({defaultItemId:e,fnBeforeSelectItem:function(){var h=d.newGrid.manager();h.valid();h.clearActiveEditor()},fnAfterSelectItem:function(j){var k=f._showStatus[j].getRecord(g),h=d.newGrid.manager();h.setValue(k,false);if(j=="error"&&k.length&&g.op._errorMsg){a.showErrorMsg(h,k,g.op._errorMsg)}}})},10)}},buildPopup:function(c,j,e){var k={popDiv:c.getBottom().children(".jalor-igrid-status")};if(k.popDiv.length<1){k.popDiv=$.create("div","jalor-igrid-status");a.buildTab(j,k);a.buildToolBar(c,j,k);a.buildGrid(c,j,e,k);k.overlay=$.create("div","jalor-igrid-overlay");var f=$(".jalor-dialog.jalor-popup:last");if(f.length){var l=f.css("z-index")*1;k.overlay.css("z-index",l+10);k.popDiv.css("z-index",l+20)}c.getBottom().append(k.overlay).append(k.popDiv);k.newGrid.igrid(j);c.op._initStatusBar=false}else{c.op._initStatusBar=true}var h=c.dom.width(),d=c.dom.height();k.popDiv.width(h);var g=$("#"+c.id+"-status");g.width(h);$(".jalor-igrid-body",g).css({height:d-42,"min-height":"","max-height":""});$(".jalor-igrid-overlay").show();c.op._initStatusBar&&$(c.dom).find(".igrid-status-tab").manager().selectItem(e);return k.popDiv},openPopup:function(g,k,c){g.clearActiveEditor();g.op.Storage.mergeNewData(!k._requesting,k);var d=$.extend(true,{},g.dom.data("defGridOp"));a.changeOp(g,d);var h=a.buildPopup(g,d,c);var j=g.dom,f=j.parent();if(f.hasClass("jalor-grid")){j=f}var e;$(g.op.fullPanel).hasClass("jalor-fullscreen-full")&&(e={left:"0px",top:"0px"});Jalor.UI.popup(j,h,e)},showErrorMsg:function(g,e,f){var c,d;$.each(e,function(k,h){c=h._errorNo&&f[h._errorNo];if(c){for(var j in c){if(j!="length"&&c[j]){d=g.getCellByField(h._index,j);d.addClass("grid-tip igrid-servervalid-error").attr("tip",c[j])}}}})},changeOp:function(d,c){a.changeShowStatus(c);if(c.operation&&c.operation.del){c._operation=$.extend(true,{},c.operation)}$.extend(c,{showStatus:false,customSetting:false,colsort:false,toolPanel:null,fullPanel:null,showPager:false,rowCodeBegin:[],rowCodeEnd:[],autoLoad:false,allowResize:false,allowSort:false,showTip:true,operation:null,rowRender:null,rowRenderOp:null,allowFilter:false,fnComplete:function(){if(d.op._cache){this.op.Storage.Cache.Caches=d.op.Storage.Cache.Caches}}});if(c.showSeq&&c.columns&&c.columns[0]._ctype=="Seq"){c.columns.shift()}if(c._operation&&c._operation.del){c.operation={del:{btn:"#igrid-status-delBtn",undoBtn:"#igrid-status-undoDelBtn"}}}var e=c.fnEndEdit;c.fnEndEdit=function(j,h,k,g,f){a.fnEndEditSetting(j,h,k,g,f,d,e)};c._popDom={}},changeShowStatus:function(g){if(g.showStatus==true){g._showStatus=Jalor.UI.IGrid.statusItems}else{if($.isArray(g.showStatus)){var c={};for(var d=0,f;f=g.showStatus[d];d++){if(typeof f=="string"){var e=Jalor.UI.IGrid.statusItems[f];e&&(c[f]=e)}else{c[f.name]={getRecord:f.getRecord,link:f.link}}}g._showStatus=c}}return g},closePopup:function(d,c,e){d.reload(null,d.op._cache,true);setTimeout(function(){c.setValue([],false);$(".jalor-igrid-status, .jalor-igrid-overlay").hide()},50)},updateStatus:function(g,j,d){var h,c,f;for(var e in j._showStatus){h=d?j._showStatus[d]:j._showStatus[e];f=d?g.getStatus(d):g.getStatus(e);if(h&&f.length){c=h.getRecord(g);a.updateStatusItem(f,c);a.updateLinkStatus(g,j,h.link)}if(d){break}}},updateStatusItem:function(d,c){if(c.length>0){d.text(c.length).addClass("show")}else{d.removeClass("show")}},updateLinkStatus:function(d,g,f){var e,c;f&&$.each(f,function(h,j){e=g._showStatus[j];c=d.getStatus(j);e&&a.updateStatusItem(c,e.getRecord(d))})},inputFocus:function(){$("#igrid-status-focus").click()},fnEndEditSetting:function(l,j,h,g,f,e,d){var k=e.op._errorMsg,c=j&&j._errorNo&&k[j._errorNo];if(c&&l!=f&&c[g.field]){c.lenght--;c[g.field]=null;h.removeClass("grid-tip igrid-servervalid-error").removeAttr("tip");if(!c.lenght){k[j._errorNo]=null;j._errorNo=null}}d&&d.call(this,l,j,h,g,f)}};Jalor.UI.XControl.addPlugin("XGrid","statusBar",{miniToolBar:function(e,g,c){if(g.showStatus){a.changeShowStatus(g);!g._reIniting&&a.build(e,g);for(var d in g._showStatus){c.push({type:"html",htmlContent:"<span class='igrid-status {0}' name='{1}' title='{2}'>0</span>".formatValue(d,d,$i18n("jalor.common.igrid."+d+"status"))})}var f=g.fnEndEdit;g.fnEndEdit=function(l,k,n,j,h){a.fnEndEditSetting(l,k,n,j,h,e,f)};g.handler.complete.add(function(){a.bindEvent(e,g);a.updateStatus(e,g)});g.handler.afterBindData.add(function(h,j){a.updateStatus(h,j)})}}});Jalor.UI.XControl.extendIManager("XGrid",{getStatus:function(c){return this.getMiniToolBar().children(".igrid-status."+c)},updateStatus:function(c){return a.updateStatus(this,this.op,c)},popupStatus:function(c){return a.openPopup(this,this.op,c)}})})(Jalor.UI.IGrid);Jalor.UI.IGrid.statusItems={inserted:{getRecord:function(a){return a.getInsertedRecords()}},deleted:{getRecord:function(a){return(a.getDeletedRecords()).concat(a.op.Storage.getPreDeletedRecords())},link:["inserted","updated"]},updated:{getRecord:function(a){return a.getUpdatedRecords()}},error:{getRecord:function(a){return a.getErrorRecords()}}};(function(g,e){var f=e.I18n.operation={selectMsg:"jalor.common.message.selectedRecords",confirmMsg:"jalor.common.message.confdel",noSelectMsg:"jalor.common.message.selectedRecords",clearCacheMsg:"jalor.common.message.clearCache",successMsg:"jalor.common.message.success"};Jalor.UI.XControl.addPlugin("XGrid","operation",{build:function(h,j){if(j.operation){$.each(j.operation,function(k,l){g.Operation.bind(h,j,k,l)});if(!j._reIniting&&j.showNewRow&&j.operation.insert){j.handler.complete.add(function(k,l){g.Operation.get("insert").operate(k,l,l.operation.insert)})}}},clear:function(h,j){if(j.operation){$.each(j.operation,function(k,l){g.Operation.clear(h,j,l)})}}});Jalor.UI.XControl.extendIManager("XGrid",{getInsertedRecords:function(h,j){return this.op.Storage.getInsertedRecords(h,j)},getDeletedRecords:function(h,j){return this.op.Storage.getDeletedRecords(h,j)},getErrorRecords:function(){var h=function(j){return j._errorNo?true:false};return this.op._cache?this.getInsertedRecords(h):this.op.Storage.filter(h)},appendRow:function(k,o){this.op.operation||(this.op.operation={});this.op.operation.insert||(this.op.operation.insert={});var l=this,j=l.getFocusRow(),n,h,p=l.op.operation.insert.defaultRow&&l.op.operation.insert.defaultRow.data;$.each(k,function(q,r){h=p?$.extend(true,{},p,r):$.extend(true,{},r);n=o||(j.length?{posTr:j}:{});b.insert(l,l.op,h,n,true)})},save:function(l,h){var j=this,k=l.success;fnError=l.error;l.success=function(n){if(!k||k(n)!==false){h&&Jalor.UI.topBox(f.successMsg);l.data=null;j.clearCache();j.reload("operation",true)}};l.error=function(s,q,p,n){if((!fnError||fnError(s,q,p,n)==false)&&p&&p.substring(0,1)=="{"){var o=Jalor.DataHelper.toJson(p);if(o!=null&&o.code==="huawei.jalor5.validator.00010001"){var r=Jalor.DataHelper.toJson(o.message);if(r.fieldErrors&&j.op.showStatus){c.checkErrorMsg(j,r.fieldErrors);j.updateStatus("error");if(j.op.popupStatus){j.popupStatus("error")}}return true}else{j.op.showStatus&&j.updateStatus("error")}}};Jalor.doPut(l)},deleteRow:function(n,r){this.endEdit();var j=this.op,k=j.Storage,q=$.isPlainObject(n)?true:false,h=q?n:this.getRowData(n),o=h._newIndex||h._index,p=q?this.getRow(o):n,l;if(h._inserted){if(o<0){k.insertStorage.destroyItem(o,p);this.op._prevSelCount-=p.length}else{j._cache&&k.Cache.insertCache.cache(h,true,o);l=true}}else{if(r){if(typeof(r)=="function"){r(h,p,this)}else{if(r=="remove"){l=true}}}else{a.sendDeleteRequest(this,h)}}if(l){k.destroyItem(o);j._loadType="noScroll";this.reload(null,null,true)}else{if(!this.getAllRecords().length){this.getHeadTable().find(".igrid-head tr").removeClass("igrid-selected");this.getHeadTable().find(".igrid-head .grid-select").addClass("grid-selected-disabled")}}this.totalColumn();this.autoWhiteWidth()},deleteRows:function(q,t){this.endEdit();var h=this,l=this.op,n=l.Storage,s=$.isPlainObject(q[0])?true:false,j=[],k,r,p,o;$.each(q,function(u,v){r=s?false:$(v);k=s?v:h.getRowData(r);if(a.delInsertRow(h,n,k,r)){p=true}!k._inserted&&j.push(k)});if(t){if(typeof(t)=="function"){t(q,h)}else{if(t=="remove"){o=true}}}else{if(j.length>0){a.sendDeleteRequest(h,j)}else{o=true}}if(o&&p){n.destroy(function(u){return u?u._destroy:this.ReturnValue.complete});l._loadType="noScroll";h.reload(null,null,true)}else{if(!h.getAllRecords().length){h.getHeadTable().find(".igrid-head tr").removeClass("igrid-selected");h.getHeadTable().find(".igrid-head .grid-select").addClass("grid-selected-disabled")}}h.totalColumn();h.autoWhiteWidth()}});g.Operation=$.IAdapter({bind:function(j,l,k){if(k.btn){var h=this.operate;$(k.btn).unbind("click").click(function(n){!l._disabled&&h(j,l,k)})}},operate:function(h,k,j){}},{bind:function(k,n,j,l){var h=this.get(j);h&&h.bind(k,n,l)},clear:function(h,k,j){j.btn&&$(j.btn).unbind("click");j.undoBtn&&$(j.undoBtn).unbind("click")}});var d={setParam:function(n,l){var k;if(l.panel){var j=$(l.panel);if(!j.valid()){return false}k=j.jsonData()}else{k={}}if(n.ajax&&n.ajax.params!=null){var h=n.ajax.params;if(h&&typeof h=="function"){h=h()}k=$.extend(true,{},h,k)}if(n.ajax){n.ajax.data=k}}};g.Operation.add("search",{bind:function(h,k,j){if(k.showSwitch&&k.allowFilter&&k.genSearchByFilter){return}if((!k.showSwitch&&!k.allowFilter)||k.switchMode=="search"){j.panel&&$(j.panel).show();this.proxy(this.base.bind,h,k,j);j.autoSearch!==false&&d.setParam(k,j)}else{if(j.panel){$(j.panel).jalorReset().hide()}}},operate:function(h,l,k){if(d.setParam(l,k)!==false){var j=l.Storage;if(j&&j.cacheData&&j.Cache.count()){Jalor.UI.confirm(f.clearCacheMsg,function(n){if(n){h.clearCache();h.reload(true,true,true)}})}else{h.reload(true,true,true)}}}});var a=g.Operation.del={remove:function(j,q,t,n){if(t.ajax){a.ajaxDel(j,q,t)}else{var s,l=j.getSelectedRecords();if(l.length>0){if(t.undoBtn){s=n?false:true}var k=j.getSelectRows(false),u,p,r,h=j.getHeadTable().find("."+e.selected.css);(h.length>0)&&h.removeClass(e.selected.css,false);for(var o=k.length-1;o>-1;o--){u=$(k[o]);p=j.getRowData(u);if(!t.fnBeforeDelete||t.fnBeforeDelete.call(j,p,t,u,s)!==false){a.delRow(u,s,j)}}}else{Jalor.UI.showMessage(f.selectMsg,"warn")}}},delRow:function(k,j,h){h.op.Storage.removeItem(h.getRowData(k),j,k);if(h.op._activeEditTr!=null&&h.getRowIndex(k)==h.op._activeEditTr){h.clearActiveEditor()}},delInsertRow:function(h,n,k,l){var j=k._newIndex||k._index;if(j<0){n.insertStorage.destroyItem(j,l||h.getRow(j));h.op._prevSelCount-=1;return false}else{k._destroy=true;h.op._cache&&n.Cache.insertCache.cache(k,true,j);return true}},initAjax:function(h,j){if(!j.ajax){j.ajax={url:j.url};delete j.url}j.msg||(j.msg={});j.msg=$.extend({confirm:f.confirmMsg,noSelected:f.noSelectMsg},j.msg);Jalor.UI.ajax.setFnSuccess(j.ajax,function(){h.reload("operation",true)})},ajaxDel:function(j,n,l){var h=j.getSelectedRecords(),k;if(h.length>0){Jalor.UI.confirm(l.msg.confirm,function(o){l.fnConfirm&&l.fnConfirm.call(j,o);if(o){(j.op._activeEditTr!=null)&&j.clearActiveEditor();j.deleteRows(h)}})}else{Jalor.UI.showMessage(l.msg.noSelected,"warn")}},sendDeleteRequest:function(j,h,n){var l=n||j.op.operation&&j.op.operation.del;if(l&&l.ajax){var k=$.extend({},l.ajax);k.data=h;if(!l.fnBeforeDelete||l.fnBeforeDelete.call(j,k.data,l,k)!==false){Jalor.doPut(k)}}}};g.Operation.add("del",{bind:function(h,k,j){this.base.bind.call(this,h,k,j);if(j.ajax||j.url){a.initAjax(h,j)}else{if(j.undoBtn){$(j.undoBtn).click(function(l){!k._disabled&&a.remove(h,k,j,1)})}}if(!k._reIniting){k.Storage.Trigger.remove.add(function(l,o,n){n&&n.toggleClass(e.deleted.css,o);this.setItemSelected(l,false,n)})}},operate:a.remove});var b=g.Operation.insert={initInsertStorage:function(l,k,j){if(!k._reIniting){l.insertStorage=Jalor.Storage.create({at:function(n){return this.filter(function(o){if(o._newIndex==n){return this.ReturnValue.last}})[0]},destroyItem:function(o,n){return this.destroy(function(p){if(p._newIndex==o){return this.ReturnValue.last}},n)},insertItem:function(o,p,n){if(o){this.setStatus(o,this.Status.inserted);this.dataset.push(o);this.fireTrigger("insert",o,p,n)}return this}});var h=l.insertStorage.Trigger;h.destroy=l.Trigger.destroy;h.insert=l.Trigger.insert;h.destroy.add(function(n,o){o&&o.remove()})}this.setStorage(l,k,j)},setStorage:function(k,j,h){if(!j._reIniting){k.extend({insertItem:function(n,o,l){this.insertStorage.insertItem(n,o,l);return this},at:function(l){return l<0?this.insertStorage.at(l):this.proxy(this.fn.at,l)},filter:function(l,o,r,q,n){var p=this.proxy(this.fn.filter,l,o,r,q);if(n!==false&&this.insertStorage&&this.insertStorage.len()){return p.concat(this.insertStorage.getInsertedRecords(l,o,true))}return p},sort:function(o,n,p,l){this.mergeNewData(!j._requesting,j);this.proxy(this.fn.sort,o,n,p,l);return this},mergeNewData:function(q,p){var o=this.insertStorage;if(o.len()){if(q){var n=0,l=this;o.sort("_index","asc").each(function(s,r){delete s._newIndex;delete s._seq;if(s._index){l.fn.insertItem.call(l,s,s._index+n)}else{l.fn.insertItem.call(l,s,0)}n++})}o.clear()}},clear:function(l){this.dataset=[];this.insertStorage.dataset=[];this.fireTrigger("clear",l)}})}j.handler.beforeBindData.add(function(l,n){l.op.Storage.mergeNewData(!n._requesting,n)})},insert:function(j,n,l,k,h){newData=l.data?l:{data:l};n.operation.insert.trTmpl||(n.operation.insert.trTmpl="<% var i = index;var _rowNo = - 1; with(data){ %>"+n.tmpl+"<% } %>");j.getBodyPanel().find(".grid-no-result").remove();return this.addRow(j,n.operation.insert,newData,k,h)},addRow:function(h,y,n,u,C){h.getHeadTable().find(".igrid-head tr").removeClass("igrid-selected");h.getHeadTable().find(".igrid-head .grid-select").removeClass("grid-selected-disabled");var q=h.op;n.data._newIndex=-(++y.index);n.data._seq="+"+y.index;(n.data._cacheKey!=null)&&(n.data._cacheKey=null);u.dataHandle&&u.dataHandle(n.data,h);var j=h.getDataBody(),k,z=q.Storage;if(!u.posTr){var o=h.getFocusRow(),r;if(o.length){u.posTr=o;r=h.getRowData(o);if(r){k=r._index}else{u.posTr=j.children(":not(.igrid-newrow):first");k=0}}else{u.posTr=j.children(":not(.igrid-newrow):first");k=0}}else{if(u.posIndex!=null){k=u.posIndex}else{if(!h.isNewRow(u.posTr)){k=h.getRowIndex(u.posTr)}else{k=h.getRowData(u.posTr)._index}}}var A=q.pagerOp.pageInf;k+=(A.curPage-1)*A.pageSize;z.insertItem(n.data,k);var B=Jalor.UI.template(y.trTmpl,n,null,null,{_grid:h},true),t,s=$(B);s.find(".igrid-multi.grid-select").length>0&&!q._prevSelCount?q._prevSelCount=1:q._prevSelCount++;n.data.rowIdx=n.data._newIndex;k&&(n.data._index=k);if(u.posTr.length){if(u.position=="after"){u.posTr.after(s)}else{u.posTr.before(s)}if(q.rowRender&&q.rowRender=="rowSpan"){var w=s.next();var p=w.children("td[field]:hidden");function l(G,E,D){D++;var H=G.prev(),F=h.getCellByField(H.attr("_row")*1,E);if(F.is(":hidden")){return l.call(this,H,E,D)}return{prevCell:F,index:D}}p.each(function(){var E=h.getColumnOp($(this)),D=l(s,E.field,0);$(this).attr("rowspan",D.prevCell.attr("rowspan")*1-D.index).show();D.prevCell.attr("rowspan",D.index)})}var v=u.posTr.position().top-s.height(),x=h.getBodyPanel();t=(v<0||v>x.height())?v:x.scrollTop()}else{j.append(s)}if(q._fnEndInsertRow){q._fnEndInsertRow.call(h,s,u,n.data)}q.fnRenderRow&&q.fnRenderRow.call(h,s,n.data,n.data.rowIdx);if(q.showFirstEditor&&C!==true&&s.position().top>=-1){s.find(".grid-cell").each(function(D,E){var F=$(E);if(F.attr("eno")=="edit"){if(h.callEditor(F)!==false){return false}}})}g.Editor.activeEditor(h);u.scroll&&this.scroll(h,t);h.totalColumn();h.autoWhiteWidth();return t},copy:function(j,n,t,u){var q,l=u.scroll,r,o=u.posTr?true:null;if(n._cache){var k=j.getSelectedRecords(),p;if(k.length){r=true;u.scroll=null;$.each(k,function(w,v){p=j.getRow(v.rowIdx);j.op.Storage.setItemSelected(v,false,p);q=b.copyInsert(j,n,v,t,u,q,o)})}}else{var s=j.getSelectRows(),h;if(s.length){r=true;h=j.getHeadTable().find("."+e.selected.css);(h.length>0)&&h.removeClass(e.selected.css,false);u.scroll=null;s.each(function(w){var x=$(this),v=j.getRowData(x);j.op.Storage.setItemSelected(v,false,x);q=b.copyInsert(j,n,v,t,u,q,o)})}}if(q!=null){l&&this.scroll(j,q)}else{r||this.insertDefault(j,n,t,u)}},insertDefault:function(h,l,k,j){this.insert(h,l,$.extend(true,{},k.defaultRow),j)},copyInsert:function(h,l,k,q,r,o,n){var j=$.extend(true,{},k);b.clearField(l,j,q);var p=b.insert(h,l,{data:j},r);return o?o:p},scroll:function(j,l){var h=j.getBodyPanel(),k=h.scrollTop();(l<k||l>k+h.height()-30)&&j.syncScroll(null,l)},clearField:function(k,h,j){if(j.clear){$.each(j.clear,function(l,n){h[n]=j.defaultRow.data[n]})}delete h._index;k.Storage.clearStatus(h)}};g.Operation.add("insert",{bind:function(h,n,l){this.base.bind.call(this,h,n,l);var k=l.defaultRow,j=Jalor.DataHelper;k||(k={});$.each(n.columns,function(p,o){if(!o.inner&&!o.columnType){j.getObj(o.field,k)==undefined&&j.setObj(o.field,k,null);o.valueField&&j.getObj(o.valueField,k)==undefined&&j.setObj(o.valueField,k,null)}});l.defaultRow={data:k};l.index=0;b.initInsertStorage(h.op.Storage,h.op,h)},operate:function(h,l,k){var j=k._getInsertSet?k._getInsertSet(h,l):{};j.scroll!==false&&(j.scroll=true);k.copy?b.copy(h,l,k,j):b.insertDefault(h,l,k,j)}});var c=g.Operation.save={checkErrorMsg:function(h,o){var r={},q,s,j,n,k;for(var l=0,u;u=o[l];l++){var t=u.fieldName.split(".").pop(),p=u.rowIndex;if(j!=p){if(k&&q){k.lenght=s;r[q]=k}s=0;q=$.newGuid();k={};j=p;n=h.getRowData(p);n._errorNo=q}k[t]=u.messages;s++}k.lenght=s;r[q]=k;h.op._errorMsg=r}};g.Operation.add("save",{bind:function(j,l,k){if(k.btn){var h=this.operate;$(k.btn).unbind("click").click(function(n){n.stopPropagation();if(!l._disabled){if(j.valid()&&!j.getDataBody().find(".igrid-servervalid-error").length){h(j,l,k)}else{if(j.op.showStatus&&j.setErrorMsg(j.getInsertedRecords())){j.updateStatus("error");if(j.op.popupStatus){j.popupStatus("error")}}}}})}},operate:function(j,q,p){var o=q.Storage,l;if(q._errorMsg){q._errorMsg=null;o.filter(function(r){r._errorNo&&(r._errorNo=null)})}l=o.getChangedRecords();if(l.insertedRecords.length||l.updatedRecords.length||l.deletedRecords.length){var k=$.extend(true,{},p.ajax);k.data={items2Delete:l.deletedRecords,items2Create:l.insertedRecords,items2Update:l.updatedRecords};if(!p.fnBeforeSave||p.fnBeforeSave(k.data,k,j,p)!==false){j.save(k,true)}}else{var n=o.getPreDeletedRecords(),h;if(n.length){$.each(n,function(r,s){if(a.delInsertRow(j,o,s)){h=true}});q._loadType="noScroll";if(h){o.destroy(function(r){return r?r._destroy:this.ReturnValue.complete});j.reload()}}else{Jalor.UI.topBox("jalor.common.message.nothingModified")}}}})})(Jalor.UI.IGrid,Jalor.UI.IGrid.Const);(function(h,e){var b=e.I18n.rowRender={rowRenderSet:"jalor.common.igrid.rowRenderSet",rowSpanCol:"jalor.common.igrid.rowSpanCol",groupCol:"jalor.common.igrid.groupCol",rowRenderMsg:"jalor.common.message.rowRenderMsg",noSelectedMsg:"jalor.common.message.noSelectExist"};function c(j){return(j==="desc")?"desc":"asc"}function g(k){var j=[];if(k&&k.length>0){$.each(k,function(){j.push(this.field)})}return j}h.rowRender=$.IAdapter();Jalor.UI.XControl.addPlugin("XGrid","rowRender",{preInit:function(j,l){if(l.rowRender&&!l._reIniting){var k=h.rowRender.get(l.rowRender);k&&k.init&&k.init(j,l);j.setSortSetting()}},build:function(j,l){if(l.rowRender){var k=h.rowRender.get(l.rowRender);k&&k.build(j,l)}},clear:function(j,l){if(l.rowRender){var k=h.rowRender.get(l.rowRender);k&&k.clear&&k.clear(j,l)}},individuation:function(k,r,n,u,q){if(r.allowSort&&r.remoteSort&&(r.rowRender=="group"||r.rowRender=="rowSpan")){var s=r.rowRenderOp,v=s&&s.spareFields,o=s&&s.order||[],l=(r.rowRender=="group")?b.groupCol:b.rowSpanCol,p=d.setComboData(o,v,r._columnMap),t=h.Const.I18n.header,j;Jalor.Validator.addRule("isSameValue",function(A,C,x){var w=h.Helper.getGridObj(x),y=x.manager().getValue(),z=x.data("caller").attr("val"),B;if(y!=z){B=w.op.Storage.filter(function(E,D){return(E.field==y)?true:false});return B.length?false:true}return true},$i18n(b.noSelectedMsg));n.rowRenderOp.ePropName=b.rowRenderSet;n.rowRenderOp.order={type:"arrayEditor",ePropConf:o,ePropName:l,ePropDesc:b.rowRenderMsg,editorOp:{width:518,usingEsc:false,fnRowDrag:function(y,A,w,x,z){if(!this.valid()){return false}},columns:[{field:"field",header:l,width:150,rule:{required:true,isSameValue:true},type:"enum",format:{data:p}},{field:"sort",header:t.sortType,width:80,cssName:"center",type:"enum",format:{data:[{value:"asc",text:$i18n(t.sortAsc)},{value:"desc",text:$i18n(t.sortDesc)}]},editorOp:{conf:{combo:false}},defaultValue:{sort:"asc"}}]}}}}});var d={setComboData:function(k,j,n){var o=[],l=j?k.concat(j).clearRepeating():k;if(l.length>0){$.each(l,function(p,q){if($.isPlainObject(q)){o.push({value:q.field,text:$i18n(n[q.field].header)})}else{o.push({value:q,text:$i18n(n[q].header)})}})}return o}};Jalor.UI.XControl.extendIManager("XGrid",{expand:function(j){var k=this.getRows(),l=k.filter(".grid-row-group");if(j===false){k.filter(".grid-row").hide();l.find("a.group-open").removeClass("group-open");l.not("[groupIndex=0]").hide()}else{k.filter(".grid-row").show();l.show().find("a.igrid-group").addClass("group-open")}}});h.rowRender.add("group",{init:function(n,q){q.rowRenderOp=$.extend({_groupHeader:{},_groupValueFn:{},order:[]},q.rowRenderOp);var j=q.rowRenderOp.order;var o={},j=q.rowRenderOp.order;for(var l=0,p;p=j[l];l++){j[l]={field:p,sort:"asc"};o[p]=j[l]}for(var l=0,k;k=q.columns[l];l++){if(o[k.field]){o[k.field].sort=c(k.sort)}if(k.group&&!o[k.field]){j.push({field:k.field,sort:c(k.sort)})}k.sort=null}},build:function(j,k){if(!k.handler.changeTmpl){k.handler.changeTmpl=$.Callbacks()}k.handler.changeTmpl.add(a.groupRender);k.handler.setColumn.add(this.colSet);k.handler.dataProcess.add(a.dataProcess);k.handler.initComplete.add(a.groupRender);k.handler.click.add("groupToggle",a.groupToggle);k.handler.click.add("groupSelect",a.groupSelect);k.handler.click.add("groupClick",a.groupClick);k.handler.afterBindData.add(a.initToggleStype);if(k.operation&&k.operation.insert){setTimeout(function(){k.operation.insert._getInsertSet=a.getInsertSet},100)}k.fnSort=a.sort},colSet:function(l,k,q){var j=q.rowRenderOp.order;k.group=false;$.each(j,function(r,s){if(s.field==(k.field)){k.group=true}});var p=k.field,o=q.rowRenderOp,n=false;if(k.group||(o.spareFields&&o.spareFields.contains(p))){o._groupHeader[p]=k.header;if(k.expand===false){o.unExpand=p}if(typeof k.getGroupValue=="function"){o._groupValueFn[p]=k.getGroupValue}}},clear:function(j,k){k.rowRenderOp._groupHeader={};k.rowRenderOp._groupValueFn={}}});var a={dataProcess:function(u){var t=this,p=u.rowRenderOp,v=p.groupFields||g(p.order),l=p.groups={};if(u.rowRenderOp.disabled||this.length==0||!v||v.length==0){return this}var s,x,n,k,y;for(var r=0,w;w=v[r];r++){s=x=n=void 0,k={},y=[];for(var o=m=0,q;q=t[o];o++,m++){if("_group" in q){x=void 0;y.push(q);m--;continue}n=Jalor.DataHelper.getObj(w,q);if(p._groupValueFn[w]){n=p._groupValueFn[w].call(null,n,q)}if(x!==n){s={_temp:true,_group:n,_count:0,_field:w,_groupIndex:r,_header:p._groupHeader[w]};y.push(s);x=n;l[w]=l[w]||[];l[w].push(m)}s._count++;y.push(q)}t=y}return t},groupRender:function(j,q){if(!q.rowRenderOp.disabled&&q.rowRenderOp.order){var l,u=["<% if('_group' in data){index--;%><tr class='grid-row-group' field='${#_field}' groupValue='${_group}'  groupIndex='${#_groupIndex}' eno='groupClick' >"],t=[];q.showSeq&&u.push("<td class='grid-cell grid-col0 grid-cell-toggle'></td>");var p=false,s=false;if(q.rowRenderOp.groupSelect!==false){for(var o=0,k;k=q.columns[o];o++){if(k.columnType=="select"&&k.multi){s=true;h.Factory.Column.setTmpl(k,t)}}}l=j.getHeadPanel().find("td[field].grid-cell").length;if(t.length<1&&u.length>1){u.pop()}$.each(q.columns,function(w,v){if((v.inner||v.columnType)&&(v.columnType!="select"||!v.multi)){l++}if(v._ctype=="Seq"){p=true}});if(p&&s){l--}if(q.rowRenderOp.groupSelect===false){l++}var n='<a  class="igrid-group group-open igrid-group-${#_groupIndex}" eno="groupToggle">';var r=q.rowRenderOp.groupTmpl||" ${_header} : </a>  ${_group} (${#_count}) ";u.push(t.join("").replace("rowSelect","groupSelect"),"<td colspan='${",l,"}'  class='grid-cell'>",n,r,"","</td></tr><% }else{ %>",q.tmpl,"<% } %>");q.tmpl=u.join("")}},initToggleStype:function(j,n){if(!n.rowRenderOp.disabled&&n.rowRenderOp.unExpand){var k=j.getRows();k.filter(".grid-row").hide();groupTrs=k.filter(".grid-row-group");var l=groupTrs.filter("[field='"+n.rowRenderOp.unExpand+"']").attr("groupIndex")*1;if(n.rowRenderOp.simpleSort&&n.rowRenderOp.groupFields){k.find("a.group-open").removeClass("group-open");return}groupTrs.each(function(){var p=$(this),o=p.attr("groupIndex")*1;if(o>l){p.hide().find("a.group-open").removeClass("group-open")}else{if(o==l){p.find("a.group-open").removeClass("group-open")}}})}j.getHeadTable().find("td.igrid-selectAll").click(function(){if(!$(this).parent().hasClass("igrid-selected")){j.getBodyTable().find("tr.grid-row-group").addClass("igrid-selected")}else{j.getBodyTable().find("tr.grid-row-group").removeClass("igrid-selected")}})},groupToggle:function(o,k,j){o.stopPropagation();if(!j.valid()){return}var t=!k.hasClass("group-open"),p=k.parents("tr:first"),l=p.attr("field"),s=p.attr("groupIndex")*1,q=p.next(),r=[];k.toggleClass("group-open");while(q.hasClass("grid-row")||q.attr("groupIndex")*1>s){r.push(q[0]);q=q.next()}r=$(r);t?r.show():r.hide();if(p.next("tr.grid-row-group").attr("groupIndex")*1>s){r.filter(".grid-row").hide();r.filter(".grid-row-group").find("a.group-open").removeClass("group-open")}var n=j.getBodyPanel();if(n[0]&&n[0].style&&!n[0].style.height&&!n[0].style.maxHeight){j.getBodyPanel().css("overflow-y","hidden")}},groupSelect:function(q,k,l){var p=k.parent("tr:first"),n=!p.hasClass(e.selected.css),j=p.next("tr");var o=p.attr("groupIndex")*1;p.toggleClass(e.selected.css,n);while(j.length>0&&(!j.hasClass("grid-row-group")||j.attr("groupIndex")*1>o)){if(j.hasClass("grid-row-group")){j.toggleClass(e.selected.css,n)}else{h.innerColumn.gridSelect.rowSelected(j,n,l)}j=j.next("tr")}},groupClick:function(n,j,k){k.getBodyTable().find("tr.grid-row.igrid-actived,tr.grid-row-group.igrid-actived-group").removeClass("igrid-actived igrid-actived-group");var l=$.getEventTarget(n).parent("tr").addClass("igrid-actived-group")},getInsertSet:function(j,n){var k={scroll:false},l=j.getFocusRow();if(l[0]){l=k.posTr=l.prevAll("tr.grid-row-group:first").next()}else{l=k.posTr=j.getBodyTable().find("tr.grid-row-group.igrid-actived-group").next();while(l.hasClass("grid-row-group")){l=k.posTr=l.next()}}if(l.length==0){l=k.posTr=null}k.dataHandle=function(p,q){if(this.posTr){var o=this.posTr.prevAll("tr.grid-row-group:first");while(o.length>0){var r=o.attr("groupIndex")*1;Jalor.DataHelper.setObj(o.attr("field"),p,o.attr("groupValue"));if(r<=0){break}o=o.prevAll("tr.grid-row-group[groupIndex="+(--r)+"]:first")}}};return k},sort:function(r,p,t){this.clearSortSetting();var s=t.attr("field");if(!s){return}var l=this.op.rowRenderOp,n=l.order;if(!l.groups||this.length==0){return}if(l.simpleSort){if(l.spareFields&&l.spareFields.contains(s)){l.groupFields=[s];if(l.disabled){l.disabled=false;a.groupRender(this,this.op)}}else{if(this.op._columnMap[s].group){l.groupFields=[s];l.disabled=false;if(this.op.colsort!==false){a.groupRender(this,this.op)}}else{l.disabled=true}}return true}else{if(n[0]&&n[0].field==s){return true}else{if(this.op.remoteSort){var q=[];$.each(n,function(v,w){if(w.field!=s){q.push(w)}else{return false}});q.push({field:s,sort:p});this.setSortSetting(q,true);return}var j,u,k=this.op.Storage.dataset;$.each(n,function(v,w){if(w.field==s){j=n[v-1].field;return false}});j=j||n[n.length-1];u=l.groups[j];if(u){u.push(k.length);for(var o=1;o<u.length;o++){this.op.Storage.sort(r,p,u[o-1],u[o]-1)}l.disabled=null;this.reload();!this.op._loadType&&(this.op._loadType="sort");return false}}}}};h.rowRender.add("rowSpan",{init:function(n,q){q.rowRenderOp=$.extend({order:[]},q.rowRenderOp);var o={},j=q.rowRenderOp.order;for(var l=0,p;p=j[l];l++){j[l]={field:p,sort:"asc"};o[p]=j[l]}for(var l=0,k;k=q.columns[l];l++){if(o[k.field]){o[k.field].sort=c(k.sort)}if(k.rowSpan&&!o[k.field]){j.push({field:k.field,sort:c(k.sort)})}k.sort=null}if(q.rowRenderOp.priority===false){q.rowRenderOp.simpleSort=true}},build:function(j,k){k.handler.setColumn.add(this.colSet);k.handler.dataProcess.add(f.dataProcess);k.Storage.Trigger.store.add(function(){k.rowRenderOp.groups={}});k.__fnBeforeEdit=k.fnBeforeEdit;k.fnBeforeEdit=f.fnBeforeEdit;k._fnEndInsertRow=f.fnEndInsertRow;k.fnSort=f.sort},colSet:function(n,k,o){var l=k.field;var j=o.rowRenderOp.order;k.rowSpan=false;$.each(j,function(p,q){if(q.field==l){k.rowSpan=true}});if(k.rowSpan){k.attr.rowspan="${#data._"+f.encode(l)+"_rowSpan}";k.cssName+="${#data._"+f.encode(l)+"_rowSpanHide} ${# data._"+f.encode(l)+"_rowSpan>1 ? 'igrid-rowspan' : ''}${delete data._newRowSpan && delete data._"+f.encode(l)+"_rowSpanHide && delete data._"+f.encode(l)+"_rowSpan ? '' : ''  }"}},clear:function(j,k){k.__fnBeforeEdit=k.fnBeforeEdit}});var f={dataProcess:function(n){if(n.rowRenderOp.disabled){return this}var l=this,k=n.rowRenderOp.rowSpanFields||n.rowRenderOp.order||[],j=n.rowRenderOp.groups={};$.each(k,function(r,s){var t=s.field;var q=void 0,p=1,o=void 0;if(n._columnMap&&n._columnMap[t]&&n._columnMap[t].hidden){return}if(!t||l.length===0){return false}$.each(l,function(w,x){var v=Jalor.DataHelper.getObj(t,x),u;if(x._update&&x._updFields&&_updFields.contains(t)){u=true}else{u=false}if((!o||!o._inserted)&&!x._inserted&&!u&&!x._updated&&q===v&&(n.rowRenderOp.priority===false||!x._newRowSpan)){p++;x["_"+f.encode(t)+"_rowSpanHide"]=" hide";o["_"+f.encode(t)+"_rowSpan"]=p>1?p:null}else{q=v;p=1;o=x;o._newRowSpan=true;if(!n.rowRenderOp.simpleSort){j[t]=j[t]||[];j[t].push(w)}}})});return l},encode:function(j){return j.replaceAll("\\.","_")},fnBeforeEdit:function(o,q,j,n){if(j.rowSpan){var p=q.attr("rowspan")*1,l=q;if(p>1){for(var k=1;k<=p;k++){l=l.parent().next().find("td[_col="+j.attr._col+"]").removeClass("hide")}q.attr("rowspan",1).removeClass("igrid-rowspan")}}if(this.op.__fnBeforeEdit){return this.op.__fnBeforeEdit.call(this,o,q,j,n)}},fnEndInsertRow:function(x,y,r){var k=$(y.posTr),j=$([]);var s=g(this.op.rowRenderOp.order);for(var q=0,w;w=s[q];q++){var o=x.children("td[rowspan][field='"+w+"']"),p=o.attr("_col"),v=k.children("td[_col="+p+"]");if(x.next().children("td[rowspan=1][_col="+p+"].hide").length>0){var t=x.prev(),l;while(t.length>0){l=t.find("td[_col="+p+"]");if(l.is("td[rowspan=1].hide")){l.removeClass("hide")}else{l.attr("rowspan",1).removeClass("igrid-rowspan");break}t=t.prev()}var u=x.next(),n;while(u[0]){n=u.find("td[rowspan=1][_col="+p+"].hide");if(n[0]){n.removeClass("hide")}else{break}u=u.next()}}}},sort:function(r,p,t){this.clearSortSetting();var s=t.attr("field"),l=this.op.rowRenderOp,n=l.rowSpanFields||l.order||[];if(l.groups&&this.op.Storage.dataset.length>0){if(l.simpleSort){if(this.op._columnMap[s].rowSpan){l.rowSpanFields=[{field:s,sort:p}];l.disabled=false}else{l.disabled=true}return true}if(!l.simpleSort&&n[0]&&n[0].field!==s){if(this.op.remoteSort){var q=[];$.each(n,function(v,w){if(w.field!=s){q.push(w)}else{return false}});q.push({field:s,sort:p});this.setSortSetting(q,true);return true}else{if($.isEmptyObject(this.op.rowRenderOp.groups)){f.dataProcess.call(this.op.Storage.store(),this.op)}var j,u,k=this.op.Storage.dataset;$.each(n,function(v,w){if(w.field==s){j=n[v-1].field;return false}});if(!j){j=n[n.length-1].field}u=l.groups[j];if(u){u.push(k.length);for(var o=1;o<u.length;o++){if(u[o]-1-u[o-1]>0){this.op.Storage.sort(r,p,u[o-1],u[o]-1)}}!this.op._loadType&&(this.op._loadType="sort");l.disabled=false;this.reload();return false}return true}}}}}})(Jalor.UI.IGrid,Jalor.UI.IGrid.Const);(function(e,c){var d=c.I18n.rowRender={btnAddChildNode:"jalor.common.button.addChildNode",btnAddSameLevelNode:"jalor.common.button.addSameLevelNode",btnCopySameLevelNode:"jalor.common.button.copySameLevelNode",btnDeleteNode:"jalor.common.button.deleteNode",btnLoadChild:"jalor.common.button.reLoad"};e.rowRender.add("tree",{build:function(f,j){j.autoScroll=false;j.lazyLoad="filter";var g=j.rowRenderOp;(g.ajax||g.url)&&(g.lazyLoad=true);(g.loadDeep!=null)||(g.loadDeep=Jalor.UI.Config.igrid.treeLoadDeep);j.handler.setColumn.add(this.colSet);j.handler.dataProcess.add(b.buildTreeData);j.handler.click.add("toggleTree",b.toggleTree);j.fnSort||(j.fnSort=b.sort);var h=j._treeStorage?j._treeStorage.dataset:null;j._treeStorage=Jalor.Storage.createDataTree({parentKey:g.parent,nodeKey:g.field});h&&(j._treeStorage.dataset=h);this.initTreeTirgger(f,j.Storage,j._treeStorage);this.initOperation(f,j);this.extendStorage(f,j.Storage,j._treeStorage)},initTreeTirgger:function(f,l,g){var k=f.op,j=l.Trigger,h=g.Trigger;j.remove.add(function(o,n,p){if(p.data("_isRemove")){p.removeData("_isRemove")}else{p.data("_selected",{all:false});b.selectParent(f,k,p,true,false)}});h.insert.add(function(o,n){b.initNodeStatus(k,o.data,n)});h.halfSelect.add(function(o,n,p){p&&p.toggleClass(c.halfSelected.css,n)})},initOperation:function(j,l){var k=l.rowRenderOp,g=l.operation;if(g||k.lazyLoad){l.contextMenu=true;l.menuOp||(l.menuOp={});l.menuOp.menus||(l.menuOp.menus=[]);if(g){var h=g.insert;if(h){h.clear||(h.clear=[]);h.clear.push("_hasChild","_lazyLoad","_opened","_childCount","_parents",k.field);h.copy=false;h._getInsertSet=function(n,o){return{posTr:n.getDataBody().children(":not(.igrid-newrow):first"),posIndex:0}}}if(g.save&&k.delRoot){var f=g.save.ajax.setAjax;g.save.ajax.setAjax=function(n){if(n.data&&n.data.items2Delete.length){n.data.items2Delete=b.getRoots(n.data.items2Delete,l)}f&&f(n)}}}}},extendStorage:function(f,h,g){g.extend({setNodeStatus:function(n,k,j){if(n=this.at(n)){var l=n.data;this.setStatus(l,k,j);if(l._childCount){l._selectedChilds=j?l._childCount:0}this.each(function(o){this.setStatus(o,k,j);if(o._childCount){o._selectedChilds=j?o._childCount:0}},n)}return this},toggleNode:function(k,j){if(k=this.at(k)){if(k.count){this.setStatus(k.data,"_opened",j);if(j){var n=[],l=this.getChilds(k,function(q,p,o){if(this.isNew(q)&&(q._tempPos!="last")){n.push(q);return false}else{if(!this.isOpened(q)){return this.ReturnValue.next}else{return true}}});return b.insertToChilds(k.data,n,l,this)}}}return[]}});if(!f.op._reIniting){h.extend({filter:function(j,k,o){var n=f.op._treeStorage;var l=n.filter(j,k,o);if(this.insertStorage&&this.insertStorage.len()){return l.concat(this.insertStorage.getInsertedRecords(j,k,true))}return l},mergeNewData:function(u,s){var l=this.insertStorage;if(l&&l.len()){if(u){var r=[],w=this,k=s._treeStorage,o,q,v,t,p,n,j;l.each(function(y,x){delete y._newIndex;delete y._seq;v=n=null;q=k.getParentKey(y);if(y._index){j=y._tempPos;o=w.dataset;for(var x=0,z;z=o[x];x++){p=k.getKey(z);if(!v&&p==q){v=z;t=x;if(!j){break}}if(v){if(v._opened){if(j==p){n=x;break}else{if(j=="last"&&v!=z&&z._deep!=y._deep){n=x;break}}}else{break}}}if(v&&v._opened){w.fn.insertItem.call(w,y,j?n:t+1)}}else{w.fn.insertItem.call(w,y,-y.rowIdx-1)}if(!v){v=k.findOne(function(C,B,A){return(k.getKey(C)==q)?true:false})}k.insertItem(v,y)})}l.clear()}}})}},colSet:function(g,f,k){var h=k.rowRenderOp;if(f.field==h.showField){f.cssName="tree-cell "+(f.cssName||"");k.rowAttr.deep="${#_deep}";if(!f.renderer||!f.renderer.type){f.renderer=Jalor.UI.Renderer.get("childRender")}if(k.showSeq){var j=k.columns[0];j.content="<span>${#data._seq || index}</span>";j.cssName+=" tree-seq"}b.buildNodeTmpl(f,k.rowRenderOp,k);if(k.operation||h.lazyLoad){b.initTreeEdit(g,f,k)}}},clear:function(f,g){delete g.menuOp;if(g.columns){$.each(g.columns,function(j,h){if(!h.inner&&h.field==g.rowRenderOp.showField){h.content=null;h.cssName=null;return false}})}}});var b=e.tree={buildTreeData:function(j){if(!j._scrollLoading){var f=j.rowRenderOp.loadDeep,h=j._treeIniting?j._treeStorage:j._treeStorage.store(this),g=h.filterByDeep(j.rowRenderOp.loadDeep,function(l,k){if(k.count){l._opened=(l._deep<f);l._childCount=k.count}});j.Storage.store(g);j._treeIniting&&(delete j._treeIniting);return g}a.updateTotal(j);return this},initNodeStatus:function(l,j,g){var h=l.rowRenderOp,f=g.data,k=l._treeStorage;if(!k.isNew(j)){if(h.fnCheckChild?h.fnCheckChild(j):h.lazyLoad){j._lazyLoad=j._hasChild=1}}if(f){if(!f._hasChild){f._hasChild=1;delete f._lazyLoad}if(k.isSelected(f)){j[k.Status.selected]=true}else{if(k.isDeleted(f)){j[k.Status.deleted]=true}}}},dataBuild:function(l){if(!l._scrollLoading){var f=this,j=l.rowRenderOp,k=j.fnCheckChild;for(var g=0,h;h=f[g];g++){h._lazyLoad=h._hasChild=k?k(h):1;h._deep=0}return f}return this},getID:function(g,f){return Jalor.DataHelper.getObj(g,f)},buildDataTree:function(f,o){var n=[],l=o.rowRenderOp.field,j=o.rowRenderOp.parent,k=f.shift(),g;while(k){var h=this.getID(j,k);if(this.checkParent(h,k,o,f)){g=b.getParent(h,k,f,l,j)}else{g=k;b.getChild(g,f,l,j)}n.push(g);k=f.shift()}return n},checkParent:function(g,j,k,f){var h=k.rowRenderOp.fnCheckRoot;if(h&&h(g,j,f)){return true}return g&&g>0},getParent:function(g,k,f,n,h){for(var j=0,l;l=f[j];j++){if(b.getID(n,l)==g){f.splice(j,1);--j;l._childs=[k];g=b.getID(h,l);b.getChild(l,f,n,h);return g?arguments.callee(g,l,f,n,h):l}}return k},getChild:function(k,f,n,h){var g=b.getID(n,k);if(g){for(var j=0,l;l=f[j];j++){if(b.getID(h,l)==g){f.splice(j,1);--j;k._childs?k._childs.push(l):k._childs=[l]}}if(k._childs&&k._childs.length){for(var j=0,o;o=k._childs[j];j++){arguments.callee(o,f,n,h)}}}},buildTreeList:function(f,l){var k=[],g=0;for(var h=0,j;j=f[h];h++){this.checkChild(j,k,g,l)}return k},checkChild:function(h,l,f,k,g){l.push(h);var j=h._childs;if(j){this.addTreeRow(j,l,++f,k);delete h._childs}},addTreeRow:function(l,k,f,n){for(var g=0,h=l[0];h;g++,h=l[g]){this.checkChild(h,k,f,n)}},toggleTree:function(h,f,g){h.stopPropagation();f.toggleClass("tree-close");a.loadChild(f,g)},initTreeEdit:function(h,f,n){var k=n.rowRenderOp,j=n.menuOp.menus;if(k.lazyLoad){j.push({text:$i18n(d.btnLoadChild),css:"load_child",click:function(o){if(k.allowSearch&&n.ajax&&n.ajax.data){k.ajax.data=n.ajax.data}b.reloadChildNodes(h,h.getRowData(o))},fnCheck:function(o,q,p){return p&&!p._inserted&&p._hasChild}})}if(n.operation){if(n.operation.insert){var l=n.operation.insert.defaultRow.data,g=k.addRoot;l._deep=0;l._hasChild=null;l._lazyLoad=null;j.push({text:$i18n(d.btnCopySameLevelNode),css:"copy",click:function(o){b.insertNode(o,n,h,false,true)},fnCheck:function(o,q,p){return p&&(p._deep>0||g)&&!p._deleted}});j.push({text:$i18n(d.btnAddSameLevelNode),css:"add",click:function(o){b.insertNode(o,n,h)},fnCheck:function(o,q,p){return p&&(p._deep>0||g)&&!p._deleted}});j.push({text:$i18n(d.btnAddChildNode),css:"add_child",click:function(o){b.insertNode(o,n,h,true)},fnCheck:function(o,q,p){return p&&!p._inserted&&(!k.maxDeep||p._deep<k.maxDeep)&&!p._deleted}})}if(n.operation.del){j.push({text:$i18n(d.btnDeleteNode),css:"remove",click:function(o){b.removeNode(o,n,h)}})}j.length&&(f.menuable=true)}},insertNode:function(w,p,f,h,r){var s=f.getCellRow(w),l=f.getRowData(s);if(l){var o=p.rowRenderOp,v=l._deep+(h?1:0),g=this.getPosTr(s.next(),v,h),n=$.extend({},r?l:p.operation.insert.defaultRow.data),k=Jalor.DataHelper,u;r&&e.Operation.insert.clearField(p,n,p.operation.insert);n=$.extend(true,{},n);n._deep=v;if(o.parentText){var j=h?k.getObj(o.showField,l):k.getObj(o.parentText,l);k.setObj(o.parentText,n,j)}k.setObj(o.parent,n,this.getID(h?o.field:o.parent,l));e.Operation.insert.insert(f,p,n,{posTr:g.length?g.prev():s.parent().children(":last"),position:"after",isScroll:false,posIndex:f.isNewRow(s)?(l._index+1):null});if(h){n._treeNo=l._treeNo+"."+n.rowIdx;l._childCount?l._childCount++:(l._childCount=1);l._selected&&(u=true)}else{n._treeNo=l._treeNo.substring(0,l._treeNo.lastIndexOf(".")+1)+n.rowIdx;var q=p._treeStorage.getParent(l),q=q?q.data:null,t=g.length&&f.getRowData(g);q&&(q._childCount?q._childCount++:(q._childCount=1));q&&q._selected&&(u=true);n._tempPos=(t&&t._deep==l._deep)?b.getID(o.field,t):"last"}u&&b.selectParent(f,p,f.getRow(n.rowIdx),true,null,false)}},getPosTr:function(j,h,g){if(j.length){var f=b.getDeep(j);if(f==h||f<h){return j}else{return g?j:arguments.callee(j.next(),h)}}return j},checkMenu:function(o,p,h,f){if(o){var k=o.children("a"),g=h.find(" > ul > li"),j=o.parents("tr:first"),n=this.getDeep(j),l=j.hasClass(c.deleted.css);g.filter(".add_child").toggleClass("hide",n>=f.op.rowRenderOp.loadDeep||l);g.filter(".add").toggleClass("hide",l)}},removeNode:function(f,o,h){var g=o.Storage,l=h.getCellRow(f),k=h.getRowData(l),j=!g.isDeleted(k),n=g.isSelected(k);n||l.data("_isRemove",true);k._selectedChilds&&(k._selectedChilds=0);e.Operation.del.delRow(l,j,h);this.handleChild(l,function(p){p.data("_isRemove",true);e.Operation.del.delRow(p,j,h)});if(o.Storage.isNew(k)&&j){o._treeStorage.destroy(k)}else{o._treeStorage.remove(k,j)}},sort:function(h,j,f){var k=this.op,g=b.sortNode(b.buildDataTree(k.Storage.store(),k),h,j);k.Storage.store(b.buildTreeList(g,k.rowRenderOp));a.treeLoad(this,k);return false},sortNode:function(g,f,j){g=Jalor.DataHelper.sort(f,j,g);for(var h=0,k;k=g[h];h++){if(k._childs&&k._childs.length){arguments.callee(k._childs,f,j)}}return g},getRoots:function(f,h){var g=this.buildDataTree(f,h);$.each(g,function(j,k){k._childs=null});return g},getDeep:function(f){return f.attr("deep")*1},handleChild:function(k,h){var j=this.getDeep(k);k=k.next();if(k.length){var f=this.getDeep(k);while(j<f){var g=k.next();h(k,f);if(g&&g.length){k=g;f=this.getDeep(k)}else{return}}}},handleParent:function(j,g,k){var h=this.getDeep(j);j=j.prev();if(j.length){var f=this.getDeep(j);while(h>0){if(f<h){h--;g(j,f)}j=j.prev();if(j&&j.length){f=this.getDeep(j)}else{return}}}},buildNodeTmpl:function(g,h,j){var f=["<span class='igrid-tree' style='margin-left:${#_deep? _deep*10 : 0}px'>"];if(h.select){f.push("<span class='tree-chk ",h.select,"' eno='nodeSelect'>&nbsp;</span>");j.handler.click.add("nodeSelect",this.nodeSelect)}f.push("<span ${#data._hasChild ? 'eno=toggleTree' : ''} ${#data._lazyLoad ? '_lz=' +",h.field," :''} ${#Jalor.UI.IGrid.setCustomIcon(data, _grid)}</span>");f.push("</span><span class='child-render'>",(g.content||"${"+g.field+"}"),"</span>");g.content=f.join("")},nodeSelect:function(o,q,g){o&&o.stopPropagation();var n=q.hasClass("multi"),l=g.op,p=g.getCellRow(q),h=g.getRowData(p),j=!l.Storage.isSelected(h),k=l.rowRenderOp,f=e.innerColumn.gridSelect;if(n){if(p.hasClass(c.halfSelected.css)){p.data("_selected",{half:j});b.halfRowSelected(p,false,g)}else{p.data("_selected",{all:j})}f.rowSelected(p,j,g);b.handleChild(p,function(r){if(r.hasClass(c.halfSelected.css)){b.halfRowSelected(r,false,g)}f.rowSelected(r,j,g)});if(!l.Storage.isNew(h)){l._treeStorage.setSelected(h,j)}}else{b.removeHalfSelected(p,j,g);f.singlerSelected(o,p,j,g)}b.selectParent(g,l,p,n,j)},selectParent:function(h,o,k,n,j,l){if(o.rowRenderOp.selectParent){var f=k,g;b.handleParent(k,function(q,p){if(n){if(g!=false){if(l==false&&f.data("_selected")){l=true}g=b.multiParentSelected(q,f,h,l);f=q}}else{b.halfRowSelected(q,j,h)}})}},multiParentSelected:function(o,q,g,j){var n=g.getRowData(o),l=g.op,h=l.rowRenderOp,f=e.innerColumn.gridSelect,p=q.data("_selected");(n._selectedChilds==null)&&(n._selectedChilds=0);if(j!=false){if(!p.notChange){if(p.half==null){p.all?n._selectedChilds++:n._selectedChilds--}else{p.half?n._selectedChilds+=0.5:n._selectedChilds-=0.5;q.hasClass(c.selected.css)&&q.data("_selected",{all:true})}}else{q.data("_selected",p.notChange);return false}}var k=n._selectedChilds;if(k){if(n._childCount==k){if(o.hasClass(c.halfSelected.css)){o.data("_selected",{half:true});b.halfRowSelected(o,false,g)}else{o.data("_selected",{all:true})}f.rowSelected(o,true,g)}else{if(o.hasClass(c.halfSelected.css)){o.data("_selected",{notChange:o.data("_selected")})}else{if(o.hasClass(c.selected.css)){o.data("_selected",{half:false});f.rowSelected(o,false,g)}else{o.data("_selected",{half:true})}b.halfRowSelected(o,true,g)}}}else{o.data("_isRemove",true);if(o.hasClass(c.halfSelected.css)){o.data("_selected",{half:false});b.halfRowSelected(o,false,g)}else{if(o.hasClass(c.selected.css)){o.data("_selected",{all:false});f.rowSelected(o,false,g)}}}},removeHalfSelected:function(h,g,f){f.getSelectRows(true,"."+c.halfSelected.css).each(function(j){b.halfRowSelected($(this),false,f)})},halfRowSelected:function(h,g,f){f.op._treeStorage.setHalfSelected(f.getRowData(h),g,h)},fixedNode:function(h,q,k,s){var g=b.getNodeInfoByField(h,q,true),o=h.op,w,z,j,n,x,u,t;if(g){w=g.rowIdx;if(h.getRowData(w)==g){j=h.getRow(w).find("span.tree-icon");if(k){a.removeChild(h,o,g._deep,w+1,false);j.toggleClass("tree-close",false);a.bindChild(h,o,g,j,Jalor.DataHelper.getObj(o.rowRenderOp.field,g),w+1,true)}else{if(s&&j.hasClass("tree-close")){j.removeClass("tree-close");a.loadChild(j,h)}}}else{var r=g._parents,y,p;for(var v=0,f;f=r[v];v++){y=f.data,treeStorage=o._treeStorage;if(!y._opened){var l=treeStorage.toggleNode(y,true);l.unshift(y.rowIdx+1,0);Array.prototype.splice.apply(o.Storage.store(),l)}}if(k){a.bindChild(h,o,g,j,Jalor.DataHelper.getObj(o.rowRenderOp.field,g),w+1,true)}else{if(s&&g._childCount&&!g._opened){g._opened=true;var l=treeStorage.toggleNode(g,true);l.unshift(w+1,0);Array.prototype.splice.apply(o.Storage.store(),l)}a.treeLoad(h,o)}}if(!k){z=h.getRow(g.rowIdx);n=z.height();x=z.position().top+n;u=h.getBodyPanel();t=u.height();if(x<0||x>t){u.scrollTop(h.getRowIndex(z)*n-t/2)}h.setFocusRow(z)}}},reloadChildNodes:function(f,j){var g=b.getNodeInfoByField(f,j,false,true);if(g){if(g.count){var h=g.childs;for(var k in h){if(!h[k].data._inserted){delete g.childs[k];g.count--}}}b.fixedNode(f,j,true)}},getNodeInfoByField:function(h,l,g,n){var o=h.op,j=o._treeStorage,f=l;if(!$.isPlainObject(l)){var k=o.Storage.findOne(function(q,p){return(l==j.getKey(q))?true:false});if(!k){k=j.findOne(function(s,r,p,q){return(l==this.getKey(s))?true:false})}f=k||null}if(f){g&&(f._parents=b.getParentNodes(j,f));n&&(f=j.at(f))}return f},getParentNodes:function(j,h,g){var f=j.getParent(h);if(f){if(g){g.unshift(f)}else{g=[f]}arguments.callee(j,f,g)}return g},insertToChilds:function(g,t,r,h){if(t.length){var p=h.getKey(g),f,q,k,j;for(var n=0,o;o=t[n];n++){k=null;f=o._tempPos;q=h.getParentKey(o);if(!f&&q==p){r.unshift(o)}else{for(var s=0,l;l=r[s];s++){j=h.getKey(l);if(!f&&q==j){k=s+1}else{if(f==j){k=s||1}}if(k){r.splice(k,0,o);break}}}}}return r}};var a={updateTotal:function(f){f.lazyLoad&&(f.pagerOp.pageInf.totalRows=f.Storage.len())},loadChild:function(p,g){var n=g.op,k=n.rowRenderOp,f,j=p.attr("_lz"),s=p.hasClass("tree-close"),q=p.parents("tr:first"),r=b.getDeep(q),o=g.getRowIndex(q),h=n.Storage.at(o),l=Jalor.DataHelper.getObj(k.field,h);delete h._lazyLoad;if(s){delete h._opened;this.removeChild(g,n,r,o+1)}else{if(k.onlyExpandDeep!=null&&r<=k.onlyExpandDeep){this.onlyExpandNode(g,n,n._treeStorage.dataset.childs,h._treeNo.split("."),0)}h._opened=true;this.bindChild(g,n,h,p,l,h.rowIdx+1,j)}},onlyExpandNode:function(h,n,j,l,f){var g;for(var k in j){g=j[k].data;if(g._opened){if(g._treeNo.split(".")[f]!=l[f]){delete g._opened;this.removeChild(h,n,g._deep,g.rowIdx+1)}else{if(j[k].count>1){this.onlyExpandNode(h,n,j[k].childs,l,f+1)}}}}},removeChild:function(l,o,g,k,j){var h=0,f=o.Storage.at(k),n=f?f._deep:0;while(n>g){f=o.Storage.at(k+(++h));n=f?f._deep:0}if(h){o.Storage.dataset.splice(k,h);(j!=false)&&this.treeLoad(l,o)}},initRowRenderAjax:function(l,h,g,j,f){if(l.ajax||l.url){var k=$.extend({},l.ajax)||{url:l.url};if(k.url){if(k.url.indexOf("{0}")>0){k.url=k.url.formatText(g)}else{k.url=k.url.formatField(h)}}k.success=function(n){j&&j(n.result||n)};k.error=function(q,p,o,n){h._opened=false;f&&f(q,p,o,n)};Jalor.UI.ajax(k)}},bindChild:function(j,o,h,n,f,g,l){var k=o._treeStorage.at(h);if(l){a.initRowRenderAjax(o.rowRenderOp,h,f,function(p){a.appendChild(j,o,n,g,k,p)});return false}this.appendChild(j,o,n,g,k)},appendChild:function(f,l,o,n,j,k){var g=l._treeStorage,p;if(k&&k.length){g.insert(j,k);j.data._childCount=j.count}p=g.toggleNode(j,true);if(p.length){j.data._opened=true;var h=l.Storage.store();var q=h.splice(n,h.length);Array.prototype.push.apply(h,p);Array.prototype.push.apply(h,q);this.treeLoad(f,l)}else{delete j.data._lazyLoad;delete j.data._hasChild;delete j.data._opened;o&&o.length&&o.removeAttr("_lz").removeAttr("eno").removeClass("tree-open")}},treeLoad:function(f,h,g){h._scrollLoading=true;g&&h.Storage.store(g);f.reload();delete h._scrollLoading}};e.checkTreeNode=function(g){var f="";if(g._hasChild||g._lazyLoad){f=" tree-open";if(!g._opened){f+=" tree-close"}}return f};e.setCustomIcon=function(h,g){var j=g.op.rowRenderOp&&g.op.rowRenderOp.customIcon,f="",k;if(h._hasChild||h._lazyLoad){f="tree-open";if(!h._opened){f+=" tree-close"}}if(j){k=(typeof j=="function")?j.call(g,h):(j[h._deep]||j.def);if(f){k+=(f.indexOf("close")>0)?"-close":"-open"}}return"class='tree-icon {0}'>{1}".formatText(k?f:"tree-node "+f,k?"<a class='"+k+"'></a>":"")};Jalor.UI.XControl.extendIManager("XGrid",{treeFilter:function(f,h,j,g){return this.op._treeStorage.nodeFilter(f,h,j,g)},treeLoad:function(f){a.treeLoad(this,this.op,f);a.updateTotal(this.op);this.getBodyPanel().scrollTop(0)},getNodeByField:function(f){b.getNodeInfoByField(this,f)},goToNode:function(g,f){b.fixedNode(this,g,false,f)},reloadChildNodes:function(f){b.reloadChildNodes(this,f)}})})(Jalor.UI.IGrid,Jalor.UI.IGrid.Const);(function(c){var b=c.Const.I18n.header={sortType:"jalor.common.igrid.sortType",remoteSort:"jalor.common.igrid.remoteSort",staticSort:"jalor.common.igrid.staticSort",sortAsc:"jalor.common.igrid.sortAsc",sortDesc:"jalor.common.igrid.sortDesc"};var a=c.header={setCol:function(e,d,f){if(!d.hidden){d.headHtml="<span>"+(d.header||d.customHeader||"")+"</span>";if(!d.inner&&!d.columnType){if((f.allowSort&&d.sortable!==false)||(f.allowFilter&&d.filter&&f.switchMode!="search")){a.setSort(e,d)}f.allowResize&&d.resizable!==false&&a.setResize(e,d)}else{f.allowResize&&d.resizable&&a.setResize(e,d)}}},setSort:function(f,e){e._headCss+=" sort";e.sortField||(e.sortField=e.field);var d=f.op.sort,g;if(d||e.sort){if(d){g=d.split(" ");if(g[0]==e.sortField){e.headHtml="<div class='g-sort active "+g[1]+"'></div>"+e.headHtml}else{e.headHtml="<div class='g-sort'></div>"+e.headHtml}}else{f.op.sort=e.sortField+" "+e.sort;e.headHtml="<div class='g-sort active "+e.sort+"'></div>"+e.headHtml}}else{e.headHtml="<div class='g-sort'></div>"+e.headHtml}},sortClick:function(e,d){var h=Jalor.UI.IGrid.Helper.getGrid(e).manager(),l=h.op,k=e.children().children(".g-sort"),g=d.hasClass("asc")?"asc":"desc",f=h.getColumnOp(e).sortField,j=".active";h.getHeadTable().find(".active").attr("class","g-sort");k.addClass("active "+g);l.sort=f+" "+g;if(!l.fnSort||l.fnSort.call(h,f,g,e)!==false){!l._loadType&&(l._loadType="sort");if(l.remoteSort){h.reload(true)}else{l._staticSort=true;l.Storage.sort(f,g);h.reload()}}},autoSize:function(d){d.op.wrapHead||d.getHeadTable().find("span").each(function(){var e=$(this);e.parent().attr("minwidth",e.width()+30)})},setResize:function(e,d){e.op._resizeColNum++;d.headHtml="<div eno='resize' class='g-resize disabled'></div>"+d.headHtml},bindResize:function(g,j){a.autoSize(g);var f,e,d=$.create("div","jalor-igrid-moveLine").appendTo(g.getContent());var h={target:".g-resize",handler:d,virtual:false,fixed:{y:-2},fnFiexdPosition:function(l,n,k){n.top=0;n.left+=l.parent().position().left;return n},onDragStart:function(q,s,k,l){var t=l.parent(),o=t.position().left,r=g.getContent(),n,p;e=o+(j.wrapHead?50:(t.attr("minwidth")*1+30));f=r.width()+200;if(j.beforeColResize){j.beforeColResize.call(g,n,t)}if(!j.percentWidth){if(g.getBodyPanel().height()<g.getBodyTable().outerHeight()){p=o+g.getScrollPanelWidth()-17}else{p=o+g.getScrollPanelWidth()-1}f=Math.min(f,p-5);n=g.getColumnOp(t);if(j.allowFreezen&&n.freezeable){f=t.width()+p}}(f<e)&&(f=e);k.height(r.height())},onMoving:function(n,o,k,l){if(o.left>f){o.left=f}else{if(o.left<e){o.left=e}}k.css("left",o.left);return false},onDroped:function(q,r,l,o){var k=o.parent(),n=g.getColumnOp(k),p=r.left-k.position().left+(k.width()-o.position().left);if(!j.fnResize||j.fnResize.call(g,p,n,k)!==false){n.width=p;g.setColWidth(k,p);l.hide();e=null}k.one("click.current",function(){return false});setTimeout(function(){k.unbind("click.current")},10)}};g.getHeadTable().drag(h)},customHead:function(d,f){var e=$(f.customHead);e.length&&a.setTd(d,f,e)},setTd:function(e,f,d){e.getHeadTable().children(".igrid-head").html(d.children().html()).find("td[field]").each(function(j){var o=$(this),l=o.attr("field"),g=Jalor.Format.getArrayItem(l,f.columns,"_ctype");o.addClass("grid-cell "+g._indexCss+" "+(g._headCss||g.headCss||"")).attr("_col",g._i);g.headENo&&o.attr("eno",g.headENo);var k=Jalor.Format.getPixe(g.width);o.width(k);var n=o.children();if(n.length){n.addClass("igrid-innercell");n.attr("minwidth",30);n.append(g.headHtml)}else{var h=["<div class='igrid-innercell'"];h.push(">",g.headHtml,"</div>");o.html(h.join(""));o.children("div").attr("minwidth",30)}})}};Jalor.UI.XControl.addPlugin("XGrid","header",{build:function(d,e){e.handler.setColumn.add(a.setCol);if(e.allowSort){e.headMenus=[{text:"jalor.common.igrid.sortAsc",click:a.sortClick,css:"asc",icon:"sort-asce"},{text:"jalor.common.igrid.sortDesc",click:a.sortClick,css:"desc",icon:"sort-desc"}];e.handler.click.add("sort",a.sortClick)}if(e.allowResize){e._resizeColNum=0;e.handler.initComplete.add(a.bindResize)}if(e.customHead){e.allowFilter=false;e.handler.initComplete.add(a.customHead)}},individuation:function(e,h,g,f,d){if(h.allowSort&&h.remoteSort){if(!h.lazyLoad){g.remoteSort={type:"bool",ePropConf:true,ePropName:b.sortType,editor:"enum",format:{isBool:true,data:[{value:true,text:$i18n(b.remoteSort)},{value:false,text:$i18n(b.staticSort)}]}}}f.push({field:"sort",width:80,header:b.sortType,cssName:"center",type:"enum",format:{data:[{value:"asc",text:$i18n(b.sortAsc)},{value:"desc",text:$i18n(b.sortDesc)}]},editorOp:{conf:{combo:false}},fnEndEdit:function(o,n,p,l,k){var j;this.op.Storage.filter(function(q){if(q.sort){j=q}q.sort=null});if(j){this.getCellByField(j._index,"sort").attr("val","").html("")}}});d.changeHandler.remoteSort=function(o,p,n){if(h.rowRender=="group"||h.rowRender=="rowSpan"){var j=this.findByName("rowRenderOp.order"),l=j.parents("tr:first");if(p){l.show().prev().show()}else{j.children(":last").manager().setValue(h.rowRenderOp.order||[]);l.hide().prev().hide()}}var q=this.findByName("columns").manager(),k;if(p){q.hideColumns()}else{k=q.getCellByField(0,"sort").attr("_col")*1;q.hideColumns(k,k+1)}}}}})})(Jalor.UI.IGrid);(function(b){Jalor.UI.XControl.extendIManager("XGrid",{colsort:function(){var h=this.op,f=h.columns,e=a.getOrderColumns(h);for(var d=0,c;c=e[d];d++){if(c.inner||c.columnType||!c.field){c._colsort=-1;continue}c._colsort=d+1;if(isNaN(c.colsort)){c.colsort=c._colsort}}var g=-1000;$.each(h.columns,function(){if(this.inner||this.columnType||!this.field){this.colsort=g++}});Jalor.DataHelper.sort("colsort","asc",h.columns);$.each(h.columns,function(){if(this.colsort%1==0){delete this.colsort}})}});var a=b.colSort={init:function(d,e){a.setIndex(d);var c=$.create("div","jalor-igrid-colpanel").appendTo(d.getContent()).data("indexCache",{});c.append($.create("div","jalor-igrid-colpanel-move"));c.append('<div class="btn clear"><span class="jalor-button jalor-botton-main"><a  class="jalor-icon confirm"></a><label>{0}</label></span><span  class=jalor-button><a  class="jalor-icon cancel"></a><label>{1}</label></span></div>'.formatText($i18n("jalor.common.button.ok"),$i18n("jalor.common.button.cancel")));c.find("span.jalor-button:first").click(function(){a.drop(d,c)}).next().click(function(){c.hide();$(document).off("mousemove.drag")});d.getHeadTable().drop({activePanelCss:"",target:"td",getSignTarget:function(){return c.find("li")},clickable:true,offset:true,panels:c.find("div.jalor-igrid-colpanel-move"),fnFiexdPosition:function(g,k,f,j,h){k={left:h.pageX-20,top:h.pageY-10};return k},onDragStart:function(j,k,f,h){if(!h.is("td[field]")){return false}else{var g=a.start.call(this,j,d,c);if(g===false){return false}h[0]=c.find("li[field='"+h.attr("field")+"']").addClass("self")[0]}f.addClass("jalor-igrid-movecol").css({width:0,height:0}).html(h.html())},onDroped:a.onDroped})},setIndex:function(g){var h=g.op,f=h.columns,e=a.getOrderColumns(h);for(var d=0,c;c=e[d];d++){c._colsort=d+1}},start:function(k,g,d){var h=g.getContent(),j=$(this).attr("field");var f=g.op._columnMap[j],c=h.children(".jalor-igrid-moveLine");if((c.length>0&&c.css("display")!="none")||f.inner||f.columnType){return false}d.show();a.initDrop(d,g);a.createColPanel(g,d,j);g._colSortPanelText=d.text()},drop:function(d,c){c.hide();$(document).off("mousemove.drag");if(d._colSortPanelText!=c.text()){a.colSort(d,c)}},initDrop:function(c,d){if(c.attr("init")){return}c.drop({activePanelCss:"",target:"li",panels:c.find("div.jalor-igrid-colpanel-move"),fnFiexdPosition:function(f,l,e,k){var g=d.getContent();e.text(f.text()).addClass("jalor-igrid-movecol");var j=g.offset().left,h=g.offset().top;l={left:l.left+j,top:l.top+h};return l},onDragStart:function(h,j,f,g){if(!g.is("li[field]")){return false}else{c.find("li.self").removeClass("self");g.addClass("self")}},onDroped:a.onDroped});c.attr("init",true)},onDroped:function(j,k,c,d,h){var f=d.parents(".jalor-igrid-colpanel"),l=h.actives&&h.actives.item;var n=f.find("li.self");if(h.actives&&h.actives.item&&!n.hasClass("hidden")&&!n.parent().hasClass("jalor-igrid-colpanel-freezen")){var g=h.actives.item.parent(".jalor-igrid-colpanel-freezen").length?3:2;if(f.find("ul.jalor-igrid-colpanel-free").children().not(".hidden").length<g){Jalor.UI.topBox("jalor.common.message.notFreezeAll");return false}}if(h.actives&&!h.actives.item){h.actives.panel[0]=f.find("ul.jalor-igrid-colpanel-free")[0]}if((l&&l[0]!=d[0]&&a.getPrevCol(l)[0]!=d[0])||(!l&&f.find("li:last")[0]!==d[0])){d.attr("move",true)}return true},createColPanel:function(c,f,k){var l=["<ul class='jalor-igrid-colpanel-freezen'><A class='jalor-icon lock' title=lock></A>"],h=this.getOrderColumns(c.op),d=false;for(var g=0,e;e=h[g];g++){var j=e.field;if(!e.freezeable&&!d){l.push("<li class='jalor-igrid-colpanel-line'>line</li></ul><ul class='jalor-igrid-colpanel-free'>");d=true}var n=(j==k?" self":"")+(e.freezeable?" freeze":"")+(e.hidden?" hidden":"");l.push("<li field='{0}' class='{1}' index={2}>{3}</li>".formatText(j,n,e._colsort++,e.header?$i18n(e.header):e.customHeader))}if(!d){l.push("<li class='jalor-igrid-colpanel-line'>line</li></div>")}l.push("</ul>");f.find("div.jalor-igrid-colpanel-move").html(l.join(""))},getOrderColumns:function(e){var d=[],c=[];$.each(e.columns,function(g,f){if(f.inner||f.columnType||!f.field){return}(e.allowFreezen&&f.freezeable?d:c).push(f)});return d.concat(c)},colSort:function(c,f){var h=c.op;var d=h.columns,g=[],l=[],j=[],k=[];$.each(h.columns,function(o,n){if((n.inner||n.columnType||!n.field)&&!n.lockEnd){g.push(n)}});var e=null;f.find("li[field]").each(function(p){var n=$(this),s=n.attr("field"),o=h._columnMap[s];var r=n.is("[move]"),q=false;if(r){o.colsort=e?((e.colsort||e._colsort)+0.01):0.01;q=true}else{if(e&&o.colsort&&o.colsort==e.colsort){o.colsort+=0.01;q=true}else{o.colsort=o._colsort;q=true}}if($(this).nextAll("li.jalor-igrid-colpanel-line").length>0){if(!o.freezeable){o.freezeable=true;q=true}}else{if(o.freezeable){q=true;o.freezeable=false}}g.push(o);q&&j.push({field:o.field,hidden:o.hidden,freezeable:o.freezeable,colsort:o.colsort});e=o});$.each(h.columns,function(o,n){if((n.inner||n.columnType||!n.field)&&n.lockEnd){g.push(n)}});h.columns=g;c.op.customSetting&&c.saveCustom({hasColSort:true,showMessage:false,columns:j});f.empty();h._scrollTop=c.getBodyPanel().scrollTop();c.reInit({_hasColSort:true,columns:g})},getPrevCol:function(c){var d=c.prev("li");if(d.length==0){d=c.parent().prev(".jalor-igrid-colpanel-freezen").children("li[field]:last")}return d}};Jalor.UI.XControl.addPlugin("XGrid","colsort",{build:function(c,d){if(!d.customHead&&d.colsort!==false){d.handler.initComplete.add(a.init)}},clear:function(c,e,d){if(d._scrollTop){e._scrollTop=d._scrollTop}if(e.Storage&&e.Storage.dataset.length>0){e.autoLoad=true}}})})(Jalor.UI.IGrid);(function(c,a){Jalor.UI.XControl.extendIManager("XGrid",{getEditPanel:function(){return DomClass.getProp(this,this.getBodyPanel(),"pedit",".jalor-igrid-editpanel",true)},getActiveEditor:function(){return $.isEmptyObject(this.op._activeEditor)?null:this.op._activeEditor},clearActiveEditor:function(){var d=this.op._activeEditor;if(d){$.each(d,function(e,f){b.cancelEdit(f)});this.op._activeEditor={};this.op._activeEditTr=this.op._activeTd=null}},endEdit:function(){var d=this,e=d.getActiveEditor()||[];$.each(e,function(f,g){b.endEdit(g,d,d.op)});d.clearActiveEditor()},getUpdatedRecords:function(){return this.op.Storage.getUpdatedRecords()},getRecords:function(){var d=this.op.Storage.getChangedRecords();if(d.insertedRecords.length||d.updatedRecords.length||d.deletedRecords.length){return d}else{return null}},getUnvariedRecords:function(){var d=this.op.Storage.filter(function(f,e){if(!(this.isNew(f)||this.isUpdated(f)||this.isDeleted(f))){return f}});return d},getAllRecords:function(d,f,h,g,e){if(typeof(d)=="boolean"){e=d;d=null}return this.op.Storage.filter(d,f,h,g,e)},getValidRecords:function(d){return this.valid(d)},validRecords:function(d,h){var f=this;if(d&&d.length){var e=f.getEditPanel().children().data("validator"),g;$.each(d,function(k,j){if(!f.validRecord(j,e)){g=true;return false}});return g?false:true}return(h!=null)?h:true},validRecord:function(e,g){!g&&(g=this.getEditPanel().children().data("validator"));var h=g.valid(e),f=this,l=f.op,k,j=l.pagerOp&&l.pagerOp.pageInf;if(h!==true){if(e._cachePos!=null&&!e._newIndex){dataIndex=(e._cachePos==0)?(e._index+1):(e._cachePos+1);if(j&&(dataIndex<=j.startIndex||dataIndex>j.endIndex)){return false}}for(var d in h){k=f.getCellByField(e.rowIdx,d);k.length&&b.callDataEditor(f,f.getColumnOp(k),e,e.rowIdx)}return false}return true},setErrorMsg:function(d){var g=this;if(d&&d.length){var h={},e,f=Jalor.Validator.create({fields:g.op.validOp.rule});$.each(d,function(o,j){var n=f.valid(j);if(n!=true){var l=0;for(var k in n){l++}n.lenght=l;e=$.newGuid();j._errorNo=e;h[e]=n}});if(!$.isEmptyObject(h)){g.op._errorMsg=h;return true}return false}return false},validEditor:function(g){var e=this,d=true,f=e.getActiveEditor();if(f){$.each(f,function(h,k){var j=k.children(".grid-editor"),l=j.data("caller");if(!e.getColumnOp(l).editor.valid(j)){g&&j.focus();d=false;return}})}return d},valid:function(g){if(b.check(this,true)){var f=this.op;f._endEditTriggerTr&&b.endRowEdit(this,f);var d=b.checkData(this,g);if(!d){var e=this;$.each(e.getActiveEditor()||[],function(o,n){var l=n[0].offsetLeft+n.width(),t=n[0].offsetTop,p=e.getBodyPanel(),h=p.width(),j=p.scrollTop(),s=p.height()+j,k=l-h,r=t<j||t>s;if(k>0||r){e.syncScroll(k>0?k:null,r?t:null)}var q=n.children(".grid-editor").data("caller");q&&e.scrollTo(e.getColumnOp(q));return false})}return d}return false},callEditor:function(e){var d=b.callEditor(null,e,this);(d!==false)&&this.setFocusRow(this.getCellRow(e));return d},triggerRowEditor:function(e,d){this.setFocusRow(e);b.triggerRowEditor(e,this,d)},updateCellData:function(d,g,e){var f=this.getColumnOp(d),h;if(f.editable!==false&&!b.compareValue(g,e)&&this.cellValue(d,f,g,true)!==false){h=f.rule?Jalor.Validator.valid(g,f.rule):true;if(h==true){!this.isNewRow(d.parents("tr:first"))&&d.addClass("cell-update")}else{d.addClass("grid-tip igrid-servervalid-error").attr("tip",h);this.op.showStatus&&b.updateErrorMsg(this,this.getRowData(d),this.getValueField(f.field),h)}}}});var b=c.Editor={setCol:function(e,d,g){if(!d.inner&&!d.columnType&&d.editable!==false){d.editorOp=$.extend({type:d.type,field:d.valueField||d.field,format:d.format,rule:d.rule},d.editorOp);if(!d.editor||typeof(d.editor)=="string"){d.editor=Jalor.Editor.get(d.editor||d.editorOp.type)}if(g.editMode!="insert"){g.showColumnIcon&&(d._headCss+=" editor");g.customTable&&(d.cssName+=" editor")}d.eNo=(e.op.editMode=="insert")?("<% if (data._inserted) { %>edit<% } else { %>noedit<% } %>"):"edit";var f=$.extend({},d);f.field=f.valueField||f.field;g.modalOp.fields.push(f);b.setValid(g,d)}},setValid:function(e,d){if(d.valid!==false&&d.editorOp.rule){e.validOp.rule[d.valueField||d.field]=d.editorOp.rule;if(d.editorOp.rule.required){e.customTable?(d.attr._required="required"):(d.headHtml+="<font color='red'>&nbsp;*</font>")}}},buildPanel:function(f,h){if(!h.modal){h.modal=Jalor.Modal.create(h.modalOp)}var g=$.create("div").appendTo(f.getBodyPanel()).xForm({showHead:false,tagName:"div",innerButton:false,renderType:"edit",modal:h.modal,layout:"gridedit",buildControlTag:false}).dom.addClass("jalor-igrid-editpanel").bind("click focusin",function(j){h._inEdit=true}).focusout(function(j){if(!$(j.relatedTarget).hasClass("igrid-scroller")||!h.rowEdit){h._inEdit=null;h._editClose&&clearTimeout(f.op._editClose);h._editClose=setTimeout(function(){h._inEdit||b.check(f);delete h._editClose},200)}}).keydown(function(j){return b.keydown(f,j)}).submit(function(j){return false});for(var d,e=0;d=h.columns[e];e++){if(!d.inner&&!d.columnType&&d.editable!==false){d._editCtr=g.find("[name='"+(d.valueField||d.field)+"']").attr("eno","edit").addClass("grid-editor").removeClass("jalor-control");d._editCtr.parent().attr("_col",d._i)}}},keydown:function(d,y){if(y.keyCode==9){var x=$.getEventTarget(y),l=x.data("caller"),g=d.getEditPanel().find(".grid-editor"),j=g.filter(":visible");if(x[0]==j[y.shiftKey?0:j.length-1]){x.data("ctr_locked",false);x.hasClass("jalor-dropdown")&&x.manager&&x.manager().getSelector&&x.manager().getSelector().hide();if(b.check(d)){var k,f=d.getOrderColumns(),q=l.attr("_col")*1,t=y.shiftKey?-1:1;for(var v=0,h;h=f[v];v++){if(h._i==q){q=v;break}}for(var v=q+t,h;h=f[v];v+=t){if(h.editable!==false){k=d.scrollTo(h);$("a:first").focus();if(k.is("[eno='edit']:visible")&&b.showEditor(k,d)!==false){return false}}}var p=l.parents("tr:first"),o=p.attr("_row")*1;q=y.shiftKey?f.length-1:0;var s=y.shiftKey?p.prevAll("tr.grid-row:first"):p.nextAll("tr.grid-row:first");if(s.length==0){return true}d.setFocusRow(s);p.removeData("focusin");for(var v=q;h=f[v];v+=t){if(h.editable!==false){k=d.scrollTo(h);$("a:first").focus();if(k.is("[eno='edit']:visible")&&b.showEditor(k,d)!==false){return false}}}}else{return false}}else{for(var v=0;v<j.length;v++){if(j[v]==x[0]){break}}var w=$(y.shiftKey?j[v-1]:j[v+1]).parent().attr("_col");if(w){setTimeout(function(){d.scrollTo(d.op.columns[w])},0)}}}else{if(y.keyCode==27){if(d.op.usingEsc!==false){var x=$(y.target);if(!x.hasClass("grid-editor")){return false}else{var n=x.data("old-val"),r=d.getEditPanel().find(".grid-editor:visible"),h=d.getColumnOp(x.data("caller"));if($.isPlainObject(n)&&Jalor.DataHelper.isEmpty(n.value)){return false}else{if(Jalor.DataHelper.isEmpty(n)){return false}}if(r.length==1){var u=d.getBodyPanel();if(u.data("isFixed")){u.css("min-height",d.op.minHeight||"");u.data("isFixed",null)}b.cancelEdit(x.parent(),d.op);n=""}h.editor.setValue(x,n)}}return false}}return true},callEditor:function(f,g,d){if(g.isVisiable()&&!g.hasClass("grid-editor")&&(!d.getCellRow(g).hasClass(a.deleted.css)||g.attr("rowspan")*1>1)){if(b.check(d)!==false&&g.parent().length>0){d.op._inEdit=true;d.op._activeEditor={};return b.showEditor(g,d)}}return false},showEditor:function(l,e,j,d){var k=e.op,h=e.getCellRow(l),g=e.getRowData(h);d||(d=e.getColumnOp(l));if(l.hasClass("igrid-servervalid-error")){l.removeClass("igrid-servervalid-error grid-tip").removeAttr("tip");b.updateErrorMsg(e,g,e.getValueField(d.field),null,true)}if(!h.data("focusin")){h.data("focusin",true);if(k.fnBeforeRowEdit){if(k.fnBeforeRowEdit.call(e,g,h)===false){return false}}}if(k.fnBeforeEdit){var f=e.cellValue(l,d);if(k.fnBeforeEdit.call(e,f,l,d,g)===false){return false}}if(k.rowEdit){b.triggerRowEditor(h,e,d);return}this._showEditor(l,e,d,h)},_showEditor:function(h,e,d,g,f){d||(d=e.getColumnOp(h));if(!f&&d.editorOp&&d.editorOp.trigger){this.showTrigger(d.editorOp.trigger,g,e)}this.setEditor(e,h,d,f);if(!f&&d.editorOp&&d.editorOp.afterTrigger){this.showTrigger(d.editorOp.afterTrigger,g,e)}},triggerRowEditor:function(f,e,d){var g=e.op;g.rowEdit=true;f.find("[eno='edit']").each(function(){var j=$(this),h=e.getColumnOp(j);if(!g.fnCheckRowEditor||g.fnCheckRowEditor.call(e,j,f,h,d)!==false){Jalor.UI.setCtrHandler(h._editCtr,"fnLocked",function(k){if(this.data("ctr_locked")===false){this.removeData("ctr_locked")}g._rowLocked=k});b.setEditor(e,j,h,d._i!==h._i)}})},setEditor:function(f,k,d,j){if(d.editor){var h=f.cellValue(k,d),g=d._editCtr;if(d.editor.type=="ldap"){g.attr("title",h.text)}$.type(h)=="date"&&(h=h.getUTCTime());d._editCtr.data("old-val",h).data("caller",k);d.editor.setValue(g,h);b.setStyle(f,g,k,d,j);if(!j){f.op._activeTd=k;var e=g[0].tagName;if(e=="TEXTAREA"||(e=="INPUT"&&g.attr("type")=="text")){g.select()}g.focus();setTimeout(function(){g.focus()},10)}}},showTrigger:function(e,f,d){$.each(e,function(g,h){var j=f.find("[field='"+h+"']");j.length&&b._showEditor(j,d,null,f,1)})},setStyle:function(e,g,k,d,f){var h=g.parent(),j=e.op;g.manager().hide(true);this.fixPosition(e,g,k,h,d,f);j._activeEditor[h.attr("_col")]=h;j._activeEditTr=e.getRowIndex(k.parent())},activeEditor:function(e,d){var g=e.getActiveEditor(),f=e.getBodyPanel();if(g){$.each(g,function(h,j){var k=j.children(".grid-editor").data("caller").position();j.css({left:k.left+1,top:k.top+1+f.scrollTop()})})}},fixPosition:function(d,z,p,x,j,s){var l=p.position(),h={left:l.left+1,top:l.top+1},f=d.getBodyPanel().scrollTop(),v=p.outerWidth()-2,t=p.outerHeight()+1,y,g=z[0].tagName;x.outerHeight()<t&&x.height(t-3);j||(j=d.getColumnOp(p));if(v<5){if(s){return}d.scrollTo(j);v=p.outerWidth()}if(j.fnFixEditor){j.fnFixEditor(d,z,p,x,j,h)}else{if(z.attr("type")=="text"||g=="SELECT"||g=="TEXTAREA"){z.width(v-2);y=1}else{v-=1;h.left+=1;if(!d.op.customTable){z.width("").css("margin-left",0);var q=z.outerWidth(true),w=z.outerHeight(true);if(q>v){z.width(v)}else{z.css("margin-left",(v-q)/2)}}}h.top+=f}var A=false;if(d.getBodyPanel().width()==d.getBodyPlace().width()){A=true}x.css(h).show();if(A&&d.getBodyPanel().width()!=d.getBodyPlace().width()){var o=j.editorOp;if(o&&o.conf&&o.conf.multi&&o.conf.showType=="textarea"||o.type=="textarea"){h.left=p.position().left+1;x.css(h).show();d.getHeadTable().parent().css("padding-right","17px")}}else{x.show()}if(y){var u=x.attr("fix");if(u==null){u=z.innerWidth()-z.width();if(u<=2){z.width(0);var k=z.parent().children();if(k.length!=1){var n=k.first().position().left,r=k.last(),e=r.position().left+r.outerWidth();u=e-n-z.innerWidth()+7}}x.attr("fix",u)}var o=j.editorOp;if(o&&o.conf&&o.conf.multi&&o.conf.showType=="textarea"){z.width(v-5)}else{z.width(v-2-u*1)}}x.width(v);z.data("fixedX",h.left-l.left)},endEdit:function(z,d,p){var q=true,B=z.children(".grid-editor");if(B.data("ctr_locked")||p._rowLocked){return q}var n=B.data("caller");if(n){var l=d.getColumnOp(n),f=d.getCellRow(n);if(l.editor.valid(B)){var x=l.editor.getValue(B,true);if(!this.compareValue(x,B,l)){if(d.cellValue(n,l,x,true,B.data("old-val"))!==false){if(!d.isNewRow(f)){n.addClass("cell-update");f.hasClass(a.updated.css)||f.addClass(a.updated.css)}p._isChangeValue=true}}B.removeData("old-val").removeData("caller");if(p.fnEndRowEdit&&p._isChangeValue&&!p._endEditTriggerTr){p._endEditTriggerTr=f;p._endEditTriggerTrTime=setTimeout(function(){b.endRowEdit(d,p)},500)}p.showStatus&&d.updateStatus("error")}else{if(p.weakValid===true){var k=$("#"+d.id+"_weakPanel");!k.length&&(k=$('<div id="'+d.id+'_weakPanel"></div>').appendTo(d.getBodyPanel()));var h=z.find("label");var s=z.position();s.top+=d.getBodyPanel().scrollTop();var o=$("<div style='position:absolute;'></div>").css(s).width(z.width()).append(h).appendTo(k);h.position().top>0&&h.css("top",n.outerHeight());B.removeClass("error error-ctr");setTimeout(function(){o.remove();d.getBodyPanel().css("min-height",p.minHeight||"")},3000)}else{q=false}var A=z[0].offsetLeft+z.width(),e=z[0].offsetTop,r=d.getBodyPanel(),w=r.width(),g=r.scrollTop(),u=r.height()+g,j=A-w,t=e<g||e>u;if(j>0||t){d.syncScroll(j>0?j:null,t?e:null)}}}if(q){var y=d.getBodyPanel();var v=y.css("min-height");if(y.data("isFixed")){y.css("min-height",p.minHeight||"");y.data("isFixed",null)}if(p.weakValid===true||0<d.getEditPanel().find("div:visible label.error").length){y.css("min-height",v||"")}B.manager().hide();z.hide().css("height","");delete p._activeEditor[z.attr("_col")];p._activeTd=null;$.isEmptyObject(p._activeEditor)&&(p._activeEditTr=null);p.percentWidth&&c.Factory.fixScroll(d,p)}return q},endRowEdit:function(e,h){var d=e.getFocusRow(),f=h._endEditTriggerTr;if(!d.length||e.getRowIndex(d)!=e.getRowIndex(f)||!h._inEdit){var g=e.getRowData(f);if(h.fnEndRowEdit.call(e,g,f)==true){e.renderRow(f,g)}f.removeData("focusin");h._isChangeValue=null}clearTimeout(h._endEditTriggerTrTime);h._endEditTriggerTr=h._endEditTriggerTrTime=null},cancelEdit:function(e,f){var d=e.css("height","").hide().children(".grid-editor.error");d.removeClass("error").next(".error").remove();if(f){f._activeEditor={};f._activeEditTr=f._activeTd=null}},compareValue:function(j,h,e,f,d){!d&&(d=h&&h.jquery?h.data("old-val"):h);if($.isPlainObject(j)){return j.value==d.value}else{var g=$.type(j);if(g=="date"){return j-d==0}return Jalor.DataHelper.isEmpty(d)===Jalor.DataHelper.isEmpty(j)&&j==d}},check:function(e,g){var d=true,f=e.getActiveEditor();if(f){$.each(f,function(h,j){if(!b.endEdit(j,e,e.op)){g&&j.focus();d=false;return}})}return d},initValid:function(e,f){var d=e.getEditPanel().children().data("validator");d&&(d.errorPlacement=function(g,h){b.showError(e,g,h)})},showError:function(e,j,f){var g=f.data("caller");if(g){j.text(j.text());j.width(f.width()-10).addClass("error");f.addClass("error").after(j);var k=f.parent().position().top,l=f.outerHeight(),h=e.getBodyPanel(),n=h.height();if(k>n){if(parseInt(f.parent().css("top"))+l>e.getDataBody().height()){l=-j.css({top:l,left:0}).outerHeight()}}else{var d=f.parent().outerHeight()+j.outerHeight();if(d>n-3){h.css("min-height",d+k);!h.data("isFixed")&&h.data("isFixed",true).css("min-height",d+k)}else{if(k>24&&(k+l>n-10)){l=-j.css({top:l,left:0}).outerHeight()}}}j.css({top:l,left:0})}},fixActive:function(d){var g=d.getActiveEditor(),e=d.op.rowEdit,f;if(g){$.each(g,function(h,k){var j=k.children(".grid-editor"),l=j.data("caller");if(l&&l.width()>10){b.fixPosition(d,j,l,k);if(e&&!f&&j.is(":focus")){f=j}}else{k.css("height","").hide()}});f&&f.focus()}},checkData:function(e,g){var f=e.op;if(f.validOp&&!$.isEmptyObject(f.validOp.rule)){var d=e.getRecords();if(d){if(!e.validRecords(d.insertedRecords,g)){return false}if(f.isValidUpdate){if(!e.validRecords(d.updatedRecords,true)){return false}}return d}}return true},callDataEditor:function(f,e,h,d){var g=f.getRow(d),j=f.getRowCell(d,e._i);f.setFocusRow(g);this.showEditor(j,f,true,e);e._editCtr.valid()},updateErrorMsg:function(d,g,l,h,f){var k=d.op,e,n,j;if(f){j=k._errorMsg&&k._errorMsg[g._errorNo];if(j&&j[l]){j[l]=null;j.length--;if(!j.lenght){k._errorMsg[g._errorNo]=null;g._errorNo=null}}}else{e=k._errorMsg?k._errorMsg:(k._errorMsg={});n=g._errorNo?g._errorNo:(g._errorNo=$.newGuid());j=e[n]?e[n]:(e[n]={});j[l]||(j[l]=h);if(j.length){j.length++}else{j.length=1}}}};Jalor.UI.XControl.addPlugin("XGrid","editor",{build:function(d,f){if(f.editMode){f._activeEditor={};f.validOp={rule:{}};if(!f.modalOp||!f.modalOp.fields){f.modalOp={autoAlias:true,modalName:"modal",fields:[],layoutTmpl:""}}var e=f.handler;e.setColumn.add(b.setCol);e.click.add("edit",b.callEditor);e.initComplete.add(b.buildPanel);e.initComplete.add(b.initValid);e.afterBindData.add(function(g,h){g.clearActiveEditor()});e.widthChange.add(b.fixActive);e.scrollX.add(function(g){setTimeout(function(){b.fixActive(g)},320)})}}})})(Jalor.UI.IGrid,Jalor.UI.IGrid.Const);Jalor.ViewLayout.add("gridedit",{layout:'<div class="jalor-igrid-editcell"> ${item} </div>'});(function(d,c){Jalor.UI.XControl.extendIManager("XGrid",{popupEdit:function(f,e){if(f){if("rowIdx" in f){record=f}else{if(f.jquery&&f.is("tr")){record=this.getRowData(f)}else{record=this.op.Storage.findOne(f)}}b.popup(this,record,e||"edit")}else{b.popup(this,null,"create")}}});var a={content:"<div class='igrid-edit-panel'></div>",imgBtn:true,tabId:"defaultTabId",showFoot:false,autoRefresh:true,xFormOp:{renderType:"edit",layout:"form-Flow",showHead:false},create:{xFormOp:{buttons:[{text:"jalor.common.label.save",css:"jalor-button",icon:"confirm",click:function(k,j,f,h,g){if(j.valid()){b.save(j.getValue(),f,h,this,g)}}},{text:"jalor.common.button.cancel",css:"jalor-button",icon:"cancel",click:function(){this.close?this.close():this.removeItem(this.op.tabId)}}]}},edit:{xFormOp:{buttons:[{text:"jalor.common.label.save",css:"jalor-button",icon:"confirm",click:function(k,j,f,h,g){if(j.valid()){b.save(j.getValue(),f,h,this,g)}}},{text:"jalor.common.button.cancel",css:"jalor-button",icon:"cancel",click:function(){this.close?this.close():this.removeItem(this.op.tabId)}}]}},view:{xFormOp:{renderType:"view",layout:"form-Flow",buttons:[{text:"jalor.common.label.close",css:"jalor-button",icon:"cancel",click:function(){this.close?this.close():this.removeItem(this.op.tabId)}}]}}};var b=d.PopupEditor={setCol:function(f,e){if(!e.inner&&!e.columnType&&e.editable!==false){e.editorOp=$.extend({type:e.type,field:e.valueField||e.field,format:e.format,rule:e.rule},e.editorOp);if(!e.editor||typeof(e.editor)=="string"){e.editor=Jalor.Editor.get(e.editor||e.editorOp.type)}var g=$.extend({},e);g.field=g.valueField||g.field;f.op.modalOp.fields.push(g)}},popup:function(e,h,n){var j=e.op,f;if(!j.modal){j.modal=Jalor.Modal.create(j.modalOp)}var g=$.extend(true,{},a,j.popupEditor);g=$.extend(true,{},g,g[n],{xFormOp:{modal:j.modal,dataset:h}});var o=function(r,q){var p=q.xForm(r.xFormOp);r.afterLoad&&r.afterLoad(p,k);if(h){if(!r.beforeSetValue||r.beforeSetValue(h,p,k)!==false){p.setValue(h)}}};var l=g.xFormOp.buttons;l&&$.each(l,function(q,p){!p._click&&(p._click=p.click);p.click=function(s){var r=f.dom.find("div.igrid-edit-panel:first").xForm();p._click&&p._click.call(f,s,r,h,e,g)}});if(g.tab){var f=$(g.tab).manager();f.addItem(g);o(g,f.dom.find("div[tabid='"+g.tabId+"']").find("div.igrid-edit-panel"))}else{var k=Jalor.UI.dialog(null,g.title,g);o(g,k.find("div.igrid-edit-panel"));f=k.manager();f.fixPosition()}},save:function(h,l,g,k,f){if(!f.beforeSave||f.beforeSave(h,l,g,k)!==false){if(!f.autoRefresh){if(l){g.op.Storage.updateItem(l,h);var j=g.getRow(l.rowIdx);g.renderRow(j,g.getRowData(j))}else{g.appendRow([h])}}if(f.editType!="draft"){if(f.save){f.save(h,l,g,k);k.close?k.close():this.removeItem(k.op.tabId);return}var e=$.extend({type:"POST",data:$.extend({},l,h),success:function(){if(f.autoRefresh){g.reload(false,true)}k.close?k.close():k.removeItem(k.op.tabId);f.afterSave&&f.afterSave(h,l,g)}},f.saveAjax);Jalor.Core.ajax(e,k.getBody?k.getBody():k.dom)}}}};Jalor.UI.XControl.addPlugin("XGrid","popupEditor",{preInit:function(e,f){if(typeof f.popupEditor=="object"){if(!f.operation){f.operation={insert:{}}}else{if(!f.operation.insert){f.operation.insert={}}}}},build:function(e,g){var f=g.handler;if(typeof g.popupEditor=="object"){if(!g.modalOp||!g.modalOp.fields){g.modalOp={autoAlias:true,modalName:"modal",fields:[]};f.setColumn.add(b.setCol)}g.handler.click.add("popupedit",function(k,h,j){j.popupEdit($.getEventTarget(k).parents("tr:first"),"edit")});g.handler.click.add("popupview",function(k,h,j){j.popupEdit($.getEventTarget(k).parents("tr:first"),"view")})}}})})(Jalor.UI.IGrid,Jalor.UI.IGrid.Const);(function(c){var b=c.Const.I18n.pager={pagerSave:"jalor.common.message.confpagersave",noResult:"jalor.common.label.noresult",validLose:"jalor.common.igrid.pagervalidlose"};var a={initPager:function(f,g){!g.pagerOp&&(g.pagerOp={});var d=$.create("div","",f.id+"Pager").appendTo(f.getBottom()),e=g.pagerOp.fnBeforeChanged;g.pagerOp.fnBeforeChanged=function(h,p,o,k,j,n){if(!e||e(h,p,o,p.pageSize,j,n)!==false){var q=g.Storage,l=q.getChangedRecords();if(!g._cache&&(l.insertedRecords.length||l.updatedRecords.length||l.deletedRecords.length)){Jalor.UI.confirm(b.pagerSave,function(r){if(r){var s=g.operation&&g.operation.save&&g.operation.save.btn;if(f.valid()&&s){$(s).click()}else{p.curPage=o;p.pageSize=k;p.totalPages=n;j(h,p);Jalor.UI.showMessage(b.validLose,"warn")}}else{j(h,p);g.pagerOp.pageInf=p;f.reload(false,true,true)}},true)}else{j(h,p);g.pagerOp.pageInf=p;f.reload(false,true,true)}}return false};d.pager(g.pagerOp,f);g.handler.afterBindData.add(function(h,j){j._reload||h.getBottom().children(".jalor-pager").pager(j.pagerOp,h)})},initScrollPager:function(f,l,d){l.autoScroll=null;l.ajax&&(l.remoteSort=true);l._scrollOp={start:1,end:l.pagerOp.pageInf.pageSize,pageSize:l.pagerOp.pageInf.pageSize,total:l.pagerOp.pageInf.totalRows};var j=f.op.lazyLoad!="filter"&&l.ajax,h,e={itemHeight:l.rowHeight,pageInf:l._scrollOp,mode:j?"ajax":"filter",dataParam:j?l.ajax:l.handler.dataProcess,target:f.getBodyPlace(),fnLoad:function(n){f.op.ajax&&(f.op.ajax.loading=false);f.op._scrollLoading=true;f.getBodyTable().hide();f.reload(false,f.op.lazyLoad!="filter");f.op._scrollLoading=false}};if(j){e.fnTriggeOver=function(n,r,o){f.clearActiveEditor();f.getBodyTable().hide();if(!h){var q=n.offset(),p=Jalor.UI.loading();p.css({top:q.top+(n.height()-80)/2,left:q.left+(n.width()-200)/2});h=true}};e.fnScrollEnd=function(n,p,o){if(!o){f.getBodyTable().show();Jalor.UI.loadingClose();h=null}}}else{e.delay=0;if(!f._getRowIndex){f._getRowIndex=f.getRowIndex;f.getRowIndex=function(o){var n=this._getRowIndex(o);if(n>-1){return n+l.startIndex-1}return n}}}var g=l.scrollLoader=f.getBodyPanel().scrollLoad(e),k=$.create("div","jalor-pager jalor-pager-number").appendTo(f.getBottom());l.handler.beforeBindData.add(function(n,o){a.setPageInf(n,o);if(o._scrollTop){n.getBodyPanel().scrollTop(o._scrollTop);o._scrollTop=null}});l.handler.afterBindData.add(function(n,o){g.setTotal(o.pagerOp.pageInf.totalRows);n.getBodyTable().show();k.html(a.setScrollPager(n,o));if(h){Jalor.UI.loadingClose();h=null}});if(l.operation){l.operation.search&&l.handler.beforeLoad.add(function(o,p,n){if(n){p.ajax&&(p.ajax.loading=true);g.reset()}});l.operation.insert&&(l.operation.insert._getInsertSet=a.getInsertSet)}},setScrollPager:function(f,g){f.getBodyPanel().find(".grid-no-result").remove();var e=[],d=g.pagerOp.pageInf.totalRows;if(d>0){e.push('<div class="jalor-pager-group msg">',Jalor.UI.Config.pager.text.total.formatText("<font class='total'>"+d+"</font>"),"</div>")}else{if(null!=g.noResultI18n){b.noResult=g.noResultI18n}f.getBodyPanel().append('<div class="grid-no-result">'+$i18n(b.noResult)+"</div>")}return e.join("")},setPageInf:function(d,f){f.startIndex=f._scrollOp.start;var e=f.pagerOp.pageInf;e.pageSize=f._scrollOp.pageSize;e.curPage=parseInt(f.startIndex/e.pageSize)+1},getInsertSet:function(e,l){var f={scroll:false},k=e.getFocusRow();if(e.getSelectedRecords().length){while(k.length){var j=k.prev();if(j.hasClass("igrid-selected")){k=j}else{break}}}if(k&&k.length){f.posTr=k}else{if(l._scrollOp.showStart&&l._scrollOp.showStart>1){var h=e.getRow(l._scrollOp.showStart%l._scrollOp.pageSize);if(h.length){k=h;for(var d=l._scrollOp.showStart;d<l._scrollOp.showEnd;d++){if(e.isNewRow(k)){f.posTr=k;break}k=h.next()}f.posTr||(f.posTr=h)}}}if(f.posTr){var k=f.posTr;while(k.length){if(e.isNewRow(k)&&k.next().length){k=k.next()}else{break}}var g=e.getRowData(k);f.posIndex=g._index}else{l._scrollOp.showStart>1&&(f.posIndex=l._scrollOp.showStart+1)}return f}};Jalor.UI.XControl.addPlugin("XGrid","pager",{build:function(d,e){if(e.showPager){e.lazyLoad?a.initScrollPager(d,e,e.dataset):a.initPager(d,e)}}})})(Jalor.UI.IGrid);(function(c){var a=c.Const.I18n.custom={dialogTitle:"jalor.common.igrid.customSetting",customTitle:"jalor.common.igrid.optionSetting",columnsName:"jalor.common.igrid.columnSetting",columnsDesc:"jalor.common.igrid.columnDesc",colHeader:"jalor.common.igrid.columnName",colWidth:"jalor.common.igrid.width",colFreeze:"jalor.common.igrid.freeze",colHidden:"jalor.common.igrid.hidden",notHiddenMsg:"jalor.common.message.notHiddenAll",notFreezeMsg:"jalor.common.message.notFreezeAll",btnDefault:"jalor.common.button.defalutConfig",msgDefault:"jalor.common.igrid.defalutConfigMsg",changeDataMsg:"jalor.common.igrid.changeDataMsg"};var b=c.Individuation={setCustomProp:function(e,h){if(!h._reIniting){var f=Jalor.ViewLayout.create({layout:'<tr deep="${item.ePropDeep}"><td style="padding-left:${item.ePropPadding}px" class="jalor-igridprop-name ${item.titleMark}"><span>${item.ePropName}</span></td><td class="jalor-prop-input"><div class="igrid-individuation-editor">${item}</div>${item.ePropDesc}</td></tr>',setItemOp:function(l){l=this.base.setItemOp.call(this,l);var j=false;for(var k=0,n=h.columns[0];n;k++,n=h.columns[k]){if(n.rule&&n.rule.required||n.hiddenable===false){j=true;break}}if(l.ePropDesc&&j){l.ePropDesc='<div class="jalor-msg msg-tip"><a class="jalor-icon warning nocursor"></a><b class="i18n" i18nKey="jalor.common.message.topBoxIcon"></b><span> '+l.ePropDesc+"</span></div>"}else{l.ePropDesc=""}return l}},"prop"),g=Jalor.UI.PropEditor.operateButtons,d={dialogTitle:a.dialogTitle,dialogWidth:600,showLoading:h.customLoading,getChanged:false,arrKeys:{columns:"field"},props:{},config:{},changeHandler:{},layout:f,buttons:[g.save,g.reset,{type:"imgBtn",icon:"confirm",cls:"jalor-icon",text:a.btnDefault,click:function(){var j=$("#propGrid").parents("form:first").manager().op.defConfig;b.execSaveProp(e,null,j,$(this))}},g.cancel],fnSave:function(j){b.execSaveProp(e,j,this.defConfig)},fnComplete:function(){if(!this.op.config.remoteSort){if(h.rowRender=="group"||h.rowRender=="rowSpan"){this.find("[name='rowRenderOp.order']").parents("tr:first").hide().prev().hide()}var k=this.find("[name='columns']").manager(),j=k.getCellByField(0,"sort").attr("_col")*1;k.hideColumns(j,j+1)}}};b.setDefaultOp(e,h,d.props,d);d.props.columns.ePropConf=b.setColData(h.columns,d.props.columns.editorOp.columns,e);e.dom.data("propOp",d)}},clearColProp:function(d){var e=["colsort","freezeable","hidden"];$.each(d,function(g,f){$.each(e,function(j,h){f[h]=null})})},execSaveProp:function(d,h,j,g){var k=d.op,f=d.getRecords();if(h){b.clearColProp(j.columns);var n=h.rowRenderOp&&h.rowRenderOp.order,l=Jalor.DataHelper.getDataChange(h,j,{columns:"field"})||{},p=l&&l.rowRenderOp&&l.rowRenderOp.order;if(n&&!n.length){l.rowRenderOp=h.rowRenderOp}else{if(l.rowRenderOp){l.rowRenderOp=h.rowRenderOp;if(l.columns){$.each(l.columns,function(r,q){q&&q.sort&&(q.sort=null)})}}}d.saveCustom(l);var o=$.extend(true,{},l);if(h.remoteSort&&f){Jalor.UI.showMessage(a.changeDataMsg,"warn")}else{if(($.isEmptyObject(o)||o.remoteSort!==false)&&d.dom.data("defGridOp").remoteSort){var e=o.rowRenderOp&&o.rowRenderOp.order;if(e&&e.length){o._sortSetting={isRemoteSort:true,sort:e}}else{o._sortSetting=null}d.clearCache()}else{o.sort=k.sort}d.reInit(o)}}else{Jalor.UI.confirm(a.msgDefault,function(q){if(q){d.saveCustom(j);var r=$.extend(true,{},j);if(k.remoteSort&&f){Jalor.UI.showMessage(a.changeDataMsg,"warn")}else{d.reInit(r)}g.parents("div.jalor-dialog:first").manager().close()}})}},settingClick:function(g,f,j){var d=$.extend(true,{},f.dom.data("propOp")),h=Jalor.Personalized.getCurrPageSettings(f.id);if(h){d.config=h;if(h.hasColSort){var e=b.setColData(j.columns,d.props.columns.editorOp.columns,f);Jalor.DataHelper.applyArrayChange(e,d.props.columns.ePropConf,"field");d.props.columns.ePropConf=e}}Jalor.UI.openPropEditor(d,j.profileOpen)},setDefaultOp:function(f,j,h,e){if(j.allowSort&&j.remoteSort&&!j.lazyLoad){h.remoteSort={}}var g=h.columns={type:"tableEditor",ePropName:a.columnsName,ePropDesc:a.columnsDesc,ePropConf:[],editorOp:{width:518,columns:[{field:"header",width:(!j.percentWidth&&j.allowFreezen)?150:200,header:a.colHeader,editable:false,content:"${#Jalor.UI.IGrid.Individuation.setRequiredStyle(data)}"},{field:"hidden",width:(j.allowSort&&j.remoteSort)?80:100,header:a.colHidden,type:"bool",format:{isBool:true,noFork:true},editorOp:{shortChecked:true},cssName:"center",editable:false,content:"${#Jalor.Format.boolRender('propGrid',hidden,data._noHidden)}",fnEndEdit:function(o,n,r,l,k){var q=this.op,p=q.Storage.len();if(o){q._hideCount++;n.freezeable&&q._freezeCount--}else{q._hideCount--;n.freezeable&&q._freezeCount++}if(q._hideCount==p){Jalor.UI.showMessage(a.notHiddenMsg,"warn");q._hideCount--;return false}if(!f.op.percentWidth&&f.op.allowFreezen&&q._freezeCount&&(p-q._hideCount-2)<q._freezeCount){Jalor.UI.showMessage(a.notFreezeMsg,"warn");if(!o){q._hideCount++;n.freezeable&&q._freezeCount--}else{q._hideCount--;n.freezeable&&q._freezeCount++}return false}}}],fnDataBindComplete:function(){var k=0,n=0,l=this.op;l.Storage.filter(function(o){o.hidden&&k++;o.freezeable&&!o.hidden&&n++});l._hideCount=k;l._freezeCount=n},fnBeforeEdit:function(n,o,k){if(k.field=="hidden"){var l=this.getRowData(o);if(l._noHidden){return false}}}}};if(j.customSettingRowGroup){g.editorOp.rowRender="rowSpan";g.editorOp.wrap=true;g.editorOp.columns.unshift({field:"rowGroupName",width:120,header:"jalor.common.igrid.customRowGroupName",cssName:"customSettingRowGroup",editable:false,rowSpan:true})}if(!j.percentWidth&&j.allowFreezen){g.editorOp.columns.push({field:"freezeable",width:(j.allowSort&&j.remoteSort)?80:100,header:a.colFreeze,type:"bool",format:{isBool:true,noFork:true},editorOp:{shortChecked:true},cssName:"center",editable:false,content:"${#Jalor.Format.boolRender('propGrid',freezeable)}",fnEndEdit:function(o,n,r,l,k){var q=this.op,p=q.Storage.len();if(!n.hidden){o?q._freezeCount++:q._freezeCount--;if((p-q._hideCount-2)<q._freezeCount){Jalor.UI.showMessage(a.notFreezeMsg,"warn");o?q._freezeCount--:q._freezeCount++;return false}}}})}if(j.allowSort&&j.remoteSort&&(j.rowRender=="group"||j.rowRender=="rowSpan")){h.rowRenderOp={}}var d=Jalor.UI.XControl.getPlugin(f.type);d.fireAll("individuation",f,j,h,g.editorOp.columns,e)},setGridData:function(e,f,d){$.each(e,function(g,h){if(g!=="columns"){d[g]&&(f[g]=d[g])}})},setColData:function(q,n,d){var e=[];for(var l=0,g;g=q[l];l++){if(!g.inner&&!g.columnType){var h={},o;for(var k=0,p;p=n[k];k++){o=g[p.field];h[p.field]=(o!=null)?o:null;if(g.rule&&g.rule.required||g.hiddenable===false){h._noHidden=true}h.header=g.header?$i18n(g.header).encode():g.customHeader;h.colsort=g.colsort;h.width=g.width;h.field=g.field;h.rowGroupName=g.rowGroupName||""}e.push(h)}}if(d.op.customSettingRowGroup){var f=e.sort(function(r,j){if(r.rowGroupName<j.rowGroupName){return -1}else{if(r.rowGroupName>j.rowGroupName){return 1}else{return 0}}});return f}return e},setRequiredStyle:function(d){return d._noHidden?((d.header||d.customHeader)+"<font color='red'>&nbsp;*</font>"):(d.header||d.customHeader)},saveWidthChange:function(e,g,f,d){if(!f.inner){var j=[],h=e.op;if(h.columns&&h.percentWidth){$.each(h.columns,function(l,k){if(!k.inner&&!k.hidden){if(k.field==f.field){j.push({field:k.field,width:parseFloat(g).toFixed(2)+"%"})}else{j.push({field:k.field,width:parseFloat(k._curWidth).toFixed(2)+"%"})}}})}else{j.push({field:f.field,width:g})}e.saveCustom({hasColResize:true,showMessage:false,columns:j})}}};Jalor.UI.XControl.addPlugin("XGrid","individuation",{preInit:function(d,e){!e._reIniting&&d.dom.data("defGridOp",$.extend(true,{},e));if(e.customSetting){b.setCustomProp(d,e);Jalor.Personalized&&Jalor.Personalized.iGridProcessor&&Jalor.Personalized.iGridProcessor(d,e);e.handler.widthChange.add(b.saveWidthChange)}},build:function(d,e){},miniToolBar:function(g,k,e){if(k.customSetting){if(k.profileSelectPanel){var j=Jalor.Personalized.getPageKey(),d=g.id,h=j+"#"+d;var f="services/jalor/personalized/setting/list/page?settingKey="+j+"&gridId="+d;$(k.profileSelectPanel).dropdown({ajax:{url:f},allowDel:true,fnBeforeRemoveItem:function(n,p,l){var o="services/jalor/personalized/setting/delSingle/{0}".formatValue(n.settingId);Jalor.doDelete({url:o})},valueField:"profileName",displayField:"profileName",fnBeforeBinded:function(n,l,p){for(var o=0;o<l.length;o++){if(l[o].settingKey.indexOf(h)==-1||l[o].settingKey==h){l.splice(o,1);o--}else{l[o].profileName=l[o].settingKey.replace("!"+h,"")}}},fnSelected:function(s,t,p,q,l,r){if(r&&p!=s){var o=$.parseJSON(r.settingContent);var n=$.extend(true,{},o);Jalor.Personalized.saveSetting(g.id,n,k.hasColResize?null:$.noop,true);if(g.getRecords()){Jalor.UI.showMessage(a.changeDataMsg,"warn")}else{g.reInit(n)}}}})}e.push({type:"img",icon:"setting",text:"jalor.common.igrid.customSetting",click:function(){b.settingClick($(this),g,k)}})}}});Jalor.UI.XControl.extendIManager("XGrid",{saveCustom:function(g){var e=Jalor.Personalized.getCurrPageSettings(this.id)||{},d,f;if(!$.isEmptyObject(g)){if(g.hasColSort||g.hasColResize){Jalor.DataHelper.applyChangeData(e,g,{columns:"field"})}else{e.hasColSort&&(d=true);e.switchMode&&(f=e.switchMode);e=$.extend(true,{},g);d&&(e.hasColSort=true);f&&(e.switchMode=f)}Jalor.Personalized.saveSetting(this.id,e,function(){e.showMessage!==false&&Jalor.UI.topBox("jalor.common.message.success");var o=JSON.parse(this.data)["settingKey"].split("#"),l=o[o.length-1],h=$("#"+l).data("op");if(h.profileSelectPanel){var p=Jalor.Personalized.getPageKey(),j=h.id,n=p+"#"+j,k="services/jalor/personalized/setting/list/page?settingKey="+p+"&gridId="+j;$(h.profileSelectPanel).manager().reBind({url:k})}},true)}else{Jalor.Personalized.deleteSetting(this.id)}}})})(Jalor.UI.IGrid);(function(d){var a=d.Const.I18n.pager={pagerSave:"jalor.common.message.confpagersave",noResult:"jalor.common.label.noresult",validLose:"jalor.common.igrid.pagervalidlose"};var b=d.RowTurn={commonRowTurn:function(o,r,h,j,t,g){var n=g.op.Storage;if(t.actives){var p=t.actives.item,l=n.dataset,k=g.getRowData(j),q=k._index,s,u,f;if(p){p.after(j);s=g.getRowData(p);if(k._newIndex){k._index=s._index}else{u=s._index;l.splice(q,1);l.splice(u,0,k)}}else{t.actives.panel.append(j);l.splice(q,1);l.push(k)}g.reload()}}};var c={setCol:function(e,g,j){g.header=g.header?$i18n(g.header).encode():(g.name?$i18n(g.name).encode():"");if(!g.inner&&!g.columnType){if(g.content&&!g.renderer){g._contentTd=true}else{var n=g.renderer;if(n){if(typeof(n)=="string"){g.renderer=Jalor.UI.Renderer.get(n)}else{if(typeof(n)!="object"||n.__type!="iobject"){j._renderRow=true;g._renderTd=true}}}else{g.renderer=Jalor.UI.Renderer.get(g.type)}g.format||(g.format={});g.renderer.setOption&&g.renderer.setOption(g)}if(g.type=="date"||g.type=="datetime"||g.type=="dateym"||g.type=="datehm"){var o=g.format&&(g.format.dateFormat||g.format.renderFormat)||Jalor.Config.Format[g.type];j._dateFields.push({field:g.field,type:o})}if(g.mappingRenderField){var f,h,k=2,l=g.content;if(g.mappingFunc){f=g.field;h=g.mappingFunc}else{(l.charAt(2)=="#")&&k++;f=l.substring(l.indexOf("(")+1,l.indexOf(",")>0?l.indexOf(","):l.indexOf(")"));h=Jalor.DataHelper.getObj(l.substring(k,l.indexOf("(")))}j._mappingFields.push({field:g.mappingRenderField,funcParam:f,func:h});hasMappingFields=true}}if(g.permission&&!Jalor.Permission.check(g.permission)){g._noPermission=true;g.hidden=true}if(g.editPermission&&!Jalor.Permission.check(g.editPermission)){g.editable=false}if(!j.wrap&&g.type=="longtext"&&g.showTip!==false){g.showTip=true}if(g.showTip){g.cssName+=" grid-tip";j.showTip=true}if(j.headTip&&!g.inner){g._headCss+=" grid-tip";j.showTip=true}},checkEditor:function(e,f){if(f.editPermission&&!Jalor.Permission.check(f.editPermission)){f.editMode=false}},checkColumns:function(f,j){var h=j.columns;if(h&&h.length){var e=[],g;$.each(h,function(l,k){g=k&&k.modal;if(g&&Jalor.Modal.isModal(g)){g.each(function(n){if(n.colOp!==false){e.push(c.filedToColumn({field:n}))}})}else{k&&e.push(c.filedToColumn(k))}});j.columns=e}},filedToColumn:function(e){var g=e.field;if($.isPlainObject(g)){var f=$.extend(true,{},g,g.colOp?$.extend(true,{},g.colOp,e.colOp):e.colOp);f.colOp&&delete f.colOp;return f}return e},setTip:function(e,f){if(f.showTip){e.dom.tip({global:true,child:".grid-tip",tipProp:"tip",addTipStyle:false,offset:true,showOverflow:f.showOverflow,width:f.tipWidth||200})}},initComplete:function(e,f){c.setTip(e,f);c.renderRow(e,f)},renderRow:function(f,g){if(g._renderRow){delete g._renderRow;var e=g.fnRenderRow;g.fnRenderRow=function(k,j,h){c.renderRowDom(k,j,h,this);e&&e.call(this,k,j,h)}}},renderRowDom:function(h,g,f,e){h.find(".grid-cell").each(function(k){var n=$(this),j=e.getColumnOp(n),l;if(j._renderTd){l=Jalor.DataHelper.getObj(j.field,g);n.html(typeof j.renderer=="function"?j.renderer(l,g,j,e,j._i,f):l)}})},changeResize:function(f){var e=f.data,g=e.gridMag,o=g.op,h=o._scrollOp,n=e.fullContainer.height()-e.fixeHeight-30,l=e.bodyPanel.css("min-height");if(!$.isNumeric(parseInt(l))){l=e.bodyPanel.height()||24}if(n<parseInt(l)+70){e.fullContainer.css("overflow-y","auto")}else{e.fullContainer.css("overflow-y","")}e.bodyPanel.removeAttr("style").css({height:"","min-height":o.height||o.minHeight||null,"max-height":n});if(o.lazyLoad==true&&h){var p=Math.ceil(n/o.rowHeight);h.pageSize=parseInt(g.setScrollSize(n));if(h.end<h.total){h.end=h.showStart+h.pageSize;h.showEnd=h.showStart+p}else{var j=h.showEnd-h.pageSize,k=h.total-p;h.start=(j<0)?0:j;h.showStart=(k<0)?0:k}o.scrollLoader.load()}},maximizeClick:function(f,e,g){f.hide().next().show();$(g.fullPanel).fullScreen();!g.toolPanel&&e.hideToolBar();$("#jalor_fullscreen_overlay").show()},normalClick:function(f,e,g){f.hide().prev().show();$(g.fullPanel).fullScreen();!g.toolPanel&&e.hideToolBar();$("#jalor_fullscreen_overlay").hide()},changeSearchMode:function(j,h,f,k){var e=k.operation.search.panel,g=$.extend({},Jalor.Personalized.getCurrPageSettings(f.id)||{});if(h=="search"){j.hide().next().show();k._filters&&(k._filters={});k._inputFilters&&(k._inputFilters={});k._cusFilters&&(k._cusFilters={});k.pagerOp.pageInf.filter&&(k.pagerOp.pageInf.filter="[]".encodeURI())}else{j.hide().prev().show();k.ajax.data&&(k.ajax.data={})}g.switchMode=h;k.customSetting&&Jalor.Personalized.saveSetting(f.id,{switchMode:h});f.clearCache();f.reInit(g)},switchClick:function(g,f,e,h){if(!h._cache&&e.getRecords()){Jalor.UI.confirm(a.pagerSave,function(j){if(j){var k=h.operation&&h.operation.save&&h.operation.save.btn;if(e.valid()&&k){$(k).click();c.changeSearchMode(g,f,e,h)}else{Jalor.UI.showMessage(a.validLose,"warn")}}else{c.changeSearchMode(g,f,e,h)}},true)}else{c.changeSearchMode(g,f,e,h)}},extendStorage:function(e,g){var f=g.Storage;f.Trigger.update.add(function(k,l,h){var j=k._updFields;if(j){!j.contains(h)&&k._updFields.push(h)}else{k._updFields=[h]}})},gridRowDrop:function(g,n){var l=g.dom,j=g.getDataBody(),e=n.fnRowDrag,k=n.fnRowMove,h=n.fnBeginRowDrop,f=n.fnEndRowDrop;l.addClass("jalor-igrid-rowdrop");l.unbind("mousedown").drop({target:".grid-row",clickable:true,signMode:"ver",panels:j,offset:true,onDragStart:function(q,s,o,p,r){if(!e||e.call(g,q,s,o,p,r)!==false){o.width(l.width()).text(p.children("td:eq(2)").text())}else{return false}},onMoving:function(q,s,o,p,r){if(k&&k.call(g,q,s,o,p,r)===false){return false}},onDroped:function(q,s,o,p,r){if(!h||h.call(g,q,s,o,p,r)!==false){b.commonRowTurn(q,s,o,p,r,g);f&&f.call(g,q,s,o,p,r)}}})}};Jalor.UI.XControl.addPlugin("XGrid","extend",{preInit:function(e,f){c.checkEditor(e,f);c.checkColumns(e,f);f.handler.setColumn.add(c.setCol);f.handler.initComplete.add(c.initComplete)},build:function(e,f){!f._reIniting&&c.extendStorage(e,f);f.allowRowDrop&&f.handler.complete.add(c.gridRowDrop)},miniToolBar:function(g,l,f){if(l.showSwitch&&l.allowFilter&&((l.operation&&l.operation.search&&l.operation.search.panel)||l.genSearchByFilter)){var k="inquire",j="screening hide";if(l.switchMode=="search"){k="inquire hide";j="screening"}else{if(l.heightOfFilterMode){g.getBodyPanel().height(l.heightOfFilterMode);d.Factory.fixScroll(g,l)}}f.push({type:"img",icon:k,text:"jalor.common.igrid.switchSearchMode",click:function(){c.switchClick($(this),"search",g,l)}},{type:"img",icon:j,text:"jalor.common.igrid.switchFilterMode",click:function(){c.switchClick($(this),"filter",g,l)}})}if(l.fullPanel){if(!l._reIniting){Jalor.UI.FullScreen.init(g)}var e="panel-maximize",h="panel-normal hide";if($(l.fullPanel).hasClass("jalor-fullscreen-full")){e="panel-maximize hide";h="panel-normal"}f.push({type:"img",icon:e,text:"jalor.common.widget.maximize",click:function(){c.maximizeClick($(this),g,l)}},{type:"img",icon:h,text:"jalor.common.widget.normal",click:function(){c.normalClick($(this),g,l)}})}},clear:function(f,e,g){if(e.fullPanel&&$(e.fullPanel).hasClass("jalor-fullscreen-full")){e._fullOp=g._fullOp;e.height=null;e.maxHeight=g._fullOp.maxHeight;e.minHeight=g._fullOp.minHeight}}});Jalor.UI.XControl.extendIManager("XGrid",{fullScreen:function(g,q,h){var e=this,o=e.getBodyPanel(),p=e.op,j=$(window),n=function(){var r=0;e.dom.siblings().each(function(){r+=$(this).outerHeight()});return r};if(h){p._fullOp||(p._fullOp={scrollOp:p._scrollOp,fixedHeight:n()+e.getHeadPanel().outerHeight()+e.getBottom().outerHeight(),oriHeight:p.height,oriMinHeight:p.minHeight,oriMaxHeight:p.maxHeight,minHeight:p.height||p.minHeight||null});var l,k=p._fullOp.scrollOp,f={gridMag:e,bodyPanel:o,fixeHeight:p._fullOp.fixedHeight,fullContainer:g};j.bind("resize",f,c.changeResize);d.Factory.fixScrollToFullScreen(this);c.changeResize({data:f});p._fullOp.maxHeight=parseInt(o.css("max-height"))}else{j.unbind("resize",c.changeResize);o.removeAttr("style").css({height:p._fullOp.oriHeight||null,"min-height":p._fullOp.oriMinHeight||null,"max-height":p._fullOp.oriMaxHeight||null});if(p.lazyLoad==true&&p._scrollOp){p._scrollOp=p._fullOp.scrollOp;p.scrollLoader.load()}}Jalor.UI.IGrid.Factory.fixScroll(e,p)},renderValue:function(h,g,p,q,j){var n=g.renderer,f=Jalor.DataHelper;if(p==null){j||(j=this.getRowData(h));var r=f.getObj(g.field,j),e;r=(r==null)?"":r;if(g.valueField){if(g._renderTd||g._contentTd){e=f.getObj(g.valueField,j);e=(e==null)?"":e;return{value:e,text:r}}else{var e=n.getValue(h,g.format);return e}}return r}else{if(!q){var k=Jalor.UI.Config.Editor.rules[g.type],o=Jalor.UI.Renderer.get(g.type);if(k&&o&&(k.number||k.digits)){return o.parse(p,g.format)}return(g._renderTd||g._contentTd)?p:n.parse(p,g.format)}else{if(g._renderTd||g._contentTd){var l=g._renderTd?n(p,j,g,this,g._i,this.getRowNo(h)):Jalor.UI.template("<% with(data){ %>"+g.content+" <% } %>",{data:j},null,null,{_grid:this});h.html(l)}else{n.render(h,p,g.format)}}}}})})(Jalor.UI.IGrid);(function(b){var a={setAfterBindData:function(c,d){a.setTopHeight(c,d);a.setHiddenScroll(c,d)},setTopHeight:function(d,e){if(e.wrapHead){var c=d.getHeadTable();c.removeAttr("style");c.height(c[0].height)}},setHiddenScroll:function(d,g){if($.browser.msie&&($.browser.version==8)&&g.percentWidth&&(g.rowRender=="rowSpan")){var e=d.getBodyPanel(),f=e.css("max-height")||e.css("height"),c=d.getBodyTable().height();if(c<=parseInt(f)){e.css("overflow","hidden")}else{e.css("overflow","")}}},setHeadWidth:function(d,e){if(e.percentWidth&&$.browser.safari){var c=d.getHeadTable();c.width("99.9%");setTimeout(function(){c.width("100%")},10)}},setEditor:function(d,c,e){if(!c.inner&&!c.columnType&&c.editable!==false&&c.editorOp){if(c.editorOp.type=="ldap"||c.editorOp.type=="suggest"){c.editorOp.conf=c.editorOp.conf||{};c.editorOp.conf.nopending=true}if(c.editorOp.autoClose){c.editorOp.conf=c.editorOp.conf||{};c.editorOp.conf.fnSelect=function(){b.Editor.endEdit(c._editCtr.parent(),d,d.op)}}}}};Jalor.UI.XControl.addPlugin("XGrid","compatibility",{build:function(c,d){d.handler.setEditor.add(a.setEditor);d.handler.widthChange.add(a.setTopHeight);d.handler.afterBindData.add(a.setAfterBindData);d.handler.complete.add(a.setHeadWidth)}})})(Jalor.UI.IGrid);(function(a){var h=["equals","unEqual","greatThan","lessThan","equalsGreatThan","equalsLessThan","includes","exclude","prefix","suffix","empty","unEmpty"];var e=Jalor.Local.getCurrLanguage()=="zh_CN"?["并","或"]:["AND","OR"];var f=e[0],d=e[1];var l=[{value:"equals",text:$i18n("jalor.common.filtercustom.equals")},{value:"unEqual",text:$i18n("jalor.common.filtercustom.unEqual")},{value:"greatThan",text:$i18n("jalor.common.filtercustom.greatThan")},{value:"equalsGreatThan",text:$i18n("jalor.common.filtercustom.equalsGreatThan")},{value:"lessThan",text:$i18n("jalor.common.filtercustom.lessThan")},{value:"equalsLessThan",text:$i18n("jalor.common.filtercustom.equalsLessThan")},{value:"includes",text:$i18n("jalor.common.filtercustom.includes")},{value:"exclude",text:$i18n("jalor.common.filtercustom.exclude")},{value:"prefix",text:$i18n("jalor.common.filtercustom.prefix")},{value:"suffix",text:$i18n("jalor.common.filtercustom.suffix")}];var k={equals:0,unEqual:1,greatThan:2,lessThan:3,equalsGreatThan:4,equalsLessThan:5,includes:6,exclude:7,prefix:8,suffix:9,empty:10,unEmpty:11};var g=$.IFactory();g.add("def,equals",{compare:function(o,n){return o==n?true:false}});g.add("unEqual",{compare:function(o,n){return o!=n?true:false}});g.add("greatThan",{compare:function(o,n){return o>n}});g.add("lessThan",{compare:function(o,n){return Jalor.DataHelper.hasValue(o)&&o<n}});g.add("equalsGreatThan",{compare:function(o,n){return o>=n}});g.add("equalsLessThan",{compare:function(o,n){return Jalor.DataHelper.hasValue(o)&&o<=n}});g.add("includes",{compare:function(o,n){return o&&o.indexOf(n)>-1?true:false}});g.add("exclude",{compare:function(o,n){return o&&o.indexOf(n)==-1?true:false}});g.add("prefix",{compare:function(o,n){return o&&o.indexOf(n)==0?true:false}});g.add("suffix",{compare:function(o,n){if(o){var p=o.lastIndexOf(n);return p>=0&&p==o.length-n.length?true:false}return false}});g.add("empty",{compare:function(o,n){return !Jalor.DataHelper.hasValue(o)}});g.add("unEmpty",{compare:function(o,n){return Jalor.DataHelper.hasValue(o)}});g.add("today",{compare:function(n){return c.filterItems(this.getFilter(),n,"date")},getFilter:function(){var p=new Date(),o=new Date(p.getFullYear(),p.getMonth(),p.getDate()),n=new Date(o.getTime()+24*60*60*1000);return[{operation:"equalsGreatThan",value:o},{operation:"lessThan",value:n}]}});g.add("week",{compare:function(n){return c.filterItems(this.getFilter(),n,"date")},getFilter:function(){var o,r=new Date(),q=new Date(r.getFullYear(),r.getMonth(),r.getDate()),p=q.getDay();if(p==0){o=new Date(r.getFullYear(),r.getMonth(),r.getDate()-6)}else{o=new Date(r.getFullYear(),r.getMonth(),r.getDate()-p+1)}var n=new Date(o.getTime()+7*24*60*60*1000);return[{operation:"equalsGreatThan",value:o},{operation:"lessThan",value:n}]}});g.add("month",{compare:function(n){return c.filterItems(this.getFilter(),n,"date")},getFilter:function(){var n=new Date(),o=new Date(n.getFullYear(),n.getMonth(),1),p=o.addMonth(1);return[{operation:"equalsGreatThan",value:o},{operation:"lessThan",value:p}]}});g.add("threeMonth",{compare:function(n){return c.filterItems(this.getFilter(),n,"date")},getFilter:function(){var n=new Date(),p=new Date(n.getFullYear(),n.getMonth()+1,1),o=new Date(n.getFullYear(),n.getMonth()-2,1);return[{operation:"equalsGreatThan",value:o},{operation:"lessThan",value:p}]}});g.add("year",{compare:function(n){return c.filterItems(this.getFilter(),n,"date")},getFilter:function(){var n=new Date(),p=new Date(n.getFullYear()+1,0,1),o=new Date(n.getFullYear(),0,1);return[{operation:"equalsGreatThan",value:o},{operation:"lessThan",value:p}]}});var j=$.IFactory({parseValue:function(n){return n},getDefaultFilterItems:function(){return null}});j.add("number,integer,currency,floatRequ",{equals:function(o,n){return o===n*1?true:false},unEqual:function(o,n){return o===n*1?false:true},greatThan:true,lessThan:true,equalsGreatThan:true,equalsLessThan:true,empty:true,unEmpty:true});j.add("def,string",{equals:true,unEqual:true,includes:true,exclude:true,prefix:true,suffix:true,empty:true,unEmpty:true});j.add("boolean,bool",{equals:true,unEqual:true,empty:true,unEmpty:true});j.add("date,datetime",{equals:function(p,o){var n=typeof p;if(n=="string"){return p==o?true:false}else{return p*1==o*1?true:false}},unEqual:function(o,n){return !j.get("date").equals(o,n)},greatThan:true,lessThan:true,equalsGreatThan:true,equalsLessThan:true,empty:true,unEmpty:true,today:true,week:true,month:true,threeMonth:true,year:true,getDefaultFilterItems:function(){return[{operation:"today",unique:true},{operation:"week",unique:true},{operation:"month",unique:true},{operation:"threeMonth",unique:true},{operation:"year",unique:true}]}});j.add("enum,lookup,ldap,country,country,area,iCurrency,pbi",{equals:true,unEqual:true,empty:true,unEmpty:true});var c=a.Filter={init:function(n,o){o.contextMenu=true;o.headMenuOp={panelBegin:"<ul class='jalor-igrid-filter'>",item:"<li class='jalor-contextmen-item ${css} ${parent}' ${click} op='${op}' val='${value}' >${#icon}${#text}${#children}</li>",mode:"click",fixPanel:".jalor-igrid-content",target:"td[field].sort,li[field].sort",fnDynamicMenu:function(t,u,r){menus=c.buildMenus(n,t.attr("field"),t);if(menus.length==0){return null}var s=t.attr("field"),q=n.op._filters?n.op._filters[s]:null,p=n.op._columnMap[s];$.nodeEach(menus,"children",function(){var z=this.value&&this.value.valueOf(),y=this,A=this.op,x;(z||z=="0")?x=z:x="";if(y.children&&n.op.allowSort&&n.op.sort&&(n.op.sort).indexOf(p.sortField)>-1){if(y.children.length==2){$.each(y.children,function(B,C){if(C.css=="asc"&&(n.op.sort).indexOf("asc")>-1){C.icon+=" active-bg"}else{if(C.css=="desc"&&(n.op.sort).indexOf("desc")>-1){C.icon+=" active-bg"}}})}}var w=n.op._cusFilters&&n.op._cusFilters[s],v=n.op._inputFilters&&n.op._inputFilters[s];!w&&!v&&A&&q&&$.each(q,function(){var B=this.value&&this.value.valueOf();if((this.operation==A||(A=="dayFilter"&&this.operation=="equalsGreatThan"))&&B==x){y.css?(y.css+=" selected"):(y.css="selected");y.icon="yes active-bg"}});if(v&&y.css=="igrid-input-filter"){y.icon="yes active-bg"}if(w&&y.css=="filter-custom selected"){y.icon+=" active-bg"}});t.data("menus",menus);return menus},callback:function(q,p,r){c.popMenuCallback(n,q,p,r)}}},popMenuCallback:function(p,r,o,t){Jalor.UI.init(o);var n=o.find(".igrid-input-filter");if(n.length>0){n.find(".filter-confirm-btn").click(function(){c.filterAreaConfirm(r,o)});n.find(".filter-cancel-btn").click(function(){o.hide()});n.find(".filter-reset-btn").click(function(){var u,w=o.find(".filter-input"),v=$(".filter-operation > :checked").val()=="equals";if(v){w.find(".equals").show();w.find(".range").hide()}else{w.find(".range").show();w.find(".equals").hide()}});var q=n.find(".filter-input > :input:visible");if(q.hasClass("jalor-calendar")){n.addClass("date-filter");c.dateRadioClick(p,r,n,o);n.find(".filter-input > :input").bind("change",function(){Jalor.UI.setInputFocus($(this),null,false)})}c.reSetInputValue(p,r,q,o);Jalor.UI.setInputFocus(q.first(),null,false);n.delegate(":input","keydown",function(u){if(u.keyCode==13&&!$(this).hasClass("jalor-user")){c.filterAreaConfirm(r,o)}})}var s=o.find(".filter-enumable-btn");if(s.length>0){s.find(".applyfilter").click(function(){c.applyMultiFilter($(this),p);o.hide()});s.find(".cancelfilter").click(function(){o.hide()})}},buildFilterArea:function(o,n){if(o.filter.input==false||$.inArray(o.type,["bool","boolean","enum"])>-1){return""}var s=[],q="jalor.common.filtercustom.",u="",t=[];inputArea="<input type='text' class='filter-input-area' name='_filterInput' autocomplete='off' maxlength='100' />";if(o.filter!==false){t=[{operation:"equals"},{operation:"prefix"},{operation:"includes",checked:true}]}if($.isArray(o.filter.input)){t=o.filter.input}for(var r=0,v;v=t[r];r++){if(r>2){break}u+="<input type='radio' name='_filterOperation' id='{3}' value='{0}' {1}/><label for='{3}'>{2}</label>".formatValue(v.operation,v.checked?"checked":"",$i18n(q+v.operation),"_filter_"+v.operation)}if(o.type=="integer"||o.type=="int"||o.type=="floatRequ"){u="<input type='radio' name='_filterOperation' value='greatThan' id='_filter_greatThan'/><label for='_filter_greatThan'>{0}</label><input type='radio' name='_filterOperation' value='equals' id='_filter_equals' checked /><label for='_filter_equals'>{1}</label><input type='radio' name='_filterOperation' value='lessThan' id='_filter_lessThan'/><label for='_filter_lessThan'>{2}</label>".formatValue($i18n(q+"greatThan"),$i18n(q+"equals"),$i18n(q+"lessThan"));inputArea="<input type='text' class='filter-input-area number' name='_filterInput' autocomplete='off' maxlength='100' />"}else{if(o.type=="date"||o.type=="datetime"){var p=true;if(n.op._inputFilters[o.field]&&n.op._inputFilters[o.field].length>0&&n.op._inputFilters[o.field][0].operation!="equals"){p=false}u="<input type='radio' name='_filterOperation' value='equals' id='_filter_equals' {0} /><label for='_filter_equals'>{1}</label><input type='radio' name='_filterOperation' value='range' id='_filter_range' {2}/><label for='_filter_range'>{3}</label>".formatValue(p?"checked":"",$i18n(q+"equals"),p?"":"checked",$i18n(q+"range"));if(n.op._inputFilters[o.field]&&n.op._inputFilters[o.field].length>0&&n.op._inputFilters[o.field][0].operation!="equals"){inputArea="<input type='text' name='_filterEqualsDate' class='equals init jalor-calendar date' autocomplete='off' maxlength='50' style='display:none' /><input type='text' name='_filterStartDate' id='_filterStartDate' class='range init jalor-calendar date dateCompareB' compareto='#_filterEndDate' autocomplete='off' maxlength='50'/><span class='range range-flag'></span><input type='text' name='_filterEndDate' id='_filterEndDate' compareTo='#_filterStartDate' class='range init jalor-calendar date dateCompare' autocomplete='off' maxlength='50'/>"}else{inputArea="<input type='text' name='_filterEqualsDate' class='equals init jalor-calendar date' autocomplete='off' maxlength='50' /><input type='text' name='_filterStartDate' id='_filterStartDate' class='range init jalor-calendar date dateCompareB' compareto='#_filterEndDate' autocomplete='off' maxlength='50' style='display:none'/><span class='range range-flag' style='display:none'></span><input type='text' name='_filterEndDate' id='_filterEndDate' compareTo='#_filterStartDate' class='range init jalor-calendar date dateCompare' autocomplete='off' maxlength='50' style='display:none'/>"}}else{if(o.type=="user"||o.type=="ldap"){u="<input type='radio' name='_filterOperation' value='equals' id='_filter_equals' checked style='display: none;' />";inputArea="<input type='text' class='init jalor-user filter-input-area' name='_filterInput' autocomplete='off' maxlength='100' valueField='{0}' />".formatValue(o.filter&&o.filter.input&&o.filter.input.valueField||"userId")}}}s.push("<form class='init jalor-form'>");s.push("<ul class='input-filter-div' tabIndex='1'><li class='filter-operation'>");s.push(u);s.push("</li><li class='filter-input'>");s.push(inputArea);s.push("</li><li class='filter-btn'>");s.push("<input type='button' name='_filterConfirm' class='filter-confirm-btn' value='{0}' /><input type='button' name='_filterCancel' class='filter-cancel-btn' value='{1}'  /><input type='reset' name='_filterReset' class='filter-reset-btn' value='{2}' />".formatValue($i18n("jalor.common.button.ok"),$i18n("jalor.common.button.cancel"),$i18n("jalor.common.label.reset")));s.push("</li></ul></form>");return s.join("")},dateRadioClick:function(o,q,p,n){p.find(".filter-operation > :radio").click(function(){var r,t=n.find(".filter-input"),s=$(this).val()=="equals";if(s){t.find(".equals").show();t.find(".range").hide()}else{t.find(".range").show();t.find(".equals").hide()}t.find("input").jalorSetValue("").removeClass("error");t.find("label.error").remove();Jalor.UI.setInputFocus(t.find("input:visible:first"),null,false);Jalor.UI.init(t);c.reSetInputValue(o,q,p.find(":input:visible"),n)})},reSetInputValue:function(n,r,u,o){var p=n.op._inputFilters[r.attr("field")]||[],s=o.find(".jalor-calendar").length>0,v,t,q;$.each(p,function(w,x){if(s){v=p[w].operation=="equalsGreatThan";t=p[w].operation=="lessThan";q=p[w].operation=="equals";v&&o.find("[name='_filterStartDate']").jalorSetValue(x.value);t&&o.find("[name='_filterEndDate']").jalorSetValue(x.value);q&&o.find("[name='_filterEqualsDate']").jalorSetValue(x.value)}else{o.find("[name='_filterInput']").jalorSetValue(x.value);o.find(":radio[name='_filterOperation'][value='"+x.operation+"']").attr("checked",true)}})},filterAreaConfirm:function(x,t){if(!t.find(".jalor-form").valid()){return}var p=[],u=[],z=x.attr("field"),n=Jalor.UI.IGrid.Helper.getGrid(x).manager(),o=t.find(".filter-input > :input:visible").jalorGetValue()||"",q=t.find("[name='_filterOperation']:checked").val()||"includes",y=false;if(t.find(".jalor-calendar").length>0){if(t.find("[name='_filterOperation']:checked").val()=="range"){var w=t.find("[name='_filterStartDate']").val(),s=t.find("[name='_filterEndDate']").val(),r=Jalor.Format.toDate(w,Jalor.Config.Format.sysDate),v=Jalor.Format.toDate(s,Jalor.Config.Format.sysDate);if(r){y=true;r=c.dateSetting(r,0);p.push({operation:"equalsGreatThan",value:r});u.push({operation:"equalsGreatThan",value:w})}if(v){y=true;v=c.dateSetting(v,24);p.push({operation:"lessThan",value:v});u.push({operation:"lessThan",value:s})}}else{if(o.length>0){var r=Jalor.Format.toDate(o,Jalor.Config.Format.sysDate),v=Jalor.Format.toDate(o,Jalor.Config.Format.sysDate);if(r&&v){y=true;r=c.dateSetting(r,0);v=c.dateSetting(v,24);p.push({operation:"equalsGreatThan",value:r});p.push({operation:"lessThan",value:v});u.push({operation:"equals",value:o})}}}}else{if(o){y=true;p.push({operation:q,value:o});u.push({operation:q,value:o})}}if(y){c.confirmFilter(n,function(){n.op._inputFilters[z]=u;n.op._filters[z]=p;c.addFilterStyle(x);delete n.op._cusFilters[z];var A=n.op._columnMap[z];if(A&&A.filter&&A.filter.fnInput){A.filter.fnInput.call(this,z,n)}})}else{c.clearFilter(x,$(this))}t.hide()},dateSetting:function(o,n){o.setHours(n);o.setMinutes(0);o.setSeconds(0);o.setMilliseconds(0);if(o.getTime()>=253402272000000){o.setTime(253402272000000-1)}return o},menuClick:function(v,z){var y=v.attr("field"),t=v.data("menus"),o={operation:z.attr("op")||0,value:z.attr("val")},n=Jalor.UI.IGrid.Helper.getGrid(v).manager(),r=n.op._columnMap[y],w=r.type||r.type||r.filter.type,A=(w=="date"||w=="datetime")&&z.attr("op")=="dayFilter";if(A){var q=z.attr("val"),p=Jalor.Format.toDate(q),u=Jalor.Format.toDate(q);u=c.dateSetting(u,24);var x={operation:"equalsGreatThan",value:p},s={operation:"lessThan",value:u}}if(z.hasClass("filter-checkbox")){z.toggleClass("selected");v.parents(".jalor-igrid-head:first").data("contextMenuOp").selectClose=false}else{if(z.hasClass("igrid-input-filter")){v.parents(".jalor-igrid-head:first").data("contextMenuOp").selectClose=false}else{c.confirmFilter(n,function(){A?n.op._filters[y]=[x,s]:n.op._filters[y]=[o];delete n.op._cusFilters[y];delete n.op._inputFilters[y];c.addFilterStyle(v)})}}},addFilterStyle:function(n){if(n&&!n.hasClass("filter")){n.addClass("filter")}},clearFilterStyle:function(o,n){o.removeClass("filter")},clearAllFilterStyle:function(n){n.getHeadPanel().find("td,li").removeClass("filter")},applyMultiFilter:function(p,o){var t=p.attr("field"),r=[],s=[],q=p.parents(".jalor-igrid-head:first");q.data("contextMenuOp").selectClose=true;q.find("li.filter-checkbox.selected").each(function(){var x=$(this).attr("val");if($(this).attr("op")=="dayFilter"){var w=Jalor.Format.toDate(x),u=Jalor.Format.toDate(x);u=c.dateSetting(u,24);var y={relation:1,operation:"equalsGreatThan",value:w},v={relation:0,operation:"lessThan",value:u};r.push(y,v)}else{r.push({relation:1,operation:h[0],value:$(this).attr("val")})}});var n=c.confirmFilter(o,function(){delete o.op._cusFilters[t];delete o.op._inputFilters[t];o.op._filters[t]=r;if(r.length>0){c.addFilterStyle(q.find("div.jalor-contextmenu").data("target"))}else{o.getHeadPanel().find("td[field='{0}']".formatText(t)).removeClass("filter")}})},clearFilter:function(q,n){var o=Jalor.UI.IGrid.Helper.getGrid(q).manager(),p=q.attr("field");c.confirmFilter(o,function(){if(n.hasClass("filter-clearall")){c.clearAllFilterStyle(o);o.op._filters={};o.op._cusFilters={};o.op._inputFilters={}}else{c.clearFilterStyle(q);delete o.op._filters[p];delete o.op._cusFilters[p];delete o.op._inputFilters[p]}})},buildMenus:function(n,v,s){var o=n.op._columnMap[v],u=o.type||o.renderer;if(!o){return null}var p=o.sortable==false?[]:[{children:Jalor.DataHelper.copyArray(n.op.headMenus)}];if(n.op.allowFilter&&o.filter&&n.op.switchMode!="search"){var r=this.buildFilterItemsByCol(n,o,s),t=c.buildFilterArea(o,n);t.length>0&&p.push({css:"igrid-input-filter",text:t,click:c.menuClick});p=p.concat(this.buildMenusByFilter(o,r));p.push({text:"jalor.common.filter.clear",click:this.clearFilter,css:"filter-clear",icon:"clear-filter"});p.push({text:"jalor.common.filter.clearall",click:this.clearFilter,css:"filter-clearall",icon:"clear-filter"});if(u!="bool"&&u!="boolean"&&o.filter.custom!==false&&o.filter.input!==false){var q=n.op._cusFilters[v]?"filter-custom selected":"filter-custom";p.push({text:"jalor.common.filter.custom",click:this.popCusotm,css:q,icon:"customize-filter"})}}return p},getTypeEnum:function(n,o){var q=o?[{value:"clear",text:""}]:[],p=j.get(n.filter.type||n.type||n.renderer);$.each(l,function(r,s){if(p[s.value]){q.push(s)}});return q},popCusotm:function(t,n){var s=t.attr("field"),p=Jalor.UI.IGrid.Helper.getGrid(t).manager(),o=p.op._columnMap[s],q=o.type,r=n.attr("op")||"equals";Jalor.UI.dialog(null,"jalor.common.filter.custom",{width:400,height:120,content:"<div></div>",imgBtn:true,okClick:function(){c.popCusotmOK(p,this,s,t)},fnLoad:function(){var u=this.getBody().html("<div id='customfilterPanel' class='jalor-filter-custom'><ul><li  class='filter-colname'></li><li  class='filter-item'></li><li class='filter-relation clear'></li><li class='filter-item'></li><ul></div>");var w=this.getBody().find("#customfilterPanel").jalorValidate({errorPlacement:function(A,B){B.addClass("error").after(A.addClass("error").css({width:B.width()-10,top:B.position().top+20,left:B.position().left}))}});w.find("li.filter-colname").text(t.find("span").text());u.find("li.filter-item").each(function(B){var A=Jalor.Editor.get("enum").build($(this),{format:{data:c.getTypeEnum(o,B==0?false:true)}});A.addClass("filter-operation").attr("readonly",true).attr("name","item"+B+".operation");B==0&&A.addClass("required")});var z=$.extend({type:o.type,field:o.valueField||o.field,format:o.format||{}},o.editorOp);w.find("li.filter-item").append("<span class=required></span>");Jalor.Editor.get(o.type).build(u.find("li.filter-item"),z).addClass("filter-value").addClass(q).attr("name",function(A){return"item"+A+".value"}).attr("maxLength","100").filter(":first").addClass("required");w.find("li.filter-relation").append("<input type=radio name='item1.relation' checked value=0>{0}<input type=radio name='item1.relation' value=1 >{1}".formatText(f,d));var x=p.op._cusFilters[s];if(x){var v={};$.each(x,function(A){v["item"+A]=this});w.jsonData(v)}else{u.find("li.filter-item:first ").children(":first").jalorSetValue(r)}w.find("span.required:last").css("visibility","hidden");w.find("input.filter-operation:last")[0].onchange=function(A){var B=w.find("input.filter-operation:last").val();if(B=="clear"||B===""){w.find("span.required:last").css("visibility","hidden");$("input[name='item1.value']").valid()}else{w.find("span.required:last").css("visibility","visible")}};var y=this;setTimeout(function(){w.find("[name='item0.value']").focus();w.find("[name*='item']").keydown(function(A){if(A.keyCode==13){c.popCusotmOK(p,y,s,t)}})},100)}})},popCusotmOK:function(p,o,u,t){var r=o?o.getBody().find("#customfilterPanel"):this.getBody().find("#customfilterPanel"),n=r.find("input[name='item1.value']");if(r.find("input[name='item1.operation']").val()){n.addClass("required")}else{n.removeClass("required")}if(r.valid()===true){var s=r.jsonData(),q=[];q.push(s.item0);if(s.item1.operation){s.item1.relation=s.item1.relation*1;q.push(s.item1)}c.confirmFilter(p,function(){p.op._filters[u]=q;p.op._cusFilters[u]=q;delete p.op._inputFilters[u];c.addFilterStyle(t)});o.close()}},buildFilterItemsByCol:function(o,s,A){if(!s.filter){return}var z=[],r=s.filter,C=r.type||s.type||s.renderer,D=s.field,q=j.get(C)||j.get("string");if(r.defines){z.push({children:r.defines})}var n={children:[]},B=A.data("exsitKeys")||{},t=A.data("filterItems")||[];if(r.enumable){if(r.values||r.ajax||r.lookup){if(r.ajax){$.extend(r.ajax,{async:false,success:function(E){r.values=E.result||E||[]}});var p=r.ajax.url;if(p.indexOf("${filter}")>-1){p=p.formatField({filter:c.genFilterStr(o)})}Jalor.Core.ajax($.extend(true,{},r.ajax,{url:p}))}else{if(r.lookup){var x=r.values=[];if(r.lookup===true&&s.format){r.lookup=s.format}x=Jalor.UI.getStaticData(r.lookup);for(var w=0,v;v=x[w];w++){r.values.push({value:Jalor.DataHelper.getObj(r.lookup.valueField||"itemCode",v),text:Jalor.DataHelper.getObj(r.lookup.displayField||"itemName",v)})}}}r.values&&$.each(r.values,function(E,F){if(C=="date"||C=="datetime"){c.buildDayEnumItems(r,F,n,[],{})}else{if(typeof F=="object"){n.children.push({value:Jalor.DataHelper.getObj(r.valueField||"value",F),text:Jalor.DataHelper.getObj(r.displayField||"text",F)})}else{n.children.push({value:F})}}})}else{var y=(o.op._filterStorage||o.op.Storage).dataset;$.each(t,function(){n.children.push(this)});$.each(y,function(E,G){var F=Jalor.DataHelper.getObj(D,G),H;if(r.displayField){H=Jalor.DataHelper.getObj(r.displayField,G)}if(C=="date"||C=="datetime"){c.buildDayEnumItems(r,F,n,t,B)}else{if(Jalor.DataHelper.hasValue(F)&&!B[F]){n.children.push({value:F,text:H});t.push({value:F,text:H});B[F]=true}}});if($.inArray(C,["number","integer","currency","floatRequ"])>-1){n.children.sort(function(F,E){return c.arrayCompare(E.value,F.value)});t.sort(function(F,E){return c.arrayCompare(E.value,F.value)})}else{if($.inArray(C,["date","datetime"])>-1){n.children.sort(function(F,E){return c.arrayCompare(F.value,E.value)});t.sort(function(F,E){return c.arrayCompare(F.value,E.value)})}}}}if(n.children.length>0){if(r.enumable&&z.length>0){this.mergeItems(z[0],n.children)}else{z.push(n)}A.data("exsitKeys",B);A.data("filterItems",t)}if(r.defaultFilters!==false){var u=q.getDefaultFilterItems()||[];u.push({operation:"empty",unique:true},{operation:"unEmpty",unique:true});z.push({children:u})}return z},mergeItems:function(o,n){var p={};$.each(o.children,function(q,r){p[r.value]=true});$.each(n,function(q,r){if(r.children){this.buildItems(o,r.children)}else{!p[r.value]&&o.children.push(r)}})},arrayCompare:function(o,n){if(o<n){return 1}else{if(o>n){return -1}else{return 0}}},buildDayEnumItems:function(q,r,p,s,t){if(typeof r=="object"&&q.valueField&&!(r instanceof Date)){r=r[q.valueField]}var o=Jalor.Format.toDate(r,Jalor.Config.Format.sysDate),n=Jalor.Format.toDateStr(o);if(Jalor.DataHelper.hasValue(r)&&!t[n]){o=c.dateSetting(o,0);p.children.push({value:o,text:n,operation:"dayFilter"});s.push({value:o,text:n,operation:"dayFilter"});t[n]=true}},buildMenusByFilter:function(n,q){var r=[],p=n.filter,o=p.multi?"filter-checkbox":"";$.each(q,function(u,v){if(v.children){var t=c.buildMenusByFilter(n,v.children);r.push({children:t});(p.enumable&&r.length&&r[r.length-1].children&&r[r.length-1].children[0].css=="filter-checkbox")&&r.push({css:"filter-enumable-btn",text:"<input type='button' class='applyfilter' field='{2}' value='{0}' /><input type='button' class='cancelfilter' value='{1}' />".formatValue($i18n("jalor.common.filter.applyfilter"),$i18n("jalor.common.button.cancel"),n.field)})}else{var s=v.operation||h[0],y;var x=v.value?v.value.valueOf():v.value;if(x!==void 0){if(typeof n.renderer=="function"){y=n.renderer.call(n,v.value)}else{if(typeof n.renderer=="object"){var w={};w[n.field]=v.value;y=Jalor.UI.template(n.content,w)}}}r.push({op:s,css:v.unique?"":o,click:c.menuClick,text:$i18n(v.text)||$i18n("jalor.common.filter."+s).formatValue(y||x),value:x})}});return r},confirmFilter:function(n,q){var p=n.op,o=p.Storage;if(o&&o.cacheKey&&o.Cache.count()||!p._cache&&n.getRecords()){Jalor.UI.confirm("jalor.common.filter.cleardata",function(r){if(r){n.clearCache();q&&q();c.filter(n)}})}else{q&&q();c.filter(n)}},filter:function(n){var o=n.op;o.pagerOp.pageInf.filter=c.genFilterStr(n);if(!o.remoteSort||o.lazyLoad){n.reload("search",true)}else{n.reload("search")}if(o.showTip){$("#_tip_"+n.id).css({visibility:"hidden"});setTimeout(function(){$("#_tip_"+n.id).hide().css({visibility:"inherit"})},500)}},genFilterStr:function(p){var u=p.op,r=u._filters,t=u.Storage,o=u._columnMap;conds=[];for(var s in r){var n=[],q=o[s].filter;r[s]&&$.each(r[s],function(){var v=g.get(this.operation);if(v.getFilter){n=n.concat(v.getFilter(this.value))}else{n.push(this)}});$.each(n,function(){var w=this.value;q.convert&&(w=q.convert(w));if(typeof w=="string"){w=encodeURIComponent(w)}var v={ft:k[this.operation],fv:w,fn:s};if(this.relation){v.fr=1}conds.push(v)})}u._filtersStr=Jalor.DataHelper.toJsonStr(conds).encodeURI();return u._filtersStr},compare:function(q,s,o,p){var r=j.get(p)[q],n=true;if(r){if(typeof(r)==="function"){n=r(s,o)}else{n=g.get(q).compare(s,o)}}return n},filterItems:function(p,t,o){var n=-1,q;for(var r=0,s;s=p[r];r++){if(j.get(o)[s.operation]){q=c.compare(s.operation,t,s.value,o);if(n===-1){n=q}else{n=s.relation?n||q:n&&q}}}return n}};var b={init:function(p,q){var o=$(q.operation.search.panel);if(o.hasClass("jalor-widget")){o.empty().removeClass("jalor-widget");o.data("xctrInited",false);p.op.pagerOp.pageInf.filter="[]".encodeURI()}if(q.switchMode!="search"){return}var n={modal:this.createModal(p,q),title:q.genSearchByFilter.title||$i18n("jalor.common.button.search"),renderType:"search",showHead:false,buttons:[{type:"imgBtn",text:"jalor.common.button.search",icon:"search",css:"default",attr:{eno:"search"}},{type:"imgBtn",text:"jalor.common.button.reset",icon:"reset",attr:{eno:"reset"}}],operation:{search:function(u,s){if(!s.valid()){return}var t=s.getValue();var r=[];$.each(t,function(x){var v=s.op.modal[x];var y=this;if(v.field.indexOf("_")>0){v.field=v.field.replaceAll("_",".")}if(y.value!=undefined){y=y.value}if(y){var z=k.includes;if((y instanceof Number||v.type=="date"||v.type=="enum"||v.type=="ldap")&&v.layout!="range"){z=k.equals}if(v.type!="date"&&v.type!="datetime"){y=encodeURIComponent(y)}v.filter&&v.filter.convert&&(y=v.filter.convert(y));if(v.layout=="range"){var w=v.field.lastIndexOf(".start");if(w!=-1){r.push({ft:k.equalsGreatThan,fv:y,fn:v.field.substring(0,w)})}w=v.field.lastIndexOf(".end");if(w!=-1){r.push({ft:k.equalsLessThan,fv:y,fn:v.field.substring(0,w)})}}else{r.push({ft:z,fv:y,fn:v.field})}}});p.op.pagerOp.pageInf.filter=Jalor.DataHelper.toJsonStr(r).encodeURI();if(!p.op.remoteSort||p.op.lazyLoad){p.reload("search",true)}else{p.reload("search")}},reset:function(s,r){r.setValue({});r.dom.find(".error-ctr").removeClass("error error-ctr");r.dom.find("label.error").hide()}}};o.xForm(n)},addField:function(n,p){var o=[];if(p.columns){$.each(p.columns,function(){if(this.filter&&!this.hidden){var q={};q.field=this.field;if(this.field.indexOf(".")>0){q.field=this.field.replaceAll("\\.","_")}q.name=$i18n(this.header);if(this.filter.defines&&!(this.type=="integer"||this.type=="int"||this.TypeError=="floatRequ")){q.type="enum";$.each(this.filter.defines,function(){this.text=$i18n(this.text)});q.format={data:this.filter.defines||{},valueField:"value",displayField:"text"}}else{if(this.filter.enumable&&this.filter.ajax){q.type="enum";q.format={service:"REST:"+this.filter.ajax.url,valueField:this.filter.valueField,displayField:this.filter.displayField||this.filter.valueField}}else{if(this.type=="textarea"){q.type="text";q.format=this.format||{}}else{q.type=this.type;q.format=this.format||{}}}}q.editorOp=this.editorOp||{};q.filter=this.filter;if(this.filter.range){o.push({type:this.type,field:q.field+"_start",editorOp:{id:q.field+"_start"},layout:"range",enable:false,format:this.format||{}});o.push({type:this.type,field:q.field+"_end",layout:"range",enable:false,format:this.format||{},rule:{dateCompare:["#"+q.field+"_start"]}});q.layout="range";q.renderTmpl="${searchModel."+q.field+"_start}${searchModel."+q.field+"_end}"}o.push(q)}})}return o},createModal:function(n,p){var o={modalName:"searchModel",fields:this.addField(n,p)};return Jalor.Modal.create(o)}};Jalor.UI.XControl.addPlugin("XGrid","dataFilter",{preInit:function(n,o){o.headMenus=[];c.init(n,o);o.beforeColResize=function(){this.getHeadPanel().children(".jalor-contextmenu-list.jalor-popup").hide()}},build:function(n,o){if(o.allowFilter&&o.switchMode!="search"){!o._filters&&(o._filters={});!o._cusFilters&&(o._cusFilters={});!o._inputFilters&&(o._inputFilters={});o.handler.setColumn.add(function(q,p){if(p.filter){var r=o._filters[p.field]?" filterable filter":" filterable";p._headCss+=r}})}if(!o.pagerOp.pageInf.filter){o.pagerOp.pageInf.filter="[]".encodeURI()}if(o.allowFilter&&o.genSearchByFilter){b.init(n,o)}},clear:function(n,p,o){p._filters=o._filters;p._inputFilters=o._inputFilters;p._cusFilters=o._cusFilters;p.pagerOp.pageInf.filter=o.pagerOp.pageInf.filter}});Jalor.UI.XControl.extendIManager("XGrid",{getFilters:function(n){return n?this.op._filters[n]||[]:this.op._filters||{}},getFiltersStr:function(){return this.op._filtersStr||"[]".encodeURI()}})})(Jalor.UI.IGrid);(function(d){var b=d.Const.I18n.menu={btnDelete:"jalor.common.button.gridDelete",btnUndoDelete:"jalor.common.button.gridUndoDelete",btnCopy:"jalor.common.button.copy"};var a={colSet:function(f,e){e.menuable&&(e.cssName+=" "+f.id+"-menuable")},initMenus:function(e,h){var g=h.menuOp,f=h.headMenuOp;if(g){g.fnGetData=function(j){return e.getRowData(j)};g.menus&&this.setMenus(g.menus);this.bindMenu(e,g,e.getBodyPanel())}if(f){f.setBorder=false;this.bindMenu(e,f,e.getHeadPanel())}},setMenus:function(h){for(var f=0,e=h.length;f<e;f++){var j=h[f];if(j.type){var g=c.get(j.type);if(g){if($.isArray(g)){$.each(g,function(){h[f]=$.extend(j,g)})}else{h[f]=$.extend(j,g)}delete j.type}else{h.splice(f--,1)}}}},bindMenu:function(f,g,e){!g.target&&(g.target=f.id+"-menuable");g.offset="fixed";e.contextMenu(g)}};var c=$.IAdapter();c.add("del",{text:$i18n(b.btnDelete),css:"delete",click:function(e,g){var f=d.Helper.getGridObj(e);d.Operation.del.delRow(f.getCellRow(e),true,f)},fnCheck:function(e,g,f){return f&&!f._deleted}}).add("undo",{text:$i18n(b.btnUndoDelete),css:"undo",click:function(e,g){var f=d.Helper.getGridObj(e);d.Operation.del.delRow(f.getCellRow(e),false,f)},fnCheck:function(e,g,f){return f&&f._deleted}}).add("copy",{text:$i18n(b.btnCopy),css:"copy",click:function(e,k){var g=d.Helper.getGridObj(e),j=g.getCellRow(e),f=g.getRowData(j),n=g.op,l=n.operation.insert,h={};h.posTr=j;d.Operation.insert.copyInsert(g,n,f,l,h)}});Jalor.UI.XControl.addPlugin("XGrid","contextMenu",{build:function(e,g){if(g.contextMenu){var f=g.handler;g.menuOp&&f.setColumn.add(a.colSet);f.initComplete.add(function(h,j){a.initMenus(h,j)})}},clear:function(e,f){if(f.columns){$.each(f.columns,function(h,g){if(g.menuable){g.cssName=null}})}e.dom.unbind("mouseover").unbind("mouseleave")}});Jalor.UI.XControl.extendIManager("XGrid",{copyCellData:function(g,n){var j=this,k,f,l=j.getColumnOp(g),h=j.cellValue(g,l),e=n?j.getCellRow(g):g.next();while(e.length){k=n?j.getRowCell(e,l._i):e;f=j.getColumnOp(k);if(f.editable!==false){j.cellValue(k,f,h,true);!j.isNewRow(k.parents("tr:first"))&&k.addClass("cell-update")}e=n?e.next():k.next()}}})})(Jalor.UI.IGrid);(function(d){var a={pasteReplace:"jalor.common.igrid.pasteReplace"};var c;var b={initEvent:function(e,j,f){var g=e.id,o=e.getDataBody(),h=j.onCellClick,k,n;var l=f.panel=$.create("textarea","igrid-copydata-panel",null).appendTo(e.getBodyPanel());l.bind({blur:function(){l.data("noClear")||b.clearCopyCell(o,e)},paste:function(){if(j.editMode){f.origData=l.val();setTimeout(function(){b.pasteDataEvent(l.val(),e,j,f)},100)}}});j.onCellClick=function(x,v,u,A,w,p,t,q,y){var z=q.op,B=u.position(),r=q.getDataBody(),s=r.find("td[field]:last");if(w==0&&isNaN(p)){z.selectAllPlace&&b.setPlaceSign(y,B,r,s,null,q)}c=t.type;if(y.shiftKey&&!t.inner){if(n){b.setPlaceSign(y,u.position(),u,selectTarget,null,q);n=selectTarget=null}else{selectTarget=u;b.setSinglePlaceSign(selectTarget,q);n=true}Jalor.UI.setInputFocus(q.op._copyOp.panel,null,true);return false}else{n=selectTarget=null}if(h){return h.call(q,x,v,u,A,w,p,t,q,y)}}},initMover:function(e,n){var o=e.id,t=e.getBodyPanel(),y=e.getDataBody(),s=e.getScroller(),g=n._copyOp,q=t.height(),x=t.width(),h,u,l,w,r,v,j,k,f,p=$.create("div","jalor-mover-vbox jalor-drop-activepanel",o+"_copydata_mover").hide().appendTo(t);n.dragObj="custom";n.dragOp={offset:false,virtual:false,container:t,target:".grid-cell[field]",handler:"#"+o+"_copydata_mover",fnDrag:function(E,F,z,A,C){if(E.which==1){var B=t.scrollTop(),D=t.scrollLeft();w=true;g.trigger=A;F.top+=E.offsetY+B;F.left+=E.offsetX+D;h=F;h.offsetY=E.offsetY;h.offsetX=E.offsetX;h.oriScrollTop=B;h.oriScrollLeft=D;u={top:0,left:0};b.getPanelSpanByCursor(F,y,n,e);t.on("scroll.copy",function(G){if(r!==true){u.top=$(this).scrollTop()-h.oriScrollTop;b.setMover(z,l,h,n._bodySpan,u)}})}else{return false}},fnMove:function(C,D,z,A,B){if(w){l=D;b.setMover(z,l,h,n._bodySpan,u);k=D.top-h.oriScrollTop;f=D.left-h.oriScrollLeft;if(k>q||k<0){j||(j=setInterval(function(){t.scrollTop(t.scrollTop()+(k<0?k:k-q))},10))}else{j&&clearInterval(j);j=null}if(f>x||f<0){v||(v=setInterval(function(){s.scrollLeft(s.scrollLeft()+(f<0?f:f-x))},10))}else{v&&clearInterval(v);v=null}}return false},fnBeginDrop:function(C,D,z,A,B){if(w){v&&clearInterval(v);j&&clearInterval(j);w=h=u=l=r=v=j=k=null;n._copyOp.panel.css({top:C.clientY,left:C.clientX});n._readonly=true;(n._activeEditTr!=null)&&e.clearActiveEditor();b.setPlaceSign(C,D,z,A,B,this);t.off("scroll.copy");z.hide()}return false}};n.handler.scrollX.add(function(B,C,D){if(w){r=true;var A=n._bodySpan,z=g.trigger;h.left=(z.width()>5)?z.position().left+h.offsetX:(n._fzColSet&&n._fzColSet.count?n._fzColSet.width+20:0);u.left=t.scrollLeft()-h.oriScrollLeft;b.getPanelSpanByCursor({top:A.topHeight,left:h.left},y,n,B);b.setMover(p,l,h,n._bodySpan,u)}})},getPanelSpanByCursor:function(h,e,g,f){g._bodySpan={leftWidth:h.left,rightWidth:e.outerWidth()-h.left,topHeight:h.top,bottomHeight:e.outerHeight()-h.top}},setMover:function(f,o,l,p,n){var q=o.top+n.top,g=o.left+ +n.left,k=(q<0)?0:Math.min(q,l.top),e=(g<0)?0:Math.min(g,l.left),h,j;if(q<l.top){h=p.topHeight-k}else{h=Math.min(q-k,p.bottomHeight)}if(g<l.left){j=p.leftWidth-e}else{j=Math.min(g-e,p.rightWidth)}f.css({top:k,left:e,height:h,width:j})},setSinglePlaceSign:function(e,f){var k=f.op,n=k._copyOp,h=k.copyOp,g=Jalor.DataHelper,o,j,l=e.attr("field");if(l){e.addClass("igrid-cell-copy");o=f.getCellRow(e);if(h.renderData){j=h.fnToRenderData?h.fnToRenderData.call(f,e):e.text()}else{j=g.getObj(f.getValueField(l),f.getRowData(o))}n.colCount=n.rowCount=1;n.panel.val(j);Jalor.UI.setInputFocus(n.panel,null,true)}},setPlaceSign:function(E,l,f,x,u,g){var s=g.op,j=s._copyOp,B=s.copyOp,o=Jalor.DataHelper,p=l.left,n=l.top,v=x,C=x.position(),G=g.getColumnIndex(v),A,r=[],y,q,k,w,t,z,D,F,h;if(C.left<l.left){p+=f.width();F=true}if(C.top<l.top){n+=f.height();h=true}do{A=[];do{k=v.attr("field");if(k){v.addClass("igrid-cell-copy");t=g.getCellRow(v);if(B.renderData){y=B.fnToRenderData?B.fnToRenderData.call(g,v):v.text()}else{y=o.getObj(g.getValueField(k),g.getRowData(t))}}if(F){A.push(y);w=v.next()}else{if(k){A.unshift(y)}w=v.prev()}if(w.length){v=w;C=v.position()}else{break}}while(F?(C.left<p):(p<C.left+v.width()));j.colCount=A.length;q=A.join("\t");if(h){r.push(q);z=t.next()}else{r.unshift(q);z=t.prev()}if(z.length){D=z.position();v=g.getRowCell(z,G)}else{break}}while(h?(D.top<n):(n<D.top+z.height()));s.allowMoveCopy&&b.moveCopyData(g);j.rowCount=r.length;j.panel.val(r.join("\n"));Jalor.UI.setInputFocus(j.panel,null,true)},setSelectPanel:function(j,n,o,e){var q=j.position(),h=e.getCellRow(j),l=e.getBodyPanel(),k=0,g=0,f=0,p=0;for(;k<o;k++){f+=j.outerWidth();j=j.next()}for(;g<n;g++){p+=h.outerHeight();h=h.next()}$("#"+e.id+"_copydata_mover").css({top:q.top+l.scrollTop(),left:q.left+l.scrollLeft(),width:f,height:p}).show()},pasteDataEvent:function(j,e,k,h){dataHelper=Jalor.DataHelper;if(j){var q=e.getDataBody().find(".igrid-cell-copy"),y=j.length-1,r,l,p;if(j.substr(y)=="\n"){j=j.substring(0,y)}var v=e.getDataBody().find(".enum.igrid-cell-copy");if(v.length!=0&&j.indexOf("\n")==-1){var n=false;var x=[];x=$("ul[class='list'] li");if(x){for(var t=0;t<x.length;t++){if(j==$(x[t]).text()||j==$(x[t]).attr("val")){j=$(x[t]).attr("val");c="";n=true;break}}if(!n){j=""}}}if(c=="integer"){var w=$(e.getFocusRow()).find(".num");var g=dataHelper.getObj(e.getValueField(w.attr("field")),e.getRowData(w));j=g.toString();c=""}var f=[];for(var t=0;t<q.length;t++){f[e.getColumnOp($(q[t])).field]=e.getColumnOp($(q[t])).field}if(Object.keys(f).length>1&&j.indexOf("\t")==-1){var u=[];for(var o=0;o<Object.keys(f).length;o++){u.push(j)}j=u.toString().replace(",","\t")}r=j.split("\n");if(j.indexOf("\n")==-1){for(var t=0;t<h.rowCount-1;t++){r.push(j)}}l=Math.min(r.length,k.copyOp.maxLine);p=r[0].split("\t").length;if(h.rowCount<l||h.colCount<p){h.panel.data("noClear",true);b.setSelectPanel(q,l,p,e);Jalor.UI.confirm(a.pasteReplace,function(s){h.panel.data("noClear",null).focus();$("#"+e.id+"_copydata_mover").hide();if(s){b.pasteData(r,l,q,e)}else{h.panel.val(h.origData);Jalor.UI.setInputFocus(h.panel,null,true)}},true)}else{b.pasteData(r,l,q,e)}}},pasteData:function(h,p,k,e){var o=e.op,l=o.copyOp,g=e.getColumnIndex(k),j=Jalor.DataHelper,r,f,q,n;$.each(h,function(t,s){if(k.length&&t<p){q=s.split("\t");$.each(q,function(w,u){if(k.length){l.fnToOriginalData&&(u=l.fnToOriginalData.call(e,k,u));n=l.renderData?k.text():j.getObj(e.getValueField(k.attr("field")),e.getRowData(k));var x=$(k[0]);var v=e.getColumnOp(x);if(v.editable!==false){if(!e.op.fnBeforeEdit||e.op.fnBeforeEdit&&e.op.fnBeforeEdit.call(e,e.cellValue(x,v),x,v,e.getRowData(x))!==false){e.updateCellData(x,u,n)}}r=k;k=k.next()}else{k=r;return false}});k=e.getRowCell(e.getCellRow(k.length?k:r).next(),g)}else{return false}});e.getDataBody().attr("tabindex",-1).focus();o.showStatus&&e.updateStatus()},clearCopyCell:function(f,e){e.op._readonly=null;f.removeAttr("tabindex").find(".igrid-cell-copy").removeClass("igrid-cell-copy");e.op.allowMoveCopy&&b.clearMoveCopyData(e)},moveCopyData:function(g){var A=g.getDataBody();if(A.find(".igrid-cell-copy").length!==1){return}var v=g.getBodyPanel(),s=v.height(),z=v.scrollTop(),x=v.offset().top,t=g.getBodyPlace().height(),q=A.find(".igrid-cell-copy:first"),y=q.position(),h=y.top,l=y.left,w=q.outerWidth(),k=q.outerHeight(),n=null,r=null,f=null,u=null;var p=$('<div class="igrid-copy-panel"></div>');var e=$('<div class="igrid-copy-box"></div>');var o={width:w,height:k-1,top:Math.min(Math.max(0,h+z),t-4)-1,left:l-2};var j={top:h+k+z-4,left:l+w-4};p.css(o).appendTo(v);e.css(j).appendTo(v);e.mousedown(function(){v.children(".igrid-copydata-panel").data("noClear",true)}).drag({offset:false,virtual:false,container:v,onDragStart:function(D,E,B,C){j.startTop=v.scrollTop();E.top=E.top+v.scrollTop();j.scrollTop===undefined&&(j.scrollTop=v.scrollTop());$(document.body).css("cursor","move")},onMoving:function(C,D){var B=Math.min(Math.max(0,D.top-j.startTop+v.scrollTop()),t-4);r=B+2-h-j.scrollTop;e.css({top:B});p.css({top:(r>0?o.top:o.top+r),height:(r>0?Math.max(o.height,r):o.height-r)});if(C.pageY>x+s||C.pageY<x){n||(n=setInterval(function(){v.scrollTop(v.scrollTop()+(C.pageY<x?-24:24))},10))}else{n&&clearInterval(n);n=null}return false},onDroped:function(){n&&clearInterval(n);n=null;$(document.body).css("cursor","");var F=q,J=F.parent()[0],C=g.getColumnOp(F),H=g.cellValue(F,C),D=H instanceof Object?{value:"",text:""}:"";nextRow=null,selector="td[_col='{0}']:first".formatValue(q.attr("_col"));if(f&&u!==null){nextRow=f;if(u>0&&r<0){while(nextRow[0]!=J){var I=nextRow.children(selector),B=g.getColumnOp(I);g.cellValue(I,B,D,true);nextRow=nextRow.prev()}}else{if(u>0&&r>0){var E=F.position().top+p.height();while(nextRow[0]!=J&&E<=nextRow.position().top){var I=nextRow.children(selector),B=g.getColumnOp(I);g.cellValue(I,B,D,true);nextRow=nextRow.prev()}}else{if(u<0&&r<0){var G=p.position().top;while(nextRow[0]!=J&&G>=nextRow.position().top+nextRow.height()){var I=nextRow.children(selector),B=g.getColumnOp(I);g.cellValue(I,B,D,true);nextRow=nextRow.next()}}else{if(u<0&&r>0){while(nextRow[0]!=J){var I=nextRow.children(selector),B=g.getColumnOp(I);g.cellValue(I,B,D,true);nextRow=nextRow.next()}}}}}}f=null;u=r;if(r>0){var E=F.position().top+p.height();nextRow=F.parent().next();while(nextRow.length&&E>nextRow.position().top){var I=nextRow.children(selector),B=g.getColumnOp(I);if(B.editable!==false){if(!g.op.fnBeforeEdit||g.op.fnBeforeEdit&&g.op.fnBeforeEdit.call(g,g.cellValue(I,B),I,B,g.getRowData(I))!==false){if(g.cellValue(I,B,H,true)!==false){if(!g.isNewRow(nextRow)){I.addClass("cell-update");I.hasClass(Jalor.UI.IGrid.Const.updated.css)||I.addClass(Jalor.UI.IGrid.Const.updated.css)}}}}f=nextRow;nextRow=nextRow.next()}}else{if(r<0){var G=p.position().top;nextRow=F.parent().prev();while(nextRow.length&&G<nextRow.position().top+nextRow.height()){var I=nextRow.children(selector),B=g.getColumnOp(I);if(B.editable!==false){if(!g.op.fnBeforeEdit||g.op.fnBeforeEdit&&g.op.fnBeforeEdit.call(g,g.cellValue(I,B),I,B,g.getRowData(I))!==false){if(g.cellValue(I,B,H,true)!==false){if(!g.isNewRow(nextRow)){I.addClass("cell-update");I.hasClass(Jalor.UI.IGrid.Const.updated.css)||I.addClass(Jalor.UI.IGrid.Const.updated.css)}}}}f=nextRow;nextRow=nextRow.prev()}}}}});$(document).bind("mouseup.igrid-copy",function(){v.children(".igrid-copydata-panel").removeData("noClear").focus()})},clearMoveCopyData:function(e){$(document).unbind("mouseup.igrid-copy");e.getBodyPanel().children("div.igrid-copy-box,div.igrid-copy-panel").remove()}};Jalor.UI.XControl.addPlugin("XGrid","copyData",{build:function(f,g){if(g.allowCopy){var e={maxLine:100,renderData:false,fnToRenderData:null,fnToOriginalData:null};g.showTip||(g.showTip=true);g.copyOp=g.copyOp?$.extend(e,g.copyOp):e;g._copyOp={};b.initEvent(f,g,g._copyOp);b.initMover(f,g)}}})})(Jalor.UI.IGrid);(function(b){var a=b._Drag={gridDrag:function(f,k){k.dragOp||(k.dragOp={});var d=k.dragOp.container||f.dom,h=f.getDataBody(),c=k.dragOp.fnDrag,j=k.dragOp.fnMove,g=k.dragOp.fnBeginDrop,e=k.dragOp.fnEndDrop;d.addClass("jalor-igrid-drag").drop($.extend(k.dragOp,{clickable:true,panels:h,onDragStart:function(o,q,l,n,p){if(c&&c.call(f,o,q,l,n,p)===false){return false}},onMoving:function(o,q,l,n,p){if(j&&j.call(f,o,q,l,n,p)===false){return false}},onDroped:function(o,q,l,n,p){if(!g||g.call(f,o,q,l,n,p)!==false){e&&e.call(f,o,q,l,n,p)}}}))},commonRowTurn:function(l,p,f,g,r,d){var k=d.op.Storage;if(r.actives){var n=r.actives.item,j=k.dataset,h=d.getRowData(g),o=h._index,q,s,c;if(n){n.before(g);q=d.getRowData(n);s=q._index;j.splice(o,1);if(o<s){s=s-1}j.splice(s,0,h)}else{r.actives.panel.append(g);j.splice(o,1);j.push(h)}d.reload()}}};b.Drag=$.IAdapter();Jalor.UI.XControl.addPlugin("XGrid","drag",{build:function(c,e){if(e.dragObj){var d=b.Drag.get(e.dragObj);d&&d.setOption(c,e);e.handler.complete.add(a.gridDrag)}}});b.Drag.add("row",{setOption:function(d,g){g.dragOp||(g.dragOp={});var c=g.dragOp.fnDrag,e=g.dragOp.fnBeginDrop,f={target:".grid-row",signMode:"ver",offset:true,fnDrag:function(k,n,h,j,l){if(!c||c.call(d,k,n,h,j,l)!==false){h.width(d.dom.width()).text(j.children("td:eq(2)").text())}else{return false}},fnBeginDrop:function(k,n,h,j,l){if(!e||e.call(d,k,n,h,j,l)!==false){a.commonRowTurn(k,n,h,j,l,d)}else{return false}}};$.extend(g.dragOp,f)}})})(Jalor.UI.IGrid);Jalor.doPost=function(a,d,f,e,b,c){Jalor.Core._ajax("POST",a,d,f,e,b,c)};Jalor.doGet=function(a,d,f,e,b,c){Jalor.Core._ajax("GET",a,d,f,e,b,c)};Jalor.doDelete=function(a,d,f,e,b,c){Jalor.Core._ajax("DELETE",a,d,f,e,b,c)};Jalor.doPut=function(a,d,f,e,b,c){Jalor.Core._ajax("PUT",a,d,f,e,b,c)};Jalor.doCreate=Jalor.doPost;Jalor.doUpdate=Jalor.doPut;Jalor.Page._beforeForward=function(){$.dialogClose();Jalor.UI.loading()};Jalor.Page._afterForward=function(){Jalor.UI.loadingClose()};Jalor.Common={};Jalor.Common.formFill=function(e,b,g,d,f,a,c){Jalor.Core._ajax(d?"POST":"GET",b,f,function(h){var j=$(e);j.jsonData(h);g&&g(h,j)},a,c)};Jalor.Common.save=function(a,c,f,e,b,d){Jalor.Core.setActiveForm(d);Jalor.Core._ajax(a?"POST":"PUT",c,f,e,b)};Jalor.Common.formSave=function(d,c,a,e,b){var d=$(d);if(d.valid()){Jalor.Common.save(a,c,d.jsonData(),e,b,d)}};Jalor.Common.gridDel=function(d,c,g,f,b,e){var a=$(d).getJalorGridManager().getSelectedRecords();if(a.length>0){Jalor.UI.confirm((e&&e.confirm)?e.confirm:"jalor.common.message.confdel",g||function(h){if(h){Jalor.doPut(c,a,function(){f?f():$(d).getJalorGridManager().search(1)},b)}})}else{Jalor.UI.showMessage((e&&e.noSelected)?e.noSelected:"jalor.common.message.selectedRecords","warn")}};Jalor.Common.del=function(b,e,f,d,a,c){Jalor.UI.confirm((c&&c.confirm)?c.confirm:"jalor.common.message.confdel",f||function(g){if(g){if(!e||(e!=="object"&&Jalor.DataHelper.isEmpty(e))){Jalor.UI.showMessage((c&&c.noSelected)?c.noSelected:"jalor.common.message.selectedRecords","warn")}else{Jalor.doPut(b,e,function(){d&&d()},a)}}})};Jalor.Common.openPage=function(d,b,a,e){if(!a){a={}}if(a.tab){var c=$(a.tab);if(c.length>0){a.title=d;a.url=b;!a.permitsMany&&(a.tabId=(a.tabIndex||a.tabid||a.tabId||"_addtabitem_default"));a.fnAfterAddItem=e;c.getJalorTabManager().addItem(a)}else{Jalor.Core.log("没有Tab[{0}]对象！".formatValue(a.tab))}}else{Jalor.UI.dialog(b,d,$.extend({width:a.width||550,height:a.height||400,reSizable:a.reSizable||false,callback:e,fnBeforeClose:a.fnBeforeClose,btnAlign:a.btnAlign||Jalor.UI.Config.dialog.btnAlign,buttons:a.buttons},a.dialogOp))}};Jalor.Common.toggle=function(b,a,c,e){var f=$(a).toggle();var d=$(b).toggleClass(c||"expend");if(e){e(!f.css("display")=="none")}};Jalor.Common.toggleScreen=function(b){var a=$(document.body).toggleClass("fullScreen");var c=0;$("#bodyfixed #leftMenuContent").css("position","relative");if(a.hasClass("fullScreen")){c=1;$("#W3AppTop_Header").width("98%");$("#fullScreen_a").text($i18n("jalor.home.label.screen"))}else{$("#W3AppTop_Header").width("980px");$("#fullScreen_a").text($i18n("jalor.home.label.fullscreen"))}$("#bodyfixed #leftMenuContent").css("position","fixed");Jalor.UI.TopMenu&&Jalor.UI.TopMenu.helper.buildTopMenu();Jalor.UI.TopItem&&Jalor.UI.TopItem.helper.buildTopItem();Jalor.UI.Resizes.fire("toggleScreen");!b&&Jalor.Personalized&&Jalor.Personalized.save({common:{wideScreen:c,theme:Jalor.Personalized.global.common.theme||""}},true,"",false)};Jalor.Common.fullScreen=function(){var a=$("#resizeWorkSpace");if(a.hasClass("big-maximize")){a.attr("title",$i18n("jalor.common.widget.normal"));a.addClass("small-maximize");a.removeClass("big-maximize");$("#head_div").hide();$("#foot_div").hide();if(!$("#menuHideNarrow").hasClass("narrow")){$("#midPanel").trigger("click")}a.data("wideScreen",$(document.body).hasClass("fullScreen"));if(!a.data("wideScreen")){Jalor.Common.toggleScreen(true)}}else{$("#head_div").show();$("#foot_div").show();if(!a.data("wideScreen")){Jalor.Common.toggleScreen(true)}if($("#menuHideNarrow").hasClass("narrow")){$("#midPanel").trigger("click")}a.attr("title",$i18n("jalor.common.widget.maximize"));a.addClass("big-maximize");a.removeClass("small-maximize")}};(function($){_jsonDataGetValue=function(elmt,container,currObj,lastAttr){var format=elmt.attr("format"),type=elmt.attr("type"),value=elmt.val();if(type=="radio"){return elmt[0].checked?value:(elmt.attr("uncheckvalue")||"")}else{if(type=="checkbox"){var checked=elmt.attr("checked"),isArray=elmt.attr("isArray"),split=elmt.attr("splitChar")||",";if(currObj&&checked){currObj[lastAttr]=currObj[lastAttr]||(isArray?[]:"");if(typeof currObj[lastAttr]=="string"){currObj[lastAttr]+=currObj[lastAttr]?split+value:value}else{currObj[lastAttr].push(value)}}else{return checked?value:(elmt.attr("uncheckvalue")||"")}}else{if(format&&value&&!elmt.attr("timezoneop")){if(!elmt.attr("convertDate")&&(elmt.attr("showDate")=="false"||elmt.attr("datatype")=="string")){return value}var format=(format=="date"||format=="datetime"||format=="datehm")?null:format;return value.toDate(format)}else{return elmt.jalorGetValue()}}}};_jsonDataSetValue=function(elmt,value){var tagName=elmt[0].tagName,type=elmt[0].type;if(type=="radio"){if(value==elmt[0].value){elmt.attr("checked","checked")}else{if(elmt[0].checked){elmt.removeAttr("checked")}}}else{if(type=="checkbox"){var splitChar=elmt.attr("splitChar")||",";var isArray=elmt.attr("isArray");if(value!==null&&value!==""){var values=isArray?value:(""+value).split(splitChar);for(var i=0;i<values.length;i++){if(values[i]==elmt[0].value){elmt[0].checked=true;return}}elmt.removeAttr("checked")}else{elmt.removeAttr("checked")}}else{if(tagName=="LABEL"){var fmt=elmt.attr("format");if(fmt&&value!==null){value=Jalor.Format.toDate(value).format(Jalor.Config.Format[fmt]||fmt)}if(elmt.hasClass("manytext")){elmt.html((""+value).replace(/&/g,"&#38;").replace(/</g,"&lt;").replace(/\x0d|\x0a/g,"<br>"))}else{elmt.text(value===null?"":value)}}else{if(value||value===0){var fmt=elmt.attr("format");if(fmt){fmt=Jalor.Config.Format[fmt]||fmt;value=Jalor.Format.toDate(value,fmt).format(fmt)}elmt.jalorSetValue(value)}else{elmt.jalorSetValue("")}}}}};$.fn.jsonData=function(data){var elmtName,elmtValue,elmt,curFormat,isStringType,currValue,elmts=data&&data.prototype&&data._elements||this.find(":input[name]").toArray(),i=0,length;if(data&&typeof data=="object"){elmts=elmts.concat(this.find("label[name]").toArray());length=elmts.length;for(;i<length;i++){elmt=$(elmts[i]);elmtName=elmt.attr("name");elmtValue=void 0;try{elmtValue=eval("data."+elmtName)}catch(e){}if(typeof elmtValue!="undefined"){if(elmt.hasClass("jalor-calendar")&&elmtValue){curFormat=elmt.attr("format");curFormat=(curFormat=="date"||curFormat=="datetime"||curFormat=="datehm")?null:curFormat;isStringType=$.type(elmtValue)=="string";currValue=$.type(elmtValue)=="date"?elmtValue:elmtValue.toDate();currValue&&$.type(currValue)=="date"&&(elmtValue=currValue.getUTCTime());isStringType&&(elmtValue=elmtValue.toString())}if((elmt.is("textarea")&&elmt.attr("textarea-maxlength"))||elmt.attr("textarea-maxlength")==0){var textarea_maxlength=elmt.attr("textarea-maxlength")*1,elmtValue_lenght=elmtValue?elmtValue.toString().length:0;if(!isNaN(textarea_maxlength)&&elmtValue_lenght){if(elmtValue_lenght>textarea_maxlength){elmtValue=elmtValue.toString().substring(0,textarea_maxlength)}elmt.next(".textarea-maxlength").find("span.only-count").text(textarea_maxlength-elmtValue.toString().length)}}_jsonDataSetValue(elmt,elmtValue)}}return this}else{var fullObj={},currObj;length=elmts.length;if(typeof data=="function"){fullObj=data.fullObj||{};i=data.currIndex||0}for(;i<length;i++){elmt=$(elmts[i]);elmtName=elmt.attr("name");elmtValue=_jsonDataGetValue(elmt,this);if(!Jalor.DataHelper.isEmpty(elmtValue)){if(elmt.hasClass("jalor-calendar")&&!elmt.attr("timezoneop")){curFormat=elmt.attr("format");curFormat=(curFormat=="date"||curFormat=="datetime"||curFormat=="datehm")?null:curFormat;isStringType=$.type(elmtValue)=="string";currValue=$.type(elmtValue)=="date"?elmtValue:elmtValue.toDate();currValue&&$.type(currValue)=="date"&&(elmtValue=currValue.getUTCTime(8,Jalor.Personalized.global.common.timeZone));isStringType&&(elmtValue=elmtValue.format(curFormat))}currObj=fullObj;var attrs=elmtName.match(/[a-zA-Z0-9_]+/g);if(!attrs){continue}for(var j=0;j<attrs.length-1;j++){if(typeof currObj[attrs[j]]!="object"){currObj=currObj[attrs[j]]=isNaN(attrs[j+1])?{}:[]}else{currObj=currObj[attrs[j]]}}var lastAttr=attrs[attrs.length-1];if(!isNaN(lastAttr)){lastAttr=lastAttr*1}if(elmt[0].type=="checkbox"&&!elmt.attr("uncheckvalue")){_jsonDataGetValue(elmt,this,currObj,lastAttr)}else{currObj[lastAttr]=elmtValue}}if(i&&i%100==0&&i+1<elmts.length&&typeof data=="function"){setTimeout(function(){var fullData=$([]).jsonData($.extend(data,{fullObj:fullObj,currIndex:i+1,_elements:elmts}));if(fullData){data(fullData)}},0);return}}return fullObj}};$.fn.nameChild=function(name){return this.find("[name='"+name+"']")};$.fn.formSetValue=function(name,value){return this.nameChild(name).val(value)}})(jQuery);Jalor.Common.initValidate=function(){$.validator.addTempMethod=function(b,d,c){var a=$.validator.tempMethods;!a&&(a=$.validator.tempMethods=[]);a.push(b);$.validator.addMethod(b,d,c)};$.validator.clearTempMethods=function(){if(this.tempMethods){for(var b=0,a;a=this.tempMethods[b];b++){$.validator.removeRule(a)}this.tempMethods=null}};$.validator.addMethod("max-gap",function(g,f){var a=f.attr("maxGap"),e=f.attr("compareTo"),d=$(e).jalorGetValue(),c=true;if(f.attr("maxGap")&&!isNaN(a)&&e){if(d){var b=d.toDate().addMonth(a*1);if(f.jalorGetValue()){var h=f.jalorGetValue().toDate();c=h-b==0?true:h<b}}else{c=false}}return c});$.validator.addMethod("dateCompare",function(l,f){var c=arguments[2];var j=true;try{var d=$(f);if(c&&c.length>2){var h=($(c[2]).manager().getEditRow($(f)).children('[field="'+c[0]+'"]')).text().replace(/\s/g," ");var b=Jalor.Format.toDate(l);if(h){var a=Jalor.Format.toDate(h);if(c[1]===0){return b<=a}else{if(c[1]){return b>=a}}}else{return true}}else{var n=$(d.attr("compareTo")||c[0]);var k=d.attr("format")||"date";if(l===null||l===""||n.length==0){j=true}else{if(!n.hasClass("dateCompareB")&&d.prop("id")){n.attr("compareTo","#"+d.prop("id"));n.addClass("dateCompareB")}var h=n.val();if(h&&h.toDate()){n.removeClass("error-ctr error");return l.toDate()>=h.toDate()?true:false}}return j}}catch(g){return true}});$.validator.addMethod("dateCompareB",function(c,a){var f=$(a);try{var b=$(f.attr("compareTo"));var g=b.val();if(b.length>0&&c!=""&&g!=""){b.valid(true)}return true}catch(d){return true}});$.validator.addMethod("speczh",function(b){if(b){var a=new RegExp("[<>?!@#$%\\\\\\/]+");return !a.test(b)}return true});$.validator.addMethod("specialch",function(b){if(b){var a=new RegExp("^[a-zA-Z0-9_.-]+$");return a.test(b)}return true});$.validator.addMethod("specialch2",function(b){if(b){var a=new RegExp("^[a-zA-Z0-9_. +@&():?-]+$");return a.test(b)}return true});$.validator.addMethod("filesize",function(d,c,e){if(d){if(/^\d+\.?\d*[BKMGT]?$/i.test(d)){var a=e.maxsize||999999999,b=e.minsize||0;unit=e.unit||"K",currUnit=d[d.search(/[BKMGT]/i)]||unit;d=Jalor.Format.toFileSize(parseFloat(d),unit,currUnit.toUpperCase())||0;return parseFloat(d)<=a*1&&parseFloat(d)>=b*1}else{return false}}return true});$.validator.addMethod("sameValue",function(g,c){try{var b=Jalor.UI.IGrid.Helper.getGridObj(c),d=c.manager().getValue(),f=c.data("caller").attr("val")||c.data("caller").text(),j,a=c.attr("name");if(d!=f){j=b.op.Storage.filter(function(k,e){return(k[a]==d)?true:false});return j.length?false:true}return true}catch(h){return true}})};Jalor._fnInitAjax4Loading=function(){function a(c,e,d){if(d.loading!==false){if(e){$(e).loadingClose()}else{var b=c!=="GET";if(Jalor.Core_ajaxCount[b?"other":"get"]<=0){Jalor.UI.loadingClose(b)}}}}Jalor.Core._Delegates.ajax_before.add("loading",function(d,c,b){if(b.loading!==false){if(c){$(c).loading()}else{Jalor.UI.loading(d.type!=="GET")}}else{Jalor.autoLoading=true}});Jalor.Core._Delegates.ajax_Sucess.add("loadingclose",a);Jalor.Core._Delegates.ajax_Error.add("loadingclose",a)};Jalor._fnCheckBrowser=function(){Jalor.Common.setBrowserVersion();var l=parseInt(workspaceVO.checkBrowser);var j=0,k=1,d=2,c=3;if(l==j){$("#browserVersionTip").remove();return}if(Jalor.Personalized.global.common&&Jalor.Personalized.global.common.lastCheckBrowserDate!="0"){if(Jalor.Core.getServerTime().format("yyyy-MM-dd")==Jalor.Personalized.global.common.lastCheckBrowserDate){$("#browserVersionTip").remove();return}}var o,e,n,a=navigator.userAgent.toLowerCase(),f=[{rule:/(msie\s|trident.*rv:)([\d.]+)/,type:"ie",minVersion:9},{rule:/(chrome)\/([\d.]+)/,type:"chrome",minVersion:28},{rule:/version\/([\d.]+).*(safari)/,type:"safari",minVersion:5},{rule:/(firefox)\/([\d.]+)/,type:"firefox",minVersion:22}];for(var g=0,h;h=f[g];g++){if(o=a.match(h.rule)){e=h.type;n=parseInt(g==2?o[1]:o[2]);o=h.minVersion;break}}var b=[];b.push('<div style="width:100%;height:25px;line-height:25px;z-index:990;position:fixed;background-color:#FFFACD;">');b.push('<span class="i18n" i18nKey="jalor.common.checkBrowser.tip" style="float:left;padding-left:10px;"></span>');b.push('<input type="button" id="closeBrowserBtn" class="i18n" onclick="Jalor.Common.closeCheckBrowser()" i18nKey="jalor.common.checkBrowser.tipBtn" />');b.push("</div>");if((e=="chrome"&&n<o)||(e=="ie"&&$.browser.version<o)||(e=="safari"&&n<o)||(e=="firefox"&&n<o)){switch(l){case k:$("#browserVersionTip").attr("style","width:100%;height:25px;").append(b.join(""));break;case d:$(document.body).html($i18n("jalor.common.checkBrowser.tip")+"<p><a href=\"#\" onclick=\"window.open('', '_self', '');window.top.close()\">Close Window</a>").css("font-size","15px");break;case c:$("#browserVersionTip").attr("style","width:100%;height:25px;").append(b.join(""));$("#closeBrowserBtn").remove();break}}else{if(e!="chrome"&&e!="ie"&&e!="safari"&&e!="firefox"){$("#browserVersionTip").attr("style","width:100%;height:25px;").append(b.join(""))}}};Jalor.Common.closeCheckBrowser=function(){$("#browserVersionTip").remove();Jalor.Personalized.global.common.lastCheckBrowserDate=Jalor.Core.getServerTime().format("yyyy-MM-dd");Jalor.Personalized.save(Jalor.Personalized.global,true,function(){})};Jalor.Common.setBrowserVersion=function(){var a=$.browser.version,b=navigator.userAgent.toLowerCase();if(b.match(/msie ([\d.]+)/)){if(b.indexOf("trident/5.0")>0){a="9"}else{if(b.indexOf("trident/4.0")>0){a="8"}}}$.browser.version=a};Jalor.Common.getFiltersUrl=function(a,b){var c=$(b).manager();if(c.op.showSwitch&&c.op.switchMode=="search"){return a.formatField({filtersStr:c.op.pagerOp&&c.op.pagerOp.pageInf&&c.op.pagerOp.pageInf.filter||encodeURIComponent("[]")})}return a&&c.getFiltersStr?a.formatField({filtersStr:c.getFiltersStr()}):""};Jalor.Component={};Jalor.Component.difLog=function(b,c,a){$(b).jalorLoad("jalor/web/resource/common/component/difLog/difLogContainer.html",function(){$("#view_logs_").click(function(){Jalor.Component.DifLog.showHiddView(c,a)})})};Jalor.Component.openUploadDialog=function(d,c,b,a){if($("div[module='Jalor.Upload.Dialog']").length){return}Jalor.Page.register("Jalor.Upload.Dialog","jalor/upload/support/dialog.html");Jalor.Component.uploadDialogParam=c;Jalor.Common.openPage(d,"Jalor.Upload.Dialog",{height:a||290,width:b||560,fnBeforeClose:function(){if(Jalor.Upload.Dialog&&Jalor.Upload.Dialog.exit){try{Jalor.Upload.Dialog.exit()}catch(f){}}},buttons:[{type:"imgBtn",icon:"cancel",cls:"jalor-icon",text:"jalor.common.label.close",onClick:function(){if(Jalor.Upload.Dialog&&Jalor.Upload.Dialog.closeDialog){Jalor.Core.log("Before close upload dialog");try{Jalor.Upload.Dialog.closeDialog()}catch(f){}}}}]},function(){Jalor.Core.log("Before init upload dialog.");Jalor.Upload.Dialog.init(Jalor.Component.uploadDialogParam);Jalor.Component.uploadDialogParam=null})};Jalor.Component.customUpload=function(a){Jalor.Page.register("Jalor.Upload.Custom","jalor/upload/support/custom.html");Jalor.Core.log("Before init upload custom.");var b=$("#customUpdalodJSdiv");if(b.length==0){window.uploadLoadBack=$.Callbacks();b=$("<div id='customUpdalodJSdiv' style='margin:0px;display:none'></div>").appendTo(document.body);b.jalorLoad("jalor/upload/support/custom.html",function(){Jalor.Upload.Custom.init(a);window.uploadLoadBack.fire()})}else{if(!Jalor.Upload||!Jalor.Upload.Custom){window.uploadLoadBack.add(function(){Jalor.Upload.Custom.init(a)})}else{window.uploadLoadBack.clear();Jalor.Upload.Custom.init(a)}}};Jalor.Component.Excel={};Jalor.Component.Excel.uploadCallback=function(){Jalor.UI.showMessage("jalor.common.message.importUploadSucess","success",null,false,false)};Jalor.Component.Excel.uploadCallback_topBox=function(){Jalor.UI.topBox({css:"callback-topbox",content:"jalor.common.message.importUploadSucess.title",character:"jalor.common.message.importUploadSucess.topBox",forwardUrl:"jalor/async/task/listImport.html",type:"big_com",noTitle:true})};Jalor.Component.Excel.exportCallback=function(){Jalor.UI.showMessage("jalor.common.message.exportSucess","success",null,false,false)};Jalor.Component.Excel.exportCallback_topBox=function(){Jalor.UI.topBox({css:"callback-topbox",content:"jalor.common.message.exportSucess.title",character:"jalor.common.message.exportSucess.topBox",forwardUrl:"jalor/async/task/listExport.html",type:"big_com",noTitle:true})};Jalor.Component.Excel.iexcelExport=function(a,b,c){b=b||10;c=c||0;if(!a||typeof a!="string"){return}if(c>=b){Jalor.Component.Excel.exportCallback();return}setTimeout(function(){Jalor.doGet("services/jalor/task/export/list/page/15/1/%5B%5D?guid={0}".formatURI(a),null,function(e){if(!e.result.length){return}var d=e.result[0];if(d.guid!=null&&d.exportFlag==2){location.href="servlet/iexcelexport?reportName={0}&guid={1}".formatURI(d.tmpName,a)}else{Jalor.Component.Excel.iexcelExport(a,b,++c)}},null,null,false)},2000)};Jalor.Component.popUserInfo=function(e,c){var f=Jalor.Local.getCurrLanguage()==="zh_CN"?"CHN":"ENG";if(typeof(c)==="undefined"){c=IData.Util.getRes("ws/PersonServlet")}var d="";Jalor.Page.register("Jalor.Component.UserInfoPopup","jalor/web/resource/common/component/popup/userInfoPopup.html");var a=$i18n("jalor.security.label.groupViewUser")+":"+e;var b={modal:true,title:a,height:400,width:480};b.callback=function(){Jalor.Component.UserInfoPopup.init({key:e,lang:f,infoURL:c})};b.fnBeforeClose=function(){$("object[classid='clsid:93A44D3B-7CED-454F-BBB4-EE0AA340BB78']").remove()};d=Jalor.UI.dialog("Jalor.Component.UserInfoPopup",a,b)};Jalor.Component.popGroupInfo=function(c){if(typeof(url)==="undefined"){url=IData.Util.getRes("ws/PersonServlet")}var d="";Jalor.Page.register("Jalor.Component.GroupInfoPopup","jalor/web/resource/common/component/popup/groupInfoPopup.html");var a=$i18n("jalor.security.label.groupViewGroup");var b={modal:true,title:a,height:280,width:450};b.callback=function(){Jalor.Component.GroupInfoPopup.init(c)};d=Jalor.UI.dialog("Jalor.Component.GroupInfoPopup",a,b)};Jalor.Component.getPermissionPopupBean=function(a,b,e,d){var c={igrid:true,resKey:"Jalor.security.attribute.PermissionTree",resPath:"jalor/security/attribute/permissionTree.html",title:"jalor.security.label.listPermission",multiSelect:true,isMulti:a,splitChar:b,width:383,height:451,uniqueKey:"value",displayName:"value",selectedItems:d,callback:e};return c};Jalor.Component.popPermissionTree=function(f,c,e,d,b){var a=Jalor.Component.getPermissionPopupBean(f,c,e,d);Jalor.Component.popup($.extend(a,b),$i18n("jalor.security.label.listPermission"),false,383,480)};Jalor.Component.getRolePopupBean=function(d,c){var b=[{header:$i18n("jalor.security.label.roleName"),id:"roleName",isCondition:true},{header:$i18n("jalor.common.label.description"),id:"roleDesc",isCondition:true,width:198},{header:$i18n("jalor.security.role.valid"),id:"status",type:"bool",format:{type:"valid"},align:"center"}];var a={igrid:true,queryParam:{},servicePath:"services/jalor/security/rolePopup/list",uniqueKey:"roleId",columns:b,callback:d,selectedItems:c,displayField:"roleName"};return a};Jalor.Component.getOwnerBeanHtmlAreaProgram=function(d,c){var b=[{header:$i18n("jalor.security.label.displayName"),id:"displayName",isCondition:true},{header:$i18n("jalor.common.label.name"),id:"value",isCondition:true,width:198}];var a={igrid:true,queryParam:{},servicePath:"services/jalor/htmlarea/query/list/HtmlAreaDimension",uniqueKey:"value",columns:b,callback:d,selectedItems:c,displayField:"displayName"};return a};Jalor.Component.getOwnerBeanCustomProgram=function(d,c){var b=[{header:$i18n("jalor.security.label.displayName"),id:"siteNodeId",isCondition:true},{header:$i18n("jalor.common.label.name"),id:"name",isCondition:true,width:198}];var a={igrid:true,queryParam:{},servicePath:"services/jalor/sitemap/all/tree/full",uniqueKey:"tree",columns:b,callback:d,selectedItems:c,displayField:"name"};return a};Jalor.Component.getOwnerBeanUserDimension=function(d,c){var b=[{header:$i18n("jalor.common.label.userAccount"),id:"userAccount",isCondition:true},{header:$i18n("jalor.common.label.userName"),id:"userCN",isCondition:true,width:198}];var a={igrid:true,queryParam:{},servicePath:"services/jalor/security/userPopup/list",uniqueKey:"userId",columns:b,callback:d,selectedItems:c,displayField:"userCN"};return a};Jalor.Component.getOwnerBeanWorkflowTypeDimension=function(d,c){var b=[{header:$i18n("jalor.workflow.label.key"),id:"key",isCondition:true},{header:$i18n("jalor.workflow.label.processtype"),id:"name",isCondition:true,width:198}];var a={igrid:true,queryParam:{},servicePath:"services/jalor/workflow/processPopup/list",uniqueKey:"key",columns:b,callback:d,selectedItems:c,displayField:"name"};return a};Jalor.Component.popupRole=function(c,b,a){Jalor.Component.popup(Jalor.Component.getRolePopupBean(c,b),$i18n("jalor.registry.label.popupTitle"),b&&a!==false&&true)};Jalor.Component.getProgramPopupBean=function(d,c){var a=[{header:$i18n("jalor.program.label.name"),id:"name",isCondition:true},{header:$i18n("jalor.program.label.desc"),id:"description",isCondition:true},{header:$i18n("jalor.program.label.status"),id:"status",type:"bool",format:{type:"valid"}}];var b={igrid:true,queryParam:{},servicePath:"services/jalor/security/programPopup/list",uniqueKey:"programId",columns:a,callback:d,selectedItems:c};return b};Jalor.Component.popupProgram=function(c,b,a){Jalor.Component.popup(Jalor.Component.getProgramPopupBean(c,b),$i18n("jalor.program.poput.title"),b&&a!==false&&true)};Jalor.Component.getGroupPopupBean=function(d,c){var b=[{header:$i18n("jalor.security.label.groupName"),id:"name",isCondition:true},{header:$i18n("jalor.security.label.groupDescription"),id:"areaCode"},{header:$i18n("Owner"),id:"owner.userCN"}];var a={servicePath:"services/jalor/security/groupPopup/list",uniqueKey:"groupId",columns:b,igrid:true,callback:d,selectedItems:c,condRender:function(){return $i18n("jalor.security.label.groupNameDescription")+":<input type='text' style='width:120px' name='name' maxlength='100'/>&nbsp;"}};return a};Jalor.Component.popupUser=function(b,a){Jalor.Component.popup(Jalor.Component.getUserPopupBean(b,a),"jalor.common.label.userSelect",a&&true)};Jalor.Component.popupGroup=function(b,a){Jalor.Component.popup(Jalor.Component.getGroupPopupBean(b,a),$i18n("jalor.security.popup.groupTitle"),a&&true)};Jalor.Component.multiPopupGroup=function(a,c){a=a.split(",");if(!a[a.length-1]){a.pop()}Jalor.Component.popupGroup(b,a);function b(d){var f=[];var e=[];$.each(d,function(g,h){f.push(h.groupId);e.push(h.name)});$(c).parent().find("textarea").val(e.join(","));$(c).parent().find("input[type='hidden']").val(f.join(","))}};Jalor.Component.popup=function(f,h,b,d,j){if(b){d=d||920;minHeight=j||470}else{d=d||550;minHeight=j||460}var e,c,a=b?"Jalor.Component.MultiPopup":"Jalor.Component.SinglePopup";if(f.resKey&&f.resPath){a=f.resKey;Jalor.Page.register(f.resKey,f.resPath)}else{var g=f.igrid?"i":"";Jalor.Page.register("Jalor.Component.SinglePopup","jalor/web/resource/common/component/popup/{0}singlePopup.html".formatText(g));Jalor.Page.register("Jalor.Component.MultiPopup","jalor/web/resource/common/component/popup/{0}multiPopup.html".formatText(g))}c=Jalor.Core.Namespace.register(a);var k={minHeight:minHeight,maxHeight:minHeight+40,width:d,fnBeforeClose:f.beforeClose,callback:function(){var l=Jalor.Core.Namespace.register(a);l.context=c.context;l.init(f);this.dom.find("#focusInputEnd").focus()},cancelClick:true,buttons:[{text:$i18n("jalor.common.button.clearselect"),onClick:function(){f.fnClear()}}]};k=$.extend(k,f.dialogOp);if(f.simpleMode||b||f.resKey){k.okClick=function(){var l=Jalor.Core.Namespace.register(a);l.context=c.context;l.onOk()}}if(typeof f.fnClear!="function"){delete k.buttons}if(f.buttons===null){delete k.okClick}e=Jalor.UI.dialog(a,h,k);if(f.needReturn){return e}};Jalor.Component.getProgramPopupInfoBean=function(e,d,b){var a=[{header:$i18n("jalor.program.label.name"),id:"name",isCondition:true},{header:$i18n("jalor.program.label.desc"),id:"description",isCondition:true},{header:$i18n("jalor.program.label.status"),id:"status",type:"bool",format:{type:"valid"}},{header:$i18n("Owner"),id:"owner",displayField:"owner ? owner.userCN : ''"}];var c={queryParam:b,servicePath:"services/jalor/security/programPopup/list/info",uniqueKey:"programId",columns:a,callback:e,selectedItems:d,displayName:"name"};return c};Jalor.Component.popupProgramInfo4Dimension=function(c,b,a){Jalor.Component.popupProgramInfo(Jalor.Component.getProgramPopupInfoBean(c,a),$i18n("jalor.program.poput.title"),b&&true)};Jalor.Component.popupProgramInfo=function(d,e,c,b,a){d.igrid=true;d.simpleMode=true;if(c){b=b||940;d.resKey="Jalor.security.program.MultiPopupDimensionProgram";d.resPath="jalor/security/program/multiPopupDimensionProgram.html"}else{b=b||800;d.resKey="Jalor.security.program.SinglePopupDimensionProgram";d.resPath="jalor/security/program/singlePopupDimensionProgram.html"}Jalor.Component.popup(d,e,c,b,a)};Jalor.Component.popupTree=function(g,k,h,c,a,j,b){h=h||{};var e=20;if(h.filter!==false){h.filter=true;e=50}var f,d="popTree"+parseInt(Math.random()*100000);a=a||300;j=j||400;var l={width:a,height:j,content:"<ul id='"+d+"' style='width:"+a+"px;height:"+(j-e)+"px;overflow: auto;'></ul>",cancelClick:true,okClick:function(){var n=$("#"+d).getJalorTreeManager();if(c&&c(n.getCheckedNodes()||[])!==false){f.close()}}};if(!h.checkType||h.checkType=="single"){h.checkType="single"}f=Jalor.UI.dialog("",g,$.extend(l,b));return $("#"+d).jalorTree(k,h,function(){h.callback&&h.callback()})};Jalor.Component.Session={};Jalor.Component.Session.openRebuildDialog=function(b,a){if(Jalor.Component.Session.isOpen){Jalor.Core.log("Rebuild dialog already opened.");return}Jalor.Component.Session.isOpen=true;Jalor.Component.Session.fnCallback=b;Jalor.Component.Session.callbackParameter=a;Jalor.Component.Session.dialog=Jalor.UI.dialog("servlet/rebuildSession?domain={0}".formatURI(document.domain),"jalor.common.message.sessionrebuild",{width:625,height:450,load:false,fnBeforeClose:function(){delete Jalor.Component.Session.dialog;delete Jalor.Component.Session.isOpen}});$(".loading,#loading_msg").hide()};Jalor.Component.Session.rebuiltCallback=function(a){Jalor.Component.Session.dialog.close();if(a!=workspaceVO.user.userAccount){Jalor.UI.topBox("jalor.common.message.userChanged");setTimeout(function(){$(window.document.body).loading()},2000);setTimeout(function(){if(workspaceVO.config.enableHomeCache){window.location.reload();return}window.location.href=workspaceVO.contextPath},3000);return}if(typeof Jalor.Component.Session.fnCallback=="function"){Jalor.Component.Session.fnCallback(Jalor.Component.Session.callbackParameter);delete Jalor.Component.Session.fnCallback;delete Jalor.Component.Session.callbackParameter}Jalor.UI.topBox("jalor.common.message.sessionRebuildDone")};Jalor.Component.showHandleError=function(b){var a=$(b).data("msg");var c=window.open("about:blank");c.document.write((a+" ").encode())};Jalor.Component.handleError=function(f,b,j,c,e){Jalor.UI.loadingClose();if(j.status==403){Jalor.Core.log("Before open session rebuild dialog.");Jalor.Component.Session.openRebuildDialog(c,e)}else{if(j.status==401){Jalor.Component.handleNoPermissionEror(f)}else{if(j.status==404){Jalor.UI.showMessage("jalor.common.message.notFoundResouceError","error")}else{if((typeof f=="string")&&f.substring(0,1)=="{"){var g=Jalor.DataHelper.toJson(f);if(g.code==="huawei.jalor5.validator.00010001"){Jalor.Component.handleValidationError(g,c,e)}else{if(g.stackTrace){var a=g.stackTrace;a=a.replaceAll("\n","");a=a.replaceAll("\r","");a=a.replace(/\'/g,"");a=a.replace(/\"/g,"");a=a.replace(/\</g,"");a=a.replace(/\>/g,"");g.message+="<br/><div class='jalor-form-input'><span id='detailLog' class='jalor-button' jalorPermission='Service$Logs.Search$SearchLogInfo' onclick='Jalor.Component.showHandleError(this)'><a class='jalor-icon execute'></a>Detail Log</span></div>"}if(g.code=="unknown"){var d="jalor.common.message.systemExceptionError";var h=$i18n(d);if(h!==d){Jalor.UI.showMessage(h,"error")}else{if(g.stackTrace){Jalor.UI.showMessage(g.message,"error",null,null,false,null);$("#detailLog").jalorHasPermission();$("#detailLog").length&&$("#detailLog").data("msg",a)}else{Jalor.UI.showMessage(g.message,"error")}}}else{if(g.stackTrace){Jalor.UI.showMessage(g.message,"error",null,null,false,null);$("#detailLog").jalorHasPermission()}else{Jalor.UI.showMessage(g.message,"error")}}}}else{Jalor.Core.log(f);Jalor.UI.showMessage("jalor.common.message.unknownError","error")}}}}};Jalor.Component.handleNoPermissionEror=function(b){var a=Jalor.DataHelper.toJson(b);if(a&&a.entity){var c=a.entity.split("$");if(c.length==4&&c[0]!="null"&&c[0]!=workspaceVO.user.currentRole.roleId){Jalor.UI.showMessage("jalor.common.message.roleOrUserChanged","error");return}map=new Jalor.HashMap();Jalor.doGet("services/jalor/registry/query/list/{0}/{1}".formatURI("Jalor.Security.NoPermissionMsg",false),"",function(e){if(Jalor.Component.handleNoPermissionErorDialog){return}for(var d=0;d<e.length;d++){map.put(e[d].name,e[d].value)}if(map.get("MessageType")==1){var f={width:480,height:185,cancelClick:true,fnLoad:function(){Jalor.security.noPermission.noPermissionMessage.init(c[1],c[2],c[3])},fnClose:function(){Jalor.Component.handleNoPermissionErorDialog=null}};Jalor.Page.register("Jalor.security.noPermission.noPermissionMessage","jalor/security/noPermission/noPermissionMessage.html");Jalor.Component.handleNoPermissionErorDialog=Jalor.UI.dialog("Jalor.security.noPermission.noPermissionMessage","jalor.security.label.warmWarn",f)}else{Jalor.UI.showMessage("jalor.common.message.noPrivilegeError","error")}})}else{Jalor.UI.showMessage("jalor.common.message.roleOrUserChanged","error")}};Jalor.Component.handleValidationError=function(f){var l=Jalor.DataHelper.toJson(f.message);if(l.actionErrors.length&&l.actionErrors.length>0){var g="<div></div>";g+=l.actionErrors.join("<br />");for(var c=0;c<l.actionErrors.length;c++){g.append("<ul>"+l.actionErrors[c].encode()+"</ul>")}var e=Jalor.Core.getActiveForm();if(typeof(theForm)==="undefined"){e=Sigma.activeGrid}e.jalorTip(g[0].outerHTML)}if(l.fieldErrors){for(var c=0;c<l.fieldErrors.length;c++){var n=l.fieldErrors[c].fieldName.split(".").pop();var h=l.fieldErrors[c].rowIndex;if(h!=-1){var d=Sigma.activeGrid;var a=d.getColumn(n);var p=d.gridTable.rows.item(h);var k=p.cells[a.getColumnIndex()];d.showValidResult("",l.fieldErrors[c].messages,k,a)}else{var o=l.fieldErrors[c].messages.join("<br />");var e=Jalor.Core.getActiveForm();var b=$("[name='"+n+"']",e);var j=$("<LABEL/>").attr({"for":b.attr("id"),generated:true}).addClass("error").html(o||"");Jalor.UI.toggleValid(false,b,j,true)}}}};Jalor.Core.handleError=Jalor.Component.handleError;Jalor.Component.selectHRDept=function(a){Jalor.Component.selectHR("HRDept",a)};Jalor.Component.selectHRApprover=function(a){Jalor.Component.selectHR("HRApprover",a)};Jalor.Component.selectHR=function(c,b){Jalor.Page.register("Jalor.Component.HRSelector","jalor/web/resource/common/component/idata/HRSelector.html");Jalor.Page.register("Jalor.Component.HRSelector","jalor/web/resource/common/component/idata/HRSelector.html");if(c=="HRApprover"){b.category=b.category||"0301"}var a={width:550,minHeight:400,fnBeforeClose:b.fnBeforeClose,callback:function(){Jalor.Component.HRSelector.init(b,c)},okClick:function(){Jalor.Component.HRSelector.ok()},cancelClick:function(){Jalor.Component.HRSelector.cancel()}};popupDialog=Jalor.UI.dialog("Jalor.Component.HRSelector",c=="HRDept"?"jalor.idata.title.dept":"jalor.idata.title.approver",a)};Jalor.Component.selectCustomer=function(b){Jalor.Page.register("Jalor.Component.Customer","jalor/web/resource/common/component/idata/customer.html");var a={width:550,height:330,fnBeforeClose:b.fnBeforeClose,callback:function(){Jalor.Component.Customer.init(b)},okClick:function(){Jalor.Component.Customer.ok()}};popupDialog=Jalor.UI.dialog("Jalor.Component.Customer","jalor.idata.title.customer",a)};Jalor.Component.selectPBI=function(b){b=b||{};Jalor.Page.register("Jalor.Component.PBI","jalor/web/resource/common/component/idata/pbi.html");var a={width:950,minHeight:300,fnBeforeClose:b.fnBeforeClose,callback:function(){Jalor.Component.PBI.init(b)}};popupDialog=Jalor.UI.dialog("Jalor.Component.PBI","jalor.idata.title.pbi",a)};Jalor.Personalized={_settings:new Jalor.HashMap(),_saveKeys:{},global:{common:{wideScreen:(workspaceVO.config.IsWideScreen==true)?1:0,lang:workspaceVO.currentLanguage,grid:{pageSize:Jalor.UI.Config.pager.defaultSize},lastCheckBrowserDate:0,pushMsg:{enable:1,items:null},infoTipLanguage:workspaceVO.currentLanguage,timeZone:"076+8"}},getPageKey:function(){var a=window.location.href.split("#!");if(a.length>1){return a[1].split("?")[0]}else{return false}},getKeyById:function(b){var a=this.getPageKey();return a?a+"#"+b:false},getCurrPageSettings:function(c){var a=this.getPageKey(),b=null;if(!a){return null}if(c){b=this._settings.get(a+"#"+c);if(!b){b=this._settings.get(a);if(b&&b.grid&&b.grid[c]){b=b.grid[c]}else{if(b&&b[c]){b=b[c]}}}}else{b=this._settings.get(a)}return b},init:function(){var a=Jalor.Personalized.global.common.theme;if(Jalor.Config.Personalized.open){this.global=$.extend(true,this.global,this._settings.get("global"));$("#bodyfixed #leftMenuContent").css("position","relative");if(this.global.common.wideScreen){$(document.body).addClass("fullScreen");setTimeout(function(){$("#fullScreen_a").text($i18n("jalor.home.label.screen"));$("#W3AppTop_Header").width("98%")},0)}else{$("#fullScreen_a").text($i18n("jalor.home.label.fullscreen"));$("#W3AppTop_Header").width("980px");$(document.body).removeClass("fullScreen")}Jalor.UI.Resizes.fire("toggleScreen");$("#bodyfixed #leftMenuContent").css("position","fixed");a&&Jalor.UI.TopMenu&&Jalor.UI.TopMenu.helper.buildTopMenu();a&&Jalor.UI.TopItem&&Jalor.UI.TopItem.helper.buildTopItem();if(this.global.common.grid.pageSize){Jalor.UI.Config.pager.defaultSize=this.global.common.grid.pageSize}}else{Jalor.Personalized=null}},load:function(){var c=workspaceVO.userSettingList||[];for(var a=0;a<c.length;a++){var b=c[a];try{b.settingContent=JSON.parse(b.settingContent);b.settingContent._settingId=b.settingId}catch(d){}this._settings.put(b.settingKey,b.settingContent)}workspaceVO.userSettingList=null},saveSetting:function(g,b,h,f){var c=this.getKeyById(g),e=this._settings.get(c)||{};if(!c){return}var d=$("#profileText"),a=null;d.length&&(a=d.val().trim()+"!"+c);e=f?b:$.extend(e,b);this._settings.put(c,e);if(typeof h=="function"){this.saveItem({settingKey:c,settingContent:JSON.stringify(e)},h);a&&this.saveItem({settingKey:a,settingContent:JSON.stringify(e)},h)}else{this._saveKeys[c]=true;setTimeout(function(){var n=Jalor.Personalized._saveKeys;Jalor.Personalized._saveKeys={};for(var j in n){var l=Jalor.Personalized._settings.get(j);if(!$.isEmptyObject(l)){Jalor.Personalized.saveItem({settingKey:j,settingContent:JSON.stringify(l)},null,false)}}},Jalor.Config.Personalized.delay)}},save:function(d,a,f,e){var b=a?"global":d&&d.historyKey||this.getPageKey(),c=this._settings.get(b);if(!c){c=a?this.global:{}}if(!b){return}if(a&&!d.common.theme){delete c.common.theme}if($.isArray(d)){this._settings.put(b,d)}else{c=$.extend(true,c,d);this._settings.put(b,c)}if(typeof f=="function"){this.saveItem({settingKey:b,settingContent:JSON.stringify(c)},f,e)}else{this._saveKeys[b]=true;setTimeout(function(){var j=Jalor.Personalized._saveKeys;Jalor.Personalized._saveKeys={};for(var g in j){var h=Jalor.Personalized._settings.get(g);Jalor.Personalized.saveItem({settingKey:g,settingContent:JSON.stringify(h)},null,false)}},Jalor.Config.Personalized.delay)}},saveItem:function(a,c,b){if(a.settingContent.length<4000){Jalor.doPost("services/jalor/personalized/setting/createSingle",a,c||$.noop,null,"",b)}},deleteSetting:function(c){var b=this.getCurrPageSettings(),a=this.getCurrPageSettings(c);if(b&&b[c]&&b._settingId){delete b[c];Jalor.doDelete("services/jalor/personalized/setting/delSingle/"+b._settingId,null,$.noop,null,"",false)}if(a){if(a._settingId){Jalor.doDelete("services/jalor/personalized/setting/delSingle/"+a._settingId,null,$.noop,null,"",true)}else{this.saveItem({settingKey:this.getKeyById(c),settingContent:"{}"},$.noop,null,"",true)}this._settings.put(this.getKeyById(c),{})}},gridProcessor:function(c){var d=c.columns||[],b=c.id;var e=this.getCurrPageSettings(b);if(!e){return}var a=e.show,f=e.widths;$.each(d,function(g,h){if(a&&h.hideable!==false){if(a[h.id]){h.hidden=false}else{h.hidden=true}}if(f&&h.resizable!==false){if(f[h.id]){h.width=f[h.id]}}})},iGridProcessor:function(b,e){var c=this.getCurrPageSettings(b.id),d;if(!e._reIniting&&c){if(c.sort!==undefined&&typeof c.sort!="string"){this.deleteSetting(b.id);return}try{Jalor.DataHelper.applyChangeData(e,c,{columns:"field"},function(h,f,j,k,g){if(h=="field"){if(k){if(k.rule&&k.rule.required&&f.hidden){d=true;f.hidden=false}}else{d=true;c.columns.splice(j,1);return false}}})}catch(a){this.deleteSetting(b.id);return}b.setSortSetting();if(e.colsort!==false){b.colsort()}d&&Jalor.Personalized.saveSetting(b.id,c)}},widgetProcessor:function(b,c){var a=this.getCurrPageSettings(b.id);if(a){c._customSettings=a}}};Jalor.Personalized.load();Jalor.History={config:{storage:0,length:10,enable:0},init:function(){try{if(typeof workspaceVO.config.historySettings=="string"){var a=workspaceVO.config.historySettings=Jalor.DataHelper.toJson(workspaceVO.config.historySettings);$.extend(this.config,a)}}catch(b){Jalor.Log.error("数据字典历史记录配置出错")}},saveList:function(d,a,b){if(a.length>10){a=a.slice(0,10)}for(var c=0,e;e=a[c];c++){this.save(d,e[b],null,this.getHistory(d,true))}},save:function(h,g,d,c){if(!h||(!g&&g!==0)){return}var a=false,f=c||this.getHistory(h);for(var e=0,j;j=f[e];e++){if(j.value==g){j.times++;j.time=new Date().getTime();if(d){j.data=d}a=true}}if(!a){while(f.length&&f.length>=this.config.length){f.pop()}f=[{value:g,times:1,time:new Date().getTime(),data:d}].concat(f)}if(this.config.storage=="1"){f.historyKey=h;Jalor.Personalized.save(f,false)}else{var b={history:f,creationDate:new Date().getTime()};Jalor.LocalStorage.setItem(h,JSON.stringify(b))}},getHistory:function(a,b){if(!a){return[]}var d;if(this.config.storage=="1"){d=Jalor.Personalized._settings.get(a)||[]}else{var c=Jalor.LocalStorage.getItem(a);d=c&&Jalor.DataHelper.toJson(c).history||[]}while(d&&d.length>this.config.length){d.pop()}if(!b){Jalor.DataHelper.sort("time","desc",d)}if(this.config.sort=="0"){Jalor.DataHelper.sort("times","desc",d)}return d},delInvalidHistory:function(a,b){if(!a){return}var d=this.getHistory(a);if(Jalor.DataHelper.hasValue(b)){$.each(d,function(e,f){if(f.value==b){d.splice(e,1);return false}})}if(this.config.storage=="1"){d.historyKey=a;Jalor.Personalized.save(d,false)}else{var c={history:d,creationDate:new Date().getTime()};Jalor.LocalStorage.setItem(a,JSON.stringify(c))}},hasHistory:function(b){var a=this.getHistory(b.historyKey||(b.ajax&&b.ajax.url));return a.length>0?true:false},isSupport:function(a){return a.historySupport||this.config.enable&&a.historySupport!==false}};Jalor.History.init();Jalor.Component.Helper={helpers:{},init:function(){if(Jalor.Config.Helper.open&&Jalor.Personalized.global.common.helper!=="0"){Jalor.Core.log("动态帮助启动 将延时请求帮助信息数据-----");setTimeout(function(){Jalor.Core.ajax({url:Jalor.Config.Helper.service,loading:false,sysauto:true,success:function(f){Jalor.Core.log("请求帮助信息数据成功，总帮助数据条数："+f.length);if(f.length>0){workspaceVO.helpers=f;try{var c=Jalor.Component.Helper.helpers;for(var b=0,d;d=f[b];b++){c[d.helperUrl]=Jalor.DataHelper.toJson(d.helperCfg);c[d.helperUrl].helperId=d.helperId}var a=location.hash.substr(2);if(a){Jalor.Component.Helper.showHelper(a,Jalor.Page.getContentPanel())}}catch(g){Jalor.Core.log("helper 数据反序列化出错，可能存在不正常的配置！"+d&&d.helperUrl)}}},error:function(){Jalor.Core.log("请求帮助信息数据失败，发生异常！");return true}})},Jalor.Config.Helper.delayInit)}},showHelper:function(b,a){if(workspaceVO.helpers&&workspaceVO.helpers.length>0){setTimeout(function(){var c=Jalor.Component.Helper.helpers[b.toLowerCase()];if(c&&c.readed!=true&&c.length>0){Jalor.Core.log("准备显示动态帮助,URL:{0}".format(b));Jalor.Component.Helper.showTip(c,0,a,b.toLowerCase())}},0)}},showTip:function(a,e,c,d){if(e===0){Jalor.doPost(Jalor.Config.Helper.readService,{helper:{helperId:a.helperId}},function(){},function(){return true},null,false);a.readed=true}var f=a[e];if(f){Jalor.Core.log("准备显示动态帮助,Target:{0}".format(f.target));var b;if(f.target&&f.target.indexOf("!")==0){b=$(f.target.substr(1))}else{b=c.find(f.target)}b.fadeOut(1000).fadeIn(1000).jalorTip({content:f[workspaceVO.currentLanguage]?f[workspaceVO.currentLanguage]:f.message,action:"once",autoClose:true,fnClose:function(){Jalor.Component.Helper.showTip(a,e+1,c,d)}})}else{Jalor.Component.Helper.helpers[d]=void 0}}};Jalor.Component.PushMsg={handler:$.Callbacks(),dialog:null,currTime:0,intervalId:0,allowGet:true,timerId:0,stopFlag:false,pushMsgParam:{},OutAnnouceTime:null,listen:function(a){if(a){this.currTime=0}if(!this.intervalId){this.intervalId=setInterval(function(){Jalor.Component.PushMsg.stopFlag=false;Jalor.Component.PushMsg.getMessage()},Jalor.Config.PushMsg.alternation)}},getMessage:function(){Jalor.Log.debug("准备处理消息推送.");var a=Jalor.Component.PushMsg;if(document.hasFocus&&!document.hasFocus()&&(!window.webkitNotifications||window.webkitNotifications.checkPermission())){window.clearInterval(a.intervalId);a.intervalId=null;setTimeout(function(){a.getMessage()},3000);return}if(!this.intervalId){a.listen()}if(a.allowGet&&a.currTime<Jalor.Config.PushMsg.maxTime){Jalor.Core.ajax({url:Jalor.Config.PushMsg.service,sysauto:true,loading:false,success:function(f){var e=true,c=Jalor.Component.PushMsg.OutAnnouceTime;if(c&&(new Date()).getTime()-c.getTime()<3600000){e=false}Jalor.Config.PushMsg.open&&Jalor.Component.PushMsg.handler.fire(f);var h=[],b=0;Jalor.Component.PushMsg.currTime++;if(f.length>0){for(var d=0,g;g=f[d];d++){if(g.messageType=="OutAnnouce"&&e){Jalor.Component.PushMsg.OutAnnouceTime=new Date()}else{if(g.messageType=="OutAnnouce"&&!e){continue}}if(g.messageFlag<=2){b++;h.push(g)}}b>0?$("#unReadMsgAccount").html("<label class='jalor-push-message'>"+b+"</label>"):$("#unReadMsgAccount").text("");Jalor.Component.PushMsg.push(h,true)}},error:function(c,d,b){Jalor.Component.PushMsg.error=true;Jalor.Log.warn("请求消息推送服务数据，发生异常！不再请求数据: "+c.responseText);Jalor.Component.PushMsg.stop();return true}})}else{Jalor.Log.debug("消息推送没有启用或者已经到达最大请求次数，本次不请求。")}},stop:function(){window.clearInterval(this.intervalId);window.clearTimeout(this.timerId);this.timerId=this.intervalId=void 0;this.stopFlag=true},push:function(j,k){if((!window.webkitNotifications||window.webkitNotifications.checkPermission())&&(document.hasFocus&&!document.hasFocus())){Jalor.Component.PushMsg.timerId=setTimeout(function(){Jalor.Component.PushMsg.push(j)},3000);return}if(this.stopFlag){this.stopFlag=false;return}this.timerId&&window.clearTimeout(this.timerId);var a=j.pop(),q=[],e=$(window),d=Jalor.Config.PushMsg.delayHide,p;if(!a){return}this.allowGet=false;this.dialog&&this.dialog.remove();var b=a.messageIco&&a.messageIco.length>10?"style=\"overflow:hide;float:left;display:block;background:url('{0}') no-repeat;\"":"";var r=a.messageType&&a.messageType=="OutAnnouce"?"<div class='jalor-dialog-message'><div class='jalor-dialog-image' "+b+"></div><div class='jalor-dialog-content'>{1}</div><input type='button' id='iknow' class='init i18n'  i18nKey='Jalor.push.msg.iknow'/></div>":"<div class='jalor-dialog-message'><div class='jalor-dialog-image' "+b+"></div><div class='jalor-dialog-content'>{1}</div></div>";r=r.formatText(a.messageIco,a.messageTemplate);var n=function(){if(a.readed){Jalor.Component.PushMsg.markReaded(a.messageId);var t=$("#unReadMsgAccount").children();if(!isNaN(t.text())){var s=t.text()*1-1;s>0?t.text(t.text()*1-1):t.remove()}}if(j.length==0){Jalor.Component.PushMsg.allowGet=true}else{Jalor.Component.PushMsg.timerId=setTimeout(function(){Jalor.Component.PushMsg.push(j)},3000)}};if((document.hasFocus&&!document.hasFocus())&&window.webkitNotifications){var o=window.webkitNotifications.checkPermission();if(o==0){var l=window.webkitNotifications.createNotification(a.messageIco,a.messageTitle,$("<div>"+a.messageTemplate+"</div>").text());l.display=function(){};l.onerror=function(){};l.onclose=function(){if(a.readed!==false){a.readed=true}n()};l.onclick=function(){a.readed=true};l.replaceId="Jalor5HomeNotify";setTimeout(function(){l.cancel();if(!a.readed){a.readed=false}},d);l.show();return}else{if(o==1){var h=$("#pushmessage_enable");if(h.length==0){var c=$i18n("jalor.common.label.enableDesktopNotify");var g=$i18n("jalor.common.message.enableDesktopNotify");$("#pushmessage_a").before("<span  id='pushmessage_enable'><a style='color:red' href='javascript:window.webkitNotifications.requestPermission();$(\"#pushmessage_enable\").remove();'>{0}</a> - </span>".format(c));h=$("#pushmessage_enable>a");h.fadeOut().fadeIn().jalorTip({content:g,show:true})}}else{}}}var f=Jalor.UI.dialog(null,a.messageTitle,{width:230,id:"jalor_pushmsg_dialog",height:150,modal:false,target:null,drag:false,fixed:true,show:false,showFoot:false,position:{top:e.height()-200,left:e.width()-250},content:r,fnBeforeClose:n});this.dialog=f.css({top:e.height(),left:e.width()-f.width()-2}).show().animate({top:e.height()-f.height()},500).bind("mouseover",function(){a.readed=true;window.clearTimeout(p||0)}).bind("mouseout",function(){window.clearTimeout(p||0);p=setTimeout(function(){f.animate({top:e.height()},500,function(){f.close()})},d)});f.find("#iknow").bind("click",function(){f.close();Jalor.Core.ajax({url:"services/jalor/cms/handle/message/{0}".formatURI(a.bindItems.cmsVO.id),loading:false,type:"get",success:function(s){}})});p=setTimeout(function(){f.animate({top:e.height()},500,function(){f.close()})},d)},markReaded:function(a){Jalor.doGet(Jalor.Config.PushMsg.markReadedService.formatText(a),null,function(){},null,null,false)},view:function(){var c={height:340,wrap:true,columns:[{field:"messageTemplate",header:"jalor.cms.label.content",width:475,content:"${#thisToMessageTemplate(messageFlag,messageTemplate)}",resizable:false,sortable:false},{field:"creationDate",width:120,header:"jalor.cms.label.pushDate",cssName:"center",type:"date",content:"${#thisToDateBefore(data.creationDate)}",resizable:false}],ajax:{url:Jalor.Config.PushMsg.viewService},pagerOp:{pageInf:{pageSize:10},pageSizes:[10]}};var b;var a={width:650,height:410,buttons:[{text:"jalor.common.label.close",onClick:function(){b.close()}}],content:"<div id='jalorPushMsgDiv'><div style='height:410px;overflow:auto; padding-right:0px;margin:0px;'><div id='msgBody'></div></div></div>".formatValue($i18n("jalor.i18n.label.content"),$i18n("jalor.common.label.creationDate")),fnLoad:function(d){Jalor.Component.PushMsg.push([]);d.find("#msgBody").igrid(c)}};b=Jalor.UI.dialog("","jalor.home.label.mymsg",a);$("#unReadMsgAccount").text("");this.stop();this.allowGet=true},init:function(){if(Jalor.Config.PushMsg.open&&Jalor.Personalized.global.common.pushMsg.enable!=="0"){Jalor.Core._Delegates.ajax_before.add(function(b){if(!b.sysauto){var a=Jalor.Component.PushMsg.currTime;Jalor.Component.PushMsg.currTime=0;if(a>=Jalor.Config.PushMsg.maxTime){Jalor.Component.PushMsg.getMessage()}else{if(!Jalor.Component.PushMsg.error){Jalor.Component.PushMsg.listen(true)}}}});this.render();setTimeout(function(){Jalor.Component.PushMsg.listen(true);Jalor.Component.PushMsg.getMessage()},Jalor.Config.PushMsg.delayLoad)}},render:function(){if(Jalor.UI.TopMenu!=null){b=$("<li title='{0}' class='W3AppTop_li'><span class='W3AppTop_dot' id='pushmessage'  ><a id='pushmessage_a'  href='javascript:Jalor.Component.PushMsg.view();' ><samp  id='pushMessageTitle'>{0}</samp><samp id='unReadMsgAccount' ></samp></a></span></li>".formatValue($i18n("jalor.home.label.mymsg")));b.insertAfter($(".W3AppTop_gray_Bar_Content_right ul li:first").next())}else{var a;if($("#appPushMessagePanel").length>0){a=$("#appPushMessagePanel")}else{a=$(".W3AppTop_Header_search_app")}var b=$("<li title='{0}' ><span class='W3AppTop_dot' id='pushmessage'  ><a id='pushmessage_a'  href='javascript:Jalor.Component.PushMsg.view();' ><samp  id='pushMessageTitle'>{0}</samp><samp id='unReadMsgAccount' ></samp></a></span></li>".formatValue($i18n("jalor.home.label.mymsg")));a.append(b)}}};thisToDateBefore=function(a){return Jalor.Format.toDateBefore(a)};thisToMessageTemplate=function(c,b){var a=(c*1)<2?'<a class="jalor-icon status-new" style="cursor:default;" ></a>':"";return a+b};Jalor.Component.PushMsg.handler.add(function(d){if(d.length==0){$("#leftSiteMapTree").find(".jalor-push-message").remove();return}var c=Jalor.Component.PushMsg.pushMsgParam;for(var b=0,e;e=d[b];b++){var a=e.messageType;if(c[a]==null){c[a]={messageType:a,messageTitle:0,messageReceiver:null,bindEvented:false}}Jalor.Component.PushMsg.trigger(e)}});Jalor.Component.PushMsg.trigger=function(c){var a=c.messageType,b=Jalor.Component.PushMsg.pushMsgParam;if(c.messageTitle==0){$(b[a].messageReceiver,$("#leftSiteMapTree, .push-message-container")).each(function(){$(this).children(".jalor-push-message").remove()});$("> li",$("#leftSiteMapTree")).undelegate("click.message."+a);b[a]={messageType:a,messageTitle:0,messageReceiver:null,bindEvented:false};return}b[a].messageReceiver=c.messageReceiver;b[a].messageTitle=c.messageTitle;$(b[a].messageReceiver,$("#leftSiteMapTree, .push-message-container")).each(function(){var d=$(this);if(d.children(".jalor-push-message").length==0){d.append($.create("label","jalor-push-message").text(b[a].messageTitle))}else{d.children(".jalor-push-message").text(b[a].messageTitle)}});if(!b[a].bindEvented){b[a].bindEvented=true;$("> li",$("#leftSiteMapTree")).delegate("[treenode_a]","click.message."+a,function(){setTimeout(function(){$(b[a].messageReceiver,$("#leftSiteMapTree")).each(function(){var d=$(this);if(d.children(".jalor-push-message").length==0){d.append($.create("label","jalor-push-message").text(b[a].messageTitle))}else{d.children(".jalor-push-message").text(b[a].messageTitle)}})},200)})}};Jalor.Component.PushMsg.triggerByName=function(d){if(Jalor.Config.PushMsg.open){var c=Jalor.Component.PushMsg.pushMsgParam;if(d){for(var a=0,b;b=d[a];a++){c[b]&&c[b].messageReceiver&&Jalor.Component.PushMsg.trigger(c[b])}return}for(var b in c){c[b].messageReceiver&&Jalor.Component.PushMsg.trigger(c[b])}}};Jalor.Component.Lookup={storageData:{maps:{},keys:[]},setTimeoutId:null,storageLangData:{maps:{},keys:[]},setTimeoutLangId:null,getListOneRequest:function(c,d,g,h){if(!h){return}this.reset();g=g||"";d=d||"";var f=""+c+"_&_"+d+g;var b=Jalor.Cache.get("lookup")||{};Jalor.Cache.put("lookup",b);var a=b[f];if(!a){function e(k,l,j){if(Jalor.Component.Lookup[k].maps[c]){Jalor.Component.Lookup[k].maps[c].callbacks.push(h)}else{Jalor.Component.Lookup[k].maps[c]={cacheKey:f,callbacks:[h]};Jalor.Component.Lookup[k].keys.push(c)}clearTimeout(Jalor.Component.Lookup[l]);Jalor.Component.Lookup[l]=setTimeout(function(){var n=Jalor.Component.Lookup[k];Jalor.Component.Lookup[k]={maps:{},keys:[]};Jalor.Core.ajax({url:j.formatURI(n.keys.join(",")),loading:false,success:function(o){$.each(n.keys,function(q,p){$.each(n.maps[p].callbacks,function(s,r){r(o[p])});b[n.maps[p].cacheKey]=o[p]})},error:function(){Jalor.Core.log("lookup 数据查询失败")}})},200)}g?e("storageLangData","setTimeoutLangId","services/jalor/lookup/itemquery/listbycodesFitlerLanguage/{0}"):e("storageData","setTimeoutId","services/jalor/lookup/itemquery/listbycodes/{0}")}else{h(a)}},getLookup3List:function(d,f){this.reset();f=f||"";var c=Jalor.Local.getCurrLanguage();var e=""+d+"_&_"+c+"_&_"+f;var b=Jalor.Cache.get("lookup")||{};Jalor.Cache.put("lookup",b);var a=b[e];if(!a){Jalor.Core.ajax({url:(f?"services/jalor/lookup/itemquery/listbycodesFitlerLanguage/{0}?locale={1}":"services/jalor/lookup/itemquery/listbycodes/{0}").formatURI(d,c),async:false,loading:false,success:function(g){a=g||[];b[e]=a},error:function(){Jalor.Core.log("lookup 数据查询失败")}})}return a},getList:function(c,d,f){this.reset();f=f||"";d=d||"";var e=""+c+"_&_"+d+f;var b=Jalor.Cache.get("lookup")||{};Jalor.Cache.put("lookup",b);var a=b[e];if(!a){Jalor.Core.ajax({url:f?"services/jalor/lookup/itemquery/list/lang/"+c:"services/jalor/lookup/itemquery/list/"+c,async:false,success:function(g){a=g||[];b[e]=a},error:function(){Jalor.Core.log("lookup 数据查询失败")}})}return a},getMap:function(d,f,h){this.reset();f=f||"";var g=""+d+"_&_"+f;var b=Jalor.Cache.get("lookup_map")||{};Jalor.Cache.put("lookup_map",b);var e=b[g];if(!e){e={};var a=Jalor.Cache.get("lookup")[g]||this.getList(d,f,h);for(var c=0;c<a.length;c++){e[a[c].itemCode]=a[c].itemName}b[g]=e}return e},clear:function(){Jalor.Cache.put("lookup",{});Jalor.Cache.put("lookup_map",{})},reset:function(){if(!Jalor.Cache.get("lookup_map")){Jalor.Cache.put("lookup_map",{})}if(!Jalor.Cache.get("lookup")){Jalor.Cache.put("lookup",{})}}};Jalor.Component.InfoTip={targets:{},contents:{},htmlContents:{},template:{},currentDlg:{},hoverMode:false,hoverDlgFlag:false,closeDlgDelayInterval:300,init:function(a){currentDlg={};hoverMode=false;hoverDlgFlag=false;closeDlgDelayInterval=300;if(!Jalor.Config.InfoTip.open){return}this.readable=Jalor.Permission.check("Service$InfoTip$read");if(!this.readable){return}this.editable=Jalor.Permission.check("Service$InfoTip$update,Service$InfoTip$delete,Service$InfoTip$create");a=this.urlSetting(a);this.getTargets(a);if(!this.targets[a]){this.delUselessContent();return}setTimeout(function(){Jalor.Component.InfoTip.setIcon(a);Jalor.Component.InfoTip.setActiveIconStyle()},Jalor.Config.InfoTip.delayInit)},setIcon:function(a){var c={title:$i18n("jalor.common.label.help")},k=Jalor.Component.InfoTip,b="<a class = 'jalor-info-icon jalor-icon ${icon}' title = '${title}' forinfokey = '${source}'></a>",l=k.targets[a][0],e,d=[],g;if(l){if(l.hoverDisplay){hoverMode=true}else{hoverMode=false}g=$(l.target);$.each(g,function(n,o){if(!o.id&&!o.name){return}e=l.moduleKey+"."+(o.id||o.name);$(o).attr("infoKey",e);d.push(e)})}if(d.length==0){return}this.getContents(d);var j,f,h;$.each(g,function(n,o){j=$(o);if(j.length&&!j.hasClass("hasInfoTip")){c.icon="help";c.source=e=j.attr("infoKey");h=k.contents[e];if($.isEmptyObject(h.Chinese)&&$.isEmptyObject(h.English)){if(!k.editable){return true}c.icon="gray-help"}f=$(b.formatField(c));f.data("targetConf",l);if(o.tagName=="SAMP"&&j.parent().hasClass("jalor-form-row")){j.append(f)}else{j.after(f)}j.addClass("hasInfoTip");k.bindIconEvent(f,e)}})},bindIconEvent:function(a,c){a.bind(hoverMode?"mouseenter":"click",function(j){var e={id:"jalor_infoTip",modal:false,infoTip:true,reSizable:true};var d=Jalor.Component.InfoTip,g=d.getTemplate("View"),h=d.contents[c];if($("#jalor_infoTip").find(".jalor-dialog-pinimg.pin").length){d.operateMode(c,"View");d.helpIconSetting(c,null,true)}else{e.top=a.offset().top+20-$(window).scrollTop();e.left=a.offset().left+20;e.content=g;e.fnLoad=function(){a.addClass("active-infotip");d.afterPopupEvent(c,h)};e.fnClose=function(){$(".jalor-info-icon").removeClass("active-infotip")};var k=Jalor.UI.dialog("","jalor.helper.label.help",e);currentDlg=k;k.bind("mouseenter",function(l){hoverDlgFlag=true});k.bind("mouseleave",function(l){hoverDlgFlag=false});if(k.offset().left+k.width()>$(window).width()){k.css({left:"auto",right:15})}}var f=a.data("targetConf");if(f&&((f.permission&&!Jalor.Permission.check(f.permission))||f.editable===false)){$("#jalor-info-operate .edit").remove()}j.stopPropagation()});var b=function(){if(currentDlg&&!hoverDlgFlag){currentDlg.close()}};if(hoverMode){a.bind("mouseleave",function(d){setTimeout(function(){b()},closeDlgDelayInterval);d.stopPropagation()})}},getTargets:function(b){var a=this,c=a.targets[b];if(!c){Jalor.Core.ajax({url:Jalor.Config.InfoTip.service,async:false,loading:false,data:{helperUrl:b},success:function(d){if(d.length>0){try{a.targets[b]=Jalor.DataHelper.toJson(d[0].helperCfg);a.targets.contents=d[0].htmlAreaVOs}catch(f){Jalor.Core.log("infotip数据反序列化出错，可能存在不正常的配置！"+d[0]&&d[0].helperUrl)}}},error:function(){Jalor.Core.log("请求infotip在线帮助信息数据失败，发生异常！")}})}},getContent:function(b){var a="";Jalor.doGet({url:Jalor.Config.InfoTip.contentService.formatURI(b),async:false,loading:false,success:function(c){if(c){Jalor.Component.InfoTip.htmlContents[b]=c;try{a=Jalor.DataHelper.toJson(c.content);!a.Chinese&&(a.Chinese={});!a.English&&(a.English={})}catch(d){Jalor.Core.log("infoTip 数据反序列化出错，可能存在不正常的配置！"+c&&c.name)}}else{a={Chinese:{},English:{}}}}});return a},getContents:function(b){var a=this;for(var d=0;d<a.targets.contents.length;d++){try{var f=a.targets.contents[d];a.contents[f.name]=Jalor.DataHelper.toJson(f.content)||{Chinese:{},English:{}};a.htmlContents[f.name]=f}catch(g){Jalor.Core.log("infotip数据反序列化出错，可能存在不正常的配置！"+f.name)}}if(b.length!=a.contents.length){for(var d=0,c;c=b[d];d++){a.contents[c]||(a.contents[c]={Chinese:{},English:{}})}}},getTemplate:function(b){var a=Jalor.Component.InfoTip.template[b.toLowerCase()];if(!a){Jalor.doGet({url:Jalor.Config.InfoTip.templateService.formatURI("infoTip"+b),async:false,loading:false,success:function(c){a=c.content;Jalor.Component.InfoTip.template[b.toLowerCase()]=a},error:function(){Jalor.Core.log("获得帮助信息模板出错，可能不存在配置！")}})}return a},afterPopupEvent:function(f,b,d){$("#jalorInfoTipKey").jalorSetValue(f);try{$("#jalorInfoListZh").html(Jalor.UI.template($("#jalorInfoTmplZh"),b));$("#jalorInfoListEn").html(Jalor.UI.template($("#jalorInfoTmplEn"),b))}catch(c){Jalor.UI.showMessage($i18n("jalor.common.infotip.error").formatValue(f),"error");return}var a=Jalor.Personalized.global.common.infoTipLanguage;setTimeout(function(){Jalor.UI.init($("#jalor_infoTip"));var e=$("#jalor-info-tab");e.jalorTab({defaultItemId:a}).show();if(!e.manager().type){e.getJalorTabManager().selectItem&&e.getJalorTabManager().selectItem(a)}$("#lang-switch").html(a=="en_US"?"中 文":"English");d!="Edit"&&e.find(".l-tab-links").hide()},100);this.buttonsEvent()},buttonsEvent:function(){$("#lang-switch").click(function(){var a=$(this),d;if(a.html()=="中 文"){d="zh_CN";a.html("English")}else{d="en_US";a.html("中 文")}var b=$("#jalor-info-tab"),e=b.manager(),c=(e.type=="XTab")?e:b.getJalorTabManager();c.selectItem(d);Jalor.Component.InfoTip.savePersonalized(d)});$("#jalor-info-operate .edit").click(function(){var f=Jalor.Component.InfoTip,h=$("#jalor_infoTip").find(".jalor-dialog-pinimg"),e=h.hasClass("pin");h.addClass("editMode pin");var a=$(this),d=$("#jalorInfoTipKey").jalorGetValue(),c=f.htmlContents[d];contentId=c&&c.htmlAreaId;f.operateMode(d,"Edit");opToolbar=$("#jalor-info-operate");if(contentId){var b=$.create("input","delete",null,"button").val("Delete");opToolbar.append(b.click(function(){$("#jalor_infoTip").data("notClose",true);Jalor.UI.confirm($i18n("jalor.common.confirm.sureDelete"),function(k){if(k){Jalor.doDelete(Jalor.Config.InfoTip.deleteService,{htmlAreaId:contentId},function(){f.contents[d]={Chinese:{},English:{}};delete f.htmlContents[d];$("#jalor_infoTip").manager().close();f.helpIconSetting(d,false)})}else{$("#jalor_infoTip").data("notClose",false)}},true)}))}var g=$.create("input","save",null,"button").val("Save");opToolbar.append(g.click(function(){if(h.hasClass("editMode")){e?h.removeClass("editMode"):h.removeClass("editMode pin")}var l=$("#jalor-info-tab"),o=l.find("form.chinese-info").jsonData(),n=l.find("form.english-info").jsonData(),q=$("#jalor_infoTip").find("#jalorInfoTipKey").jalorGetValue(),k={Chinese:o,English:n};k=Jalor.DataHelper.toJsonStr(k);var p=function(){f.operateMode(q,"View",true)};if(contentId){Jalor.doPut(Jalor.Config.InfoTip.editService,$.extend(f.htmlContents[q],{content:k}),p,null,null,false)}else{Jalor.doPost(Jalor.Config.InfoTip.editService,{category:"InfoTip",name:q,content:k,title:"infoTip"},p,null,null,false)}f.helpIconSetting(q,true)}));var j=$.create("input","cancel",null,"button").val("Cancel");opToolbar.append(j.click(function(){if(h.hasClass("editMode")){e?h.removeClass("editMode"):h.removeClass("editMode pin")}f.operateMode(d,"View")}))})},savePersonalized:function(a){Jalor.Personalized.global.common.infoTipLanguage=a;Jalor.Personalized.save(Jalor.Personalized.global,true,function(){},false)},operateMode:function(e,c,d){var a=this.getTemplate(c);if(d){this.contents[e]=this.getContent(e)}var b=this.contents[e];$("#jalor_infoTip").manager().getBody().html(a);this.afterPopupEvent(e,b,c)},urlSetting:function(a){if(a.indexOf("?")>0){a=a.split("?")[0]}return a},helpIconSetting:function(e,a,c){var d=$(".jalor-info-icon"),b=d.filter("[forinfokey='"+e+"']").addClass(c?"active-infotip":"");d.filter("[forinfokey!='"+e+"']").removeClass("active-infotip");if(a!=null){a?b.removeClass("gray-help").addClass("help"):b.removeClass("help").addClass("gray-help")}},setActiveIconStyle:function(){var a=$("#jalorInfoTipKey").jalorGetValue();a&&this.helpIconSetting(a,null,true)},delUselessContent:function(){if($(".jalor-info-icon").length||$("#jalorInfoTipKey").length){return}this.contents={};this.htmlContents={}}};Jalor.Component.FloatBar={init:function(a){a=a||{};this.build(a);this.buildResize(a)},build:function(e){var d=$("#jalor_float_bar");if(!d.length){d=$.create("div","jalor-float-bar jalor-resize","jalor_float_bar");e.css&&d.addClass(e.css);if(e.items){for(var a=0,c;c=e.items[a];a++){d.append(c)}}var b=this.setStyle(e);$(document.body).append(d.css("text-align",e.align||"center").animate(b))}else{d.show()}this._dom=d},buildResize:function(b){var a=this;a._dom.manager().resize=function(){a._dom.animate(a.setStyle(b))}},addItem:function(a){$("#jalor_float_bar").append(a)},removeItem:function(a){$("#jalor_float_bar").find(a).remove()},removeItems:function(){$("#jalor_float_bar").empty()},closeBar:function(){$("#jalor_float_bar").hide()},removeBar:function(){$("#jalor_float_bar").remove()},setStyle:function(g){var f=$("#"+Jalor.Config.Panel.main),e=f.offset().left,d=g.width||f.width(),a=g.height||$("#jalor_float_bar").height()||25,b=g.buttom||workspaceVO.config.IsFixedMenu?$("#foot_div").height():8,c={width:d,height:a,left:e,bottom:b,"line-height":a+"px"};return c}};Jalor.Init.AfterUI.add(function(){Jalor._fnInitI18nMsg4Validator();Jalor._fnInitI18nMsg4Pager();Jalor._fnInitI18nMsg4Others();Jalor._fnInitAjax4Loading();Jalor.Personalized.init();Jalor.UI.Resizes.add(function(){var b=$(".jalor-resize");if(b.length>0){b.each(function(e,c){var d=$(c);d.isVisiable()&&d.manager().resize()})}var a=$("#popupPanel").children(".jalor-selector.jalor-popup:visible");if(a.length){a.each(function(){var c=$(this).data("input"),d=c.manager();d.revisionPosition&&d.revisionPosition()})}});Jalor.UI.Resizes.add(function(){Jalor.UI.clearValidError()})});Jalor.Init.AfterSystem.add(function(){if(!workspaceVO.switchLanguageEnabled){Jalor.Layout.Config.W3MenuSettings.switch_lan=null;delete Jalor.Layout.Config.W3MenuSettings.switch_lan}document.title=$i18n("app.common.label.title");Jalor.Layout.renderHeader();Jalor.Layout.renderLanguageCSS();Jalor.Layout.renderMenu(workspaceVO.leftMenuNode,$("#leftPanel"));Jalor._fnCheckBrowser();Jalor.Common.initValidate();Jalor.Layout.renderRoleSelect()});Jalor.Init.Complete.add(function(){Jalor.ready();Jalor.Page.showMenu();Jalor.Page.showResize();$.history.init(function(a){Jalor.Page.forward(a)});Jalor.Component.PushMsg&&Jalor.Component.PushMsg.init();Jalor.Component.Helper&&Jalor.Component.Helper.init();$(window).resize(function(){Jalor.UI.Resizes.fire("window")})});$(document).ready(function(){Jalor.Permission.init();Jalor.ready(Jalor.UI.init,"全局UI组件初始化");var b=workspaceVO,e=b.config,d=e.appSystemAdmin,a=b.envBean;Jalor.Page.importAppRes(function(){Jalor.Init.AfterCore.fire();Jalor.Init.AfterUI.fire();Jalor.Init.AfterSystem.fire();Jalor.Init.Complete.fire();if(!d){Jalor.UI.dialog(null,"jalor.workflow.label.edit",{id:"appSystemAdminDialog",showCloseImg:false,minHeight:100,fnBeforeClose:function(){if(!workspaceVO.config.appSystemAdmin){return false}},content:'<form id="appSystemAdminForm" class="init jalor-form"><div class="jalor-msg msg-warn"><a class="jalor-msg-icon"></a><span class="i18n" i18nKey="Jalor.App.System"></span></div><div class="jalor-form-body"><ul><li class="jalor-form-row"><samp class="i18n require" i18nKey="jalor.common.label.userAccount"></samp><span class="jalor-form-input"><input id="appSystemAdminUser" type="text" class="init required userAccount" name="value" valueField="userAccount"/></span></li></ul></div></form>',buttons:[{text:"jalor.common.button.ok",icon:"confirm",cls:"jalor-icon",onClick:function(){if(!$("#appSystemAdminForm").valid()){return}var f=$("#appSystemAdminForm").jsonData();workspaceVO.config.appSystemAdmin=f.value;this.close();Jalor.doPost("services/jalor/registry/single/systemAdmin",f,function(){Jalor.UI.topBox("jalor.common.message.success")})}}]}).appendTo(document.body);Jalor.UI.init("#appSystemAdminForm")}});if(e.hwa!="0"){(function(g,j,h,f){j[f]=j[f]||function(){(j[f].q=j[f].q||[]).push(arguments)};setTimeout(function(){try{var n=document.createElement("iframe");(n.frameElement||n).style.cssText="display:none";n.src="javascript:false";var k=document.getElementsByTagName("script")[0];k.parentNode.insertBefore(n,k);var o=n.contentWindow.document;o.open().write("<body onload=\"var js = document.createElement('script');js.src = '"+g+"';document.body.appendChild(js);\">");o.close()}catch(l){}},0)}(a.hwaPath,window,document,"ha"));ha("set","siteId",e.hwaSiteId||a.appName);var c=e.hwaIgnoreRegular;if(c){ha("setIgnore",{ignoreUrl:new RegExp(c)})}}});