# 港口的泊位聚类
## 背景
> 为什么要做泊位的识别？
1. 泊位数据现存资料不易获取
2. 而且资料较为陈旧，海运建设更新速度快
3. 为航次的划分，航运的分析做好基础

> 如果从AIS数据中找到泊位？(模型层面)
> 如果利用Spark做分布式聚类算法? (数据计算层面)

下面主要从这两个角度进行分析

## 如何从AIS数据中找到泊位
### 原始数据是怎么样的？
> 原始数据是AIS(船舶自动识别系统)信号点数据：即一种载船通信设备发出信号，然后基站接收
> AIS数据包括，船的位置，船的速度，船身信息等
### 如何识别
> 这是典型的非监督学习，不存在泊位标签等信息
> 从泊位出发，泊位有什么特点，泊位是船舶停泊的位置
1. 首先需满足船速度小的特点
2. 相比于海上，船分布的范围会比较小(泊位的附近位置)，所以必然导致密度大
> 如此分析，密度聚类的方式是非常适合的
> 密度聚类中 采用DBSCAN聚类有很多优点：
1. DBSCAN在二维聚类上效率很高
2. 不需要指定聚类的类数目
3. 参数有minpts,r两个参数，参数的可调性较高，调节minpts，r可以聚出不规则的形状(k-means就乏力了)
> 所以采用DBSCAN作为泊位识别的算法


## 如何利用Spark做分布式聚类算法
> 首先我们来分析下，Spark需要解决什么问题？
1. 如何获取数据和清洗
2. 如何分区(分布式任务)
3. 分区内如何如何计算
### 如何获取数据和清洗(抽数据模块)
1. 从Hbase中获取数据
2. 数据中是否存在不合理的数据(如有不合理，比如说存在信号偏移量较大的点，删除该点)
3. 按照速度进行过滤(取速度小的信号点)

### 如何分区(分区模块)
> 这是个非常重要的问题，因为这些点的分布太不均匀了，如果我们不做分区映射，默认按照分区的方式
遇到问题：就会出现参数很难选择，而且聚类之后还得面临类的合并问题
如何解决该问题？采取预划分的方法解决了该问题

先做一遍粗处理，将点的分布图拿出来，对当前点计算一个所属小方格(geohash)，将相连的小方格连接起来，会形成一个大方格，每个大方格就是一个分区，对应一个partitionID，然后会记录两份数据：为了数据能够进行分区
1. map1: {geohash: partitionID}，作为分区函数的映射关系
2. map2: {partionID: (pointNum, geohashNum)}
> 数据在进行重新分区时，就会根据第一个映射关系进行分区

### 分区内如何计算(计算模块)
> 遇到问题？DBSCAN的参数怎么设置呢？
全局设置
1. 范围：这个问题一开始没有好的思路，还是从泊位本身出发，为了使两个泊位能够分离，去卫星地图上观察下两个泊位之间的距离
2. 点数：这就得用到映射关系2中的pointNum，该点数越大，表明该分区内船的信号点越多，minpts就得设置大，反之则越小，所以采用pointNum / mean(pointNum)作为系数w，采用一个常用值，然后乘以系数w作为标准化
> 根据计算的参数Minpts，和r进行DBSCAN聚类
